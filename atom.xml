<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Ruan Bekker's Blog]]></title>
  <link href="http://blog.ruanbekker.com/atom.xml" rel="self"/>
  <link href="http://blog.ruanbekker.com/"/>
  <updated>2017-10-11T16:34:20-04:00</updated>
  <id>http://blog.ruanbekker.com/</id>
  <author>
    <name><![CDATA[Ruan]]></name>
    <email><![CDATA[ruan@ruanbekker.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Customize Ubuntu 16 Desktop With Arc Dark Theme]]></title>
    <link href="http://blog.ruanbekker.com/blog/2017/10/11/customize-ubuntu-16-desktop-with-arc-dark-theme/"/>
    <updated>2017-10-11T15:56:10-04:00</updated>
    <id>http://blog.ruanbekker.com/blog/2017/10/11/customize-ubuntu-16-desktop-with-arc-dark-theme</id>
    <content type="html"><![CDATA[<p><img src="https://i.snag.gy/g1ryLn.jpg" alt="" /></p>

<p>So I was running ApricityOS for quite some time, which is a Arch Distibution. But a couple of hours before PyConZa I was trying to do a update and found that their repositories were reporting 404 errors, and turns out they have stopped their project :( . I quite liked ApricityOS, as it&rsquo;s what you will expect when installing Arch with the basic applications and the numix icon/theme pack.</p>

<p>So I decided to use Ubuntu for a change.</p>

<h2>Customizations:</h2>

<p>For the Operating System, I am Ubuntu 16:</p>

<ul>
<li><a href="https://www.ubuntu.com/download/desktop">Ubuntu 16.04 (Operating System)</a></li>
</ul>


<p>For my theme I am using Arc Dark:</p>

<ul>
<li><a href="https://github.com/horst3180/arc-theme">Arch Teme</a> - <a href="https://askubuntu.com/questions/265471/autoreconf-not-found-error-during-making-qemu-1-4-0/490839">autoconf dependency required</a></li>
</ul>


<p><img src="https://i.snag.gy/u5fP4w.jpg" alt="" /></p>

<p>Moka Icon pack for my Icons:</p>

<ul>
<li><a href="https://snwh.org/moka/download">Moka Icon Themes</a></li>
</ul>


<p><img src="https://i.snag.gy/3JPi9W.jpg?nocache=1507753731895" alt="" /></p>

<p>Terminator for my terminal of choice:</p>

<ul>
<li><a href="http://www.linuxandubuntu.com/home/10-best-linux-terminals-for-ubuntu-and-fedora">Terminator Terminal</a></li>
</ul>


<p><img src="https://i.snag.gy/xqgXMc.jpg" alt="" /></p>

<p>And my config:</p>

<figure class='code'><figcaption><span>~/.config/terminator/config </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>global_config<span class="o">]</span>
</span><span class='line'>  <span class="nv">enabled_plugins</span> <span class="o">=</span> LaunchpadCodeURLHandler, APTURLHandler, LaunchpadBugURLHandler
</span><span class='line'>  <span class="nv">sticky</span> <span class="o">=</span> True
</span><span class='line'>  <span class="nv">window_state</span> <span class="o">=</span> maximise
</span><span class='line'><span class="o">[</span>keybindings<span class="o">]</span>
</span><span class='line'><span class="o">[</span>layouts<span class="o">]</span>
</span><span class='line'>  <span class="o">[[</span>default<span class="o">]]</span>
</span><span class='line'>    <span class="o">[[[</span>child1<span class="o">]]]</span>
</span><span class='line'>      <span class="nv">parent</span> <span class="o">=</span> window0
</span><span class='line'>      <span class="nv">profile</span> <span class="o">=</span> default
</span><span class='line'>      <span class="nb">type</span> <span class="o">=</span> Terminal
</span><span class='line'>    <span class="o">[[[</span>window0<span class="o">]]]</span>
</span><span class='line'>      <span class="nv">parent</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span class='line'>      <span class="nb">type</span> <span class="o">=</span> Window
</span><span class='line'>  <span class="o">[[</span>multi<span class="o">]]</span>
</span><span class='line'>    <span class="nv">foreground_color</span> <span class="o">=</span> <span class="s2">&quot;#ffffff&quot;</span>
</span><span class='line'>    <span class="nv">palette</span> <span class="o">=</span> <span class="s2">&quot;#62b9d6:#cc0000:#4e9a06:#c4a000:#3465a4:#75507b:#06989a:#d3d7cf:#77c529:#ef2929:#8ae234:#fce94f:#729fcf:#ad7fa8:#34e2e2:#eeeeec&quot;</span>
</span><span class='line'>    <span class="o">[[[</span>child0<span class="o">]]]</span>
</span><span class='line'>      <span class="nv">order</span> <span class="o">=</span> 0
</span><span class='line'>      <span class="nv">parent</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span class='line'>      <span class="nv">position</span> <span class="o">=</span> 0:25
</span><span class='line'>      <span class="nv">size</span> <span class="o">=</span> 1366, 768
</span><span class='line'>      <span class="nb">type</span> <span class="o">=</span> Window
</span><span class='line'>    <span class="o">[[[</span>child1<span class="o">]]]</span>
</span><span class='line'>      <span class="nv">order</span> <span class="o">=</span> 0
</span><span class='line'>      <span class="nv">parent</span> <span class="o">=</span> child0
</span><span class='line'>      <span class="nv">position</span> <span class="o">=</span> 632
</span><span class='line'>      <span class="nb">type</span> <span class="o">=</span> HPaned
</span><span class='line'>    <span class="o">[[[</span>child2<span class="o">]]]</span>
</span><span class='line'>      <span class="nv">order</span> <span class="o">=</span> 0
</span><span class='line'>      <span class="nv">parent</span> <span class="o">=</span> child1
</span><span class='line'>      <span class="nv">position</span> <span class="o">=</span> 354
</span><span class='line'>      <span class="nb">type</span> <span class="o">=</span> VPaned
</span><span class='line'>    <span class="o">[[[</span>child5<span class="o">]]]</span>
</span><span class='line'>      <span class="nv">order</span> <span class="o">=</span> 1
</span><span class='line'>      <span class="nv">parent</span> <span class="o">=</span> child1
</span><span class='line'>      <span class="nv">position</span> <span class="o">=</span> 354
</span><span class='line'>      <span class="nb">type</span> <span class="o">=</span> VPaned
</span><span class='line'>    <span class="o">[[[</span>terminal3<span class="o">]]]</span>
</span><span class='line'>      <span class="nb">command</span> <span class="o">=</span> top<span class="p">;</span> bash
</span><span class='line'>      <span class="nv">order</span> <span class="o">=</span> 0
</span><span class='line'>      <span class="nv">parent</span> <span class="o">=</span> child2
</span><span class='line'>      <span class="nv">profile</span> <span class="o">=</span> default
</span><span class='line'>      <span class="nb">type</span> <span class="o">=</span> Terminal
</span><span class='line'>    <span class="o">[[[</span>terminal4<span class="o">]]]</span>
</span><span class='line'>      <span class="nb">command</span> <span class="o">=</span> uptime<span class="p">;</span> bash
</span><span class='line'>      <span class="nv">order</span> <span class="o">=</span> 1
</span><span class='line'>      <span class="nv">parent</span> <span class="o">=</span> child2
</span><span class='line'>      <span class="nv">profile</span> <span class="o">=</span> default
</span><span class='line'>      <span class="nb">type</span> <span class="o">=</span> Terminal
</span><span class='line'>    <span class="o">[[[</span>terminal6<span class="o">]]]</span>
</span><span class='line'>      <span class="nb">command</span> <span class="o">=</span> <span class="nb">cd</span> ~/workspace<span class="p">;</span> bash
</span><span class='line'>      <span class="nv">order</span> <span class="o">=</span> 0
</span><span class='line'>      <span class="nv">parent</span> <span class="o">=</span> child5
</span><span class='line'>      <span class="nv">profile</span> <span class="o">=</span> default
</span><span class='line'>      <span class="nb">type</span> <span class="o">=</span> Terminal
</span><span class='line'>    <span class="o">[[[</span>terminal7<span class="o">]]]</span>
</span><span class='line'>      <span class="nb">command</span> <span class="o">=</span> <span class="nb">cd</span> ~/workspace<span class="p">;</span> bash
</span><span class='line'>      <span class="nv">order</span> <span class="o">=</span> 1
</span><span class='line'>      <span class="nv">parent</span> <span class="o">=</span> child5
</span><span class='line'>      <span class="nv">profile</span> <span class="o">=</span> default
</span><span class='line'>      <span class="nb">type</span> <span class="o">=</span> Terminal
</span><span class='line'>  <span class="o">[[</span>simples<span class="o">]]</span>
</span><span class='line'>    <span class="o">[[[</span>child0<span class="o">]]]</span>
</span><span class='line'>      <span class="nv">order</span> <span class="o">=</span> 0
</span><span class='line'>      <span class="nv">parent</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span class='line'>      <span class="nv">position</span> <span class="o">=</span> 0:25
</span><span class='line'>      <span class="nv">size</span> <span class="o">=</span> 715, 694
</span><span class='line'>      <span class="nb">type</span> <span class="o">=</span> Window
</span><span class='line'>    <span class="o">[[[</span>child1<span class="o">]]]</span>
</span><span class='line'>      <span class="nv">order</span> <span class="o">=</span> 0
</span><span class='line'>      <span class="nv">parent</span> <span class="o">=</span> child0
</span><span class='line'>      <span class="nv">position</span> <span class="o">=</span> 348
</span><span class='line'>      <span class="nb">type</span> <span class="o">=</span> VPaned
</span><span class='line'>    <span class="o">[[[</span>terminal2<span class="o">]]]</span>
</span><span class='line'>      <span class="nb">command</span> <span class="o">=</span> <span class="nb">cd</span> ~/workspace<span class="p">;</span> bash
</span><span class='line'>      <span class="nv">order</span> <span class="o">=</span> 0
</span><span class='line'>      <span class="nv">parent</span> <span class="o">=</span> child1
</span><span class='line'>      <span class="nv">profile</span> <span class="o">=</span> default
</span><span class='line'>      <span class="nb">type</span> <span class="o">=</span> Terminal
</span><span class='line'>    <span class="o">[[[</span>terminal3<span class="o">]]]</span>
</span><span class='line'>      <span class="nb">command</span> <span class="o">=</span> <span class="nb">cd</span> ~/workspace<span class="p">;</span> bash
</span><span class='line'>      <span class="nv">order</span> <span class="o">=</span> 1
</span><span class='line'>      <span class="nv">parent</span> <span class="o">=</span> child1
</span><span class='line'>      <span class="nv">profile</span> <span class="o">=</span> default
</span><span class='line'>      <span class="nb">type</span> <span class="o">=</span> Terminal
</span><span class='line'><span class="o">[</span>plugins<span class="o">]</span>
</span><span class='line'><span class="o">[</span>profiles<span class="o">]</span>
</span><span class='line'>  <span class="o">[[</span>default<span class="o">]]</span>
</span><span class='line'>    <span class="nv">background_image</span> <span class="o">=</span> None
</span><span class='line'>    <span class="nv">icon_bell</span> <span class="o">=</span> False
</span><span class='line'>    <span class="nv">scrollback_infinite</span> <span class="o">=</span> True
</span></code></pre></td></tr></table></div></figure>


<p>And to force color prompts:</p>

<figure class='code'><figcaption><span>~/.bashrc</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">force_color_prompt</span><span class="o">=</span>yes
</span></code></pre></td></tr></table></div></figure>


<p>And my Wallpaper:</p>

<ul>
<li><a href="https://www.pixelstalk.net/wp-content/uploads/2016/03/Black-lamborghini-wallpaper-HD.jpg">Lamborghini Wallpaper</a></li>
</ul>


<h2>Other Preferred Applications:</h2>

<ul>
<li><a href="https://www.docker.com/docker-ubuntu">Docker</a> &lt;&ndash; Of course! :D</li>
<li><a href="https://linuxcontainers.org/lxd/getting-started-cli/">LXD</a></li>
<li><a href="https://www.dropbox.com/">Cloud Storage: Dropbox</a></li>
<li><a href="https://www.sublimetext.com/">Text Editor: Sublime Text</a></li>
<li><a href="https://boostnote.io/">Note Taking: Boostnote</a></li>
<li><a href="https://www.nylas.com/nylas-mail/">Mail Client: Nylas</a> and <a href="https://wiki.gnome.org/Apps/Geary">Geary</a></li>
<li><a href="https://www.jetbrains.com/pycharm/">Python IDE: PyCharm</a> (however, I prefer to use VIM :D )</li>
<li><p><a href="https://netbeans.org/">Java IDE: Netbeans</a></p></li>
<li><p>Sysadmin Tools: (htop, netstat, tcpdump, nmap, vnstat, mysql-client, mongo-client, curl, nload, etc)</p></li>
</ul>


<p>I will update this page as I&rsquo;m getting new apps or modifications</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Display PHP Content Through HTML Files]]></title>
    <link href="http://blog.ruanbekker.com/blog/2017/10/11/display-php-content-through-html-files/"/>
    <updated>2017-10-11T02:43:55-04:00</updated>
    <id>http://blog.ruanbekker.com/blog/2017/10/11/display-php-content-through-html-files</id>
    <content type="html"><![CDATA[<p>While I was working with a root index page which is in <code>HTML</code> that had <code>PHP</code> content in, it did not render all of the <code>PHP</code> and some content was displayed as text, instead of rendered.</p>

<h2>The Issue:</h2>

<p>Some <code>PHP</code> content not rendered, as I am seeing this at the top of the page as plain text:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="p">;</span> <span class="nx">somePhpFunction</span><span class="p">();</span> <span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<h2>My Nginx Config:</h2>

<figure class='code'><figcaption><span>nginx.conf</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>http <span class="o">{</span>
</span><span class='line'>    include                     /etc/nginx/mime.types<span class="p">;</span>
</span><span class='line'>    default_type                application/octet-stream<span class="p">;</span>
</span><span class='line'>    sendfile                    on<span class="p">;</span>
</span><span class='line'>    access_log                  /var/log/nginx/access.log<span class="p">;</span>
</span><span class='line'>    keepalive_timeout           3000<span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    proxy_cache_path /var/cache/nginx/ <span class="nv">levels</span><span class="o">=</span>1:2 <span class="nv">keys_zone</span><span class="o">=</span>nginx_cache:10m <span class="nv">max_size</span><span class="o">=</span>16m <span class="nv">inactive</span><span class="o">=</span>60m<span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    server <span class="o">{</span>
</span><span class='line'>        listen                  80<span class="p">;</span>
</span><span class='line'>        root                    /www<span class="p">;</span>
</span><span class='line'>        index                   index.php index.html index.htm<span class="p">;</span>
</span><span class='line'>        server_name             _<span class="p">;</span>
</span><span class='line'>        client_max_body_size    32m<span class="p">;</span>
</span><span class='line'>        error_page              <span class="m">500</span> <span class="m">502</span> <span class="m">503</span> <span class="m">504</span>  /50x.html<span class="p">;</span>
</span><span class='line'>        proxy_cache       nginx_cache<span class="p">;</span>
</span><span class='line'>        add_header        X-Proxy-Cache <span class="s2">&quot;public&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nv">location</span> <span class="o">=</span> /50x.html <span class="o">{</span>
</span><span class='line'>              root              /var/lib/nginx/html<span class="p">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        location ~ <span class="se">\.</span>php<span class="nv">$ </span><span class="o">{</span>
</span><span class='line'>              fastcgi_pass      127.0.0.1:9000<span class="p">;</span>
</span><span class='line'>              fastcgi_index     index.php<span class="p">;</span>
</span><span class='line'>              include           fastcgi.conf<span class="p">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>The Fix:</h2>

<p>a <code>.htaccess</code> had to be placed in my root directory of the website:</p>

<figure class='code'><figcaption><span>.htaccess</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>AddType application/x-httpd-php .html .htm
</span></code></pre></td></tr></table></div></figure>


<p>After that was in place, all of the <code>PHP</code> was rendered</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Sending Mail With SSMTP on Alpine Linux]]></title>
    <link href="http://blog.ruanbekker.com/blog/2017/10/09/sending-mail-with-ssmtp-on-alpine-linux/"/>
    <updated>2017-10-09T16:36:35-04:00</updated>
    <id>http://blog.ruanbekker.com/blog/2017/10/09/sending-mail-with-ssmtp-on-alpine-linux</id>
    <content type="html"><![CDATA[<p>Quick Post on how to use ssmtp on Alpine Linux to Send Mail:</p>

<h2>Update and Install SSMTP</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>apk update
</span><span class='line'><span class="nv">$ </span>apk add ssmtp
</span></code></pre></td></tr></table></div></figure>


<h2>Configure SSMTP</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>cat &gt; /etc/ssmtp/ssmtp.conf <span class="s">&lt;&lt; EOF</span>
</span><span class='line'><span class="s">root=postmaster</span>
</span><span class='line'><span class="s">mailhub=mail.domain.com:25</span>
</span><span class='line'><span class="s">hostname=`hostname`</span>
</span><span class='line'><span class="s">FromLineOverride=YES</span>
</span><span class='line'><span class="s">EOF</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Create the Mail Content</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>cat &gt; mail.txt <span class="s">&lt;&lt; EOF</span>
</span><span class='line'><span class="s">To: recipient@domain.com</span>
</span><span class='line'><span class="s">From: sender@domain.com</span>
</span><span class='line'><span class="s">Subject: Mail with SSMTP</span>
</span><span class='line'>
</span><span class='line'><span class="s">Hello, this is a test mail.</span>
</span><span class='line'><span class="s">EOF</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Testing Mail Delivery</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>ssmtp recipient@domain.com &lt; file.txt
</span></code></pre></td></tr></table></div></figure>


<h2>Related:</h2>

<ul>
<li><a href="https://support.cloud.engineyard.com/hc/en-us/articles/205407478-Set-Up-SSMTP-for-Mail-Relay-to-AuthSMTP">Using Gmail as a Relay Host</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Backup and Restore Mutliple Collections From a Database With MongoDB]]></title>
    <link href="http://blog.ruanbekker.com/blog/2017/10/03/backup-and-restore-mutliple-collections-from-a-database-with-mongodb/"/>
    <updated>2017-10-03T16:42:34-04:00</updated>
    <id>http://blog.ruanbekker.com/blog/2017/10/03/backup-and-restore-mutliple-collections-from-a-database-with-mongodb</id>
    <content type="html"><![CDATA[<p>From a previous post we&rsquo;ve  <a href="http://blog.ruanbekker.com/blog/2017/09/02/setup-a-3-node-mongodb-replica-set-on-ubuntu-16/">Setup a MongoDB Cluster</a>, and in this post we will go through the steps of backing up a database and restoring it to another mongodb cluster.</p>

<p><a href="http://mlab.com/">MLab</a> offers a free Shared MongoDB Hosted Service with a limitation of 500MB, which I will be using to restore my data from my own hosted cluster to the free MLab service.</p>

<h2>Create the MongoDB Backup</h2>

<p>First we will need to create our backup path, and then backup our database, in my case, I am backing up my <code>rocketchat</code> database:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>mkdir -p /opt/backups/mongodb
</span><span class='line'><span class="nv">$ </span>mongodump --host mongodb.example.com --port <span class="m">27017</span> -u &lt;mongouser&gt; --authenticationDatabase &lt;authdb&gt; --db rocketchat --out /opt/backups/mongodb/
</span></code></pre></td></tr></table></div></figure>


<p>Change into the backup directory:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span><span class="nb">cd</span> /opt/backups/mongodb/rocketchat/
</span></code></pre></td></tr></table></div></figure>


<p>You will find the <code>bson</code> and <code>json metadata</code> files for each collection:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>ls -l <span class="p">|</span> awk <span class="s1">&#39;{print $9}&#39;</span> <span class="p">|</span> head -9
</span><span class='line'>custom_emoji.chunks.bson
</span><span class='line'>custom_emoji.chunks.metadata.json
</span><span class='line'>custom_emoji.files.bson
</span><span class='line'>custom_emoji.files.metadata.json
</span><span class='line'>instances.bson
</span><span class='line'>instances.metadata.json
</span><span class='line'>meteor_accounts_loginServiceConfiguration.bson
</span><span class='line'>meteor_accounts_loginServiceConfiguration.metadata.json
</span><span class='line'>...
</span></code></pre></td></tr></table></div></figure>


<h2>Restore MongoDB Database</h2>

<p>We will need to restore all the collections to our new mongodb service, I have created a bash script (<code>restore-mongodb.sh</code>) that will restore each collection to our <code>rocketchat</code> database:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/usr/bin/env bash</span>
</span><span class='line'>
</span><span class='line'><span class="nv">mongo_user</span><span class="o">=</span>&lt;mongouser&gt;
</span><span class='line'><span class="nv">mongo_pass</span><span class="o">=</span>&lt;mongopass&gt;
</span><span class='line'>
</span><span class='line'><span class="k">for</span> file in <span class="sb">`</span>ls <span class="p">|</span> grep bson<span class="sb">`</span>
</span><span class='line'>  <span class="k">do</span>
</span><span class='line'>    <span class="k">for</span> collection in <span class="sb">`</span><span class="nb">echo</span> <span class="nv">$file</span> <span class="p">|</span> sed <span class="s1">&#39;s/.bson//g&#39;</span><span class="sb">`</span>
</span><span class='line'>  <span class="k">do</span>
</span><span class='line'>    mongorestore --host mymongoid.mlab.com --port <span class="m">12345</span> -u <span class="nv">$mongo_user</span> -p <span class="nv">$mongo_pass</span> -d rocketchat -c <span class="nv">$collection</span> <span class="nv">$file</span>
</span><span class='line'>    sleep 2
</span><span class='line'>  <span class="k">done</span>
</span><span class='line'><span class="k">done</span>
</span></code></pre></td></tr></table></div></figure>


<p>Change the permissions of your script to make it executable and execute the script:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>chmod +x restore-mongodb.sh
</span><span class='line'><span class="nv">$ </span>./restore-mongodb.sh
</span><span class='line'>
</span><span class='line'>2017-10-03T22:05:39.138+0200    checking <span class="k">for</span> collection data in custom_emoji.chunks.bson
</span><span class='line'>2017-10-03T22:05:39.159+0200    reading metadata <span class="k">for</span> rocketchat.custom_emoji.chunks from custom_emoji.chunks.metadata.json
</span><span class='line'>2017-10-03T22:05:39.211+0200    restoring rocketchat.custom_emoji.chunks from custom_emoji.chunks.bson
</span><span class='line'>2017-10-03T22:05:39.900+0200    restoring indexes <span class="k">for</span> collection rocketchat.custom_emoji.chunks from metadata
</span><span class='line'>2017-10-03T22:05:39.922+0200    finished restoring rocketchat.custom_emoji.chunks <span class="o">(</span><span class="m">20</span> documents<span class="o">)</span>
</span><span class='line'>2017-10-03T22:05:39.922+0200    <span class="k">done</span>
</span><span class='line'>2017-10-03T22:05:42.188+0200    checking <span class="k">for</span> collection data in custom_emoji.files.bson
</span><span class='line'>2017-10-03T22:05:42.231+0200    reading metadata <span class="k">for</span> rocketchat.custom_emoji.files from custom_emoji.files.metadata.json
</span><span class='line'>2017-10-03T22:05:42.252+0200    restoring rocketchat.custom_emoji.files from custom_emoji.files.bson
</span><span class='line'>2017-10-03T22:05:42.623+0200    restoring indexes <span class="k">for</span> collection rocketchat.custom_emoji.files from metadata
</span><span class='line'>2017-10-03T22:05:42.645+0200    finished restoring rocketchat.custom_emoji.files <span class="o">(</span><span class="m">20</span> documents<span class="o">)</span>
</span><span class='line'>2017-10-03T22:05:42.645+0200    <span class="k">done</span>
</span><span class='line'>...
</span></code></pre></td></tr></table></div></figure>


<h2>Checkout the New MongoDB Database:</h2>

<p>Once the restore has been done, logon to your new mongodb database and have a look at the collections in the database:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>mongo mymongoid.mlab.com:12345/rocketchat -u &lt;mongouser&gt; -p
</span><span class='line'>MongoDB shell version v3.4.7
</span><span class='line'>Enter password:
</span><span class='line'>connecting to: mongodb://mymongoid.mlab.com:12345/rocketchat
</span><span class='line'>MongoDB server version: 3.4.9
</span><span class='line'>
</span><span class='line'>rs-mymongoid:PRIMARY&gt; show collections
</span><span class='line'>_raix_push_app_tokens
</span><span class='line'>_raix_push_notifications
</span><span class='line'>custom_emoji.chunks
</span><span class='line'>custom_emoji.files
</span><span class='line'>instances
</span></code></pre></td></tr></table></div></figure>


<h2>Resources:</h2>

<ul>
<li><a href="https://docs.mongodb.com/manual/reference/program/mongodump/">https://docs.mongodb.com/manual/reference/program/mongodump/</a></li>
<li><a href="https://docs.mongodb.com/manual/reference/program/mongorestore/">https://docs.mongodb.com/manual/reference/program/mongorestore/</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Creating a Nodejs Hostname App With Docker Stacks on Swarm]]></title>
    <link href="http://blog.ruanbekker.com/blog/2017/09/24/creating-a-nodejs-hostname-app-with-docker-stacks-on-swarm/"/>
    <updated>2017-09-24T17:52:51-04:00</updated>
    <id>http://blog.ruanbekker.com/blog/2017/09/24/creating-a-nodejs-hostname-app-with-docker-stacks-on-swarm</id>
    <content type="html"><![CDATA[<p>Create a Nodejs Application that responds GET requests with its Hostname.</p>

<p>Our nodejs application will sit beind a HAProxy Load Balancer, we are mounting the <code>docker.sock</code> from the host to the container, so as we scale our web application, our load balancer is aware of the changes, and scales as we scale our web application.</p>

<h2>Creating the Application:</h2>

<p>Our nodejs application:</p>

<figure class='code'><figcaption><span>app.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">os</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;os&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span> <span class="s1">&#39;text/html&#39;</span><span class="p">});</span>
</span><span class='line'>    <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="err">`</span><span class="nx">My</span> <span class="nx">Hostname</span><span class="o">:</span> <span class="nx">$</span><span class="p">{</span><span class="nx">os</span><span class="p">.</span><span class="nx">hostname</span><span class="p">()}</span><span class="err">\</span><span class="nx">n</span><span class="err">`</span><span class="p">);</span>
</span><span class='line'><span class="p">}).</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8080</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Our Dockerfile:</p>

<figure class='code'><figcaption><span>Dockerfile</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='docker'><span class='line'><span class="k">FROM</span> node:alpine
</span><span class='line'><span class="k">ADD</span> app.js /app.js
</span><span class='line'><span class="k">CMD</span> <span class="o">[</span><span class="s2">&quot;node&quot;</span>, <span class="s2">&quot;/app.js&quot;</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Build and Push to your registry, or you could use my image on Dockerhub: <a href="https://hub.docker.com/r/rbekker87/node-containername/">hub.docker.com/r/rbekker87/node-containername</a></p>

<figure class='code'><figcaption><span>Build and Push</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker login
</span><span class='line'><span class="nv">$ </span>docker build -t &lt;username&gt;/&lt;repo&gt;:&lt;tag&gt; .
</span><span class='line'><span class="nv">$ </span>docker push  &lt;username&gt;/&lt;repo&gt;:&lt;tag&gt;
</span></code></pre></td></tr></table></div></figure>


<h2>Creating the Compose file</h2>

<p>Create the compose file that will define our services:</p>

<figure class='code'><figcaption><span>docker-compose.yml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>version: <span class="s1">&#39;3&#39;</span>
</span><span class='line'>
</span><span class='line'>services:
</span><span class='line'>  node-app:
</span><span class='line'>    image: rbekker87/node-containername
</span><span class='line'>    networks:
</span><span class='line'>      - nodenet
</span><span class='line'>    environment:
</span><span class='line'>      - <span class="nv">SERVICE_PORTS</span><span class="o">=</span>8080
</span><span class='line'>    deploy:
</span><span class='line'>      replicas: 20
</span><span class='line'>      update_config:
</span><span class='line'>        parallelism: 5
</span><span class='line'>        delay: 10s
</span><span class='line'>      restart_policy:
</span><span class='line'>        condition: on-failure
</span><span class='line'>        max_attempts: 3
</span><span class='line'>        window: 120s
</span><span class='line'>
</span><span class='line'>  loadbalancer:
</span><span class='line'>    image: dockercloud/haproxy:latest
</span><span class='line'>    depends_on:
</span><span class='line'>      - node-app
</span><span class='line'>    environment:
</span><span class='line'>      - <span class="nv">BALANCE</span><span class="o">=</span>leastconn
</span><span class='line'>    volumes:
</span><span class='line'>      - /var/run/docker.sock:/var/run/docker.sock
</span><span class='line'>    ports:
</span><span class='line'>      - 80:80
</span><span class='line'>    networks:
</span><span class='line'>      - nodenet
</span><span class='line'>    deploy:
</span><span class='line'>      placement:
</span><span class='line'>        constraints: <span class="o">[</span>node.role <span class="o">==</span> manager<span class="o">]</span>
</span><span class='line'>
</span><span class='line'>networks:
</span><span class='line'>  nodenet:
</span><span class='line'>    driver: overlay
</span></code></pre></td></tr></table></div></figure>


<h2>Create the Stack:</h2>

<p>Deploy the Stack by specifying the compose file and name of our stack:</p>

<figure class='code'><figcaption><span>Deploy our Stack</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker stack deploy -c docker-compose.yml node
</span></code></pre></td></tr></table></div></figure>


<p>List the Services in the Stack:</p>

<figure class='code'><figcaption><span>List Services in our Stack</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker stack ls
</span><span class='line'>NAME                SERVICES
</span><span class='line'>node                2
</span></code></pre></td></tr></table></div></figure>


<p>List the Tasks in the Stack:</p>

<figure class='code'><figcaption><span>Tasks in our Stack</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker stack ps node
</span><span class='line'>ID                  NAME                  IMAGE                                 NODE     DESIRED STATE       CURRENT STATE            ERROR               PORTS
</span><span class='line'>l5ryfaedzzaq        node_loadbalancer.1   dockercloud/haproxy:latest            dsm-01   Running             Running <span class="m">40</span> minutes ago
</span><span class='line'>c8nrrcvek79h        node_node-app.5       rbekker87/node-containername:latest   dsm-01   Running             Running <span class="m">40</span> minutes ago
</span><span class='line'>dqii18b2q5nn        node_node-app.10      rbekker87/node-containername:latest   dsm-01   Running             Running <span class="m">40</span> minutes ago
</span><span class='line'>vkpw2rugy0ah        node_node-app.11      rbekker87/node-containername:latest   dsm-01   Running             Running <span class="m">40</span> minutes ago
</span><span class='line'>mm88nvnvy5lg        node_node-app.12      rbekker87/node-containername:latest   dsm-01   Running             Running <span class="m">40</span> minutes ago
</span><span class='line'>oyx8rfqc1xl2        node_node-app.16      rbekker87/node-containername:latest   dsm-01   Running             Running <span class="m">41</span> minutes ago
</span></code></pre></td></tr></table></div></figure>


<h2>Test out our Application</h2>

<p>Test out the Service:</p>

<figure class='code'><figcaption><span>GET Requests</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>curl -XGET http://127.0.0.1/
</span><span class='line'>My Hostname: a6e34246e73b
</span><span class='line'>
</span><span class='line'><span class="nv">$ </span>curl -XGET http://127.0.0.1/
</span><span class='line'>My Hostname: 5de71278be38
</span><span class='line'>
</span><span class='line'><span class="nv">$ </span>curl -XGET http://127.0.0.1/
</span><span class='line'>My Hostname: e0b7316fdd51
</span></code></pre></td></tr></table></div></figure>


<h2>Scaling Out:</h2>

<p>Scale our Application out to 30 replica&rsquo;s</p>

<figure class='code'><figcaption><span>Scaling Up</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker service scale node-app<span class="o">=</span>30
</span></code></pre></td></tr></table></div></figure>


<p>Scale our Application down to 10 replica&rsquo;s</p>

<figure class='code'><figcaption><span>Scaling Down</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker service scale node-app<span class="o">=</span>10
</span></code></pre></td></tr></table></div></figure>


<h2>Cleanup</h2>

<p>Remove the Stack:</p>

<figure class='code'><figcaption><span>Delete the Stack</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker stack rm node
</span><span class='line'>Removing service node_loadbalancer
</span><span class='line'>Removing service node_node-app
</span><span class='line'>Removing network node_nodenet
</span></code></pre></td></tr></table></div></figure>


<h2>Resources:</h2>

<ul>
<li><a href="https://github.com/ruanbekker/docker-node-containername">https://github.com/ruanbekker/docker-node-containername</a></li>
<li><a href="https://hub.docker.com/r/rbekker87/node-containername/">https://hub.docker.com/r/rbekker87/node-containername/</a></li>
<li><a href="https://medium.com/@nirgn/load-balancing-applications-with-haproxy-and-docker-d719b7c5b231">Resource 1</a> + <a href="http://anokun7.github.io/microservices-demo/">Resource 2</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Create a 3 Node Elasticsearch Stack With HAProxy on Docker Swarm]]></title>
    <link href="http://blog.ruanbekker.com/blog/2017/09/24/create-a-3-node-elasticsearch-stack-with-haproxy-on-docker-swarm/"/>
    <updated>2017-09-24T15:40:19-04:00</updated>
    <id>http://blog.ruanbekker.com/blog/2017/09/24/create-a-3-node-elasticsearch-stack-with-haproxy-on-docker-swarm</id>
    <content type="html"><![CDATA[<p>Tried out creating a 3 node elasticsearch stack on docker swarm using docker-compose, that sits behind a haproxy service.</p>

<h2>Environment:</h2>

<p>Images:</p>

<ul>
<li><a href="https://hub.docker.com/r/dockercloud/haproxy/">dockercloud/haproxy</a></li>
<li><a href="https://github.com/ruanbekker/docker-elasticsearch">rbekker87/elasticsearch:master-5.6-alpine</a></li>
</ul>


<p>Stack:</p>

<ul>
<li>1 x haproxy</li>
<li>1 x elasticsearch master (haproxy wont send requests to this one)</li>
<li>2 x elasticsearch master/data</li>
<li>1 x esnet overlay network</li>
</ul>


<h2>Defining our Stack</h2>

<p>First we will create our compose file, which we will call <code>es-compose.yml</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">version</span><span class="p-Indicator">:</span> <span class="s">&#39;3&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">services</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">es-master</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">image</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">rbekker87/elasticsearch:master-5.6-alpine</span>
</span><span class='line'>    <span class="l-Scalar-Plain">networks</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">esnet</span>
</span><span class='line'>    <span class="l-Scalar-Plain">deploy</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="l-Scalar-Plain">replicas</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">1</span>
</span><span class='line'>
</span><span class='line'>  <span class="l-Scalar-Plain">es-data-1</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">image</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">rbekker87/elasticsearch:master-5.6-alpine</span>
</span><span class='line'>    <span class="l-Scalar-Plain">environment</span><span class="p-Indicator">:</span>
</span><span class='line'>     <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">SERVICE_PORTS=9200</span>
</span><span class='line'>    <span class="l-Scalar-Plain">networks</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">esnet</span>
</span><span class='line'>    <span class="l-Scalar-Plain">deploy</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="l-Scalar-Plain">replicas</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">2</span>
</span><span class='line'>
</span><span class='line'>  <span class="l-Scalar-Plain">es-data-2</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">image</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">rbekker87/elasticsearch:master-5.6-alpine</span>
</span><span class='line'>    <span class="l-Scalar-Plain">environment</span><span class="p-Indicator">:</span>
</span><span class='line'>     <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">SERVICE_PORTS=9200</span>
</span><span class='line'>    <span class="l-Scalar-Plain">networks</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">esnet</span>
</span><span class='line'>    <span class="l-Scalar-Plain">deploy</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="l-Scalar-Plain">replicas</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">2</span>
</span><span class='line'>
</span><span class='line'>  <span class="l-Scalar-Plain">loadbalancer</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">image</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">dockercloud/haproxy:latest</span>
</span><span class='line'>    <span class="l-Scalar-Plain">depends_on</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">es-data-1</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">es-data-2</span>
</span><span class='line'>    <span class="l-Scalar-Plain">environment</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">BALANCE=leastconn</span>
</span><span class='line'>    <span class="l-Scalar-Plain">volumes</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">/var/run/docker.sock:/var/run/docker.sock</span>
</span><span class='line'>    <span class="l-Scalar-Plain">ports</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">9200:80</span>
</span><span class='line'>    <span class="l-Scalar-Plain">networks</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">esnet</span>
</span><span class='line'>    <span class="l-Scalar-Plain">deploy</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="l-Scalar-Plain">placement</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">constraints</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">node.role == manager</span><span class="p-Indicator">]</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">networks</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">esnet</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">driver</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">overlay</span>
</span></code></pre></td></tr></table></div></figure>


<p>The above compose file defines that we want a overlay network, which we will associate with all our services, 3 elasticsearch services, haproxy service which will expose port 9200, then from haproxy it has a container port of 80, which sends to the backend <code>SERVICE_PORTS</code> of each elasticsearch service.</p>

<p>We have only defined <code>SERVICE_PORTS=9200</code> on our es-data services, as I just want to proxy client connections to them.</p>

<h2>Creating our Elasticsearch Stack</h2>

<p>Now that we have our compose file ready, let&rsquo;s create our stack using <code>docker stack deploy</code>:</p>

<figure class='code'><figcaption><span>Create the Stack</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker stack deploy -c es-compose.yml analytics
</span><span class='line'>
</span><span class='line'>Creating network analytics_esnet
</span><span class='line'>Creating service analytics_loadbalancer
</span><span class='line'>Creating service analytics_es-master
</span><span class='line'>Creating service analytics_es-data-1
</span><span class='line'>Creating service analytics_es-data-2
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s have a look at our stack:</p>

<figure class='code'><figcaption><span>Docker Stack Status </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker stack ps analytics
</span><span class='line'>ID                  NAME                       IMAGE                                       NODE                  DESIRED STATE       CURRENT STATE            ERROR               PORTS
</span><span class='line'>4t3ukxl2kch3        analytics_loadbalancer.1   dockercloud/haproxy:latest                  scw-swarm-master-01   Running             Running <span class="m">27</span> seconds ago
</span><span class='line'>jgbxtgqkg9jp        analytics_es-data-2.1      rbekker87/elasticsearch:master-5.6-alpine   scw-swarm-master-01   Running             Running <span class="m">33</span> seconds ago
</span><span class='line'>x5cq6pm7u7mn        analytics_es-data-1.1      rbekker87/elasticsearch:master-5.6-alpine   scw-swarm-master-01   Running             Running <span class="m">36</span> seconds ago
</span><span class='line'>5v22w1hvtdvm        analytics_es-master.1      rbekker87/elasticsearch:master-5.6-alpine   scw-swarm-master-01   Running             Running <span class="m">38</span> seconds ago
</span></code></pre></td></tr></table></div></figure>


<p>View the logs of our haproxy service:</p>

<figure class='code'><figcaption><span>HAProxy Service Logs</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker service logs -f analytics_loadbalancer
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> INFO:haproxy:dockercloud/haproxy 1.6.7 is running outside Docker Cloud
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> INFO:haproxy:Haproxy is running in SwarmMode, loading HAProxy definition through docker api
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> INFO:haproxy:dockercloud/haproxy PID: 7
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> INFO:haproxy:<span class="o">=</span>&gt; Add task: Initial start - Swarm Mode
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> INFO:haproxy:<span class="o">=</span>&gt; Executing task: Initial start - Swarm Mode
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> INFO:haproxy:<span class="o">==========</span><span class="nv">BEGIN</span><span class="o">==========</span>
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> INFO:haproxy:Linked service: analytics_es-data-1, analytics_es-data-2, analytics_es-master
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> INFO:haproxy:Linked container: analytics_es-data-1.1.u641c5bq5vkjklk8sb1scnnlc, analytics_es-data-2.1.ic9an6bzj6aejs0lx0vzfpia6, analytics_es-master.1.h4erlgwzit509p0zehzmozy3u
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> INFO:haproxy:HAProxy configuration:
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> global
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   log 127.0.0.1 local0
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   log 127.0.0.1 local1 notice
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   log-send-hostname
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   maxconn 4096
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   pidfile /var/run/haproxy.pid
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   user haproxy
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   group haproxy
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   daemon
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   stats socket /var/run/haproxy.stats level admin
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   ssl-default-bind-options no-sslv3
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   ssl-default-bind-ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:AES128-GCM-SHA256:AES128-SHA256:AES128-SHA:AES256-GCM-SHA384:AES256-SHA256:AES256-SHA:DHE-DSS-AES128-SHA:DES-CBC3-SHA
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> defaults
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   balance leastconn
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   log global
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   mode http
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   option redispatch
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   option httplog
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   option dontlognull
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   option forwardfor
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   timeout connect 5000
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   timeout client 50000
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   timeout server 50000
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> listen stats
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   <span class="nb">bind</span> :1936
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   mode http
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   stats <span class="nb">enable</span>
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   timeout connect 10s
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   timeout client 1m
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   timeout server 1m
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   stats hide-version
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   stats realm Haproxy<span class="se">\ </span>Statistics
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   stats uri /
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   stats auth stats:stats
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> frontend default_port_80
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   <span class="nb">bind</span> :80
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   reqadd X-Forwarded-Proto:<span class="se">\ </span>http
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   maxconn 4096
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   default_backend default_service
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> backend default_service
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   server analytics_es-data-1.1.u641c5bq5vkjklk8sb1scnnlc 10.0.7.5:9200 check inter <span class="m">2000</span> rise <span class="m">2</span> fall 3
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   server analytics_es-data-2.1.ic9an6bzj6aejs0lx0vzfpia6 10.0.7.7:9200 check inter <span class="m">2000</span> rise <span class="m">2</span> fall 3
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> INFO:haproxy:Launching HAProxy
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> INFO:haproxy:HAProxy has been launched<span class="o">(</span>PID: 10<span class="o">)</span>
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> INFO:haproxy:<span class="o">===========</span><span class="nv">END</span><span class="o">===========</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Testing Elasticsearch:</h2>

<p>Do a GET request on our HAProxy&rsquo;s Expose port: 9200</p>

<figure class='code'><figcaption><span>Test Elasticsearch on port 9200</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>curl -XGET http://127.0.0.1:9200
</span><span class='line'><span class="o">{</span>
</span><span class='line'>  <span class="s2">&quot;name&quot;</span> : <span class="s2">&quot;5306a0c2ee24&quot;</span>,
</span><span class='line'>  <span class="s2">&quot;cluster_name&quot;</span> : <span class="s2">&quot;es-cluster&quot;</span>,
</span><span class='line'>  <span class="s2">&quot;cluster_uuid&quot;</span> : <span class="s2">&quot;FUJmMekFQVq6zXofPCin2A&quot;</span>,
</span><span class='line'>  <span class="s2">&quot;version&quot;</span> : <span class="o">{</span>
</span><span class='line'>    <span class="s2">&quot;number&quot;</span> : <span class="s2">&quot;5.6.0&quot;</span>,
</span><span class='line'>    <span class="s2">&quot;build_hash&quot;</span> : <span class="s2">&quot;781a835&quot;</span>,
</span><span class='line'>    <span class="s2">&quot;build_date&quot;</span> : <span class="s2">&quot;2017-09-07T03:09:58.087Z&quot;</span>,
</span><span class='line'>    <span class="s2">&quot;build_snapshot&quot;</span> : <span class="nb">false</span>,
</span><span class='line'>    <span class="s2">&quot;lucene_version&quot;</span> : <span class="s2">&quot;6.6.0&quot;</span>
</span><span class='line'>  <span class="o">}</span>,
</span><span class='line'>  <span class="s2">&quot;tagline&quot;</span> : <span class="s2">&quot;You Know, for Search&quot;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Have a look at the <code>/_cat/nodes</code> API:</p>

<figure class='code'><figcaption><span>Get the Node Info</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span> curl -XGET http://127.0.0.1:9200/_cat/nodes?v
</span><span class='line'>ip       heap.percent ram.percent cpu load_1m load_5m load_15m node.role master name
</span><span class='line'>10.0.7.6           <span class="m">28</span>          <span class="m">84</span>  <span class="m">14</span>    3.09    2.28     1.49 mdi       -      56c1b0aebc5f
</span><span class='line'>10.0.7.2           <span class="m">27</span>          <span class="m">84</span>  <span class="m">15</span>    3.09    2.28     1.49 mdi       *      572c68bca904
</span><span class='line'>10.0.7.4           <span class="m">29</span>          <span class="m">84</span>  <span class="m">15</span>    3.09    2.28     1.49 mdi       -      5306a0c2ee24
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Simple Program With C Language on Linux]]></title>
    <link href="http://blog.ruanbekker.com/blog/2017/09/24/simple-program-with-c-language-on-linux/"/>
    <updated>2017-09-24T06:41:58-04:00</updated>
    <id>http://blog.ruanbekker.com/blog/2017/09/24/simple-program-with-c-language-on-linux</id>
    <content type="html"><![CDATA[<p>Today the idea popped up on how to write a Simple &ldquo;Hello World&rdquo; Application using C Programming Language, as I just wanted to see how it works.</p>

<h2>Requirements:</h2>

<p>You will need the <code>gcc</code> package to compile the program:</p>

<figure class='code'><figcaption><span>RHEL</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>yum install gcc -y
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Debian</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>apt install gcc -y
</span></code></pre></td></tr></table></div></figure>


<h2>Writing our first Program:</h2>

<p>We will create a app that just prints out a static defined value:</p>

<p>Create any file with a <code>.c</code> extension, in my case it will be <code>app.c</code>:</p>

<figure class='code'><figcaption><span>app.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
</span><span class='line'>    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Hello, World</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now compile <code>app.c</code> with <code>gcc</code> and specify the output path of your app with <code>-o &lt;app-name&gt;</code></p>

<figure class='code'><figcaption><span>app.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="err">$</span> <span class="n">gcc</span> <span class="o">-</span><span class="n">o</span> <span class="n">app</span> <span class="n">app</span><span class="p">.</span><span class="n">c</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Testing our App:</h2>

<p>You will see that there is a executable file with the name that you have specified as the output:</p>

<figure class='code'><figcaption><span>app.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="err">$</span> <span class="p">.</span><span class="o">/</span><span class="n">app</span>
</span><span class='line'><span class="n">Hello</span><span class="p">,</span> <span class="n">World</span>
</span></code></pre></td></tr></table></div></figure>


<p>Really basic, but quite cool.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Using the AWS CLI Tools to Grab CloudWatch Metrics for Elasticsearch]]></title>
    <link href="http://blog.ruanbekker.com/blog/2017/09/22/using-the-aws-cli-tools-to-grab-cloudwatch-metrics-for-elasticsearch/"/>
    <updated>2017-09-22T18:06:23-04:00</updated>
    <id>http://blog.ruanbekker.com/blog/2017/09/22/using-the-aws-cli-tools-to-grab-cloudwatch-metrics-for-elasticsearch</id>
    <content type="html"><![CDATA[<p>Using the AWS CLI Tools to get CloudWatch Metrics for Elasticsearch.</p>

<h2>Elasticsearch:</h2>

<p>List the JVM Memory Pressure Metric:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>aws cloudwatch list-metrics --namespace AWS/ES --metric-name JVMMemoryPressure
</span><span class='line'><span class="o">{</span>
</span><span class='line'>    <span class="s2">&quot;Metrics&quot;</span>: <span class="o">[</span>
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;Namespace&quot;</span>: <span class="s2">&quot;AWS/ES&quot;</span>,
</span><span class='line'>            <span class="s2">&quot;Dimensions&quot;</span>: <span class="o">[</span>
</span><span class='line'>                <span class="o">{</span>
</span><span class='line'>                    <span class="s2">&quot;Name&quot;</span>: <span class="s2">&quot;DomainName&quot;</span>,
</span><span class='line'>                    <span class="s2">&quot;Value&quot;</span>: <span class="s2">&quot;elasticsearch-cluster&quot;</span>
</span><span class='line'>                <span class="o">}</span>,
</span><span class='line'>                <span class="o">{</span>
</span><span class='line'>                    <span class="s2">&quot;Name&quot;</span>: <span class="s2">&quot;ClientId&quot;</span>,
</span><span class='line'>                    <span class="s2">&quot;Value&quot;</span>: <span class="s2">&quot;123456789012&quot;</span>
</span><span class='line'>                <span class="o">}</span>
</span><span class='line'>            <span class="o">]</span>,
</span><span class='line'>            <span class="s2">&quot;MetricName&quot;</span>: <span class="s2">&quot;JVMMemoryPressure&quot;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">]</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Metric: JVMMemoryPressure</h2>

<p>Getting Metrics for JVMMemoryPressure, every 10 Minutes for Max Statistic:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>aws cloudwatch get-metric-statistics --namespace AWS/ES --dimensions <span class="nv">Name</span><span class="o">=</span>DomainName,Value<span class="o">=</span>elasticsearch-cluster <span class="nv">Name</span><span class="o">=</span>ClientId,Value<span class="o">=</span><span class="m">123456789012</span> --metric-name JVMMemoryPressure --start-time 2017-09-08T04:00:00 --end-time 2017-09-08T05:00:00 --period <span class="m">600</span> --statistics Maximum
</span><span class='line'><span class="o">{</span>
</span><span class='line'>    <span class="s2">&quot;Datapoints&quot;</span>: <span class="o">[</span>
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;Timestamp&quot;</span>: <span class="s2">&quot;2017-09-08T04:40:00Z&quot;</span>,
</span><span class='line'>            <span class="s2">&quot;Maximum&quot;</span>: 58.7,
</span><span class='line'>            <span class="s2">&quot;Unit&quot;</span>: <span class="s2">&quot;Percent&quot;</span>
</span><span class='line'>        <span class="o">}</span>,
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;Timestamp&quot;</span>: <span class="s2">&quot;2017-09-08T04:00:00Z&quot;</span>,
</span><span class='line'>            <span class="s2">&quot;Maximum&quot;</span>: 58.5,
</span><span class='line'>            <span class="s2">&quot;Unit&quot;</span>: <span class="s2">&quot;Percent&quot;</span>
</span><span class='line'>        <span class="o">}</span>,
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;Timestamp&quot;</span>: <span class="s2">&quot;2017-09-08T04:30:00Z&quot;</span>,
</span><span class='line'>            <span class="s2">&quot;Maximum&quot;</span>: 58.7,
</span><span class='line'>            <span class="s2">&quot;Unit&quot;</span>: <span class="s2">&quot;Percent&quot;</span>
</span><span class='line'>        <span class="o">}</span>,
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;Timestamp&quot;</span>: <span class="s2">&quot;2017-09-08T04:20:00Z&quot;</span>,
</span><span class='line'>            <span class="s2">&quot;Maximum&quot;</span>: 58.5,
</span><span class='line'>            <span class="s2">&quot;Unit&quot;</span>: <span class="s2">&quot;Percent&quot;</span>
</span><span class='line'>        <span class="o">}</span>,
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;Timestamp&quot;</span>: <span class="s2">&quot;2017-09-08T04:50:00Z&quot;</span>,
</span><span class='line'>            <span class="s2">&quot;Maximum&quot;</span>: 58.7,
</span><span class='line'>            <span class="s2">&quot;Unit&quot;</span>: <span class="s2">&quot;Percent&quot;</span>
</span><span class='line'>        <span class="o">}</span>,
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;Timestamp&quot;</span>: <span class="s2">&quot;2017-09-08T04:10:00Z&quot;</span>,
</span><span class='line'>            <span class="s2">&quot;Maximum&quot;</span>: 58.5,
</span><span class='line'>            <span class="s2">&quot;Unit&quot;</span>: <span class="s2">&quot;Percent&quot;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">]</span>,
</span><span class='line'>    <span class="s2">&quot;Label&quot;</span>: <span class="s2">&quot;JVMMemoryPressure&quot;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Metric: WriteIOPS</h2>

<p>Getting Metrics for WriteIOPS, Every 10 Minutes for Max Statistic:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>aws cloudwatch get-metric-statistics --namespace AWS/ES --dimensions <span class="nv">Name</span><span class="o">=</span>DomainName,Value<span class="o">=</span>elasticsearch-cluster <span class="nv">Name</span><span class="o">=</span>ClientId,Value<span class="o">=</span><span class="m">123456789012</span> --metric-name WriteIOPS --start-time 2017-09-08T04:00:00 --end-time 2017-09-08T05:00:00 --period <span class="m">600</span> --statistics Maximum
</span><span class='line'><span class="o">{</span>
</span><span class='line'>    <span class="s2">&quot;Datapoints&quot;</span>: <span class="o">[</span>
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;Timestamp&quot;</span>: <span class="s2">&quot;2017-09-08T04:30:00Z&quot;</span>,
</span><span class='line'>            <span class="s2">&quot;Maximum&quot;</span>: 0.5266666666666666,
</span><span class='line'>            <span class="s2">&quot;Unit&quot;</span>: <span class="s2">&quot;Count/Second&quot;</span>
</span><span class='line'>        <span class="o">}</span>,
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;Timestamp&quot;</span>: <span class="s2">&quot;2017-09-08T04:00:00Z&quot;</span>,
</span><span class='line'>            <span class="s2">&quot;Maximum&quot;</span>: 0.0,
</span><span class='line'>            <span class="s2">&quot;Unit&quot;</span>: <span class="s2">&quot;Count/Second&quot;</span>
</span><span class='line'>        <span class="o">}</span>,
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;Timestamp&quot;</span>: <span class="s2">&quot;2017-09-08T04:40:00Z&quot;</span>,
</span><span class='line'>            <span class="s2">&quot;Maximum&quot;</span>: 0.09666666666666666,
</span><span class='line'>            <span class="s2">&quot;Unit&quot;</span>: <span class="s2">&quot;Count/Second&quot;</span>
</span><span class='line'>        <span class="o">}</span>,
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;Timestamp&quot;</span>: <span class="s2">&quot;2017-09-08T04:10:00Z&quot;</span>,
</span><span class='line'>            <span class="s2">&quot;Maximum&quot;</span>: 0.0,
</span><span class='line'>            <span class="s2">&quot;Unit&quot;</span>: <span class="s2">&quot;Count/Second&quot;</span>
</span><span class='line'>        <span class="o">}</span>,
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;Timestamp&quot;</span>: <span class="s2">&quot;2017-09-08T04:50:00Z&quot;</span>,
</span><span class='line'>            <span class="s2">&quot;Maximum&quot;</span>: 0.07,
</span><span class='line'>            <span class="s2">&quot;Unit&quot;</span>: <span class="s2">&quot;Count/Second&quot;</span>
</span><span class='line'>        <span class="o">}</span>,
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;Timestamp&quot;</span>: <span class="s2">&quot;2017-09-08T04:20:00Z&quot;</span>,
</span><span class='line'>            <span class="s2">&quot;Maximum&quot;</span>: 0.0,
</span><span class='line'>            <span class="s2">&quot;Unit&quot;</span>: <span class="s2">&quot;Count/Second&quot;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">]</span>,
</span><span class='line'>    <span class="s2">&quot;Label&quot;</span>: <span class="s2">&quot;WriteIOPS&quot;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Metric: FreeStorageSpace</h2>

<p>Getting Metrics for FreeStorageSpace in Megabytes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>aws cloudwatch get-metric-statistics --namespace AWS/ES --dimensions <span class="nv">Name</span><span class="o">=</span>DomainName,Value<span class="o">=</span>elasticsearch-cluster <span class="nv">Name</span><span class="o">=</span>ClientId,Value<span class="o">=</span><span class="m">123456789012</span> --metric-name FreeStorageSpace --start-time 2017-09-11T05:00:00 --end-time 2017-09-11T06:00:00 --period <span class="m">600</span> --statistics Minimum --unit Megabytes
</span><span class='line'><span class="o">{</span>
</span><span class='line'>    <span class="s2">&quot;Datapoints&quot;</span>: <span class="o">[</span>
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;Timestamp&quot;</span>: <span class="s2">&quot;2017-09-11T05:50:00Z&quot;</span>,
</span><span class='line'>            <span class="s2">&quot;Minimum&quot;</span>: 25510.438,
</span><span class='line'>            <span class="s2">&quot;Unit&quot;</span>: <span class="s2">&quot;Megabytes&quot;</span>
</span><span class='line'>        <span class="o">}</span>,
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;Timestamp&quot;</span>: <span class="s2">&quot;2017-09-11T05:10:00Z&quot;</span>,
</span><span class='line'>            <span class="s2">&quot;Minimum&quot;</span>: 25573.032,
</span><span class='line'>            <span class="s2">&quot;Unit&quot;</span>: <span class="s2">&quot;Megabytes&quot;</span>
</span><span class='line'>        <span class="o">}</span>,
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;Timestamp&quot;</span>: <span class="s2">&quot;2017-09-11T05:20:00Z&quot;</span>,
</span><span class='line'>            <span class="s2">&quot;Minimum&quot;</span>: 25554.051,
</span><span class='line'>            <span class="s2">&quot;Unit&quot;</span>: <span class="s2">&quot;Megabytes&quot;</span>
</span><span class='line'>        <span class="o">}</span>,
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;Timestamp&quot;</span>: <span class="s2">&quot;2017-09-11T05:30:00Z&quot;</span>,
</span><span class='line'>            <span class="s2">&quot;Minimum&quot;</span>: 25540.957,
</span><span class='line'>            <span class="s2">&quot;Unit&quot;</span>: <span class="s2">&quot;Megabytes&quot;</span>
</span><span class='line'>        <span class="o">}</span>,
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;Timestamp&quot;</span>: <span class="s2">&quot;2017-09-11T05:40:00Z&quot;</span>,
</span><span class='line'>            <span class="s2">&quot;Minimum&quot;</span>: 25525.473,
</span><span class='line'>            <span class="s2">&quot;Unit&quot;</span>: <span class="s2">&quot;Megabytes&quot;</span>
</span><span class='line'>        <span class="o">}</span>,
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;Timestamp&quot;</span>: <span class="s2">&quot;2017-09-11T05:00:00Z&quot;</span>,
</span><span class='line'>            <span class="s2">&quot;Minimum&quot;</span>: 25584.383,
</span><span class='line'>            <span class="s2">&quot;Unit&quot;</span>: <span class="s2">&quot;Megabytes&quot;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">]</span>,
</span><span class='line'>    <span class="s2">&quot;Label&quot;</span>: <span class="s2">&quot;FreeStorageSpace&quot;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Using the Python Sys Library to Read Data From Stdin]]></title>
    <link href="http://blog.ruanbekker.com/blog/2017/09/18/using-the-python-sys-library-to-read-data-from-stdin/"/>
    <updated>2017-09-18T11:42:01-04:00</updated>
    <id>http://blog.ruanbekker.com/blog/2017/09/18/using-the-python-sys-library-to-read-data-from-stdin</id>
    <content type="html"><![CDATA[<p>Using Python&rsquo;s <code>sys</code> library to read data from <code>stdin</code>.</p>

<p>In this basic example we will strip our input, delimited by the comma character, add it to a list, and print it out</p>

<h2>Python: Read Data from Standard Input</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">sys</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">json</span>
</span><span class='line'>
</span><span class='line'><span class="n">mylist</span> <span class="o">=</span> <span class="p">[]</span>
</span><span class='line'>
</span><span class='line'><span class="n">data_input</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span class='line'><span class="n">destroy_newline</span> <span class="o">=</span> <span class="n">data_input</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">mylist</span> <span class="o">=</span> <span class="n">destroy_newline</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;, &#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">print</span><span class="p">(</span><span class="s">&quot;Stripping each word and adding it to &#39;mylist&#39;&quot;</span><span class="p">)</span>
</span><span class='line'><span class="k">print</span><span class="p">(</span><span class="s">&quot;Found: {} words in &#39;mylist&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mylist</span><span class="p">)))</span>
</span><span class='line'><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">mylist</span><span class="p">:</span>
</span><span class='line'>    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Word: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>We will echo three words and pipe it into our python script:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;one, two, three&quot;</span> <span class="p">|</span> python basic-stdin.py
</span><span class='line'>Stripping each word and adding it to <span class="s1">&#39;mylist&#39;</span>
</span><span class='line'>Found: <span class="m">3</span> words in <span class="s1">&#39;mylist&#39;</span>
</span><span class='line'>Word: one
</span><span class='line'>Word: two
</span><span class='line'>Word: three
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Setup a Postfix Relay Server That Uses SES to Relay Outbound Mail]]></title>
    <link href="http://blog.ruanbekker.com/blog/2017/09/16/setup-a-postfix-relay-server-that-uses-ses-to-relay-outbound-mail/"/>
    <updated>2017-09-16T18:01:49-04:00</updated>
    <id>http://blog.ruanbekker.com/blog/2017/09/16/setup-a-postfix-relay-server-that-uses-ses-to-relay-outbound-mail</id>
    <content type="html"><![CDATA[<p>We will setup a Postfix Relay Servcer which our clients will use to send out mail, the Postfix server will use Amazon&rsquo;s SES Service to send out mail, which we will configure as a relay host in Postfix.</p>

<h2>Setup EC2 Instance to Relay through AWS SES:</h2>

<p>Install Postfix and SASL:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>apt install postfix mailutils libsasl2-2 sasl2-bin libsasl2-modules -y
</span></code></pre></td></tr></table></div></figure>


<p>Section we need to configure in <code>/etc/nginx/main.cf</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">relayhost</span> <span class="o">=</span> <span class="o">[</span>email-smtp.eu-west-1.amazonaws.com<span class="o">]</span>:587
</span><span class='line'><span class="nv">smtp_use_tls</span> <span class="o">=</span> yes
</span><span class='line'><span class="nv">smtp_sasl_auth_enable</span> <span class="o">=</span> yes
</span><span class='line'><span class="nv">smtp_sasl_security_options</span> <span class="o">=</span>
</span><span class='line'><span class="nv">smtp_sasl_password_maps</span> <span class="o">=</span> <span class="nb">hash</span>:/etc/postfix/sasl_passwd
</span><span class='line'><span class="nv">smtp_tls_CAfile</span> <span class="o">=</span> /etc/ssl/certs/ca-certificates.crt
</span></code></pre></td></tr></table></div></figure>


<p>Populate SASL Passwd:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>cat /etc/postfix/sasl_passwd
</span><span class='line'><span class="o">[</span>email-smtp.eu-west-1.amazonaws.com<span class="o">]</span>:587    AKIAABCDEFGHIJKLM:SomeRandomSecretString
</span></code></pre></td></tr></table></div></figure>


<p>Postmap the changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>postmap /etc/postfix/sasl_passwd
</span></code></pre></td></tr></table></div></figure>


<p>Restart Postfix:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>sudo /etc/init.d/postfix restart
</span></code></pre></td></tr></table></div></figure>


<p>Test the Mail Flow:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span><span class="nb">echo test</span> <span class="p">|</span> mail -r ruan@ruanbekker.com -s <span class="s1">&#39;ses test mail &#39;</span> ruan@ruanbekker.com <span class="o">&amp;&amp;</span> tail -f /var/log/mail.log
</span><span class='line'>
</span><span class='line'>Jul <span class="m">18</span> 11:29:06 ip-10-1-4-250 postfix/smtp<span class="o">[</span>5056<span class="o">]</span>: 9FDCB469AA: <span class="nv">to</span><span class="o">=</span>&lt;ruan@ruanbekker.com&gt;, <span class="nv">relay</span><span class="o">=</span>email-smtp.eu-west-1.amazonaws.com<span class="o">[</span>52.10.20.30<span class="o">]</span>:587, <span class="nv">delay</span><span class="o">=</span>0.29, <span class="nv">delays</span><span class="o">=</span>0.02/0.03/0.12/0.13, <span class="nv">dsn</span><span class="o">=</span>2.0.0, <span class="nv">status</span><span class="o">=</span>sent <span class="o">(</span><span class="m">250</span> Ok 0234567d557572f2-76f56252-0a00-4d94-af87-38bd213914d2-000000<span class="o">)</span>
</span><span class='line'>Jul <span class="m">18</span> 11:29:06 ip-10-1-4-250 postfix/qmgr<span class="o">[</span>4392<span class="o">]</span>: 9FDCB469AA: removed
</span></code></pre></td></tr></table></div></figure>


<p>If your output looks more or less like the snippet from above, your mail should be working fine.</p>

<center>
<script type='text/javascript' src='https://ko-fi.com/widgets/widget_2.js'></script><script type='text/javascript'>kofiwidget2.init('Buy Me a Coffee', '#46b798', 'A6423ZIQ');kofiwidget2.draw();</script> 
</center>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Nginx Reverse Proxy for Elasticsearch and Kibana 5 on AWS]]></title>
    <link href="http://blog.ruanbekker.com/blog/2017/09/16/nginx-reverse-proxy-for-elasticsearch-and-kibana-5-on-aws/"/>
    <updated>2017-09-16T17:24:32-04:00</updated>
    <id>http://blog.ruanbekker.com/blog/2017/09/16/nginx-reverse-proxy-for-elasticsearch-and-kibana-5-on-aws</id>
    <content type="html"><![CDATA[<p>As up untill today, there&rsquo;s currently no VPC Support for Amazon&rsquo;s Elasticsearch Service.</p>

<p>So for scenarios where you would like to allow private network traffic to Elasticsearch is impossible straight out of the box as Amazon&rsquo;s Elasticsearch Services, only sees Public Internet Traffic.</p>

<p>We will setup 2 configs, one for Kibana and one for Elasticsearch, each one having its own FQDN:</p>

<ul>
<li>Kibana: <code>http://kibana.domain.com</code></li>
<li>Elasticsearch: <code>http://elasticsearch.domain.com</code></li>
</ul>


<h2>Workaround:</h2>

<p>There&rsquo;s a couple of workarounds, which includes:</p>

<ul>
<li>Nginx Reverse Proxy</li>
<li>NAT Gateway</li>
<li>Allow IAM Users/Roles</li>
</ul>


<p>Today we will tackle the Nginx Reverse Proxy Route.</p>

<p>The benefit of this, would be to associate an EIP to the Nginx EC2 Instnace, then whitelist your EIP with Elasticsearch, so the only traffic that will be accepted will be the traffic that is coming from the Nginx Instance. We will also apply an additional layer of security, in this case we will use HTTP Basic Authentication, then also authorize network sources on a Security Group level.</p>

<h2>Installing Nginx:</h2>

<p>In this case I am using Ubuntu 16.04, so we will need to install <code>nginx</code> and <code>apache2-utils</code> for creating the Basic HTTP Auth accounts.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>apt update <span class="o">&amp;&amp;</span> apt upgrade -y
</span><span class='line'><span class="nv">$ </span>apt install nginx apache2-utils -y
</span></code></pre></td></tr></table></div></figure>


<h2>Configure Nginx:</h2>

<p>Our main config: <code>/etc/nginx/nginx.conf</code>:</p>

<figure class='code'><figcaption><span>/etc/nginx/nginx.conf</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>user www-data<span class="p">;</span>
</span><span class='line'>worker_processes auto<span class="p">;</span>
</span><span class='line'>pid /run/nginx.pid<span class="p">;</span>
</span><span class='line'>error_log /var/log/nginx/error.log<span class="p">;</span>
</span><span class='line'>
</span><span class='line'>events <span class="o">{</span>
</span><span class='line'>  worker_connections 1024<span class="p">;</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'>http <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="c"># Basic Settings</span>
</span><span class='line'>  sendfile on<span class="p">;</span>
</span><span class='line'>  tcp_nopush on<span class="p">;</span>
</span><span class='line'>  tcp_nodelay on<span class="p">;</span>
</span><span class='line'>  keepalive_timeout 65<span class="p">;</span>
</span><span class='line'>  types_hash_max_size 2048<span class="p">;</span>
</span><span class='line'>  server_names_hash_bucket_size 128<span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  include /etc/nginx/mime.types<span class="p">;</span>
</span><span class='line'>  default_type application/octet-stream<span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c"># Logging Settings</span>
</span><span class='line'>        log_format  main  <span class="s1">&#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span>
</span><span class='line'>                      <span class="s1">&#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span>
</span><span class='line'>                      <span class="s1">&#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  access_log /var/log/nginx/access.log main<span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c"># Gzip Settings</span>
</span><span class='line'>  gzip on<span class="p">;</span>
</span><span class='line'>  gzip_disable <span class="s2">&quot;msie6&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c"># Elasticsearch and Kibana Configs</span>
</span><span class='line'>  include /etc/nginx/conf.d/elasticsearch.conf<span class="p">;</span>
</span><span class='line'>  include /etc/nginx/conf.d/kibana.conf<span class="p">;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Our <code>/etc/nginx/conf.d/elasticsearch.conf</code> configuration:</p>

<figure class='code'><figcaption><span>/etc/nginx/conf.d/elasticsearch.conf</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>server <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  listen 80<span class="p">;</span>
</span><span class='line'>  server_name elasticsearch.domain.com<span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c"># error logging</span>
</span><span class='line'>  error_log /var/log/nginx/elasticsearch_error.log<span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c"># authentication: elasticsearch</span>
</span><span class='line'>  auth_basic <span class="s2">&quot;Elasticsearch Auth&quot;</span><span class="p">;</span>
</span><span class='line'>  auth_basic_user_file /etc/nginx/.secrets_elasticsearch<span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  location / <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    proxy_http_version 1.1<span class="p">;</span>
</span><span class='line'>    proxy_set_header Host https://search-elasticsearch-name.eu-west-1.es.amazonaws.com<span class="p">;</span>
</span><span class='line'>    proxy_set_header X-Real-IP &lt;ELASTIC-IP&gt;<span class="p">;</span>
</span><span class='line'>    proxy_set_header Connection <span class="s2">&quot;Keep-Alive&quot;</span><span class="p">;</span>
</span><span class='line'>    proxy_set_header Proxy-Connection <span class="s2">&quot;Keep-Alive&quot;</span><span class="p">;</span>
</span><span class='line'>    proxy_set_header Authorization <span class="s2">&quot;&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    proxy_pass https://search-elasticsearch-name.eu-west-1.es.amazonaws.com/<span class="p">;</span>
</span><span class='line'>    proxy_redirect https://search-elasticsearch-name.eu-west-1.es.amazonaws.com/ http://&lt;ELASTIC-IP&gt;/<span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="c"># ELB Health Checks</span>
</span><span class='line'>  location /status <span class="o">{</span>
</span><span class='line'>    root /usr/share/nginx/html/<span class="p">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Our <code>/etc/nginx/conf.d/kibana.conf</code> configuration:</p>

<figure class='code'><figcaption><span>/etc/nginx/conf.d/kibana.conf</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>server <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  listen 80<span class="p">;</span>
</span><span class='line'>  server_name kibana.domain.com<span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c"># error logging</span>
</span><span class='line'>  error_log /var/log/nginx/kibana_error.log<span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c"># authentication: kibana</span>
</span><span class='line'>  auth_basic <span class="s2">&quot;Kibana Auth&quot;</span><span class="p">;</span>
</span><span class='line'>  auth_basic_user_file /etc/nginx/.secrets_kibana<span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  location / <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    proxy_http_version 1.1<span class="p">;</span>
</span><span class='line'>    proxy_set_header Host https://search.elasticsearch-name.eu-west-1.es.amazonaws.com<span class="p">;</span>
</span><span class='line'>    proxy_set_header X-Real-IP &lt;ELASTIC-IP&gt;<span class="p">;</span>
</span><span class='line'>    proxy_set_header Connection <span class="s2">&quot;Keep-Alive&quot;</span><span class="p">;</span>
</span><span class='line'>    proxy_set_header Proxy-Connection <span class="s2">&quot;Keep-Alive&quot;</span><span class="p">;</span>
</span><span class='line'>    proxy_set_header Authorization <span class="s2">&quot;&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    proxy_pass https://search.elasticsearch-name.eu-west-1.es.amazonaws.com/_plugin/kibana/<span class="p">;</span>
</span><span class='line'>    proxy_redirect https://search.elasticsearch-name.eu-west-1.es.amazonaws.com/_plugin/kibana/ http://&lt;ELASTIC-IP&gt;/kibana/<span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>      location ~ <span class="o">(</span>/app/kibana<span class="p">|</span>/app/timelion<span class="p">|</span>/bundles<span class="p">|</span>/es_admin<span class="p">|</span>/plugins<span class="p">|</span>/api<span class="p">|</span>/ui<span class="p">|</span>/elasticsearch<span class="o">)</span> <span class="o">{</span>
</span><span class='line'>         proxy_pass              https://search.elasticsearch-name.eu-west-1.es.amazonaws.com<span class="p">;</span>
</span><span class='line'>         proxy_set_header        Host <span class="nv">$host</span><span class="p">;</span>
</span><span class='line'>         proxy_set_header        X-Real-IP <span class="nv">$remote_addr</span><span class="p">;</span>
</span><span class='line'>         proxy_set_header        X-Forwarded-For <span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
</span><span class='line'>         proxy_set_header        X-Forwarded-Proto <span class="nv">$scheme</span><span class="p">;</span>
</span><span class='line'>         proxy_set_header        X-Forwarded-Host <span class="nv">$http_host</span><span class="p">;</span>
</span><span class='line'>         proxy_set_header      Authorization  <span class="s2">&quot;&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Once you have replaced the elasticsearch endpoint and your EPI values, we can go ahead and create the auth accounts.</p>

<h2>Create User Accounts for HTTP Basic Auth</h2>

<p>Create the 2 accounts for authentication on kibana and elasticsearch:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>htpasswd -c /etc/nginx/.secrets_elasticsearch elasticsearch-admin
</span><span class='line'><span class="nv">$ </span>htpasswd -c /etc/nginx/.secrets_kibana kibana-admin
</span></code></pre></td></tr></table></div></figure>


<h2>Restart Nginx:</h2>

<p>Restart and enable Nginx on boot:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>systemctl <span class="nb">enable </span>nginx
</span><span class='line'><span class="nv">$ </span>systemctl restart nginx
</span></code></pre></td></tr></table></div></figure>


<p>Once your Nginx Service is running, you should be able to access Kibana and Elasticsearch using the credentials that you created.</p>

<h2>Resources:</h2>

<ul>
<li><a href="https://www.nginx.com/blog/tcp-load-balancing-udp-load-balancing-nginx-tips-tricks/">https://www.nginx.com/blog/tcp-load-balancing-udp-load-balancing-nginx-tips-tricks/</a></li>
<li><a href="https://www.elastic.co/blog/playing-http-tricks-nginx">https://www.elastic.co/blog/playing-http-tricks-nginx</a></li>
<li><a href="https://sysadmins.co.za/aws-access-kibana-5-behind-elb-via-nginx-reverse-proxy-on-custom-dns/">https://sysadmins.co.za/aws-access-kibana-5-behind-elb-via-nginx-reverse-proxy-on-custom-dns/</a></li>
</ul>


<center>
<script type='text/javascript' src='https://ko-fi.com/widgets/widget_2.js'></script><script type='text/javascript'>kofiwidget2.init('Buy Me a Coffee', '#46b798', 'A6423ZIQ');kofiwidget2.draw();</script> 
</center>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[AWS: IAM S3 Policy for Cyberduck to Allow Listing Buckets and Access to One Bucket]]></title>
    <link href="http://blog.ruanbekker.com/blog/2017/09/15/aws-iam-s3-policy-for-cyberduck-to-allow-listing-buckets-and-access-to-one-bucket/"/>
    <updated>2017-09-15T11:18:17-04:00</updated>
    <id>http://blog.ruanbekker.com/blog/2017/09/15/aws-iam-s3-policy-for-cyberduck-to-allow-listing-buckets-and-access-to-one-bucket</id>
    <content type="html"><![CDATA[<p>When using Cyberduck to access S3, and a account has restrictive policies, you may find error <code>Listing Directory: /</code> failed.</p>

<p>If you have restrictive IAM Policies in your account, this may be due to the fact that <code>S3:ListMyBuckets</code> is not allowed.</p>

<p>In this post we want to allow a user to list all buckets, so that Cyberduck can do the initial list after configuration / launch, and we would like to give the user access to their designated bucket.</p>

<h2>Creating the IAM Policy:</h2>

<p>We will create this IAM Policy and associate the policy to the user&rsquo;s account:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;Version&quot;</span><span class="p">:</span> <span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;Statement&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="nt">&quot;Sid&quot;</span><span class="p">:</span> <span class="s2">&quot;Stmt1480515305000&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="nt">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="nt">&quot;Action&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class='line'>                <span class="s2">&quot;s3:ListAllMyBuckets&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="s2">&quot;s3:GetBucketLocation&quot;</span>
</span><span class='line'>            <span class="p">],</span>
</span><span class='line'>            <span class="nt">&quot;Resource&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class='line'>                <span class="s2">&quot;arn:aws:s3:::*&quot;</span>
</span><span class='line'>            <span class="p">]</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="nt">&quot;Sid&quot;</span><span class="p">:</span> <span class="s2">&quot;Stmt1480515305002&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="nt">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="nt">&quot;Action&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class='line'>                <span class="s2">&quot;s3:List*&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="s2">&quot;s3:GetObject&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="s2">&quot;s3:PutObject&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="s2">&quot;s3:DeleteObject&quot;</span>
</span><span class='line'>            <span class="p">],</span>
</span><span class='line'>            <span class="nt">&quot;Resource&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class='line'>                <span class="s2">&quot;arn:aws:s3:::allowed-bucket&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="s2">&quot;arn:aws:s3:::allowed-bucket/*&quot;</span>
</span><span class='line'>            <span class="p">]</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">]</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>So here we should be able to list the buckets:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>aws --profile cyberduck s3 ls /
</span><span class='line'>2017-06-08 08:27:01 allowed-bucket
</span><span class='line'>2017-05-21 13:39:21 private-bucket
</span><span class='line'>2016-12-21 08:23:45 confidential-bucket
</span><span class='line'>2017-08-10 14:18:19 <span class="nb">test</span>-bucket
</span><span class='line'>2016-08-03 12:38:29 datalake-bucket
</span></code></pre></td></tr></table></div></figure>


<p>Able to list inside the bucket, as well as Get, Put etc.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>aws --profile cyberduck s3 ls allowed-bucket/
</span><span class='line'>                           PRE data/
</span></code></pre></td></tr></table></div></figure>


<p>Unable to list the buckets content which is expected, as we did not mention in the policy:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>aws --profile cyberduck s3 ls confidential-bucket/
</span><span class='line'>
</span><span class='line'>An error occurred <span class="o">(</span>AccessDenied<span class="o">)</span> when calling the ListObjects operation: Access Denied
</span></code></pre></td></tr></table></div></figure>


<h2>Resources:</h2>

<ul>
<li><a href="https://aws.amazon.com/blogs/security/writing-iam-policies-how-to-grant-access-to-an-amazon-s3-bucket/">https://aws.amazon.com/blogs/security/writing-iam-policies-how-to-grant-access-to-an-amazon-s3-bucket/</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Using Python for Image Analysis With Amazons Rekognition Service]]></title>
    <link href="http://blog.ruanbekker.com/blog/2017/09/11/using-python-for-image-analysis-with-amazons-rekognition-service/"/>
    <updated>2017-09-11T10:20:28-04:00</updated>
    <id>http://blog.ruanbekker.com/blog/2017/09/11/using-python-for-image-analysis-with-amazons-rekognition-service</id>
    <content type="html"><![CDATA[<p>Amazon&rsquo;s Rekognition Service, which falls under their Artificial Intelligence tier, makes it easy to add image analysis to your applications.</p>

<p>Today we will use Rekognition to analyze an image, to determine the percentage of detection that the service analyzes. We will be using the Python SDK to do this.</p>

<h2>Getting a Random Image:</h2>

<p>So, I got this drunk guy on the couch, which I thought we could use to analyze.</p>

<p>Image Used:
- <a href="http://imgur.com/a/CHnSu">http://imgur.com/a/CHnSu</a></p>

<blockquote class="imgur-embed-pub" lang="en" data-id="a/CHnSu"><a href="//imgur.com/CHnSu"></a></blockquote>


<script async src="//s.imgur.com/min/embed.js" charset="utf-8"></script>


<h2>Our Python Code:</h2>

<p>Our code will use boto3 to use rekognition from Amazon Web Services, detects the image, and prints out the values.</p>

<p>Note that I am not specifying any credentials, as my credentials is configured in my local credential provider, where boto will pick it up from.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">boto3</span>
</span><span class='line'>
</span><span class='line'><span class="n">BUCKET</span> <span class="o">=</span> <span class="s">&quot;rekognition-bucket&quot;</span>
</span><span class='line'><span class="n">KEY</span> <span class="o">=</span> <span class="s">&quot;images/image-02.jpg&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">detect_labels</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">max_labels</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">min_confidence</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">region</span><span class="o">=</span><span class="s">&quot;eu-west-1&quot;</span><span class="p">,</span> <span class="n">profile_name</span><span class="o">=</span><span class="s">&quot;aws&quot;</span><span class="p">):</span>
</span><span class='line'>    <span class="n">rekognition</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s">&quot;rekognition&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="n">rekognition</span><span class="o">.</span><span class="n">detect_labels</span><span class="p">(</span>
</span><span class='line'>        <span class="n">Image</span><span class="o">=</span><span class="p">{</span>
</span><span class='line'>        <span class="s">&quot;S3Object&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&quot;Bucket&quot;</span><span class="p">:</span> <span class="n">BUCKET</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&quot;Name&quot;</span><span class="p">:</span> <span class="n">KEY</span><span class="p">,</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="n">MaxLabels</span><span class="o">=</span><span class="n">max_labels</span><span class="p">,</span>
</span><span class='line'>        <span class="n">MinConfidence</span><span class="o">=</span><span class="n">min_confidence</span><span class="p">,</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">response</span><span class="p">[</span><span class="s">&#39;Labels&#39;</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">detect_labels</span><span class="p">(</span><span class="n">BUCKET</span><span class="p">,</span> <span class="n">KEY</span><span class="p">):</span>
</span><span class='line'>    <span class="k">print</span><span class="p">(</span><span class="s">&quot;{Name} - {Confidence}%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">label</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Running the App:</h2>

<p>Running our Python App, will result in the following:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>python rekog.py
</span><span class='line'>People - 98.9893875122%
</span><span class='line'>Person - 98.9893951416%
</span><span class='line'>Human - 98.9505844116%
</span><span class='line'>Alcohol - 98.573425293%
</span><span class='line'>Beer - 98.573425293%
</span><span class='line'>Beer Bottle - 98.573425293%
</span><span class='line'>Beverage - 98.573425293%
</span><span class='line'>Bottle - 98.573425293%
</span><span class='line'>Drink - 98.573425293%
</span><span class='line'>Couch - 98.4713821411%
</span></code></pre></td></tr></table></div></figure>


<h2>Resources:</h2>

<ul>
<li><a href="https://aws.amazon.com/rekognition/">https://aws.amazon.com/rekognition/</a></li>
<li><a href="https://gist.github.com/alexcasalboni/0f21a1889f09760f8981b643326730ff">https://gist.github.com/alexcasalboni/0f21a1889f09760f8981b643326730ff</a></li>
</ul>


<center>
        <script type='text/javascript' src='https://ko-fi.com/widgets/widget_2.js'></script><script type='text/javascript'>kofiwidget2.init('Buy Me a Coffee', '#46b798', 'A6423ZIQ');kofiwidget2.draw();</script>
</center>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Setup RocketChat on Docker Swarm]]></title>
    <link href="http://blog.ruanbekker.com/blog/2017/09/10/setup-rocketchat-on-docker-swarm/"/>
    <updated>2017-09-10T18:45:12-04:00</updated>
    <id>http://blog.ruanbekker.com/blog/2017/09/10/setup-rocketchat-on-docker-swarm</id>
    <content type="html"><![CDATA[<p>Rocket Chat, a Self Hosted Alternative, which is very similar to Slack.</p>

<p>We will setup a RocketChat Server which is hosted on Docker Swarm. In future posts, I will also go through the steps on working with the API, Custom Emoji&rsquo;s etc.</p>

<h2>Requirements:</h2>

<p>RocketChat uses MongoDB as its Database, we will keep the database outside of our swarm, if you don&rsquo;t already have a MongoDB Server in place, follow the <a href="http://blog.ruanbekker.com/blog/2017/09/02/setup-a-3-node-mongodb-replica-set-on-ubuntu-16/">Setup a 3 Node MongoDB</a> post to get that sorted.</p>

<p>Another requirement is to have docker swarm running, alternatively, you can also follow <a href="https://rocket.chat/docs/installation/">RocketChat&rsquo;s Documentation</a> if you prefer setting it up elsewhere.</p>

<h2>Setup Rocket Chat</h2>

<p>We will assume MongoDB is accessible via <code>mongodb.domain.com</code> on port <code>27017</code>, with a username and password.</p>

<p>Creating the RocketChat service and associate it to our <code>appnet</code> overlay network:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>docker service create --name rocketchat <span class="se">\</span>
</span><span class='line'>--replicas <span class="m">1</span> <span class="se">\</span>
</span><span class='line'>--network appnet <span class="se">\</span>
</span><span class='line'>--env <span class="nv">DEPLOY_METHOD</span><span class="o">=</span>docker <span class="se">\</span>
</span><span class='line'>--env <span class="nv">NODE_ENV</span><span class="o">=</span>production <span class="se">\</span>
</span><span class='line'>--env <span class="nv">PORT</span><span class="o">=</span><span class="m">3000</span> <span class="se">\</span>
</span><span class='line'>--env <span class="nv">MONGO_URL</span><span class="o">=</span><span class="s2">&quot;mongodb://mongoadmin:mongopass@mongodb.domain.com:27017/rocketchat?authSource=admin&quot;</span> <span class="se">\</span>
</span><span class='line'>--env <span class="nv">ROOT_URL</span><span class="o">=</span>http://rocketchat.domain.com <span class="se">\</span>
</span><span class='line'>--env <span class="nv">ADMIN_USERNAME</span><span class="o">=</span>myadmin <span class="se">\</span>
</span><span class='line'>--env <span class="nv">ADMIN_PASS</span><span class="o">=</span>secret <span class="se">\</span>
</span><span class='line'>--env <span class="nv">ADMIN_EMAIL</span><span class="o">=</span>mail@domain.com <span class="se">\</span>
</span><span class='line'>--env <span class="nv">Accounts_AvatarStorePath</span><span class="o">=</span>/app/uploads <span class="se">\</span>
</span><span class='line'>--secret rocketchat_secret <span class="se">\</span>
</span><span class='line'>rocketchat/rocket.chat
</span></code></pre></td></tr></table></div></figure>


<h2>View the RocketChat Service Logs</h2>

<p>Lets monitor the docker service logs for our rocketchat service:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker service logs -f rocketchat
</span><span class='line'>
</span><span class='line'>rocketchat.1.lnbyfjiotqpz@docker-swarm-worker-03    <span class="p">|</span> Using GridFS <span class="k">for</span> custom sounds storage
</span><span class='line'>rocketchat.1.lnbyfjiotqpz@docker-swarm-worker-03    <span class="p">|</span> Using GridFS <span class="k">for</span> custom emoji storage
</span><span class='line'>rocketchat.1.lnbyfjiotqpz@docker-swarm-worker-03    <span class="p">|</span> ufs: temp directory created at <span class="s2">&quot;/tmp/ufs&quot;</span>
</span><span class='line'>rocketchat.1.lnbyfjiotqpz@docker-swarm-worker-03    <span class="p">|</span> System startup
</span><span class='line'>rocketchat.1.lnbyfjiotqpz@docker-swarm-worker-03    <span class="p">|</span> +--------------------------------------------------------------+
</span><span class='line'>rocketchat.1.lnbyfjiotqpz@docker-swarm-worker-03    <span class="p">|</span> <span class="p">|</span>                        SERVER RUNNING                        <span class="p">|</span>
</span><span class='line'>rocketchat.1.lnbyfjiotqpz@docker-swarm-worker-03    <span class="p">|</span> +--------------------------------------------------------------+
</span><span class='line'>rocketchat.1.lnbyfjiotqpz@docker-swarm-worker-03    <span class="p">|</span> <span class="p">|</span>                                                              <span class="p">|</span>
</span><span class='line'>rocketchat.1.lnbyfjiotqpz@docker-swarm-worker-03    <span class="p">|</span> <span class="p">|</span>  Rocket.Chat Version: 0.58.2                                 <span class="p">|</span>
</span><span class='line'>rocketchat.1.lnbyfjiotqpz@docker-swarm-worker-03    <span class="p">|</span> <span class="p">|</span>       NodeJS Version: 4.8.4 - x64                            <span class="p">|</span>
</span><span class='line'>rocketchat.1.lnbyfjiotqpz@docker-swarm-worker-03    <span class="p">|</span> <span class="p">|</span>             Platform: linux                                  <span class="p">|</span>
</span><span class='line'>rocketchat.1.lnbyfjiotqpz@docker-swarm-worker-03    <span class="p">|</span> <span class="p">|</span>         Process Port: <span class="m">3000</span>                                   <span class="p">|</span>
</span><span class='line'>rocketchat.1.lnbyfjiotqpz@docker-swarm-worker-03    <span class="p">|</span> <span class="p">|</span>             Site URL: http://rocketchat.domain.com           <span class="p">|</span>
</span><span class='line'>rocketchat.1.lnbyfjiotqpz@docker-swarm-worker-03    <span class="p">|</span> <span class="p">|</span>     ReplicaSet OpLog: Disabled                               <span class="p">|</span>
</span><span class='line'>rocketchat.1.lnbyfjiotqpz@docker-swarm-worker-03    <span class="p">|</span> <span class="p">|</span>          Commit Hash: 988103d449                             <span class="p">|</span>
</span><span class='line'>rocketchat.1.lnbyfjiotqpz@docker-swarm-worker-03    <span class="p">|</span> <span class="p">|</span>        Commit Branch: HEAD                                   <span class="p">|</span>
</span><span class='line'>rocketchat.1.lnbyfjiotqpz@docker-swarm-worker-03    <span class="p">|</span> <span class="p">|</span>                                                              <span class="p">|</span>
</span><span class='line'>rocketchat.1.lnbyfjiotqpz@docker-swarm-worker-03    <span class="p">|</span> +--------------------------------------------------------------+
</span><span class='line'>rocketchat.1.lnbyfjiotqpz@docker-swarm-worker-03    <span class="p">|</span> Inserting admin user:
</span><span class='line'>rocketchat.1.lnbyfjiotqpz@docker-swarm-worker-03    <span class="p">|</span> Name: Administrator
</span><span class='line'>rocketchat.1.lnbyfjiotqpz@docker-swarm-worker-03    <span class="p">|</span> Email: mail@domain.com
</span><span class='line'>rocketchat.1.lnbyfjiotqpz@docker-swarm-worker-03    <span class="p">|</span> Username: myadmin
</span><span class='line'>rocketchat.1.lnbyfjiotqpz@docker-swarm-worker-03    <span class="p">|</span> Password: secret
</span></code></pre></td></tr></table></div></figure>


<p>Now you should be able to access Rocket Chat on the <code>ROOT_URL</code> that you have specified.</p>

<h2>Resources:</h2>

<ul>
<li><a href="https://rocket.chat/docs/installation/">https://rocket.chat/docs/installation/</a></li>
<li><a href="https://github.com/RocketChat/Docker.Official.Image">https://github.com/RocketChat/Docker.Official.Image</a></li>
<li><a href="https://rocket.chat/docs/installation/docker-containers">https://rocket.chat/docs/installation/docker-containers</a></li>
</ul>


<center>
        <script type='text/javascript' src='https://ko-fi.com/widgets/widget_2.js'></script><script type='text/javascript'>kofiwidget2.init('Buy Me a Coffee', '#46b798', 'A6423ZIQ');kofiwidget2.draw();</script>
</center>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[HTTPS Termination Using LetsEncrypt With Traefik on Docker Swarm]]></title>
    <link href="http://blog.ruanbekker.com/blog/2017/09/09/https-termination-using-letsencrypt-with-traefik-on-docker-swarm/"/>
    <updated>2017-09-09T18:40:15-04:00</updated>
    <id>http://blog.ruanbekker.com/blog/2017/09/09/https-termination-using-letsencrypt-with-traefik-on-docker-swarm</id>
    <content type="html"><![CDATA[<p><img src="http://obj-cache.cloud.ruanbekker.com/traefik.png" alt="" /></p>

<p>We will setup a HTTPS Termination on Traefik for our Java Web Application using Payara Micro, that will sit behind our Traefik proxy. In this guide, I will be using GitLab&rsquo;s Private Registry for pushing my Images to.</p>

<h2>Traefik Dockerfile:</h2>

<p>Our Traefik Dockerfile:</p>

<figure class='code'><figcaption><span>Traefik Dockerfile</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='docker'><span class='line'><span class="k">FROM</span> traefik
</span><span class='line'><span class="k">ADD</span> traefik.toml .
</span><span class='line'><span class="k">EXPOSE</span> <span class="m">80</span>
</span><span class='line'><span class="k">EXPOSE</span> <span class="m">8080</span>
</span><span class='line'><span class="k">EXPOSE</span> <span class="m">443</span>
</span></code></pre></td></tr></table></div></figure>


<h2>traefik.toml</h2>

<p>Our Traefik config: <code>traefik.toml</code></p>

<figure class='code'><figcaption><span>traefik.toml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='toml'><span class='line'><span class="n">defaultEntryPoints</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;http&quot;</span><span class="p">,</span> <span class="s">&quot;https&quot;</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="p">[</span><span class="n">web</span><span class="p">]</span>
</span><span class='line'><span class="n">address</span> <span class="o">=</span> <span class="s">&quot;:8080&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="p">[</span><span class="n">entryPoints</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="p">[</span><span class="n">entryPoints</span><span class="p">.</span><span class="n">http</span><span class="p">]</span>
</span><span class='line'><span class="n">address</span> <span class="o">=</span> <span class="s">&quot;:80&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="p">[</span><span class="n">entryPoints</span><span class="p">.</span><span class="n">https</span><span class="p">]</span>
</span><span class='line'><span class="n">address</span> <span class="o">=</span> <span class="s">&quot;:443&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="p">[</span><span class="n">entryPoints</span><span class="p">.</span><span class="n">https</span><span class="p">.</span><span class="n">tls</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="p">[</span><span class="n">acme</span><span class="p">]</span>
</span><span class='line'><span class="n">email</span> <span class="o">=</span> <span class="s">&quot;recipient@domain.com&quot;</span>
</span><span class='line'><span class="n">storage</span> <span class="o">=</span> <span class="s">&quot;acme.json&quot;</span>
</span><span class='line'><span class="n">entryPoint</span> <span class="o">=</span> <span class="s">&quot;https&quot;</span>
</span><span class='line'><span class="n">onDemand</span> <span class="o">=</span> <span class="kc">false</span>
</span><span class='line'><span class="n">OnHostRule</span> <span class="o">=</span> <span class="kc">true</span>
</span><span class='line'>
</span><span class='line'><span class="p">[</span><span class="n">docker</span><span class="p">]</span>
</span><span class='line'><span class="n">endpoint</span> <span class="o">=</span> <span class="s">&quot;unix:///var/run/docker.sock&quot;</span>
</span><span class='line'><span class="n">domain</span> <span class="o">=</span> <span class="s">&quot;apps.domain.com&quot;</span>
</span><span class='line'><span class="n">watch</span> <span class="o">=</span> <span class="kc">true</span>
</span><span class='line'><span class="n">exposedbydefault</span> <span class="o">=</span> <span class="kc">false</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Build the Image:</h2>

<p>Login to GitLab&rsquo;s Registry, build and push the image:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker login registry.gitlab.com
</span><span class='line'><span class="nv">$ </span>docker build -t registry.gitlab.com/&lt;user&gt;/&lt;repo&gt;/traefik:latest .
</span><span class='line'><span class="nv">$ </span>docker push registry.gitlab.com/&lt;user&gt;/&lt;repo&gt;/traefik:latest
</span></code></pre></td></tr></table></div></figure>


<h2>Traefik:</h2>

<p>Create the Traefik Proxy Service:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker service create <span class="se">\</span>
</span><span class='line'>--name traefik <span class="se">\</span>
</span><span class='line'>--constraint <span class="s1">&#39;node.role==manager&#39;</span> <span class="se">\</span>
</span><span class='line'>--publish 80:80 <span class="se">\</span>
</span><span class='line'>--publish 443:443 <span class="se">\</span>
</span><span class='line'>--publish 8080:8080 <span class="se">\</span>
</span><span class='line'>--mount <span class="nb">type</span><span class="o">=</span><span class="nb">bind</span>,source<span class="o">=</span>/var/run/docker.sock,target<span class="o">=</span>/var/run/docker.sock <span class="se">\</span>
</span><span class='line'>--network appnet <span class="se">\</span>
</span><span class='line'>--with-registry-auth registry.gitlab.com/&lt;user&gt;/&lt;repo&gt;/traefik:latest <span class="se">\</span>
</span><span class='line'>--docker <span class="se">\</span>
</span><span class='line'>--docker.swarmmode <span class="se">\</span>
</span><span class='line'>--docker.domain<span class="o">=</span>apps.domain.com <span class="se">\</span>
</span><span class='line'>--docker.watch <span class="se">\</span>
</span><span class='line'>--logLevel<span class="o">=</span>DEBUG <span class="se">\</span>
</span><span class='line'>--web
</span></code></pre></td></tr></table></div></figure>


<h2>Java Web Application:</h2>

<p>Our Java Web Applications Dockerfile:</p>

<figure class='code'><figcaption><span>Dockerfile</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='docker'><span class='line'><span class="k">FROM</span> payara/micro
</span><span class='line'>COPY app.war /opt/payara/deployments/app.war
</span></code></pre></td></tr></table></div></figure>


<p>Build and Push the Image to our GitLab Registry:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker build -t registry.gitlab.com/&lt;user&gt;/&lt;repo&gt;/java_web:latest .
</span><span class='line'><span class="nv">$ </span>docker push registry.gitlab.com/&lt;user&gt;/&lt;repo&gt;/java_web:latest
</span></code></pre></td></tr></table></div></figure>


<p>Create the Java Web Application on Docker Swarm, specifiying our <code>Host</code>, and also a <code>PathPrefix</code>, so that the Traefik Proxy can accept requests for the <code>Hostname</code>, and anything from <code>/app/</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker service create <span class="se">\</span>
</span><span class='line'>--name java_web <span class="se">\</span>
</span><span class='line'>--label <span class="s1">&#39;traefik.port=8080&#39;</span> <span class="se">\</span>
</span><span class='line'>--label traefik.frontend.rule<span class="o">=</span><span class="s2">&quot;Host:apps.domain.com; PathPrefix: /app/&quot;</span> <span class="se">\</span>
</span><span class='line'>--network appnet <span class="se">\</span>
</span><span class='line'>--with-registry-auth registry.gitlab.com/&lt;user&gt;/&lt;repo&gt;/java_web:latest
</span></code></pre></td></tr></table></div></figure>


<p>Now we should be able to access our Web Application on <code>https://apps.domain.com/app/</code></p>

<h2>Resources:</h2>

<ul>
<li><a href="https://gist.github.com/nknapp/20c7cd89f1f128b8425dd89cbad0b802">https://gist.github.com/nknapp/20c7cd89f1f128b8425dd89cbad0b802</a></li>
<li><a href="https://niels.nu/blog/2017/traefik-https-letsencrypt.html">https://niels.nu/blog/2017/traefik-https-letsencrypt.html</a></li>
</ul>


<center>
        <script type='text/javascript' src='https://ko-fi.com/widgets/widget_2.js'></script><script type='text/javascript'>kofiwidget2.init('Buy Me a Coffee', '#46b798', 'A6423ZIQ');kofiwidget2.draw();</script>
</center>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Run Kibana on Docker Swarm With Traefik]]></title>
    <link href="http://blog.ruanbekker.com/blog/2017/09/09/run-kibana-on-docker-swarm-with-traefik/"/>
    <updated>2017-09-09T18:33:12-04:00</updated>
    <id>http://blog.ruanbekker.com/blog/2017/09/09/run-kibana-on-docker-swarm-with-traefik</id>
    <content type="html"><![CDATA[<p>We will create a Kibana Service on Docker Swarm, that will sit behind a Traefik Reverse Proxy.</p>

<h2>Create the Overlay Network:</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker network create --driver overlay appnet
</span></code></pre></td></tr></table></div></figure>


<h2>Create the Traefik Service:</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>docker service create <span class="se">\</span>
</span><span class='line'>--name traefik <span class="se">\</span>
</span><span class='line'>--constraint <span class="s1">&#39;node.role==manager&#39;</span> <span class="se">\</span>
</span><span class='line'>--publish 80:80 <span class="se">\</span>
</span><span class='line'>--publish 443:443 <span class="se">\</span>
</span><span class='line'>--publish 8080:8080 <span class="se">\</span>
</span><span class='line'>--mount <span class="nb">type</span><span class="o">=</span><span class="nb">bind</span>,source<span class="o">=</span>/var/run/docker.sock,target<span class="o">=</span>/var/run/docker.sock <span class="se">\</span>
</span><span class='line'>--network appnet <span class="se">\</span>
</span><span class='line'>traefik:camembert <span class="se">\</span>
</span><span class='line'>--docker --docker.swarmmode  <span class="se">\</span>
</span><span class='line'>--docker.domain<span class="o">=</span>apps.domain.com <span class="se">\</span>
</span><span class='line'>--docker.watch <span class="se">\</span>
</span><span class='line'>--logLevel<span class="o">=</span>DEBUG <span class="se">\</span>
</span><span class='line'>--web
</span></code></pre></td></tr></table></div></figure>


<h2>Set DNS:</h2>

<p>Set a wildcard <code>*.apps.domain.com</code> to resolve to <code>apps.domain.com</code>, where <code>apps.domain.com</code> resolves to your swarm addresses</p>

<h2>Create Kibana:</h2>

<p>Create a Kibana Service and set the <code>ELASTICSEARCH_URL</code> to your External Elasticsearch Endpoint, take note that it uses port <code>9200</code> by default.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker service create <span class="se">\</span>
</span><span class='line'>--name kibana <span class="se">\</span>
</span><span class='line'>--label <span class="s1">&#39;traefik.port=5601&#39;</span> <span class="se">\</span>
</span><span class='line'>--network appnet <span class="se">\</span>
</span><span class='line'>--env <span class="nv">KIBANA_ELASTICSEARCH_URL</span><span class="o">=</span>elasticsearch.domain.com <span class="se">\</span>
</span><span class='line'>bitnami/kibana
</span></code></pre></td></tr></table></div></figure>


<h2>Access Kibana:</h2>

<p>Your Kibana endpoint will be available at: <code>http://kibana.apps.domain.com</code></p>

<h2>Resources:</h2>

<ul>
<li><a href="https://github.com/bitnami/bitnami-docker-kibana">https://github.com/bitnami/bitnami-docker-kibana</a></li>
<li><a href="https://docs.traefik.io/">https://docs.traefik.io/</a></li>
</ul>


<center>
    <script type='text/javascript' src='https://ko-fi.com/widgets/widget_2.js'></script><script type='text/javascript'>kofiwidget2.init('Buy Me a Coffee', '#46b798', 'A6423ZIQ');kofiwidget2.draw();</script>
</center>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Using Python to Write Data to a MySQL Database]]></title>
    <link href="http://blog.ruanbekker.com/blog/2017/09/09/using-python-to-write-data-to-a-mysql-database/"/>
    <updated>2017-09-09T16:39:59-04:00</updated>
    <id>http://blog.ruanbekker.com/blog/2017/09/09/using-python-to-write-data-to-a-mysql-database</id>
    <content type="html"><![CDATA[<p>From our <a href="http://blog.ruanbekker.com/blog/2017/09/09/using-python-to-read-data-from-a-mysql-database/">previous</a> post, we used python to read data from mysql. In this post we will be using the <code>random</code> library to write random data into mysql.</p>

<p>We will define our lists with the categorized data, and then using for loop, to write data into our mysql database:</p>

<h2>Create The Database:</h2>

<p>Using Python to Create the Database:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">pdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">db_host</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">db_username</span><span class="p">,</span> <span class="n">passwd</span><span class="o">=</span><span class="n">db_password</span><span class="p">)</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;CREATE DATABASE testdb1&quot;</span><span class="p">)</span>
</span><span class='line'><span class="il">1L</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;CREATE TABLE testdb1.myusers(name VARCHAR(50), surname VARCHAR(50), countries VARCHAR(50), job VARCHAR(20), os VARCHAR(20), car VARCHAR(20))&quot;</span><span class="p">)</span>
</span><span class='line'><span class="il">0L</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now to list our databases:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;show databases&quot;</span><span class="p">)</span>
</span><span class='line'><span class="il">12L</span>
</span><span class='line'>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">dbs</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dbs</span><span class="p">:</span>
</span><span class='line'><span class="o">...</span>     <span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span class='line'><span class="o">...</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="s">&#39;information_schema&#39;</span><span class="p">,)</span>
</span><span class='line'><span class="p">(</span><span class="s">&#39;mysql&#39;</span><span class="p">,)</span>
</span><span class='line'><span class="p">(</span><span class="s">&#39;performance_schema&#39;</span><span class="p">,)</span>
</span><span class='line'><span class="p">(</span><span class="s">&#39;testdb1&#39;</span><span class="p">,)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Python Code to Write to MySQL</h2>

<p>We will create a <code>mysql_write.py</code> file, with the following contents to define our random data that we will write to our mysql database. The config module can be found from <a href="http://blog.ruanbekker.com/blog/2017/09/09/using-python-to-read-data-from-a-mysql-database/">this</a> post.</p>

<figure class='code'><figcaption><span>mysql_write.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">MySQLdb</span> <span class="kn">as</span> <span class="nn">pdb</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">config</span> <span class="kn">import</span> <span class="n">credentials</span> <span class="k">as</span> <span class="n">secrets</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">random</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">datetime</span>
</span><span class='line'>
</span><span class='line'><span class="n">db_host</span> <span class="o">=</span> <span class="n">secrets</span><span class="p">[</span><span class="s">&#39;mysql&#39;</span><span class="p">][</span><span class="s">&#39;host&#39;</span><span class="p">]</span>
</span><span class='line'><span class="n">db_username</span> <span class="o">=</span> <span class="n">secrets</span><span class="p">[</span><span class="s">&#39;mysql&#39;</span><span class="p">][</span><span class="s">&#39;username&#39;</span><span class="p">]</span>
</span><span class='line'><span class="n">db_password</span> <span class="o">=</span> <span class="n">secrets</span><span class="p">[</span><span class="s">&#39;mysql&#39;</span><span class="p">][</span><span class="s">&#39;password&#39;</span><span class="p">]</span>
</span><span class='line'><span class="n">db_name</span> <span class="o">=</span> <span class="n">secrets</span><span class="p">[</span><span class="s">&#39;mysql&#39;</span><span class="p">][</span><span class="s">&#39;database&#39;</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
</span><span class='line'>    <span class="n">a</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
</span><span class='line'>    <span class="n">b</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">surnames</span><span class="p">)</span>
</span><span class='line'>    <span class="n">c</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">countries</span><span class="p">)</span>
</span><span class='line'>    <span class="n">d</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>
</span><span class='line'>    <span class="n">e</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">os</span><span class="p">)</span>
</span><span class='line'>    <span class="n">f</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">car</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;INSERT INTO myusers values(&#39;{name}&#39;, &#39;{surname}&#39;, &#39;{countries}&#39;, &#39;{job}&#39;, &#39;{os}&#39;, &#39;{car}&#39;);&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">surname</span><span class="o">=</span><span class="n">b</span><span class="p">,</span> <span class="n">countries</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">job</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">os</span><span class="o">=</span><span class="n">e</span><span class="p">,</span> <span class="n">car</span><span class="o">=</span><span class="n">f</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span><span class='line'><span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>After running the file: <code>python mysql_write.py</code> we should have 10 records in our database.</p>

<h2>Reading the Data from MySQLL</h2>

<p>To verify that the data is in our MySQL Database, lets logon to our mysql database:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>mysql -u root -p
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='mysql'><span class='line'><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">testdb1</span><span class="p">.</span><span class="n">myusers</span><span class="p">;</span>
</span><span class='line'><span class="o">+----------+----------+-----------+----------------+---------+---------------+</span>
</span><span class='line'><span class="o">|</span> <span class="n">name</span>     <span class="o">|</span> <span class="n">surname</span>  <span class="o">|</span> <span class="n">countries</span> <span class="o">|</span> <span class="n">job</span>            <span class="o">|</span> <span class="n">os</span>      <span class="o">|</span> <span class="n">car</span>           <span class="o">|</span>
</span><span class='line'><span class="o">+----------+----------+-----------+----------------+---------+---------------+</span>
</span><span class='line'><span class="o">|</span> <span class="n">James</span>    <span class="o">|</span> <span class="n">James</span>    <span class="o">|</span> <span class="n">New</span> <span class="n">York</span>  <span class="o">|</span> <span class="n">Waiter</span>         <span class="o">|</span> <span class="n">Mac</span>     <span class="o">|</span> <span class="n">Volkswagen</span>    <span class="o">|</span>
</span><span class='line'><span class="o">|</span> <span class="n">Jennifer</span> <span class="o">|</span> <span class="n">Smith</span>    <span class="o">|</span> <span class="n">New</span> <span class="n">York</span>  <span class="o">|</span> <span class="n">Scientist</span>      <span class="o">|</span> <span class="n">Windows</span> <span class="o">|</span> <span class="n">Audi</span>          <span class="o">|</span>
</span><span class='line'><span class="o">|</span> <span class="n">Michelle</span> <span class="o">|</span> <span class="n">Jacobs</span>   <span class="o">|</span> <span class="n">Italy</span>     <span class="o">|</span> <span class="n">Police</span> <span class="n">Officer</span> <span class="o">|</span> <span class="n">Mac</span>     <span class="o">|</span> <span class="n">Ford</span>          <span class="o">|</span>
</span><span class='line'><span class="o">|</span> <span class="n">Michelle</span> <span class="o">|</span> <span class="n">Anderson</span> <span class="o">|</span> <span class="n">Italy</span>     <span class="o">|</span> <span class="n">Waiter</span>         <span class="o">|</span> <span class="n">Windows</span> <span class="o">|</span> <span class="n">Ford</span>          <span class="o">|</span>
</span><span class='line'><span class="o">|</span> <span class="n">Jennifer</span> <span class="o">|</span> <span class="n">Smith</span>    <span class="o">|</span> <span class="n">England</span>   <span class="o">|</span> <span class="n">Doctor</span>         <span class="o">|</span> <span class="n">Windows</span> <span class="o">|</span> <span class="n">Toyota</span>        <span class="o">|</span>
</span><span class='line'><span class="o">|</span> <span class="n">Peter</span>    <span class="o">|</span> <span class="n">Jacobs</span>   <span class="o">|</span> <span class="n">England</span>   <span class="o">|</span> <span class="n">IT</span>             <span class="o">|</span> <span class="n">Windows</span> <span class="o">|</span> <span class="n">BMW</span>           <span class="o">|</span>
</span><span class='line'><span class="o">|</span> <span class="n">Samantha</span> <span class="o">|</span> <span class="n">James</span>    <span class="o">|</span> <span class="n">England</span>   <span class="o">|</span> <span class="n">Doctor</span>         <span class="o">|</span> <span class="n">Mac</span>     <span class="o">|</span> <span class="n">Mazda</span>         <span class="o">|</span>
</span><span class='line'><span class="o">|</span> <span class="n">Frank</span>    <span class="o">|</span> <span class="n">Phillips</span> <span class="o">|</span> <span class="n">England</span>   <span class="o">|</span> <span class="n">IT</span>             <span class="o">|</span> <span class="n">Mac</span>     <span class="o">|</span> <span class="n">BMW</span>           <span class="o">|</span>
</span><span class='line'><span class="o">|</span> <span class="n">Samantha</span> <span class="o">|</span> <span class="n">James</span>    <span class="o">|</span> <span class="n">England</span>   <span class="o">|</span> <span class="n">Banker</span>         <span class="o">|</span> <span class="n">Linux</span>   <span class="o">|</span> <span class="n">Mercedez</span><span class="o">-</span><span class="n">Benz</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span> <span class="n">Peter</span>    <span class="o">|</span> <span class="n">Anderson</span> <span class="o">|</span> <span class="n">Sweden</span>    <span class="o">|</span> <span class="n">Doctor</span>         <span class="o">|</span> <span class="n">Windows</span> <span class="o">|</span> <span class="n">BMW</span>           <span class="o">|</span>
</span><span class='line'><span class="o">+----------+----------+-----------+----------------+---------+---------------+</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next, lets use Python to do the same, create a file <code>mysql_read.py</code> with the following content:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">MySQLdb</span> <span class="kn">as</span> <span class="nn">pdb</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">config</span> <span class="kn">import</span> <span class="n">credentials</span> <span class="k">as</span> <span class="n">secrets</span>
</span><span class='line'>
</span><span class='line'><span class="n">db_host</span> <span class="o">=</span> <span class="n">secrets</span><span class="p">[</span><span class="s">&#39;mysql&#39;</span><span class="p">][</span><span class="s">&#39;host&#39;</span><span class="p">]</span>
</span><span class='line'><span class="n">db_username</span> <span class="o">=</span> <span class="n">secrets</span><span class="p">[</span><span class="s">&#39;mysql&#39;</span><span class="p">][</span><span class="s">&#39;username&#39;</span><span class="p">]</span>
</span><span class='line'><span class="n">db_password</span> <span class="o">=</span> <span class="n">secrets</span><span class="p">[</span><span class="s">&#39;mysql&#39;</span><span class="p">][</span><span class="s">&#39;password&#39;</span><span class="p">]</span>
</span><span class='line'><span class="n">db_name</span> <span class="o">=</span> <span class="n">secrets</span><span class="p">[</span><span class="s">&#39;mysql&#39;</span><span class="p">][</span><span class="s">&#39;database&#39;</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="n">conn</span> <span class="o">=</span> <span class="n">pdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">db_host</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">db_username</span><span class="p">,</span> <span class="n">passwd</span><span class="o">=</span><span class="n">db_password</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="n">db_name</span><span class="p">)</span>
</span><span class='line'><span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;select * from myusers&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">read</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">read</span><span class="p">:</span>
</span><span class='line'>    <span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>Running the Python file, to read the data:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>python mysql_read.py
</span><span class='line'>
</span><span class='line'><span class="o">(</span><span class="s1">&#39;James&#39;</span>, <span class="s1">&#39;James&#39;</span>, <span class="s1">&#39;New York&#39;</span>, <span class="s1">&#39;Waiter&#39;</span>, <span class="s1">&#39;Mac&#39;</span>, <span class="s1">&#39;Volkswagen&#39;</span><span class="o">)</span>
</span><span class='line'><span class="o">(</span><span class="s1">&#39;Jennifer&#39;</span>, <span class="s1">&#39;Smith&#39;</span>, <span class="s1">&#39;New York&#39;</span>, <span class="s1">&#39;Scientist&#39;</span>, <span class="s1">&#39;Windows&#39;</span>, <span class="s1">&#39;Audi&#39;</span><span class="o">)</span>
</span><span class='line'><span class="o">(</span><span class="s1">&#39;Michelle&#39;</span>, <span class="s1">&#39;Jacobs&#39;</span>, <span class="s1">&#39;Italy&#39;</span>, <span class="s1">&#39;Police Officer&#39;</span>, <span class="s1">&#39;Mac&#39;</span>, <span class="s1">&#39;Ford&#39;</span><span class="o">)</span>
</span><span class='line'><span class="o">(</span><span class="s1">&#39;Michelle&#39;</span>, <span class="s1">&#39;Anderson&#39;</span>, <span class="s1">&#39;Italy&#39;</span>, <span class="s1">&#39;Waiter&#39;</span>, <span class="s1">&#39;Windows&#39;</span>, <span class="s1">&#39;Ford&#39;</span><span class="o">)</span>
</span><span class='line'><span class="o">(</span><span class="s1">&#39;Jennifer&#39;</span>, <span class="s1">&#39;Smith&#39;</span>, <span class="s1">&#39;England&#39;</span>, <span class="s1">&#39;Doctor&#39;</span>, <span class="s1">&#39;Windows&#39;</span>, <span class="s1">&#39;Toyota&#39;</span><span class="o">)</span>
</span><span class='line'><span class="o">(</span><span class="s1">&#39;Peter&#39;</span>, <span class="s1">&#39;Jacobs&#39;</span>, <span class="s1">&#39;England&#39;</span>, <span class="s1">&#39;IT&#39;</span>, <span class="s1">&#39;Windows&#39;</span>, <span class="s1">&#39;BMW&#39;</span><span class="o">)</span>
</span><span class='line'><span class="o">(</span><span class="s1">&#39;Samantha&#39;</span>, <span class="s1">&#39;James&#39;</span>, <span class="s1">&#39;England&#39;</span>, <span class="s1">&#39;Doctor&#39;</span>, <span class="s1">&#39;Mac&#39;</span>, <span class="s1">&#39;Mazda&#39;</span><span class="o">)</span>
</span><span class='line'><span class="o">(</span><span class="s1">&#39;Frank&#39;</span>, <span class="s1">&#39;Phillips&#39;</span>, <span class="s1">&#39;England&#39;</span>, <span class="s1">&#39;IT&#39;</span>, <span class="s1">&#39;Mac&#39;</span>, <span class="s1">&#39;BMW&#39;</span><span class="o">)</span>
</span><span class='line'><span class="o">(</span><span class="s1">&#39;Samantha&#39;</span>, <span class="s1">&#39;James&#39;</span>, <span class="s1">&#39;England&#39;</span>, <span class="s1">&#39;Banker&#39;</span>, <span class="s1">&#39;Linux&#39;</span>, <span class="s1">&#39;Mercedez-Benz&#39;</span><span class="o">)</span>
</span><span class='line'><span class="o">(</span><span class="s1">&#39;Peter&#39;</span>, <span class="s1">&#39;Anderson&#39;</span>, <span class="s1">&#39;Sweden&#39;</span>, <span class="s1">&#39;Doctor&#39;</span>, <span class="s1">&#39;Windows&#39;</span>, <span class="s1">&#39;BMW&#39;</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<center>
        <script type='text/javascript' src='https://ko-fi.com/widgets/widget_2.js'></script><script type='text/javascript'>kofiwidget2.init('Buy Me a Coffee', '#46b798', 'A6423ZIQ');kofiwidget2.draw();</script>
</center>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Using Python to Read Data From a MySQL Database]]></title>
    <link href="http://blog.ruanbekker.com/blog/2017/09/09/using-python-to-read-data-from-a-mysql-database/"/>
    <updated>2017-09-09T15:23:05-04:00</updated>
    <id>http://blog.ruanbekker.com/blog/2017/09/09/using-python-to-read-data-from-a-mysql-database</id>
    <content type="html"><![CDATA[<p>Wanted to use Python to read some data from MySQL and stumbled upon a couple of great resources, which I noted some of my output below:</p>

<h2>Install Dependencies:</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>apt install python-dev libmysqlclient-dev python-setuptools gcc
</span><span class='line'><span class="nv">$ </span>easy_install pip
</span><span class='line'><span class="nv">$ </span>pip install MySQL-python
</span></code></pre></td></tr></table></div></figure>


<h2>Download Some Sample Data:</h2>

<p>Download the world dataset for MySQL:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>wget http://downloads.mysql.com/docs/world.sql.zip
</span><span class='line'><span class="nv">$ </span>unzip world.sql.zip
</span></code></pre></td></tr></table></div></figure>


<h2>Create Database:</h2>

<p>Create the Database in MySQL for the dataset that we downloaded:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>mysql -u root -p -e<span class="s1">&#39;CREATE DATABASE world;&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Import Data:</h2>

<p>Import the data into the <code>world</code> database:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>mysql -u root -p world &lt; world.sql
</span></code></pre></td></tr></table></div></figure>


<h2>Create the MySQL Credentials File:</h2>

<p>Create a <code>config.py</code> file and populate the credentials in a dictionary:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">credentials</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>  <span class="s">&#39;mysql&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>      <span class="s">&#39;host&#39;</span><span class="p">:</span> <span class="s">&#39;localhost&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="s">&#39;root&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&#39;password&#39;</span><span class="p">:</span> <span class="s">&#39;password&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&#39;database&#39;</span><span class="p">:</span> <span class="s">&#39;world&#39;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Run Queries from Python:</h2>

<p>Enter the Python interpreter and run some queries:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">MySQLdb</span> <span class="kn">as</span> <span class="nn">pdb</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">config</span> <span class="kn">import</span> <span class="n">credentials</span> <span class="k">as</span> <span class="n">secrets</span>
</span><span class='line'>
</span><span class='line'><span class="c"># assignments </span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">db_host</span> <span class="o">=</span> <span class="n">secrets</span><span class="p">[</span><span class="s">&#39;mysql&#39;</span><span class="p">][</span><span class="s">&#39;host&#39;</span><span class="p">]</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">db_username</span> <span class="o">=</span> <span class="n">secrets</span><span class="p">[</span><span class="s">&#39;mysql&#39;</span><span class="p">][</span><span class="s">&#39;username&#39;</span><span class="p">]</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">db_password</span> <span class="o">=</span> <span class="n">secrets</span><span class="p">[</span><span class="s">&#39;mysql&#39;</span><span class="p">][</span><span class="s">&#39;password&#39;</span><span class="p">]</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">db_name</span> <span class="o">=</span> <span class="n">secrets</span><span class="p">[</span><span class="s">&#39;mysql&#39;</span><span class="p">][</span><span class="s">&#39;database&#39;</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="c"># create a connection to the database</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">pdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">db_host</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">db_username</span><span class="p">,</span> <span class="n">passwd</span><span class="o">=</span><span class="n">db_password</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="n">db_name</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># create a object for the queries we will be using</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="c"># execute the query</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select continent, name from country where continent = &quot;Africa&quot; limit 5&#39;</span><span class="p">)</span>
</span><span class='line'><span class="il">5L</span>
</span><span class='line'>
</span><span class='line'><span class="c"># fetch the results by assigning it to the results object:</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">results</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="c"># loop and print results:</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
</span><span class='line'><span class="o">...</span>     <span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span class='line'><span class="o">...</span>
</span><span class='line'><span class="p">(</span><span class="s">&#39;Africa&#39;</span><span class="p">,</span> <span class="s">&#39;Angola&#39;</span><span class="p">)</span>
</span><span class='line'><span class="p">(</span><span class="s">&#39;Africa&#39;</span><span class="p">,</span> <span class="s">&#39;Burundi&#39;</span><span class="p">)</span>
</span><span class='line'><span class="p">(</span><span class="s">&#39;Africa&#39;</span><span class="p">,</span> <span class="s">&#39;Benin&#39;</span><span class="p">)</span>
</span><span class='line'><span class="p">(</span><span class="s">&#39;Africa&#39;</span><span class="p">,</span> <span class="s">&#39;Burkina Faso&#39;</span><span class="p">)</span>
</span><span class='line'><span class="p">(</span><span class="s">&#39;Africa&#39;</span><span class="p">,</span> <span class="s">&#39;Botswana&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># close the connection</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Graphing Results to Plotly:</h2>

<p>A great <a href="http://moderndata.plot.ly/graph-data-from-mysql-database-in-python/">blogpost</a> that shows how to use this data to graph the results to plotly</p>

<h2>Resources:</h2>

<ul>
<li><a href="http://moderndata.plot.ly/graph-data-from-mysql-database-in-python/">http://moderndata.plot.ly/graph-data-from-mysql-database-in-python/</a></li>
<li><a href="https://stackoverflow.com/questions/11007627/python-variable-declaration">https://stackoverflow.com/questions/11007627/python-variable-declaration</a></li>
</ul>


<center>
        <script type='text/javascript' src='https://ko-fi.com/widgets/widget_2.js'></script><script type='text/javascript'>kofiwidget2.init('Buy Me a Coffee', '#46b798', 'A6423ZIQ');kofiwidget2.draw();</script>
</center>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Using Minios Python SDK to Interact With a Minio S3 Bucket]]></title>
    <link href="http://blog.ruanbekker.com/blog/2017/09/08/using-minios-python-sdk-to-interact-with-a-minio-s3-bucket/"/>
    <updated>2017-09-08T16:15:52-04:00</updated>
    <id>http://blog.ruanbekker.com/blog/2017/09/08/using-minios-python-sdk-to-interact-with-a-minio-s3-bucket</id>
    <content type="html"><![CDATA[<p>In our previous post, we have <a href="http://blog.ruanbekker.com/blog/2017/09/08/run-your-self-hosted-s3-service-with-minio-on-docker-swarm/">Setup Minio Server</a> which is a self-hosted alternative to Amazon&rsquo;s S3 Service.</p>

<p>We will go through some basic examples on working with the Python SDK, to interact with Minio.</p>

<h2>Installing the Minio Python Library:</h2>

<p>Ensure that Python and Pip is installed, the install the Python Minio Library:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>virtualenv -p /usr/local/bin/python2.7 .venv
</span><span class='line'><span class="nv">$ </span><span class="nb">source</span> .venv/bin/activate
</span><span class='line'><span class="o">(</span>.venv<span class="o">)</span><span class="nv">$ </span>pip install minio
</span></code></pre></td></tr></table></div></figure>


<h2>Create a Bucket:</h2>

<p>Enter the Python Interpreter and Create a S3 Bucket on your Minio Server:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">minio</span> <span class="kn">import</span> <span class="n">Minio</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">client</span> <span class="o">=</span> <span class="n">Minio</span><span class="p">(</span><span class="s">&#39;10.0.0.2:9000&#39;</span><span class="p">,</span> <span class="n">access_key</span><span class="o">=</span><span class="s">&#39;ASDASDASD&#39;</span><span class="p">,</span> <span class="n">secret_key</span><span class="o">=</span><span class="s">&#39;ASDASDASD&#39;</span><span class="p">,</span> <span class="n">secure</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">client</span><span class="o">.</span><span class="n">make_bucket</span><span class="p">(</span><span class="s">&#39;pythonbucket&#39;</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="s">&#39;us-west-1&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>List Buckets:</h2>

<p>I have also created a bucket from my previous post, so we should have 2 buckets:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">buckets</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">list_buckets</span><span class="p">()</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">bucket</span> <span class="ow">in</span> <span class="n">buckets</span><span class="p">:</span>
</span><span class='line'><span class="o">...</span>     <span class="k">print</span><span class="p">(</span><span class="n">bucket</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
</span><span class='line'><span class="o">...</span>
</span><span class='line'><span class="n">news3bucket</span>
</span><span class='line'><span class="n">pythonbucket</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Put Objects to your Bucket:</h2>

<p>Write a string to a file, then upload the file to 2 different destination objects. The arguments is: BucketName, Destination, Source.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;file.txt&#39;</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">data</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;This is some text&#39;</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">data</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">client</span><span class="o">.</span><span class="n">fput_object</span><span class="p">(</span><span class="s">&#39;pythonbucket&#39;</span><span class="p">,</span> <span class="s">&#39;bucket/contents/file.txt&#39;</span><span class="p">,</span> <span class="s">&#39;file.txt&#39;</span><span class="p">)</span>
</span><span class='line'><span class="s">&#39;6b8c327f0fc6f470c030a5b6c71154c5&#39;</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">client</span><span class="o">.</span><span class="n">fput_object</span><span class="p">(</span><span class="s">&#39;pythonbucket&#39;</span><span class="p">,</span> <span class="s">&#39;bucket/contents/file2.txt&#39;</span><span class="p">,</span> <span class="s">&#39;file.txt&#39;</span><span class="p">)</span>
</span><span class='line'><span class="s">&#39;6b8c327f0fc6f470c030a5b6c71154c5&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>List Objects in your Bucket:</h2>

<p>List the objects in your bucket:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">objects</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">list_objects</span><span class="p">(</span><span class="s">&#39;pythonbucket&#39;</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&#39;bucket/contents/&#39;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objects</span><span class="p">:</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objects</span><span class="p">:</span>
</span><span class='line'><span class="o">...</span>     <span class="k">print</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">object_name</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span class='line'><span class="o">...</span>
</span><span class='line'><span class="p">(</span><span class="s">&#39;bucket/contents/file.txt&#39;</span><span class="p">,</span> <span class="mi">18</span><span class="p">)</span>
</span><span class='line'><span class="p">(</span><span class="s">&#39;bucket/contents/file2.txt&#39;</span><span class="p">,</span> <span class="mi">18</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Remove Objects from your Bucket:</h2>

<p>Remove the objects from your Bucket, the list your bucket to verify that they are removed:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">client</span><span class="o">.</span><span class="n">remove_object</span><span class="p">(</span><span class="s">&#39;pythonbucket&#39;</span><span class="p">,</span> <span class="s">&#39;bucket/contents/file.txt&#39;</span><span class="p">)</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">client</span><span class="o">.</span><span class="n">remove_object</span><span class="p">(</span><span class="s">&#39;pythonbucket&#39;</span><span class="p">,</span> <span class="s">&#39;bucket/contents/file2.txt&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objects</span><span class="p">:</span>
</span><span class='line'><span class="o">...</span>     <span class="k">print</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">object_name</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span class='line'><span class="o">...</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Remove the Bucket:</h2>

<p>Remove the Bucket that we created:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">client</span><span class="o">.</span><span class="n">remove_bucket</span><span class="p">(</span><span class="s">&#39;pythonbucket&#39;</span><span class="p">)</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="nb">exit</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Resources:</h2>

<p>Minio has some great documentation, for more information on their SDK:</p>

<ul>
<li><a href="https://docs.minio.io/docs/python-client-api-reference">https://docs.minio.io/docs/python-client-api-reference</a></li>
</ul>


<center>
    <script type='text/javascript' src='https://ko-fi.com/widgets/widget_2.js'></script><script type='text/javascript'>kofiwidget2.init('Buy Me a Coffee', '#46b798', 'A6423ZIQ');kofiwidget2.draw();</script> 
</center>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Run Your Self-Hosted S3 Service With Minio on Docker Swarm]]></title>
    <link href="http://blog.ruanbekker.com/blog/2017/09/08/run-your-self-hosted-s3-service-with-minio-on-docker-swarm/"/>
    <updated>2017-09-08T15:29:29-04:00</updated>
    <id>http://blog.ruanbekker.com/blog/2017/09/08/run-your-self-hosted-s3-service-with-minio-on-docker-swarm</id>
    <content type="html"><![CDATA[<p>Minio is a distributed object storage server built for cloud applications, which is similar to Amazon&rsquo;s S3 Service.</p>

<p>Today, we will create the server on docker swarm, as I don&rsquo;t currently have a external data store like GlusterFS / NFS etc, I will host the data on the manager node, and set a constraint for the service so that the service can only run on the manager node.</p>

<h2>Prepare the Data Directory:</h2>

<p>I will only rely on the manager node for my data, so on my manager node:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ mkdir -p /mnt/data</span></code></pre></td></tr></table></div></figure>


<h2>Create the Service:</h2>

<p>If you have a Replicated Gluster Volume or NFS which is mounted throughout your docker swarm, you can create the directory path for it, and the update your <code>--mount</code> source path to your external data store. In my case, I will just point it to my manager node&rsquo;s <code>/mnt/data</code> path as I have setup the service to only run on the one manager node in my swarm:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ docker service create \
</span><span class='line'>--name minio \
</span><span class='line'>--network appnet \
</span><span class='line'>--replicas 1 \
</span><span class='line'>--publish 9000:9000 \
</span><span class='line'>--constraint 'node.role==manager' \
</span><span class='line'>-e "MINIO_ACCESS_KEY=AKIAASDKJASDL" \
</span><span class='line'>-e "MINIO_SECRET_KEY=AKIAASDKJASDL" \
</span><span class='line'>--mount "type=bind,source=/mnt/data,target=/data" \
</span><span class='line'>minio/minio server /data</span></code></pre></td></tr></table></div></figure>


<h2>Install the AWS CLI Tools:</h2>

<p>We will use the awscli tools to interact with our Minio Server:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ pip install awscli</span></code></pre></td></tr></table></div></figure>


<h2>Configure the Client:</h2>

<p>Configure the awscli client with the access details that we passed in our docker service:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ aws configure --profile minio
</span><span class='line'>AWS Access Key ID []: AKIAASDKJASDL
</span><span class='line'>AWS Secret Access Key []: ASLDKJASDLKJASDLKJ
</span><span class='line'>Default region name []: us-west-1
</span><span class='line'>Default output format []: json</span></code></pre></td></tr></table></div></figure>


<h2>Create the Bucket:</h2>

<p>Create a New Bucket, in this case <code>news3bucket</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>aws --profile minio --endpoint-url http://MINIO-IP:9000 s3 mb s3://news3bucket
</span><span class='line'>make_bucket: news3bucket</span></code></pre></td></tr></table></div></figure>


<h2>List Buckets:</h2>

<p>List our endpoint, to see the buckets on our server:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ aws --profile minio --endpoint-url http://MINIO-IP:9000 s3 ls /
</span><span class='line'>2017-09-08 15:01:40 news3bucket</span></code></pre></td></tr></table></div></figure>


<h2>Upload an Object to your Bucket:</h2>

<p>We will upload an image <code>awsddb-1.png</code> to our new bucket:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ aws --profile minio --endpoint-url http://MINIO-IP:9000 s3 cp awsddb-1.png s3://news3bucket/
</span><span class='line'>upload: ./awsddb-1.png to s3://news3bucket/awsddb-1.png</span></code></pre></td></tr></table></div></figure>


<h2>List Bucket:</h2>

<p>List your bucket, to see the uploaded object:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ aws --profile minio --endpoint-url http://MINIO-IP:9000 s3 ls s3://news3bucket
</span><span class='line'>2017-09-08 15:03:11      19851 awsddb-1.png</span></code></pre></td></tr></table></div></figure>


<h2>Download Object:</h2>

<p>Download the image from your Bucket, and set the local file to <code>file.png</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ aws --profile minio --endpoint-url http://MINIO-IP:9000 s3 cp s3://news3bucket/awsddb-1.png file.png
</span><span class='line'>download: s3://news3bucket/awsddb-1.png to ./file.png</span></code></pre></td></tr></table></div></figure>


<h2>Web Access:</h2>

<p>You can also access Minio&rsquo;s Web Interface on the port that you have exposed, in my case: <code>http://MINIO-IP:9000/minio/</code></p>

<h2>Resources:</h2>

<ul>
<li><a href="https://www.minio.io/">https://www.minio.io/</a></li>
<li><a href="https://docs.minio.io/docs/minio-docker-quickstart-guide">https://docs.minio.io/docs/minio-docker-quickstart-guide</a></li>
<li><a href="https://github.com/minio/minio/blob/master/README.md">https://github.com/minio/minio/blob/master/README.md</a></li>
<li><a href="https://github.com/arschles/minio-howto/blob/master/aws-cli-with-minio-server.md">https://github.com/arschles/minio-howto/blob/master/aws-cli-with-minio-server.md</a></li>
</ul>


<center>
    <script type='text/javascript' src='https://ko-fi.com/widgets/widget_2.js'></script><script type='text/javascript'>kofiwidget2.init('Buy Me a Coffee', '#46b798', 'A6423ZIQ');kofiwidget2.draw();</script> 
</center>

]]></content>
  </entry>
  
</feed>
