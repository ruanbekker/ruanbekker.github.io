
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Setup a 3 Node MongoDB Replica Set on Ubuntu 16 - Ruan Bekker's Blog</title>
  <meta name="author" content="Ruan">

  
  <meta name="description" content="Today we will setup a 3 Node Replica Set for MongoDB on Ubuntu 16. A Replica Set is a form of data replication, so that your data resides on more &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">


  <!-- font awesome --!>
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

  
  <link rel="canonical" href="http://blog.ruanbekker.com/blog/2017/09/02/setup-a-3-node-mongodb-replica-set-on-ubuntu-16/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Ruan Bekker's Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-105336110-1']);
    _gaq.push(['_setDomainName','ruanbekker.com']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Ruan Bekker's Blog</a></h1>
  
    <h2>From a Curious mind to Posts on Github</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://blog.ruanbekker.com/search/" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="blog.ruanbekker.com">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/blog/categories/aws/">AWS</a></li>
  <li><a href="/blog/categories/devops/">DevOps</a></li>
  <li><a href="/blog/categories/python/">Python</a></li>
  <li><a target="_blank" href="https://sysadmins.co.za">My HowTo Blog</a></li>
  <li><a href="/awesome-links/">Awesome Links</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Setup a 3 Node MongoDB Replica Set on Ubuntu 16</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-09-02T19:29:10-04:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>2</span><span class='date-suffix'>nd</span>, <span class='date-year'>2017</span></span> <span class='time'>7:29 pm</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Today we will setup a 3 Node Replica Set for MongoDB on Ubuntu 16. A Replica Set is a form of data replication, so that your data resides on more than one node for data durability. We will setup the 1st node as the primary node, the second as the secondary node and the 3rd node will act as an arbiter.</p>

<p>The arbiter node can almost be mentioned as a voter node, as it will be set in place to prevent split brain.</p>

<h2>Resources:</h2>

<ul>
<li><a href="https://eladnava.com/deploy-a-highly-available-mongodb-replica-set-on-aws/">https://eladnava.com/deploy-a-highly-available-mongodb-replica-set-on-aws/</a></li>
<li><a href="https://stackoverflow.com/questions/38524150/mongodb-replica-set-with-simple-password-authentication">https://stackoverflow.com/questions/38524150/mongodb-replica-set-with-simple-password-authentication</a> (auth)</li>
<li><a href="https://stackoverflow.com/questions/14789622/mongodb-keyfile-too-open-permissions">https://stackoverflow.com/questions/14789622/mongodb-keyfile-too-open-permissions</a></li>
</ul>


<h2>Installing MongoDB on our 3 Nodes:</h2>

<p>Our case, using Ubuntu 16.04, setting up our repository and installing mongodb from our repository:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 0C49F3730359A14518585931BC711F9BA15703C6
</span><span class='line'><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;deb [ arch=amd64,arm64 ] http://repo.mongodb.org/apt/ubuntu xenial/mongodb-org/3.4 multiverse&quot;</span> <span class="p">|</span> sudo tee /etc/apt/sources.list.d/mongodb-org-3.4.list
</span><span class='line'><span class="nv">$ </span>apt update
</span><span class='line'><span class="nv">$ </span>apt install -y mongodb-org -y
</span></code></pre></td></tr></table></div></figure>


<p>Preparing our Directories:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>mkdir -p /srv/mongodb/rs0-0 /srv/mongodb/rs0-1 /srv/mongodb/rs0-2
</span><span class='line'><span class="nv">$ </span>mkdir -p /var/log/mongodb/rs0-0 /var/log/mongodb/rs0-1 /var/log/mongodb/rs0-2
</span></code></pre></td></tr></table></div></figure>


<p>Populating our MongoDB Configuration:</p>

<ul>
<li>MongoDB Prefers XFS File Systems when using WiredTiger.</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>cat &gt; /etc/mongod.conf <span class="s">&lt;&lt; EOF</span>
</span><span class='line'><span class="s">storage:</span>
</span><span class='line'><span class="s">  dbPath: /var/lib/mongodb</span>
</span><span class='line'><span class="s">  journal:</span>
</span><span class='line'><span class="s">    enabled: false</span>
</span><span class='line'>
</span><span class='line'><span class="s">storage:</span>
</span><span class='line'><span class="s">  mmapv1:</span>
</span><span class='line'><span class="s">    smallFiles: true</span>
</span><span class='line'>
</span><span class='line'><span class="s">systemLog:</span>
</span><span class='line'><span class="s">  destination: file</span>
</span><span class='line'><span class="s">  logAppend: true</span>
</span><span class='line'><span class="s">  path: /var/log/mongodb/mongod.log</span>
</span><span class='line'>
</span><span class='line'><span class="s">net:</span>
</span><span class='line'><span class="s">  port: 27017</span>
</span><span class='line'><span class="s">  bindIp: 0.0.0.0</span>
</span><span class='line'>
</span><span class='line'><span class="s">replication:</span>
</span><span class='line'><span class="s">  replSetName: rs0</span>
</span><span class='line'>
</span><span class='line'><span class="s">security:</span>
</span><span class='line'><span class="s">  authorization: enabled</span>
</span><span class='line'><span class="s">EOF</span>
</span></code></pre></td></tr></table></div></figure>


<p>Enable MongoDB On Startup and Start MongoDB:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>systemctl <span class="nb">enable </span>mongod
</span><span class='line'><span class="nv">$ </span>systemctl restart mongod
</span></code></pre></td></tr></table></div></figure>


<h2>Setup MongoDB Replica Sets:</h2>

<p>In our setup we will have 3 nodes: (mongodb-1, mongodb-2, mongodb3) From our Primary Node, connect to MongoDB and inititalize our replica set:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>mongo
</span><span class='line'>MongoDB shell version v3.4.7
</span><span class='line'>connecting to: mongodb://127.0.0.1:27017
</span><span class='line'>MongoDB server version: 3.4.7
</span><span class='line'>&gt; rs.initiate<span class="o">()</span>
</span><span class='line'><span class="o">{</span>
</span><span class='line'>        <span class="s2">&quot;info2&quot;</span> : <span class="s2">&quot;no configuration specified. Using a default configuration for the set&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;me&quot;</span> : <span class="s2">&quot;mysql-1:27017&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;ok&quot;</span> : 1
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next, add our 2 other MongoDB Nodes, remember <code>mongodb-3</code> is our arbiter node:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>rs0:SECONDARY&gt; rs.add<span class="o">(</span><span class="s2">&quot;mongodb-2&quot;</span><span class="o">)</span>
</span><span class='line'><span class="o">{</span> <span class="s2">&quot;ok&quot;</span> : <span class="m">1</span> <span class="o">}</span>
</span><span class='line'>rs0:PRIMARY&gt; rs.add<span class="o">(</span><span class="s2">&quot;mongodb-3&quot;</span>, <span class="nb">true</span><span class="o">)</span>
</span><span class='line'><span class="o">{</span> <span class="s2">&quot;ok&quot;</span> : <span class="m">1</span> <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Verify the Replica Set Status:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>rs0:PRIMARY&gt; rs.status<span class="o">()</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="p">{</span>
</span><span class='line'>        <span class="nt">&quot;set&quot;</span> <span class="p">:</span> <span class="s2">&quot;rs0&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="nt">&quot;date&quot;</span> <span class="p">:</span> <span class="err">ISODate(</span><span class="s2">&quot;2017-08-27T13:17:42.469Z&quot;</span><span class="err">)</span><span class="p">,</span>
</span><span class='line'>        <span class="nt">&quot;myState&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>        <span class="nt">&quot;term&quot;</span> <span class="p">:</span> <span class="err">NumberLong(</span><span class="mi">1</span><span class="err">)</span><span class="p">,</span>
</span><span class='line'>        <span class="nt">&quot;heartbeatIntervalMillis&quot;</span> <span class="p">:</span> <span class="err">NumberLong(</span><span class="mi">2000</span><span class="err">)</span><span class="p">,</span>
</span><span class='line'>        <span class="nt">&quot;optimes&quot;</span> <span class="p">:</span> <span class="p">{</span>
</span><span class='line'>                <span class="nt">&quot;lastCommittedOpTime&quot;</span> <span class="p">:</span> <span class="p">{</span>
</span><span class='line'>                        <span class="nt">&quot;ts&quot;</span> <span class="p">:</span> <span class="err">Timestamp(</span><span class="mi">0</span><span class="p">,</span> <span class="err">0),</span>
</span><span class='line'>                        <span class="nt">&quot;t&quot;</span> <span class="p">:</span> <span class="err">NumberLong(</span><span class="mi">-1</span><span class="err">)</span>
</span><span class='line'>                <span class="p">},</span>
</span><span class='line'>                <span class="nt">&quot;appliedOpTime&quot;</span> <span class="p">:</span> <span class="p">{</span>
</span><span class='line'>                        <span class="nt">&quot;ts&quot;</span> <span class="p">:</span> <span class="err">Timestamp(</span><span class="mi">1503839853</span><span class="p">,</span> <span class="err">1),</span>
</span><span class='line'>                        <span class="nt">&quot;t&quot;</span> <span class="p">:</span> <span class="err">NumberLong(</span><span class="mi">1</span><span class="err">)</span>
</span><span class='line'>                <span class="p">},</span>
</span><span class='line'>                <span class="nt">&quot;durableOpTime&quot;</span> <span class="p">:</span> <span class="p">{</span>
</span><span class='line'>                        <span class="nt">&quot;ts&quot;</span> <span class="p">:</span> <span class="err">Timestamp(</span><span class="mi">1503839722</span><span class="p">,</span> <span class="err">1),</span>
</span><span class='line'>                        <span class="nt">&quot;t&quot;</span> <span class="p">:</span> <span class="err">NumberLong(</span><span class="mi">-1</span><span class="err">)</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="nt">&quot;members&quot;</span> <span class="p">:</span> <span class="p">[</span>
</span><span class='line'>                <span class="p">{</span>
</span><span class='line'>                        <span class="nt">&quot;_id&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span class='line'>                        <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;mysql-1:27017&quot;</span><span class="p">,</span>
</span><span class='line'>                        <span class="nt">&quot;health&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>                        <span class="nt">&quot;state&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>                        <span class="nt">&quot;stateStr&quot;</span> <span class="p">:</span> <span class="s2">&quot;PRIMARY&quot;</span><span class="p">,</span>
</span><span class='line'>                        <span class="nt">&quot;uptime&quot;</span> <span class="p">:</span> <span class="mi">422</span><span class="p">,</span>
</span><span class='line'>                        <span class="nt">&quot;optime&quot;</span> <span class="p">:</span> <span class="p">{</span>
</span><span class='line'>                                <span class="nt">&quot;ts&quot;</span> <span class="p">:</span> <span class="err">Timestamp(</span><span class="mi">1503839853</span><span class="p">,</span> <span class="err">1),</span>
</span><span class='line'>                                <span class="nt">&quot;t&quot;</span> <span class="p">:</span> <span class="err">NumberLong(</span><span class="mi">1</span><span class="err">)</span>
</span><span class='line'>                        <span class="p">},</span>
</span><span class='line'>                        <span class="nt">&quot;optimeDate&quot;</span> <span class="p">:</span> <span class="err">ISODate(</span><span class="s2">&quot;2017-08-27T13:17:33Z&quot;</span><span class="err">)</span><span class="p">,</span>
</span><span class='line'>                        <span class="nt">&quot;electionTime&quot;</span> <span class="p">:</span> <span class="err">Timestamp(</span><span class="mi">1503839723</span><span class="p">,</span> <span class="err">1),</span>
</span><span class='line'>                        <span class="nt">&quot;electionDate&quot;</span> <span class="p">:</span> <span class="err">ISODate(</span><span class="s2">&quot;2017-08-27T13:15:23Z&quot;</span><span class="err">)</span><span class="p">,</span>
</span><span class='line'>                        <span class="nt">&quot;configVersion&quot;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
</span><span class='line'>                        <span class="nt">&quot;self&quot;</span> <span class="p">:</span> <span class="kc">true</span>
</span><span class='line'>                <span class="p">},</span>
</span><span class='line'>                <span class="p">{</span>
</span><span class='line'>                        <span class="nt">&quot;_id&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>                        <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;mongodb-2:27017&quot;</span><span class="p">,</span>
</span><span class='line'>                        <span class="nt">&quot;health&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>                        <span class="nt">&quot;state&quot;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</span><span class='line'>                        <span class="nt">&quot;stateStr&quot;</span> <span class="p">:</span> <span class="s2">&quot;SECONDARY&quot;</span><span class="p">,</span>
</span><span class='line'>                        <span class="nt">&quot;uptime&quot;</span> <span class="p">:</span> <span class="mi">28</span><span class="p">,</span>
</span><span class='line'>                        <span class="nt">&quot;optime&quot;</span> <span class="p">:</span> <span class="p">{</span>
</span><span class='line'>                                <span class="nt">&quot;ts&quot;</span> <span class="p">:</span> <span class="err">Timestamp(</span><span class="mi">1503839853</span><span class="p">,</span> <span class="err">1),</span>
</span><span class='line'>                                <span class="nt">&quot;t&quot;</span> <span class="p">:</span> <span class="err">NumberLong(</span><span class="mi">1</span><span class="err">)</span>
</span><span class='line'>                        <span class="p">},</span>
</span><span class='line'>                        <span class="nt">&quot;optimeDurable&quot;</span> <span class="p">:</span> <span class="p">{</span>
</span><span class='line'>                                <span class="nt">&quot;ts&quot;</span> <span class="p">:</span> <span class="err">Timestamp(</span><span class="mi">0</span><span class="p">,</span> <span class="err">0),</span>
</span><span class='line'>                                <span class="nt">&quot;t&quot;</span> <span class="p">:</span> <span class="err">NumberLong(</span><span class="mi">-1</span><span class="err">)</span>
</span><span class='line'>                        <span class="p">},</span>
</span><span class='line'>                        <span class="nt">&quot;optimeDate&quot;</span> <span class="p">:</span> <span class="err">ISODate(</span><span class="s2">&quot;2017-08-27T13:17:33Z&quot;</span><span class="err">)</span><span class="p">,</span>
</span><span class='line'>                        <span class="nt">&quot;optimeDurableDate&quot;</span> <span class="p">:</span> <span class="err">ISODate(</span><span class="s2">&quot;1970-01-01T00:00:00Z&quot;</span><span class="err">)</span><span class="p">,</span>
</span><span class='line'>                        <span class="nt">&quot;lastHeartbeat&quot;</span> <span class="p">:</span> <span class="err">ISODate(</span><span class="s2">&quot;2017-08-27T13:17:41.707Z&quot;</span><span class="err">)</span><span class="p">,</span>
</span><span class='line'>                        <span class="nt">&quot;lastHeartbeatRecv&quot;</span> <span class="p">:</span> <span class="err">ISODate(</span><span class="s2">&quot;2017-08-27T13:17:40.699Z&quot;</span><span class="err">)</span><span class="p">,</span>
</span><span class='line'>                        <span class="nt">&quot;pingMs&quot;</span> <span class="p">:</span> <span class="err">NumberLong(</span><span class="mi">4</span><span class="err">)</span><span class="p">,</span>
</span><span class='line'>                        <span class="nt">&quot;syncingTo&quot;</span> <span class="p">:</span> <span class="s2">&quot;mysql-1:27017&quot;</span><span class="p">,</span>
</span><span class='line'>                        <span class="nt">&quot;configVersion&quot;</span> <span class="p">:</span> <span class="mi">3</span>
</span><span class='line'>                <span class="p">},</span>
</span><span class='line'>                <span class="p">{</span>
</span><span class='line'>                        <span class="nt">&quot;_id&quot;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</span><span class='line'>                        <span class="nt">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;mongodb-3:27017&quot;</span><span class="p">,</span>
</span><span class='line'>                        <span class="nt">&quot;health&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>                        <span class="nt">&quot;state&quot;</span> <span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
</span><span class='line'>                        <span class="nt">&quot;stateStr&quot;</span> <span class="p">:</span> <span class="s2">&quot;ARBITER&quot;</span><span class="p">,</span>
</span><span class='line'>                        <span class="nt">&quot;uptime&quot;</span> <span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
</span><span class='line'>                        <span class="nt">&quot;lastHeartbeat&quot;</span> <span class="p">:</span> <span class="err">ISODate(</span><span class="s2">&quot;2017-08-27T13:17:41.721Z&quot;</span><span class="err">)</span><span class="p">,</span>
</span><span class='line'>                        <span class="nt">&quot;lastHeartbeatRecv&quot;</span> <span class="p">:</span> <span class="err">ISODate(</span><span class="s2">&quot;2017-08-27T13:17:38.749Z&quot;</span><span class="err">)</span><span class="p">,</span>
</span><span class='line'>                        <span class="nt">&quot;pingMs&quot;</span> <span class="p">:</span> <span class="err">NumberLong(</span><span class="mi">2</span><span class="err">)</span><span class="p">,</span>
</span><span class='line'>                        <span class="nt">&quot;configVersion&quot;</span> <span class="p">:</span> <span class="mi">3</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>        <span class="p">],</span>
</span><span class='line'>        <span class="nt">&quot;ok&quot;</span> <span class="p">:</span> <span class="mi">1</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="err">rs</span><span class="mi">0</span><span class="err">:PRIMARY&gt;</span> <span class="err">exit</span>
</span><span class='line'><span class="err">bye</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Setup Auth:</h2>

<p>Setup Authentication on our MongoDB Database, we will create the user <code>adminuser</code> and setup the password to <code>secret</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>rs0:PRIMARY&gt; use admin
</span><span class='line'>switched to db admin
</span><span class='line'>
</span><span class='line'>rs0:PRIMARY&gt; db.createUser<span class="o">({</span>user: <span class="s2">&quot;adminuser&quot;</span>, <span class="nb">pwd</span>: <span class="s2">&quot;secret&quot;</span>, roles:<span class="o">[{</span>role: <span class="s2">&quot;root&quot;</span>, db: <span class="s2">&quot;admin&quot;</span><span class="o">}]})</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="err">Successfully</span> <span class="err">added</span> <span class="err">user:</span> <span class="p">{</span>
</span><span class='line'>        <span class="nt">&quot;user&quot;</span> <span class="p">:</span> <span class="s2">&quot;adminuser&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="nt">&quot;roles&quot;</span> <span class="p">:</span> <span class="p">[</span>
</span><span class='line'>                <span class="p">{</span>
</span><span class='line'>                        <span class="nt">&quot;role&quot;</span> <span class="p">:</span> <span class="s2">&quot;root&quot;</span><span class="p">,</span>
</span><span class='line'>                        <span class="nt">&quot;db&quot;</span> <span class="p">:</span> <span class="s2">&quot;admin&quot;</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>        <span class="p">]</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="err">rs</span><span class="mi">0</span><span class="err">:PRIMARY&gt;</span> <span class="err">exit</span>
</span></code></pre></td></tr></table></div></figure>


<p>Restart MongoDB:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>systemctl restart mongod
</span></code></pre></td></tr></table></div></figure>


<h2>Connect and Authenticate against MongoDB:</h2>

<p>Connect to your MongoDB Cluster with auth:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>mongo --host mongodb.example.com --port <span class="m">27017</span> -u &lt;username&gt; -p --authenticationDatabase admin
</span></code></pre></td></tr></table></div></figure>



</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Ruan</span></span>

      




<time class='entry-date' datetime='2017-09-02T19:29:10-04:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>2</span><span class='date-suffix'>nd</span>, <span class='date-year'>2017</span></span> <span class='time'>7:29 pm</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/cluster/'>cluster</a>, <a class='category' href='/blog/categories/databases/'>databases</a>, <a class='category' href='/blog/categories/mongodb/'>mongodb</a>, <a class='category' href='/blog/categories/nosql/'>nosql</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://blog.ruanbekker.com/blog/2017/09/02/setup-a-3-node-mongodb-replica-set-on-ubuntu-16/" data-via="ruanbekker" data-counturl="http://blog.ruanbekker.com/blog/2017/09/02/setup-a-3-node-mongodb-replica-set-on-ubuntu-16/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2017/08/31/setup-haproxy-load-balancer-for-mysql-galera-with-ip-whitelisting-and-backup-servers/" title="Previous Post: Setup HAProxy Load Balancer for MySQL Galera with IP Whitelisting and Backup Servers">&laquo; Setup HAProxy Load Balancer for MySQL Galera with IP Whitelisting and Backup Servers</a>
      
      
        <a class="basic-alignment right" href="/blog/2017/09/04/splitting-characters-with-python-to-determine-name-surname-and-email-address/" title="Next Post: Splitting Characters with Python to determine Name Surname and Email Address">Splitting Characters with Python to determine Name Surname and Email Address &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2018/04/29/using-the-bulk-api-with-elasticsearch/">Using the Bulk API With Elasticsearch</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/04/29/encryption-and-decryption-with-simple-crypt-using-python/">Encryption and Decryption With Simple Crypt Using Python</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/04/23/using-paramiko-module-in-python-to-execute-remote-bash-commands/">Using Paramiko Module in Python to Execute Remote Bash Commands</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/04/23/setup-a-ssh-tunnel-with-the-sshtunnel-module-in-python/">Setup a SSH Tunnel With the Sshtunnel Module in Python</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/04/21/basic-restful-api-server-with-python-flask/">Basic RESTFul API Server With Python Flask</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2018 - Ruan -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>



  <li>
    <a href="https://twitter.com/ruanbekker">
      <i class="fa fa-twitter"></i> Twitter
    </a>
  </li>



  <li>
    <a href="https://github.com/ruanbekker">
      <i class="fa fa-github"></i> GitHub
    </a>
  </li>



  <li>
    <a href="https://sysadmins.co.za">
      <i class="fa fa-bars"></i> My HowTo Blog
    </a>
  </li>


</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'blog-ruanbekker';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://blog.ruanbekker.com/blog/2017/09/02/setup-a-3-node-mongodb-replica-set-on-ubuntu-16/';
        var disqus_url = 'http://blog.ruanbekker.com/blog/2017/09/02/setup-a-3-node-mongodb-replica-set-on-ubuntu-16/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
