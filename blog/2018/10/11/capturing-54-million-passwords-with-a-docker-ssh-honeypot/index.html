
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Capturing 54 Million Passwords With a Docker SSH Honeypot - Ruan Bekker's Blog</title>
  <meta name="author" content="Ruan">

  
  <meta name="description" content="The last couple of days I picked up on my ELK Stack a couple thousands of SSH Brute Force Attacks, so I decided I will just revisit my SSH Server &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">


  <!-- font awesome --!>
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

  
  <link rel="canonical" href="http://blog.ruanbekker.com/blog/2018/10/11/capturing-54-million-passwords-with-a-docker-ssh-honeypot/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Ruan Bekker's Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-105336110-1']);
    _gaq.push(['_setDomainName','ruanbekker.com']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Ruan Bekker's Blog</a></h1>
  
    <h2>From a Curious mind to Posts on Github</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://blog.ruanbekker.com/search/" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="blog.ruanbekker.com">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/blog/categories/aws/">AWS</a></li>
  <li><a href="/blog/categories/docker/">Docker</a></li>
  <li><a href="/blog/categories/devops/">DevOps</a></li>
  <li><a href="/blog/categories/python/">Python</a></li>
  <li><a target="_blank" href="https://sysadmins.co.za">My HowTo Blog</a></li>
  <li><a href="/awesome-links/">Awesome Links</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Capturing 54 Million Passwords With a Docker SSH Honeypot</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2018-10-11T16:38:52-04:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>11</span><span class='date-suffix'>th</span>, <span class='date-year'>2018</span></span> <span class='time'>4:38 pm</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><p><img src="https://res.cloudinary.com/rbekker/image/upload/v1539291851/ssh-docker-honeypot_eyhzc7.png" alt="" /></p>

<p>The last couple of days I picked up on my ELK Stack a couple thousands of SSH Brute Force Attacks, so I decided I will just revisit my SSH Server configuration, and change my SSH Port to something else for the interim. The dashboard that showed me the results at that point in time:</p>

<p><img src="https://res.cloudinary.com/rbekker/image/upload/v1539292443/kibana-failed-ssh-auth_udkxkl.png" alt="" /></p>

<p>Then I decided I actually would like to setup a SSH Honeypot to listen on Port 22 and change my SSH Server to listen on 222 and capture their IP Addresses, Usernames and Passwords that they are trying to use and dump it all in a file so that I can build up my own password dictionary :D</p>

<h2>SSH Configuration:</h2>

<p>Changing the SSH Port:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>sudo vim /etc/ssh/sshd_config
</span></code></pre></td></tr></table></div></figure>


<p>Change the port to 222:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Port 222
</span></code></pre></td></tr></table></div></figure>


<p>Restart the SSH Server:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>sudo /etc/init.d/ssh restart
</span></code></pre></td></tr></table></div></figure>


<p>Verify that the SSH Server is running on the new port:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>sudo netstat -tulpn <span class="p">|</span> grep sshd
</span><span class='line'>tcp        <span class="m">0</span>      <span class="m">0</span> 0.0.0.0:222            0.0.0.0:*               LISTEN      28838/sshd
</span></code></pre></td></tr></table></div></figure>


<h2>Docker SSH Honeypot:</h2>

<p>Thanks to <a href="https://github.com/random-robbie/docker-ssh-honey">random-robbie</a>, as he had everything I was looking for on Github.</p>

<p>Setup the SSH Honeypot:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>git clone https://github.com/random-robbie/docker-ssh-honey
</span><span class='line'><span class="nv">$ </span><span class="nb">cd </span>docker-ssh-honey/
</span><span class='line'><span class="nv">$ </span>docker build . -t <span class="nb">local</span>:ssh-honepot
</span><span class='line'><span class="nv">$ </span>docker run -itd --name ssh-honeypot -p 22:22 <span class="nb">local</span>:ssh-honepot
</span></code></pre></td></tr></table></div></figure>


<p>Once people attempt to ssh, you will get the output to stdout:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker logs -f <span class="k">$(</span>docker ps -f <span class="nv">name</span><span class="o">=</span>ssh-honeypot -q<span class="k">)</span> <span class="p">|</span> grep -v <span class="s1">&#39;Error exchanging&#39;</span> <span class="p">|</span> head -10
</span><span class='line'><span class="o">[</span>Tue Jul <span class="m">31</span> 01:13:41 2018<span class="o">]</span> ssh-honeypot 0.0.8 by Daniel Roberson started on port 22. PID 5
</span><span class='line'><span class="o">[</span>Tue Jul <span class="m">31</span> 01:19:49 2018<span class="o">]</span> 1xx.1xx.1xx.1x gambaa gambaa
</span><span class='line'><span class="o">[</span>Tue Jul <span class="m">31</span> 01:23:26 2018<span class="o">]</span> 1xx.9x.1xx.1xx root toor
</span><span class='line'><span class="o">[</span>Tue Jul <span class="m">31</span> 01:25:57 2018<span class="o">]</span> 1xx.2xx.1xx.1xx root Passw0rd1234
</span><span class='line'><span class="o">[</span>Tue Jul <span class="m">31</span> 01:26:00 2018<span class="o">]</span> 1xx.2xx.1xx.1xx root Qwer1234
</span><span class='line'><span class="o">[</span>Tue Jul <span class="m">31</span> 01:26:00 2018<span class="o">]</span> 1xx.2xx.1xx.1xx root Abcd1234
</span><span class='line'><span class="o">[</span>Tue Jul <span class="m">31</span> 01:26:08 2018<span class="o">]</span> 1xx.2xx.1xx.1xx root ubuntu
</span><span class='line'><span class="o">[</span>Tue Jul <span class="m">31</span> 01:26:09 2018<span class="o">]</span> 1xx.2xx.1xx.1xx root PassWord
</span><span class='line'><span class="o">[</span>Tue Jul <span class="m">31</span> 01:26:10 2018<span class="o">]</span> 1xx.2xx.1xx.1xx root password321
</span><span class='line'><span class="o">[</span>Tue Jul <span class="m">31</span> 01:26:15 2018<span class="o">]</span> 1xx.2xx.1xx.1xx root zxcvbnm
</span></code></pre></td></tr></table></div></figure>


<h2>Saving results to disk:</h2>

<p>Redirecting the output to a log file, running in the foreground as a screen session:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>screen -S honeypot
</span><span class='line'><span class="nv">$ </span>docker logs -f f6cb <span class="p">|</span> grep -v <span class="s1">&#39;Error exchanging&#39;</span> <span class="p">|</span> awk <span class="s1">&#39;{print $6, $7, $8}&#39;</span> &gt;&gt; /var/log/ssh-honeypot.log
</span></code></pre></td></tr></table></div></figure>


<p>Detach from your screen session:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Ctrl + a<span class="p">;</span> d
</span></code></pre></td></tr></table></div></figure>


<p>Checking out the logs</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>head -3 /var/log/ssh-honeypot.log
</span><span class='line'>2.7.2x.1x root jiefan
</span><span class='line'>4x.7.2x.1x root HowAreYou
</span><span class='line'>4x.7.2x.1x root Sqladmin
</span></code></pre></td></tr></table></div></figure>


<p>Leaving this running for a couple of months, and I have a massive password database:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>wc -l /var/log/honeypot/ssh.log
</span><span class='line'><span class="m">54184260</span> /var/log/honeypot/ssh.log
</span></code></pre></td></tr></table></div></figure>


<p>That is correct, 54 million password attempts. 5372 Unique IPs, 4082 Unique Usernames, 88829 Unique Passwords.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Ruan</span></span>

      




<time class='entry-date' datetime='2018-10-11T16:38:52-04:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>11</span><span class='date-suffix'>th</span>, <span class='date-year'>2018</span></span> <span class='time'>4:38 pm</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/docker/'>docker</a>, <a class='category' href='/blog/categories/honeypot/'>honeypot</a>, <a class='category' href='/blog/categories/security/'>security</a>, <a class='category' href='/blog/categories/ssh/'>ssh</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://blog.ruanbekker.com/blog/2018/10/11/capturing-54-million-passwords-with-a-docker-ssh-honeypot/" data-via="ruanbekker" data-counturl="http://blog.ruanbekker.com/blog/2018/10/11/capturing-54-million-passwords-with-a-docker-ssh-honeypot/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2018/10/04/splitting-query-string-parameters-from-a-url-in-python/" title="Previous Post: Splitting Query String Parameters from a URL in Python">&laquo; Splitting Query String Parameters from a URL in Python</a>
      
      
        <a class="basic-alignment right" href="/blog/2018/10/23/my-pistack-blog-proudly-hosted-on-my-raspberrypi-swarm-cluster/" title="Next Post: My PiStack Blog Proudly hosted on my RaspberryPi Swarm Cluster">My PiStack Blog Proudly hosted on my RaspberryPi Swarm Cluster &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2018/10/23/my-pistack-blog-proudly-hosted-on-my-raspberrypi-swarm-cluster/">My PiStack Blog Proudly Hosted on My RaspberryPi Swarm Cluster</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/10/11/capturing-54-million-passwords-with-a-docker-ssh-honeypot/">Capturing 54 Million Passwords With a Docker SSH Honeypot</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/10/04/splitting-query-string-parameters-from-a-url-in-python/">Splitting Query String Parameters From a URL in Python</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/09/12/using-the-geoip-processor-plugin-with-elasticsearch-to-enrich-your-location-based-data/">Using the GeoIP Processor Plugin With Elasticsearch to Enrich Your Location Based Data</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/09/05/investigating-high-request-latencies-on-amazon-dynamodb/">Investigating High Request Latencies on Amazon DynamoDB</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2018 - Ruan -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>



  <li>
    <a href="https://twitter.com/ruanbekker">
      <i class="fa fa-twitter"></i> Twitter
    </a>
  </li>



  <li>
    <a href="https://github.com/ruanbekker">
      <i class="fa fa-github"></i> GitHub
    </a>
  </li>



  <li>
    <a href="https://sysadmins.co.za">
      <i class="fa fa-bars"></i> My HowTo Blog
    </a>
  </li>


</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'blog-ruanbekker';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://blog.ruanbekker.com/blog/2018/10/11/capturing-54-million-passwords-with-a-docker-ssh-honeypot/';
        var disqus_url = 'http://blog.ruanbekker.com/blog/2018/10/11/capturing-54-million-passwords-with-a-docker-ssh-honeypot/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
