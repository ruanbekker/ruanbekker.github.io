
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Ingesting Pocket.com Links Into Elasticsearch - Ruan Bekker's Blog</title>
  <meta name="author" content="Ruan">

  
  <meta name="description" content="Links that I stumble upon, I always save to getpocket.com and tag them with the relevant info. So the one day I had this random idea to list my &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- font awesome --!>
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

  <!-- samwize.com/2012/09/24/octopress-table-stylesheet --!>
  <link href="/stylesheets/data-table.css" media="screen, projection" rel="stylesheet" type="text/css" />

  
  <link rel="canonical" href="https://blog.ruanbekker.com/blog/2020/06/08/ingesting-pocket-items-into-elasticsearch/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Ruan Bekker's Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-105336110-1']);
    _gaq.push(['_setDomainName','ruanbekker.com']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


  <script async defer data-website-id="2cfa7c36-c1f7-48fd-949c-2e5e8a1d873d" src="https://umami-analytics.ruan.dev/umami.js"></script>

  <!-- Google AdSense -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1100086574264181"
     crossorigin="anonymous"></script>

  <!-- Twitter cards # www.brianbunke.com/blog/2017/09/06/twitter-cards-on-jekyll -->
<meta name="twitter:site"    content="@ruanbekker">
<meta name="twitter:creator" content="@">
<meta name="twitter:title"   content="Ingesting Pocket.com Links into Elasticsearch">


<meta name="twitter:description" content="">



<meta name="twitter:card"  content="summary">
<meta name="twitter:image" content="https://user-images.githubusercontent.com/567298/69000657-c093e780-08db-11ea-8464-bcd3023e9923.png">

<!-- end of Twitter cards -->

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Ruan Bekker's Blog</a></h1>
  
    <h2>From a Curious mind to Posts on Github</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://blog.ruanbekker.com/search/" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="blog.ruanbekker.com">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/blog/categories/aws/">AWS</a></li>
  <li><a href="/blog/categories/docker/">Docker</a></li>
  <li><a href="/blog/categories/devops/">DevOps</a></li>
  <li><a href="/blog/categories/python/">Python</a></li>
  <li><a target="_blank" href="https://sysadmins.co.za">My Sysadmins Blog</a></li>
  <li><a href="https://ruan.dev/">About Me</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Ingesting Pocket.com Links Into Elasticsearch</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2020-06-08T23:06:23+02:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>8</span><span class='date-suffix'>th</span>, <span class='date-year'>2020</span></span> <span class='time'>11:06 pm</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><p><img src="https://img.sysadmins.co.za/wngib2.png" alt="python-elasticsearch-pocket" /></p>

<p>Links that I stumble upon, I always save to <a href="https://getpocket.com">getpocket.com</a> and tag them with the relevant info. So the one day I had this random idea to list my links per category on a web service and I was wondering how to approach that scenario, which lead me to this.</p>

<p>In this post we will consume all our saved bookmarks from pocket.com and ingest them into elasticsearch. But we dont want to read all the items from pocket&rsquo;s api every single time when the consumer run, therefore I have a method of checkpointing the last save run with a timestamp, so the next time it runs, we have context where to start from</p>

<h2>What will we be doing</h2>

<p>We will authenticate with pocket, then write the code how we will read the data from pocket and ingest them into elasticsearch.</p>

<h2>Authentication</h2>

<p>Head over to the <a href="https://getpocket.com/developer/apps/new">developer console</a> on pocket and create a new application then save your config in <code>config.py</code> which we will have as:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>application_name = "Awesome Links"
</span><span class='line'>application_link = "https://getpocket.com/developer/app/x/x"
</span><span class='line'>application_url = "https://awesome-links.domain"
</span><span class='line'>consumer_key = "x"
</span><span class='line'>access_token = "x"
</span><span class='line'>es_host = ""
</span><span class='line'>es_user = ""
</span><span class='line'>es_pass = ""</span></code></pre></td></tr></table></div></figure>


<p>Ensure that you have the requests library installed (<code>pip install requests</code>), the code that I used to get a access token:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>import config
</span><span class='line'>import requests
</span><span class='line'>import webbrowser
</span><span class='line'>import time
</span><span class='line'>
</span><span class='line'>CONSUMER_KEY = config.consumer_key
</span><span class='line'>BASE_URL = "https://getpocket.com"
</span><span class='line'>REDIRECT_URL = "localhost" # &lt;-- you can run python -m SimpleHTTPServer 80 to have a local server listening on port 80
</span><span class='line'>HEADERS = {"Content-Type": "application/json; charset=UTF-8", "X-Accept": "application/json"}
</span><span class='line'>
</span><span class='line'>def request_code():
</span><span class='line'>    payload = {
</span><span class='line'>        "consumer_key": CONSUMER_KEY,
</span><span class='line'>        "redirect_uri": REDIRECT_URL,
</span><span class='line'>    }
</span><span class='line'>    response = requests.post("https://getpocket.com/v3/oauth/request", headers=HEADERS, json=payload)
</span><span class='line'>    print("request_code")
</span><span class='line'>    print(response.json())
</span><span class='line'>    return response.json()["code"]
</span><span class='line'>
</span><span class='line'>def request_access_token(code):
</span><span class='line'>    payload = {
</span><span class='line'>        "consumer_key": CONSUMER_KEY,
</span><span class='line'>        "code": code,
</span><span class='line'>    }
</span><span class='line'>    response = requests.post("https://getpocket.com/v3/oauth/authorize", headers=HEADERS, json=payload)
</span><span class='line'>    print("request_access_token")
</span><span class='line'>    print(response.json())
</span><span class='line'>    time.sleep(10)
</span><span class='line'>    return response.json()["access_token"]
</span><span class='line'>
</span><span class='line'>def request_authorization(code):
</span><span class='line'>    url = "https://getpocket.com/auth/authorize?request_token={code}&redirect_uri={redirect_url}".format(code=code, redirect_url=REDIRECT_URL)
</span><span class='line'>    print("request_authorization")
</span><span class='line'>    print(url)
</span><span class='line'>    webbrowser.open(url, new=2)
</span><span class='line'>
</span><span class='line'>def authenticate_pocket():
</span><span class='line'>    code = request_code()
</span><span class='line'>    request_authorization(code)
</span><span class='line'>    return request_access_token(code)
</span><span class='line'>
</span><span class='line'>authenticate_pocket()
</span><span class='line'># access_token will be returned</span></code></pre></td></tr></table></div></figure>


<h2>Main App</h2>

<p>Once we have our access_token we can save that to our <code>config.py</code>, we will also be working with elasticsearch so we can add our elasticsearch info there as well:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#!/usr/bin/env python
</span><span class='line'>
</span><span class='line'>import config
</span><span class='line'>import requests
</span><span class='line'>import time
</span><span class='line'>
</span><span class='line'>CONSUMER_KEY = config.consumer_key
</span><span class='line'>ACCESS_TOKEN = config.access_token
</span><span class='line'>HEADERS = {"Content-Type": "application/json; charset=UTF-8", "X-Accept": "application/json"}
</span><span class='line'>ES_HOST = config.es_host
</span><span class='line'>ES_USER = config.es_user
</span><span class='line'>ES_PASS = config.es_pass
</span><span class='line'>
</span><span class='line'>def write_checkpoint(timestamp):
</span><span class='line'>    response = requests.put(
</span><span class='line'>        'https://{eshost}/pocket-data/_doc/checkpoint'.format(eshost=ES_HOST),
</span><span class='line'>        auth=(ES_USER, ES_PASS),
</span><span class='line'>        json={
</span><span class='line'>            "checkpoint_timestamp": timestamp
</span><span class='line'>        }
</span><span class='line'>    )
</span><span class='line'>    return {"checkpoint_timestamp": timestamp}
</span><span class='line'>
</span><span class='line'>def get_checkpoint():
</span><span class='line'>    response = requests.get(
</span><span class='line'>        'https://{eshost}/pocket-data/_doc/checkpoint'.format(ES_HOST),
</span><span class='line'>        auth=(ES_USER, ES_PASS)
</span><span class='line'>    )
</span><span class='line'>    checkpoint_timestamp = response.json()['_source']['checkpoint_timestamp']
</span><span class='line'>    return checkpoint_timestamp
</span><span class='line'>
</span><span class='line'>def ingest_to_es(payload):
</span><span class='line'>    response = requests.put(
</span><span class='line'>        'https://{eshost}/pocket-data/_doc/{item_id}'.format(eshost=ES_HOST, item_id=payload['item_id']),
</span><span class='line'>        auth=(ES_USER, ES_PASS),
</span><span class='line'>        json=payload
</span><span class='line'>    )
</span><span class='line'>    return response.json()
</span><span class='line'>
</span><span class='line'>def convert_timestamp(epoch):
</span><span class='line'>    return time.strftime('%Y-%m-%d', time.localtime(int(epoch)))
</span><span class='line'>
</span><span class='line'>def mapper(pocket_item):
</span><span class='line'>    try:
</span><span class='line'>        payload = {
</span><span class='line'>            "item_id": pocket_item['item_id'],
</span><span class='line'>            "time_added": convert_timestamp(pocket_item['time_added']),
</span><span class='line'>            "url": pocket_item['resolved_url'],
</span><span class='line'>            "title": pocket_item['resolved_title'],
</span><span class='line'>            #"excerpt": pocket_item['excerpt'],
</span><span class='line'>            "tags": list(pocket_item['tags'].keys())
</span><span class='line'>        }
</span><span class='line'>    except:
</span><span class='line'>        print("error, item has been skipped:")
</span><span class='line'>        print(pocket_item)
</span><span class='line'>        payload = "skip"
</span><span class='line'>    return payload
</span><span class='line'>
</span><span class='line'>def ingest_pocket_items(payload):
</span><span class='line'>    pocket_items = list()
</span><span class='line'>    pocket_items.extend(payload['list'].keys())
</span><span class='line'>    last_scraped_time = payload['since']
</span><span class='line'>    number_of_items = len(pocket_items)
</span><span class='line'>    print('got {} items from pocket'.format(len(pocket_items)))
</span><span class='line'>    time.sleep(5)
</span><span class='line'>    if len(pocket_items) &gt; 0:
</span><span class='line'>        for pocket_item in pocket_items:
</span><span class='line'>            mapped_payload = mapper(payload['list'][pocket_item])
</span><span class='line'>            #print(mapped_payload)
</span><span class='line'>            if mapped_payload != "skip":
</span><span class='line'>                ingest_to_es(mapped_payload)
</span><span class='line'>            print("Number of items left to ingest: {}".format(number_of_items))
</span><span class='line'>            number_of_items-=1
</span><span class='line'>    else:
</span><span class='line'>        print('nothing new')
</span><span class='line'>    print('writing checkpoint to es: {}'.format(last_scraped_time))
</span><span class='line'>    write_checkpoint(last_scraped_time)
</span><span class='line'>    return 'done'
</span><span class='line'>
</span><span class='line'>def fetch_pocket_items(timestamp):
</span><span class='line'>    response = requests.post(
</span><span class='line'>        "https://getpocket.com/v3/get",
</span><span class='line'>        headers=HEADERS,
</span><span class='line'>        json={
</span><span class='line'>            "consumer_key": CONSUMER_KEY,
</span><span class='line'>            "access_token": ACCESS_TOKEN,
</span><span class='line'>            "state": "all",
</span><span class='line'>            "contentType": "article",
</span><span class='line'>            "sort": "newest",
</span><span class='line'>            "detailType": "complete",
</span><span class='line'>            "since": int(timestamp)
</span><span class='line'>        }
</span><span class='line'>    )
</span><span class='line'>    return response.json()
</span><span class='line'>
</span><span class='line'># get checkpoint
</span><span class='line'>print('getting checkpoint id')
</span><span class='line'>checkpoint_timestamp = get_checkpoint()
</span><span class='line'>print('got checkpoint id: {}'.format(checkpoint_timestamp))
</span><span class='line'>time.sleep(5)
</span><span class='line'>
</span><span class='line'># fetch items from pocket
</span><span class='line'>print('fetch items from pocket')
</span><span class='line'>pocket_response = fetch_pocket_items(checkpoint_timestamp)
</span><span class='line'>
</span><span class='line'># write
</span><span class='line'>print('ingesting pocket items into es')
</span><span class='line'>ingest_pocket_items(pocket_response)</span></code></pre></td></tr></table></div></figure>


<p>So what we are doing here is that we are reading from the pocket api all the data that you saved in your account, and save the current time in epoch format, which we will need to tell our run when was the last time we consumed and keep that value in memory.</p>

<p>Then from the data we received, we will map the data that we are interested in, into key/value pairs and then ingest the data into elasticsearch.</p>

<p>After the initial ingestion has been done, which can take some time depending on how many items you have on pocket, as soon as it&rsquo;s done it will write the checkpoint time to elasticsearch so that the client know the next time from what time to search from again.</p>

<p>This way we dont ingest all the items again, testing it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ python server.py
</span><span class='line'>getting checkpoint id
</span><span class='line'>got checkpoint id: 1591045652
</span><span class='line'>fetch items from pocket
</span><span class='line'>ingesting pocket items into es
</span><span class='line'>got 2 items from pocket
</span><span class='line'>Number of items left to ingest: 2
</span><span class='line'>Number of items left to ingest: 1
</span><span class='line'>writing checkpoint to es: 1591392580</span></code></pre></td></tr></table></div></figure>


<p>Add one more item to pocket, then run our ingester again:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ python server.py
</span><span class='line'>getting checkpoint id
</span><span class='line'>got checkpoint id: 1591392580
</span><span class='line'>fetch items from pocket
</span><span class='line'>ingesting pocket items into es
</span><span class='line'>got 1 items from pocket
</span><span class='line'>Number of items left to ingest: 1
</span><span class='line'>writing checkpoint to es: 1591650259</span></code></pre></td></tr></table></div></figure>


<p>Search for one document on elasticsearch:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ curl -u user:pass 'https://es.domain/pocket-data/_search?pretty=true&size=1'
</span><span class='line'>{
</span><span class='line'>  "took" : 194,
</span><span class='line'>  "timed_out" : false,
</span><span class='line'>  "_shards" : {
</span><span class='line'>    "total" : 5,
</span><span class='line'>    "successful" : 5,
</span><span class='line'>    "skipped" : 0,
</span><span class='line'>    "failed" : 0
</span><span class='line'>  },
</span><span class='line'>  "hits" : {
</span><span class='line'>    "total" : 766,
</span><span class='line'>    "max_score" : 1.0,
</span><span class='line'>    "hits" : [
</span><span class='line'>      {
</span><span class='line'>        "_index" : "pocket-data",
</span><span class='line'>        "_type" : "_doc",
</span><span class='line'>        "_id" : "2676106577",
</span><span class='line'>        "_score" : 1.0,
</span><span class='line'>        "_source" : {
</span><span class='line'>          "item_id" : "2676106577",
</span><span class='line'>          "time_added" : "2020-05-03",
</span><span class='line'>          "url" : "https://programmaticponderings.com/2019/07/30/managing-aws-infrastructure-as-code-using-ansible-cloudformation-and-codebuild/",
</span><span class='line'>          "title" : "Managing AWS Infrastructure as Code using Ansible, CloudFormation, and CodeBuild",
</span><span class='line'>          "tags" : [
</span><span class='line'>            "ansible",
</span><span class='line'>            "aws",
</span><span class='line'>            "cicd",
</span><span class='line'>            "cloudformation",
</span><span class='line'>            "devops"
</span><span class='line'>          ]
</span><span class='line'>        }
</span><span class='line'>      }
</span><span class='line'>    ]
</span><span class='line'>  }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>Search for aws tags:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ curl -u x:x 'https://es.domain/pocket-data/_search?q=tags:aws&pretty=true&size=1'
</span><span class='line'>{
</span><span class='line'>  "took" : 101,
</span><span class='line'>  "timed_out" : false,
</span><span class='line'>  "_shards" : {
</span><span class='line'>    "total" : 5,
</span><span class='line'>    "successful" : 5,
</span><span class='line'>    "skipped" : 0,
</span><span class='line'>    "failed" : 0
</span><span class='line'>  },
</span><span class='line'>  "hits" : {
</span><span class='line'>    "total" : 112,
</span><span class='line'>    "max_score" : 2.6346242,
</span><span class='line'>    "hits" : [
</span><span class='line'>      {
</span><span class='line'>        "_index" : "pocket-data",
</span><span class='line'>        "_type" : "_doc",
</span><span class='line'>        "_id" : "2673747670",
</span><span class='line'>        "_score" : 2.6346242,
</span><span class='line'>        "_source" : {
</span><span class='line'>          "item_id" : "2673747670",
</span><span class='line'>          "time_added" : "2019-07-28",
</span><span class='line'>          "url" : "https://github.com/lgoodridge/serverless-chat",
</span><span class='line'>          "title" : "lgoodridge/serverless-chat",
</span><span class='line'>          "tags" : [
</span><span class='line'>            "aws"
</span><span class='line'>          ]
</span><span class='line'>        }
</span><span class='line'>      }
</span><span class='line'>    ]
</span><span class='line'>  }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h2>Now what</h2>

<p>Now that our data is in elasticsearch, we can build a search engine or a web application that can list our favorite links per category. I wil write up a post on the search engine in the future.</p>

<h2>Thank You</h2>

<p>If you liked this please send me a shout out on Twitter: <a href="https://twitter.com/ruanbekker">@ruanbekker</a></p>
</div>


  <footer>
    <p class="meta">
      
  


<span class="byline author vcard">Posted by <span class="fn">Ruan</span></span>


      




<time class='entry-date' datetime='2020-06-08T23:06:23+02:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>8</span><span class='date-suffix'>th</span>, <span class='date-year'>2020</span></span> <span class='time'>11:06 pm</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/elasticsearch/'>elasticsearch</a>, <a class='category' href='/blog/categories/pocket/'>pocket</a>, <a class='category' href='/blog/categories/python/'>python</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="https://blog.ruanbekker.com/blog/2020/06/08/ingesting-pocket-items-into-elasticsearch/" data-via="ruanbekker" data-counturl="https://blog.ruanbekker.com/blog/2020/06/08/ingesting-pocket-items-into-elasticsearch/" >Tweet</a>
  
  
  
</div>

    
    <!-- https://www.undefinednull.com/2013/10/15/octopress-blog-tweaks-adding-author-information-section-below-each-posts/ -->
    <div class="about">
     <span class="about-image">
          <img src="/images/author.png" alt="Ruan Bekker">
     </span>
     <span class="about-desc">
          <span>My name is <a href="https://ruan.dev">Ruan</a>, I'm a DevOps Engineer from South Africa. I'm passionate
          about AWS, OpenSource, Observability, Containers, Linux, Automation and sharing my findings with the world.
          More info about me on my website, <a href="https://ruan.dev">ruan.dev</a>.</span>
          <br/>
          <hr/>
          <a href="https://twitter.com/ruanbekker" class="twitter-follow-button" data-show-count="false" data-size="large">Follow @ruanbekker</a>
     </span>
</div>

    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2020/05/16/using-python-rq-for-task-queues-in-python/" title="Previous Post: Using Python RQ for Task Queues in Python">&laquo; Using Python RQ for Task Queues in Python</a>
      
      
        <a class="basic-alignment right" href="/blog/2020/06/08/build-a-ghost-blog-with-nginx-cache-on-docker/" title="Next Post: Increase Performance with your Ghost Blog on Docker">Increase Performance with your Ghost Blog on Docker &raquo;</a>
      
    </p>
  </footer>
</article>
<!-- google advertisements
    <script data-ad-client="ca-pub-1100086574264181" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <!-- old
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-1543437721119411",
        enable_page_level_ads: true
      });
    </script>
    -->

 
-->


  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Subscribe</h1>
  <!-- Begin MailChimp Signup Form -->
  <div id="mc_embed_signup">
  <form action="https://sysadmins.us15.list-manage.com/subscribe/post?u=3dfcff447b6ee598231eeb658&amp;id=3542f323a9" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
      <div class="indicates-required"><span class="asterisk"></span></div>
      <div class="mc-field-group">
	<label for="mce-EMAIL">Email Address:  <span class="asterisk"></span>
        </label>
	<input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL">
        </div>
	<div id="mce-responses" class="clear">
	  <div class="response" id="mce-error-response" style="display:none"></div>
	  <div class="response" id="mce-success-response" style="display:none"></div>
	</div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
      <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_3dfcff447b6ee598231eeb658_3542f323a9" tabindex="-1" value=""></div>
    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
    </div>
  </form>
</div>
<!--End mc_embed_signup-->
</section>

<section>
  <h1>Slack</h1>
  Join me on <a href="http://linux-hackers.slack.com">Slack</a>
</section>

<section>
  <h1>Twitter</h1>
  Follow me on Twitter: <a href="https://twitter.com/ruanbekker">@ruanbekker</a>
</section>

<section>
  <h1>Say Hi!</h1>
  Send me a note using the <a href="https://saythanks.io/to/ruanbekker">saythanks.io</a> project.
</section>

<section>
  <h1>Newsletter</h1>
  View my newsletter on <a href="http://digests.ruanbekker.com/?via=ruanbekker-blog" target="_blank">digests.ruanbekker.com</a>
</section>

<section>
  <h1>Cheetsheet Repository</h1>
  Have a look at my <strong>Cheetsheets Github Repository</strong>:
  <p></p>
  <a href="https://github.com/ruanbekker/cheatsheets" target="_blank"><img src="https://user-images.githubusercontent.com/567298/169719365-1d8a05e2-a0d3-4078-a84f-c691544e4b8f.png" width="480" height="240"></a>
</section>

<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2022/07/31/docker-multistage-builds-for-hugo/">Docker Multistage Builds for Hugo</a>
      </li>
    
      <li class="post">
        <a href="/blog/2022/07/14/remote-builds-with-docker-contexts/">Remote Builds With Docker Contexts</a>
      </li>
    
      <li class="post">
        <a href="/blog/2022/06/29/create-a-raid5-array-with-mdadm-on-linux/">Create a RAID5 Array With Mdadm on Linux</a>
      </li>
    
      <li class="post">
        <a href="/blog/2022/06/23/install-a-specific-python-version-on-ubuntu/">Install a Specific Python Version on Ubuntu</a>
      </li>
    
      <li class="post">
        <a href="/blog/2022/06/15/how-to-persist-iptables-rules-after-reboots/">How to Persist Iptables Rules After Reboots</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Store</h1>
  <ul id=""></ul>
  <p></p>
  <strong>Check out my Store</strong>: Have a look at my latest elasticsearch cheatsheet in PDF format.
  <p></p>
  <a href="https://ruan.dev/store/elasticsearch-cheatsheet/?source=blog.ruanbekker.com" target="_blank"><img src="https://user-images.githubusercontent.com/567298/169719853-fe9a50a4-03f2-4a26-a422-0deb946ca09c.png" width="480" height="240"></a>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2022 - Ruan -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>
<script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="ruanbekker" data-description="Support me on Buy me a coffee!" data-message="" data-color="#FFDD00" data-position="Right" data-x_margin="18" data-y_margin="18"></script>



  <li>
    <a href="https://twitter.com/ruanbekker">
      <i class="fa fa-twitter"></i> Twitter
    </a>
  </li>



  <li>
    <a href="https://github.com/ruanbekker">
      <i class="fa fa-github"></i> GitHub
    </a>
  </li>



  <li>
    <a href="https://sysadmins.co.za">
      <i class="fa fa-bars"></i> My HowTo Blog
    </a>
  </li>


</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'blog-ruanbekker';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'https://blog.ruanbekker.com/blog/2020/06/08/ingesting-pocket-items-into-elasticsearch/';
        var disqus_url = 'https://blog.ruanbekker.com/blog/2020/06/08/ingesting-pocket-items-into-elasticsearch/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





      <script data-ad-client="ca-pub-1100086574264181" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <!-- old
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-1543437721119411",
        enable_page_level_ads: true
      });
    </script>
    -->


</body>
</html>
