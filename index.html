
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Ruan Bekker's Blog</title>
  <meta name="author" content="Ruan">

  
  <meta name="description" content="In this tutorial we will setup two containers, openldap and a openldap ui to manage our users on openldap. What is OpenLDAP OpenLDAP is an open &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- font awesome --!>
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

  <!-- samwize.com/2012/09/24/octopress-table-stylesheet --!>
  <link href="/stylesheets/data-table.css" media="screen, projection" rel="stylesheet" type="text/css" />

  
  <link rel="canonical" href="https://blog.ruanbekker.com/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Ruan Bekker's Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-105336110-1']);
    _gaq.push(['_setDomainName','ruanbekker.com']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


  <!-- Fathom - simple website analytics - https://github.com/usefathom/fathom -->
<script>
(function(f, a, t, h, o, m){
	a[h]=a[h]||function(){
		(a[h].q=a[h].q||[]).push(arguments)
	};
	o=f.createElement('script'),
	m=f.getElementsByTagName('script')[0];
	o.async=1; o.src=t; o.id='fathom-script';
	m.parentNode.insertBefore(o,m)
})(document, window, '//fh-blog-ruanbekker-com.home.ruan.dev/tracker.js', 'fathom');
fathom('set', 'siteId', 'MWBHH');
fathom('trackPageview');
</script>
<!-- / Fathom -->

  <!-- Twitter cards # www.brianbunke.com/blog/2017/09/06/twitter-cards-on-jekyll -->
<meta name="twitter:site"    content="@ruanbekker">
<meta name="twitter:creator" content="@">
<meta name="twitter:title"   content="">


<meta name="twitter:description" content="">



<meta name="twitter:card"  content="summary">
<meta name="twitter:image" content="https://user-images.githubusercontent.com/567298/69000657-c093e780-08db-11ea-8464-bcd3023e9923.png">

<!-- end of Twitter cards -->

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Ruan Bekker's Blog</a></h1>
  
    <h2>From a Curious mind to Posts on Github</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://blog.ruanbekker.com/search/" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="blog.ruanbekker.com">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/blog/categories/aws/">AWS</a></li>
  <li><a href="/blog/categories/docker/">Docker</a></li>
  <li><a href="/blog/categories/devops/">DevOps</a></li>
  <li><a href="/blog/categories/python/">Python</a></li>
  <li><a target="_blank" href="https://sysadmins.co.za">My Sysadmins Blog</a></li>
  <li><a href="https://ruan.dev/">About Me</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2022/03/20/run-openldap-with-a-ui-on-docker/">Run OpenLDAP With a UI on Docker</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2022-03-20T16:55:39-04:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2022</span></span> <span class='time'>4:55 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In this tutorial we will setup two containers, openldap and a openldap ui to manage our users on openldap.</p>

<h2>What is OpenLDAP</h2>

<p>OpenLDAP is an open source implementation of the Lightweight Directory Access Protocol, which makes it possible for organizations to use centralized authentication and directory access services over a network.</p>

<h2>Configuration</h2>

<p>This stack will boot a openldap and openldap-ui container container with the following <code>docker-compose.yml</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">version</span><span class="p-Indicator">:</span> <span class="s">&quot;3.8&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">services</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">openldap</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">image</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">osixia/openldap:1.5.0</span>
</span><span class='line'>    <span class="l-Scalar-Plain">container_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">openldap</span>
</span><span class='line'>    <span class="l-Scalar-Plain">volumes</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">./storage/ldap_db:/var/lib/ldap</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">./storage/ldap_config:/etc/ldap/slapd.d</span>
</span><span class='line'>    <span class="l-Scalar-Plain">environment</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">LDAP_ORGANISATION=example-org</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">LDAP_DOMAIN=example.org</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">LDAP_ADMIN_PASSWORD=admin</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">LDAP_CONFIG_PASSWORD=config</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">LDAP_RFC2307BIS_SCHEMA=true</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">LDAP_REMOVE_CONFIG_AFTER_SETUP=true</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">LDAP_TLS_VERIFY_CLIENT=never</span>
</span><span class='line'>    <span class="l-Scalar-Plain">networks</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">openldap</span>
</span><span class='line'>
</span><span class='line'>  <span class="l-Scalar-Plain">openldap-ui</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">image</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">wheelybird/ldap-user-manager:v1.5</span>
</span><span class='line'>    <span class="l-Scalar-Plain">container_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">openldap-ui</span>
</span><span class='line'>    <span class="l-Scalar-Plain">environment</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">LDAP_URI=ldap://openldap</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">LDAP_BASE_DN=dc=example,dc=org</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">LDAP_REQUIRE_STARTTLS=FALSE</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">LDAP_ADMINS_GROUP=admins</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">LDAP_ADMIN_BIND_DN=cn=admin,dc=example,dc=org</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">LDAP_ADMIN_BIND_PWD=admin</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">LDAP_IGNORE_CERT_ERRORS=true</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">NO_HTTPS=TRUE</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">PASSWORD_HASH=SSHA</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">SERVER_HOSTNAME=localhost:18080</span>
</span><span class='line'>    <span class="l-Scalar-Plain">depends_on</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">openldap</span>
</span><span class='line'>    <span class="l-Scalar-Plain">ports</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">18080:80</span>
</span><span class='line'>    <span class="l-Scalar-Plain">networks</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">openldap</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">networks</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">openldap</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">openldap</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Boot</h2>

<p>Boot the stack with docker-compose:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>docker-compose up -d
</span></code></pre></td></tr></table></div></figure>


<p>You can access OpenLDAP-UI on port <code>18080</code> and the admin password will be <code>admin</code>. You will have admin access to create users.</p>

<h2>Verify Users</h2>

<p>Access the openldap container:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>docker-compose <span class="nb">exec </span>openldap bash
</span></code></pre></td></tr></table></div></figure>


<p>You can use <code>ldapsearch</code> to verify our user:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>ldapsearch -x -h openldap -D <span class="s2">&quot;uid=ruan,ou=people,dc=example,dc=org&quot;</span> -b <span class="s2">&quot;ou=people,dc=example,dc=org&quot;</span> -w <span class="s2">&quot;$PASSWORD&quot;</span> -s base <span class="s1">&#39;uid=ruan&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Or we can use <code>ldapwhoami</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>ldapwhoami -vvv -h ldap://openldap:389 -p <span class="m">389</span> -D <span class="s1">&#39;uid=ruan,ou=people,dc=example,dc=org&#39;</span> -x -w <span class="s2">&quot;$PASSWORD&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Which will provide a output with something like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>ldap_initialize<span class="o">(</span> &lt;DEFAULT&gt; <span class="o">)</span>
</span><span class='line'>dn:uid<span class="o">=</span>ruan,ou<span class="o">=</span>people,dc<span class="o">=</span>example,dc<span class="o">=</span>org
</span><span class='line'>Result: Success <span class="o">(</span>0<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Thank You</h2>

<p>Thanks for reading, if you like my content, check out my <strong><a href="https://ruan.dev">website</a></strong>, read my <strong><a href="http://digests.ruanbekker.com/?via=ruanbekker-blog">newsletter</a></strong> or follow me at <strong><a href="https://twitter.com/ruanbekker">@ruanbekker</a></strong> on Twitter.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2022/02/20/create-dns-records-with-terraform-on-cloudflare/">Create DNS Records With Terraform on Cloudflare</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2022-02-20T13:11:06-05:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2022</span></span> <span class='time'>1:11 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In this tutorial we will use <strong>Terraform</strong> to create DNS records on <strong>Cloudflare</strong>.</p>

<h2>Installing Terraform</h2>

<p>I will be installing terraform for linux, but you can follow terraform&rsquo;s documentation if you are using a different operating system:
- <a href="https://learn.hashicorp.com/tutorials/terraform/install-cli">https://learn.hashicorp.com/tutorials/terraform/install-cli</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt; curl -fsSL https://apt.releases.hashicorp.com/gpg <span class="p">|</span> sudo apt-key add -
</span><span class='line'>&gt; sudo apt-add-repository <span class="s2">&quot;deb [arch=amd64] https://apt.releases.hashicorp.com $(lsb_release -cs) main&quot;</span>
</span><span class='line'>&gt; sudo apt update <span class="o">&amp;&amp;</span> sudo apt install terraform -y
</span></code></pre></td></tr></table></div></figure>


<p>Verify that terraform was installed:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt; terraform version
</span><span class='line'>Terraform v1.1.6
</span><span class='line'>on linux_amd64
</span></code></pre></td></tr></table></div></figure>


<h2>Cloudflare Authentication</h2>

<p>We need to create an API Token in order to authenticate terraform to make the required API calls to create the DNS Record.</p>

<p>They have a great post on this, which you can follow below:
- <a href="https://developers.cloudflare.com/api/tokens/create">https://developers.cloudflare.com/api/tokens/create</a></p>

<p>You will need access to &ldquo;Edit DNS Zones&rdquo; and also include the Domain that you would like to edit.</p>

<p>Ensure that you save the API Token in a safe place.</p>

<h2>Terraform Code</h2>

<p>First we will create a project directory:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt; mkdir terraform-cloudflare-dns
</span><span class='line'>&gt; <span class="nb">cd </span>terraform-cloudflare-dns
</span></code></pre></td></tr></table></div></figure>


<p>First we will create the <code>providers.tf</code> which we define our provider and the required parameters for the provider:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>terraform <span class="o">{</span>
</span><span class='line'>  required_providers <span class="o">{</span>
</span><span class='line'>    <span class="nv">cloudflare</span> <span class="o">=</span> <span class="o">{</span>
</span><span class='line'>      <span class="nb">source</span> <span class="o">=</span> <span class="s2">&quot;cloudflare/cloudflare&quot;</span>
</span><span class='line'>      <span class="nv">version</span> <span class="o">=</span> <span class="s2">&quot;~&gt; 3.0&quot;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'>provider <span class="s2">&quot;cloudflare&quot;</span> <span class="o">{</span>
</span><span class='line'>  <span class="nv">email</span>   <span class="o">=</span> var.cloudflare_email
</span><span class='line'>  <span class="nv">api_token</span> <span class="o">=</span> var.cloudflare_api_token
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you can see, we are referencing <code>email</code> and <code>api_token</code> as variables, therefore we need to define those variables in <code>variables.tf</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>variable <span class="s2">&quot;cloudflare_email&quot;</span> <span class="o">{</span>
</span><span class='line'>  <span class="nb">type</span>        <span class="o">=</span> string
</span><span class='line'>  <span class="nv">description</span> <span class="o">=</span> <span class="s2">&quot;clouflare email address&quot;</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'>variable <span class="s2">&quot;cloudflare_api_token&quot;</span> <span class="o">{</span>
</span><span class='line'>  <span class="nb">type</span>        <span class="o">=</span> string
</span><span class='line'>  <span class="nv">description</span> <span class="o">=</span> <span class="s2">&quot;cloudflare api token&quot;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>In our <code>main.tf</code>, we are first using a data resource to query cloudflare for our domain <code>rbkr.xyz</code> and then access the attribute <code>id</code> which we will be using in our <code>cloudflare_record</code> resource so that it knows which domain to add the DNS record for.</p>

<p>Then we are going to create the A record <code>foobar</code> and provide the value of <code>127.0.0.1</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>data <span class="s2">&quot;cloudflare_zone&quot;</span> <span class="s2">&quot;this&quot;</span> <span class="o">{</span>
</span><span class='line'>  <span class="nv">name</span> <span class="o">=</span> <span class="s2">&quot;rbkr.xyz&quot;</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'>resource <span class="s2">&quot;cloudflare_record&quot;</span> <span class="s2">&quot;foobar&quot;</span> <span class="o">{</span>
</span><span class='line'>  <span class="nv">zone_id</span> <span class="o">=</span> data.cloudflare_zone.this.id
</span><span class='line'>  <span class="nv">name</span>    <span class="o">=</span> <span class="s2">&quot;foobar&quot;</span>
</span><span class='line'>  <span class="nv">value</span>   <span class="o">=</span> <span class="s2">&quot;127.0.0.1&quot;</span>
</span><span class='line'>  <span class="nb">type</span>    <span class="o">=</span> <span class="s2">&quot;A&quot;</span>
</span><span class='line'>  <span class="nv">proxied</span> <span class="o">=</span> <span class="nb">false</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then we are defining our outputs in <code>outputs.tf</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>output <span class="s2">&quot;record&quot;</span> <span class="o">{</span>
</span><span class='line'>  <span class="nv">value</span> <span class="o">=</span> cloudflare_record.foobar.hostname
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'>output <span class="s2">&quot;metadata&quot;</span> <span class="o">{</span>
</span><span class='line'>  <span class="nv">value</span>       <span class="o">=</span> cloudflare_record.foobar.metadata
</span><span class='line'>  <span class="nv">sensitive</span>   <span class="o">=</span> <span class="nb">true</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Creating the Record</h2>

<p>Once our configuration code is in place we can run a <code>init</code> which will download the providers:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt; terraform init
</span></code></pre></td></tr></table></div></figure>


<p>Once that is done, we can run a <code>plan</code> so we can see what will be deployed, but since our <code>variables.tf</code> has no <code>default</code> values, we will either have to define this in <code>terraform.tfvars</code> or use it in-line.</p>

<p>I will be using it in-line for this demonstration:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt; terraform plan -var <span class="s2">&quot;cloudflare_email=$EMAIL&quot;</span> -var <span class="s2">&quot;cloudflare_api_token=$API_TOKEN&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Once you are happy, you can run a <code>apply</code> which will deploy the changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt; terraform apply -var <span class="s2">&quot;cloudflare_email=$EMAIL&quot;</span> -var <span class="s2">&quot;cloudflare_api_token=$API_TOKEN&quot;</span>
</span><span class='line'>
</span><span class='line'>Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:
</span><span class='line'>  + create
</span><span class='line'>
</span><span class='line'>Terraform will perform the following actions:
</span><span class='line'>
</span><span class='line'>  <span class="c"># cloudflare_record.foobar will be created</span>
</span><span class='line'>  + resource <span class="s2">&quot;cloudflare_record&quot;</span> <span class="s2">&quot;foobar&quot;</span> <span class="o">{</span>
</span><span class='line'>      + <span class="nv">allow_overwrite</span> <span class="o">=</span> <span class="nb">false</span>
</span><span class='line'>      + <span class="nv">created_on</span>      <span class="o">=</span> <span class="o">(</span>known after apply<span class="o">)</span>
</span><span class='line'>      + <span class="nv">hostname</span>        <span class="o">=</span> <span class="o">(</span>known after apply<span class="o">)</span>
</span><span class='line'>      + <span class="nv">id</span>              <span class="o">=</span> <span class="o">(</span>known after apply<span class="o">)</span>
</span><span class='line'>      + <span class="nv">metadata</span>        <span class="o">=</span> <span class="o">(</span>known after apply<span class="o">)</span>
</span><span class='line'>      + <span class="nv">modified_on</span>     <span class="o">=</span> <span class="o">(</span>known after apply<span class="o">)</span>
</span><span class='line'>      + <span class="nv">name</span>            <span class="o">=</span> <span class="s2">&quot;foobar&quot;</span>
</span><span class='line'>      + <span class="nv">proxiable</span>       <span class="o">=</span> <span class="o">(</span>known after apply<span class="o">)</span>
</span><span class='line'>      + <span class="nv">proxied</span>         <span class="o">=</span> <span class="nb">false</span>
</span><span class='line'>      + <span class="nv">ttl</span>             <span class="o">=</span> <span class="o">(</span>known after apply<span class="o">)</span>
</span><span class='line'>      + <span class="nb">type</span>            <span class="o">=</span> <span class="s2">&quot;A&quot;</span>
</span><span class='line'>      + <span class="nv">value</span>           <span class="o">=</span> <span class="s2">&quot;127.0.0.1&quot;</span>
</span><span class='line'>      + <span class="nv">zone_id</span>         <span class="o">=</span> <span class="s2">&quot;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>Plan: <span class="m">1</span> to add, <span class="m">0</span> to change, <span class="m">0</span> to destroy.
</span><span class='line'>
</span><span class='line'>Changes to Outputs:
</span><span class='line'>  + <span class="nv">metadata</span> <span class="o">=</span> <span class="o">(</span>sensitive value<span class="o">)</span>
</span><span class='line'>  + <span class="nv">record</span>   <span class="o">=</span> <span class="o">(</span>known after apply<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>Do you want to perform these actions?
</span><span class='line'>  Terraform will perform the actions described above.
</span><span class='line'>  Only <span class="s1">&#39;yes&#39;</span> will be accepted to approve.
</span><span class='line'>
</span><span class='line'>  Enter a value: yes
</span><span class='line'>
</span><span class='line'>cloudflare_record.foobar: Creating...
</span><span class='line'>cloudflare_record.foobar: Creation <span class="nb">complete </span>after 4s <span class="o">[</span><span class="nv">id</span><span class="o">=</span>xxxxxxxxxxxxxxxxxxxxx<span class="o">]</span>
</span><span class='line'>
</span><span class='line'>Apply <span class="nb">complete</span>! Resources: <span class="m">1</span> added, <span class="m">0</span> changed, <span class="m">0</span> destroyed.
</span><span class='line'>
</span><span class='line'>Outputs:
</span><span class='line'>
</span><span class='line'><span class="nv">metadata</span> <span class="o">=</span> &lt;sensitive&gt;
</span><span class='line'><span class="nv">record</span> <span class="o">=</span> <span class="s2">&quot;foobar.rbkr.xyz&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Test DNS</h2>

<p>We can now test if this is working as expected with a dns utility like dig:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt; dig foobar.rbkr.xyz
</span><span class='line'>
</span><span class='line'><span class="p">;</span> &lt;&lt;&gt;&gt; DiG 9.10.6 &lt;&lt;&gt;&gt; foobar.rbkr.xyz
</span><span class='line'><span class="p">;;</span> global options: +cmd
</span><span class='line'><span class="p">;;</span> Got answer:
</span><span class='line'><span class="p">;;</span> -&gt;&gt;HEADER<span class="s">&lt;&lt;- opco</span>de: QUERY, status: NOERROR, id: 20800
</span><span class='line'><span class="p">;;</span> flags: qr rd ra<span class="p">;</span> QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1
</span><span class='line'>
</span><span class='line'><span class="p">;;</span> OPT PSEUDOSECTION:
</span><span class='line'><span class="p">;</span> EDNS: version: 0, flags:<span class="p">;</span> udp: 4096
</span><span class='line'><span class="p">;;</span> QUESTION SECTION:
</span><span class='line'><span class="p">;</span>foobar.rbkr.xyz.       IN      A
</span><span class='line'>
</span><span class='line'><span class="p">;;</span> ANSWER SECTION:
</span><span class='line'>foobar.rbkr.xyz. <span class="m">300</span>    IN      A       127.0.0.1
</span><span class='line'>
</span><span class='line'><span class="p">;;</span> Query <span class="nb">time</span>: <span class="m">262</span> msec
</span><span class='line'><span class="p">;;</span> SERVER: 172.31.0.2#53<span class="o">(</span>172.31.0.2<span class="o">)</span>
</span><span class='line'><span class="p">;;</span> WHEN: Wed Feb <span class="m">02</span> 13:57:59 SAST 2022
</span><span class='line'><span class="p">;;</span> MSG SIZE  rcvd: 68
</span></code></pre></td></tr></table></div></figure>


<h2>Thank You</h2>

<p>Thanks for reading, if you like my content, check out my <strong><a href="https://ruan.dev">website</a></strong> or follow me at <strong><a href="https://twitter.com/ruanbekker">@ruanbekker</a></strong> on Twitter.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2021/12/05/blockchain-basics/">Blockchain Basics</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2021-12-05T08:12:10-05:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>5</span><span class='date-suffix'>th</span>, <span class='date-year'>2021</span></span> <span class='time'>8:12 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In this tutorial, we will cover the <strong>basics of blockchain</strong> and why you would want to run a full-node such as bitcoin, ethereum, etc.</p>

<h2>Blockchain Basics</h2>

<p>Before we start setting up our bitcoin full-node, we first need to get through some blockchain basics, if you already aware of it, you can skip the the setup section of this post.</p>

<h2>Block</h2>

<p>Transaction data is <strong>permanently recorded</strong> into files called <strong>blocks</strong>. You can think of it as a <strong>transaction ledger</strong>. Blocks are organised into a linear sequence over time.</p>

<p>New transactions are <strong>constantly being processed</strong> by <strong>miners</strong> into new blocks which are added to the <strong>end of the chain</strong>. As blocks are buried deeper and deeper into the blockchain they <strong>become harder</strong> and harder to change or remove, this gives rise of <strong><a href="https://en.bitcoin.it/wiki/Irreversible_Transactions">Bitcoin&rsquo;s Irreversible Transactions</a></strong>.</p>

<p>The first block added to the blockchain is referred to as the <strong><a href="https://en.bitcoin.it/wiki/Genesis_block">genesis block</a></strong></p>

<h2>Blockchain</h2>

<p>A blockchain is a transaction database shared by <strong>all nodes participating</strong> in a system based on the bitcoin protocol. A <strong>full copy</strong> of a currency&rsquo;s blockchain contains <strong>every</strong> transaction ever executed in the currency. With this information, one can find out how much value belonged to each address at any point in history.</p>

<p>Every block contains a hash of the previous block. This has the effect of creating a chain of blocks from the genesis block to the current block. <strong>Each block</strong> is guaranteed to come after the <strong>previous block</strong> chronologically because the previous block&rsquo;s hash would otherwise not be known. Each block is also computationally impractical to modify once it has been in the chain for a while because every block after it would also have to be regenerated. <strong>These properties are what make bitcoins transactions irreversible</strong>. The blockchain is the main innovation of Bitcoin.</p>

<h2>Mining</h2>

<p>Mining is the <strong>process</strong> of <strong>adding transaction records</strong> to bitcoin&rsquo;s public ledger of past transactions. The term &ldquo;mining rig&rdquo; is referred to where as a single computer system that performs the necessary computations for &ldquo;mining&rdquo;.</p>

<p>The blockchain serves to confirm transactions to the rest of the network as having taken place. Bitcoin nodes use the blockchain to <strong>distinguish legitimate Bitcoin transactions</strong> from attempts to re-spend coins that have already been spent elsewhere.</p>

<h2>Node</h2>

<p>Any <strong>computer</strong> that connects to the <strong>bitcoin network</strong> is called a <strong>node</strong>. Nodes that fully verify all of the rules of bitcoin are called full nodes. The most popular software implementation of full nodes is called bitcoin-core, its releases can be found on their <strong><a href="https://github.com/bitcoin/bitcoin/releases">github page</a></strong></p>

<h2>What is a Full Node</h2>

<p>A full node is a node (computer system with bitcoin-core running on it) which <strong>downloads every block and transaction</strong> and check them against <strong>bitcoin&rsquo;s consensus rules</strong>. which fully validates transactions and blocks. Almost all full nodes also help the network by accepting transactions and blocks from other full nodes, validating those transactions and blocks, and then relaying them to further full nodes.</p>

<p>Some <strong>examples</strong> of <strong>consensus rules</strong>:</p>

<ul>
<li>Blocks may only <a href="https://en.bitcoin.it/wiki/Controlled_supply">create</a> a certain number of bitcoins. (Currently 6.25 BTC per block.)</li>
<li>Transactions must have correct signatures for the bitcoins being spent.</li>
<li>Transactions/blocks must be in the correct data format.</li>
<li>Within a single <a href="https://en.bitcoin.it/wiki/Block_chain">blockchain</a>, a transaction output cannot be double-spent.</li>
</ul>


<p>At minimum, a full node must download every transaction that has ever taken place, all new transactions, and all block headers. Additionally, full nodes must store information about every unspent transaction output until it is spent.</p>

<p>By default full nodes are inefficient in that they download each new transaction at least twice, and they store the entire block chain (more than 165 GB as of 20180214) forever, even though only the unspent transaction outputs (&lt;2 GB) are required. Performance can improved by enabling <a href="https://bitcointalk.org/index.php?topic=1377345.0">-blocksonly</a> mode and enabling <a href="https://bitcoin.org/en/release/v0.12.0#wallet-pruning">pruning</a></p>

<h2>Archival Nodes</h2>

<p>A subset of full nodes also <strong>accept incoming connections</strong> and <strong>upload old blocks</strong> to other peers on the network. This happens if the software is run with -listen=1 as is default.</p>

<p>Contrary to some popular misconceptions, being an archival node is not necessary to being a full node. If a user&rsquo;s bandwidth is constrained then they can use -listen=0, if their disk space is constrained they can use pruning, all the while still being a fully-validating node that enforces bitcoin&rsquo;s consensus rules and contributing to bitcoin&rsquo;s overall security.</p>

<p>Most information was referenced from <strong><a href="https://en.bitcoin.it/wiki/Full_node">this</a></strong> wiki.</p>

<h2>Thank You</h2>

<p>Thanks for reading, if you like my content, check out my <strong><a href="https://ruan.dev">website</a></strong> or follow me at <strong><a href="https://twitter.com/ruanbekker">@ruanbekker</a></strong> on Twitter.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2021/12/05/run-a-geth-ethereum-light-node/">Run a GETH Ethereum Light Node</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2021-12-05T04:14:11-05:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>5</span><span class='date-suffix'>th</span>, <span class='date-year'>2021</span></span> <span class='time'>4:14 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="https://user-images.githubusercontent.com/567298/144747750-e0a6f000-fc60-4422-b9bc-7b1b6549cbe4.png" alt="ethereum" /></p>

<p>In this tutorial we will install the Geth implementation of <a href="https://ethereum.org/en/">Ethereum</a> on Linux and we will be using the <a href="https://ethereum.org/en/developers/docs/nodes-and-clients/#light-node">light sync mode</a> which will get you up and running in minutes, which only downloads a couple of GBs.</p>

<p>Once we have our node setup we will be using the API and Web3 to interact with our ethereum node.</p>

<p>To understand the basics of blockchain better, you can read my post:
- <a href="https://blog.ruanbekker.com/blog/2021/12/05/blockchain-basics/">The Basics of Blockchain</a></p>

<h2>Environment Setup</h2>

<p>We require go to be installed on our server, so from golang&rsquo;s <a href="https://golang.org/dl/">releases</a> page get the latest version of Go and extract it:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">cd</span> /tmp
</span><span class='line'>wget https://go.dev/dl/go1.17.4.linux-amd64.tar.gz
</span><span class='line'>sudo tar -C /usr/local -xzf go1.17.4.linux-amd64.tar.gz
</span></code></pre></td></tr></table></div></figure>


<p>Setup environment for Go in <code>/etc/profile.d/go.sh</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">export </span><span class="nv">GOROOT</span><span class="o">=</span>/usr/local/go
</span><span class='line'><span class="nb">export </span><span class="nv">GOPATH</span><span class="o">=</span><span class="nv">$HOME</span>/go
</span><span class='line'><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="nv">$GOROOT</span>/bin
</span></code></pre></td></tr></table></div></figure>


<p>While you are in your session, source the file:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">source</span> /etc/profile.d/go.sh
</span></code></pre></td></tr></table></div></figure>


<p>And verify that Go is installed:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>go version
</span><span class='line'>go version go1.17.4 linux/amd64
</span></code></pre></td></tr></table></div></figure>


<h2>Download Geth</h2>

<p>From the geth <a href="https://geth.ethereum.org/downloads/">releases</a> page, get the latest version, extract and setup a symlink to the latest version:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">cd</span> /tmp
</span><span class='line'>wget https://gethstore.blob.core.windows.net/builds/geth-linux-amd64-1.10.13-7a0c19f8.tar.gz
</span><span class='line'>tar -xvf geth-linux-amd64-1.10.13-7a0c19f8.tar.gz
</span><span class='line'>sudo mkdir -p /usr/local/geth/1.10.13/bin
</span><span class='line'>sudo mv geth-linux-amd64-1.10.13-7a0c19f8/geth /usr/local/geth/1.10.13/bin/geth
</span><span class='line'>sudo ln -s /usr/local/geth/1.10.13 /usr/local/geth/current
</span></code></pre></td></tr></table></div></figure>


<p>Setup the environment for geth on <code>/etc/profile.d/geth.sh</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:/usr/local/geth/current/bin
</span></code></pre></td></tr></table></div></figure>


<p>Then source the file while you are still in your session:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">source</span> /etc/profile.d/geth.sh
</span></code></pre></td></tr></table></div></figure>


<p>You should be able to verify that geth is installed by running:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>geth version
</span><span class='line'>Geth
</span><span class='line'>Version: 1.10.13-stable
</span><span class='line'>Git Commit: eae3b1946a276ac099e0018fc792d9e8c3bfda6d
</span><span class='line'>Git Commit Date: 20210929
</span><span class='line'>Architecture: amd64
</span><span class='line'>Go Version: go1.17
</span><span class='line'>Operating System: linux
</span><span class='line'><span class="nv">GOPATH</span><span class="o">=</span>/home/ubuntu/go
</span><span class='line'><span class="nv">GOROOT</span><span class="o">=</span>/usr/local/go
</span></code></pre></td></tr></table></div></figure>


<h2>Setup Geth</h2>

<p>Create the data directory for geth and change the ownership of the directory to our user:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo mkdir -p /blockchain/ethereum/data
</span><span class='line'>sudo chown -R ubuntu:ubuntu /blockchain/ethereum
</span></code></pre></td></tr></table></div></figure>


<p>Run geth in the foreground to test:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>geth --ropsten <span class="se">\</span>
</span><span class='line'>  --datadir /blockchain/ethereum/data --datadir.minfreedisk <span class="m">1024</span> <span class="se">\</span>
</span><span class='line'>  --cache <span class="m">128</span> --syncmode <span class="s2">&quot;light&quot;</span> <span class="se">\</span>
</span><span class='line'>  --http --http.addr 0.0.0.0 --http.port <span class="m">8545</span> <span class="se">\</span>
</span><span class='line'>  --metrics --metrics.addr 0.0.0.0 --metrics.port 6060
</span></code></pre></td></tr></table></div></figure>


<p>If everything goes okay, you can stop the process, and remove the ropsten testnet blockchain and state databases:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>geth --ropsten removedb
</span></code></pre></td></tr></table></div></figure>


<p>Create the systemd unit file in <code>/etc/systemd/system/geth.service</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>Unit<span class="o">]</span>
</span><span class='line'><span class="nv">Description</span><span class="o">=</span>Geth Node
</span><span class='line'><span class="nv">After</span><span class="o">=</span>network.target auditd.service
</span><span class='line'><span class="nv">Wants</span><span class="o">=</span>network.target
</span><span class='line'>
</span><span class='line'><span class="o">[</span>Service<span class="o">]</span>
</span><span class='line'><span class="nv">WorkingDirectory</span><span class="o">=</span>/home/ubuntu
</span><span class='line'><span class="nv">ExecStart</span><span class="o">=</span>/usr/local/geth/current/bin/geth <span class="se">\</span>
</span><span class='line'>  --ropsten <span class="se">\</span>
</span><span class='line'>  --datadir /blockchain/ethereum/data <span class="se">\</span>
</span><span class='line'>  --datadir.minfreedisk <span class="m">1024</span> <span class="se">\</span>
</span><span class='line'>  --cache <span class="m">128</span> <span class="se">\</span>
</span><span class='line'>  --syncmode <span class="s2">&quot;light&quot;</span> <span class="se">\</span>
</span><span class='line'>  --http --http.addr 0.0.0.0 --http.port <span class="m">8545</span> <span class="se">\</span>
</span><span class='line'>  --http.api <span class="s2">&quot;admin,db,debug,eth,miner,net,personal,txpool,web3&quot;</span> <span class="se">\</span>
</span><span class='line'>  --http.corsdomain <span class="s2">&quot;*&quot;</span> <span class="se">\</span>
</span><span class='line'>  --metrics --metrics.addr 0.0.0.0 --metrics.port <span class="m">6060</span> <span class="se">\</span>
</span><span class='line'>  --whitelist <span class="nv">10920274</span><span class="o">=</span>0xfd652086d220d506ae5b7cb80fde97d2f3f7028d346cc7d9d384a83d3d638532
</span><span class='line'><span class="nv">User</span><span class="o">=</span>ubuntu
</span><span class='line'><span class="nv">Group</span><span class="o">=</span>ubuntu
</span><span class='line'><span class="nv">Restart</span><span class="o">=</span>on-failure
</span><span class='line'><span class="nv">RestartSec</span><span class="o">=</span>120s
</span><span class='line'><span class="nv">KillMode</span><span class="o">=</span>process
</span><span class='line'><span class="nv">KillSignal</span><span class="o">=</span>SIGINT
</span><span class='line'><span class="nv">TimeoutStopSec</span><span class="o">=</span>600
</span><span class='line'>
</span><span class='line'><span class="o">[</span>Install<span class="o">]</span>
</span><span class='line'><span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</span><span class='line'><span class="nv">Alias</span><span class="o">=</span>geth.service
</span></code></pre></td></tr></table></div></figure>


<p>The values such as <code>--whitelist</code> can be retrieved from <a href="https://github.com/ethereum/go-ethereum/issues/23546">this issue</a> or <a href="https://www.linkedin.com/pulse/how-mine-ropsten-testnet-ether-keir-finlow-bates/">this post</a> and extracted from the post:</p>

<blockquote><p>&ldquo;due to the London upgrade you&rsquo;ll probably end up on the chain that isn&rsquo;t tracked by Etherscan and Metamask. To ensure you only retrieve blocks from peers on that chain, include the following string in your geth start command&rdquo;</p></blockquote>

<p>Since we created a new systemd unit file, reload the systemd daemon:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo systemctl daemon-reload
</span></code></pre></td></tr></table></div></figure>


<p>Enable and start geth:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo systemctl <span class="nb">enable </span>geth
</span><span class='line'>sudo systemctl restart geth
</span></code></pre></td></tr></table></div></figure>


<p>You can tail the logs to ensure everything runs as it should:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo journalctl -fu geth
</span></code></pre></td></tr></table></div></figure>


<h2>API</h2>

<p>Following the <a href="https://eth.wiki/json-rpc/API">JSON-RPC</a> documentation, create your account:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>curl -H <span class="s2">&quot;Content-Type: application/json&quot;</span> -XPOST http://localhost:8545/ -d <span class="s1">&#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;personal_newAccount&quot;,&quot;params&quot;:[&quot;password&quot;],&quot;id&quot;:1}&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The response should provide your ropsten testnet address:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="p">{</span><span class="nt">&quot;jsonrpc&quot;</span><span class="p">:</span><span class="s2">&quot;2.0&quot;</span><span class="p">,</span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="s2">&quot;0x2b1718cdf7dbcc381267ccf43d320c6e194d6aa8&quot;</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>We can list all our ethereum addresses by calling the <a href="https://eth.wiki/json-rpc/API#eth_accounts">eth_accounts</a> method:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>curl -H <span class="s2">&quot;Content-Type: application/json&quot;</span> -XPOST http://localhost:8545/ -d <span class="s1">&#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;eth_accounts&quot;,&quot;params&quot;:[],&quot;id&quot;:1}&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>We can then check our balance with <a href="https://eth.wiki/json-rpc/API#eth_getbalance">eth_getbalance</a>, where we pass the ethereum address which is in hex format, followed by the block number, but we will use &ldquo;latest&rdquo;:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>curl -H <span class="s2">&quot;Content-Type: application/json&quot;</span> -XPOST http://localhost:8545/ -d <span class="s1">&#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;eth_getBalance&quot;,&quot;params&quot;:[&quot;0x2b1718cdf7dbcc381267ccf43d320c6e194d6aa8&quot;, &quot;latest&quot;],&quot;id&quot;:1}&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>You can use the following faucets to send testnet funds to your account:
- <a href="https://faucet.dimensions.network/">https://faucet.dimensions.network/</a>
- <a href="https://faucet.ropsten.be/">https://faucet.ropsten.be/</a></p>

<p>After sending funds to your account, we can check our balance again:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>curl -H <span class="s2">&quot;Content-Type: application/json&quot;</span> -XPOST http://localhost:8545/ -d <span class="s1">&#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;eth_getBalance&quot;,&quot;params&quot;:[&quot;0x2b1718cdf7dbcc381267ccf43d320c6e194d6aa8&quot;, &quot;latest&quot;],&quot;id&quot;:1}&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>And our balances should reflect in our account:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="p">{</span><span class="nt">&quot;jsonrpc&quot;</span><span class="p">:</span><span class="s2">&quot;2.0&quot;</span><span class="p">,</span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="s2">&quot;0x429d069189e0000&quot;</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Hexadecimal and Wei</h2>

<p>As you can notice the value of our balance for our ethereum address is in hexadecimal format, we can convert it to decimal format:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">echo</span> <span class="k">$((</span><span class="m">0</span>x429d069189e0000<span class="k">))</span>
</span><span class='line'>300000000000000000
</span></code></pre></td></tr></table></div></figure>


<p>We can use python to convert to decimal using the int() function, by passing the hexadecimal value and pass its base to convert it into an integer, the base for hexadecimal is 16:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="s">&#39;0x429d069189e0000&#39;</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>
</span><span class='line'><span class="mi">300000000000000000</span>
</span></code></pre></td></tr></table></div></figure>


<p>The decimal value that was returned is the value in <a href="https://www.investopedia.com/terms/w/wei.asp">Wei</a>, and the value of 1 ETH equals to 1,000,000,000,000,000,000 Wei.</p>

<p>Using <a href="https://gwei.io/">gwei.io</a> the conversions from 1 ETH are:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">Wei</span><span class="p">:</span> <span class="mi">1000000000000000000</span>
</span><span class='line'><span class="n">Kwei</span><span class="p">:</span> <span class="mi">1000000000000000</span>
</span><span class='line'><span class="n">Mwei</span><span class="p">:</span> <span class="mi">1000000000000</span>
</span><span class='line'><span class="n">Gwei</span><span class="p">:</span> <span class="mi">1000000000</span>
</span><span class='line'><span class="n">Twei</span><span class="p">:</span> <span class="mi">1000000</span>
</span><span class='line'><span class="n">Pwei</span><span class="p">:</span> <span class="mi">1000</span>
</span><span class='line'><span class="n">ETH</span><span class="p">:</span> <span class="mi">1</span>
</span></code></pre></td></tr></table></div></figure>


<p>So now we can convert our balance from wei to ethereum:</p>

<ul>
<li><code>your_balance_in_wei / unit_value_of_wei</code></li>
<li><code>300000000000000000 / 1000000000000000000</code></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">python3</span> <span class="o">-</span><span class="n">c</span> <span class="s">&quot;print(300000000000000000 / 1000000000000000000)&quot;</span>
</span><span class='line'><span class="mf">0.3</span>
</span></code></pre></td></tr></table></div></figure>


<p>We can use <a href="https://eth-converter.com/">this</a> converter to make sure my math is correct</p>

<p>To get the current gas price in wei</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>curl -H <span class="s2">&quot;Content-Type: application/json&quot;</span> -XPOST http://localhost:8545/ -d <span class="s1">&#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;eth_gasPrice&quot;,&quot;params&quot;:[],&quot;id&quot;:1}&#39;</span><span class="o">{</span><span class="s2">&quot;jsonrpc&quot;</span>:<span class="s2">&quot;2.0&quot;</span>,<span class="s2">&quot;id&quot;</span>:1,<span class="s2">&quot;result&quot;</span>:<span class="s2">&quot;0x73a20d04&quot;</span><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>CLI - <a href="https://geth.ethereum.org/docs/interface/managing-your-accounts">Accounts</a></h2>

<p>Create a password in <code>/tmp/pass</code> then:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>geth --datadir /blockchain/ethereum/data --keystore /blockchain/ethereum/data/keystore account new --password /tmp/.pass
</span><span class='line'>
</span><span class='line'>Your new key was generated
</span><span class='line'>
</span><span class='line'>Public address of the key:   0x5814D945EC909eb1307be4F133AaAB3dEF3572f0
</span><span class='line'>Path of the secret key file: /blockchain/ethereum/data/keystore/UTC--2021-10-06T15-43-23.679655564Z--5814d945ec909eb1307be4f133aaab3def3572f0
</span><span class='line'>
</span><span class='line'>- You can share your public address with anyone. Others need it to interact with you.
</span><span class='line'>- You must NEVER share the secret key with anyone! The key controls access to your funds!
</span><span class='line'>- You must BACKUP your key file! Without the key, it<span class="s1">&#39;s impossible to access account funds!</span>
</span><span class='line'><span class="s1">- You must REMEMBER your password! Without the password, it&#39;</span>s impossible to decrypt the key!
</span></code></pre></td></tr></table></div></figure>


<p>Then when you attach your console session, you will be able to see the address that we created:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>geth attach /blockchain/ethereum/data/geth.ipc
</span><span class='line'>&gt; eth.accounts<span class="o">[</span>0<span class="o">]</span>
</span><span class='line'><span class="s2">&quot;0x5814d945ec909eb1307be4f133aaab3def3572f0&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>CLI - Attach</h2>

<p>Run the geth console:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>geth attach /blockchain/ethereum/data/geth.ipc
</span><span class='line'>Welcome to the Geth JavaScript console!
</span><span class='line'>
</span><span class='line'>instance: Geth/v1.10.13-stable-eae3b194/linux-amd64/go1.17
</span><span class='line'>at block: <span class="m">11173667</span> <span class="o">(</span>Wed Oct <span class="m">06</span> <span class="m">2021</span> 08:00:44 GMT+0200 <span class="o">(</span>SAST<span class="o">))</span>
</span><span class='line'> datadir: /blockchain/ethereum/data
</span><span class='line'> modules: admin:1.0 debug:1.0 eth:1.0 ethash:1.0 les:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 vflux:1.0 web3:1.0
</span><span class='line'>
</span><span class='line'>To <span class="nb">exit</span>, press ctrl-d or <span class="nb">type exit</span>
</span><span class='line'>&gt;
</span></code></pre></td></tr></table></div></figure>


<p>We can run <code>net</code> to show us the peercounts:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt; net
</span><span class='line'><span class="o">{</span>
</span><span class='line'>  listening: <span class="nb">true</span>,
</span><span class='line'>  peerCount: 1,
</span><span class='line'>  version: <span class="s2">&quot;3&quot;</span>,
</span><span class='line'>  getListening: <span class="k">function</span><span class="o">(</span>callback<span class="o">)</span>,
</span><span class='line'>  getPeerCount: <span class="k">function</span><span class="o">(</span>callback<span class="o">)</span>,
</span><span class='line'>  getVersion: <span class="k">function</span><span class="o">(</span>callback<span class="o">)</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Or if we just want to access the peerCount value:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt; net.peerCount
</span><span class='line'>1
</span></code></pre></td></tr></table></div></figure>


<p>To view the peers thats connected:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt; admin.peers
</span><span class='line'><span class="o">[{</span>
</span><span class='line'>    caps: <span class="o">[</span><span class="s2">&quot;eth/66&quot;</span>, <span class="s2">&quot;les/2&quot;</span>, <span class="s2">&quot;les/3&quot;</span>, <span class="s2">&quot;les/4&quot;</span>, <span class="s2">&quot;snap/1&quot;</span><span class="o">]</span>,
</span><span class='line'>    enode: <span class="s2">&quot;enode://3b76ec5359e59048721de8b6ff97a064ea280233d37433222ce7efcdac700c987326734983c9b65f8f1914c40e1efd6b43999912a3bca208fcbb540a678db110@93.75.22.22:30308&quot;</span>,
</span><span class='line'>    enr: <span class="s2">&quot;enr:-KO4QD2mp_FKB4ZDpfOAD_ziVnMXo1Mcd-FQl9Abj__EJKr9As6UE0frpdaiOnWjqzuGLGaabaAkG7e2CvfY8LulI9ENg2V0aMfGhHEZtrOAgmlkgnY0gmlwhF1LFhaDbGVzwQGJc2VjcDI1NmsxoQI7duxTWeWQSHId6Lb_l6Bk6igCM9N0MyIs5-_NrHAMmIRzbmFwwIN0Y3CCdmSDdWRwgnZk&quot;</span>,
</span><span class='line'>    id: <span class="s2">&quot;a95433e1bcbcc64f5d1ad8bd2535557d1f5ed2191a760f704d42a925656bb8de&quot;</span>,
</span><span class='line'>    name: <span class="s2">&quot;Geth/v1.10.9-stable-eae3b194/linux-amd64/go1.17&quot;</span>,
</span><span class='line'>    network: <span class="o">{</span>
</span><span class='line'>      inbound: <span class="nb">false</span>,
</span><span class='line'>      localAddress: <span class="s2">&quot;192.168.0.120:55166&quot;</span>,
</span><span class='line'>      remoteAddress: <span class="s2">&quot;93.75.22.22:30308&quot;</span>,
</span><span class='line'>      static: <span class="nb">false</span>,
</span><span class='line'>      trusted: <span class="nb">false</span>
</span><span class='line'>    <span class="o">}</span>,
</span><span class='line'>    protocols: <span class="o">{</span>
</span><span class='line'>      les: <span class="o">{</span>
</span><span class='line'>        difficulty: 35015228630523840,
</span><span class='line'>        head: <span class="s2">&quot;1aa1db0e6810f504f1542e8c3c49cecf17b0c3246b41f45bede42723d22b7c0c&quot;</span>,
</span><span class='line'>        version: 4
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Check if the node is syncing:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt; eth.syncing
</span><span class='line'><span class="o">{</span>
</span><span class='line'>  currentBlock: 11176044,
</span><span class='line'>  highestBlock: 11176158,
</span><span class='line'>  knownStates: 40043719,
</span><span class='line'>  pulledStates: 39904521,
</span><span class='line'>  startingBlock: 0
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>We can view our accounts:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt; eth.accounts
</span><span class='line'><span class="o">[</span><span class="s2">&quot;0x2b1718cdf7dbcc381267ccf43d320c6e194d6aa8&quot;</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>And get the balance:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt; eth.getBalance<span class="o">(</span>eth.accounts<span class="o">[</span>0<span class="o">])</span>
</span><span class='line'>300000000000000000
</span></code></pre></td></tr></table></div></figure>


<h2>CLI - SendTransaction</h2>

<p>The account that will be receiving the funds (host-a):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>geth attach /blockchain/ethereum/data/geth.ipc
</span><span class='line'>&gt; eth.accounts<span class="o">[</span>0<span class="o">]</span>
</span><span class='line'><span class="s2">&quot;0x2b1718cdf7dbcc381267ccf43d320c6e194d6aa8&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>It&rsquo;s current balance:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt; eth.getBalance<span class="o">(</span>eth.accounts<span class="o">[</span>0<span class="o">])</span>
</span><span class='line'>20485608293038927543
</span></code></pre></td></tr></table></div></figure>


<p>On the account that we will be sending from (host-b):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>geth attach /blockchain/ethereum/data/geth.ipc
</span><span class='line'>&gt; eth.accounts<span class="o">[</span>0<span class="o">]</span>
</span><span class='line'><span class="s2">&quot;0xd490fb53c0e7d3c80153112a4bd135e2cf897282&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>It&rsquo;s current balance:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt; eth.getBalance<span class="o">(</span>eth.accounts<span class="o">[</span>0<span class="o">])</span>
</span><span class='line'>2001712477998186788
</span></code></pre></td></tr></table></div></figure>


<p>When we attempt to send 1ETH to the recipient address:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt; eth.sendTransaction<span class="o">({</span>from: <span class="s2">&quot;0xd490fb53c0e7d3c80153112a4bd135e2cf897282&quot;</span>, to: <span class="s2">&quot;0x2b1718cdf7dbcc381267ccf43d320c6e194d6aa8&quot;</span>, value: <span class="s2">&quot;1000000000000000000&quot;</span><span class="o">})</span>
</span><span class='line'>Error: authentication needed: password or unlock
</span><span class='line'>  at web3.js:6357:37<span class="o">(</span>47<span class="o">)</span>
</span><span class='line'>  at web3.js:5091:62<span class="o">(</span>37<span class="o">)</span>
</span><span class='line'>  at &lt;<span class="nb">eval</span>&gt;:1:20<span class="o">(</span>10<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>You will notice that we need to unlock our account first:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt; web3.personal.unlockAccount<span class="o">(</span>web3.personal.listAccounts<span class="o">[</span>0<span class="o">]</span>, null, 60<span class="o">)</span>
</span><span class='line'>Unlock account 0xd490fb53c0e7d3c80153112a4bd135e2cf897282
</span><span class='line'>Passphrase:
</span><span class='line'><span class="nb">true</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we can send the transaction:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt; eth.sendTransaction<span class="o">({</span>from: <span class="s2">&quot;0xd490fb53c0e7d3c80153112a4bd135e2cf897282&quot;</span>, to: <span class="s2">&quot;0x2b1718cdf7dbcc381267ccf43d320c6e194d6aa8&quot;</span>, value: <span class="s2">&quot;1000000000000000000&quot;</span><span class="o">})</span>
</span><span class='line'><span class="s2">&quot;0x4bffabf28b71e6f83a48f0accb850b232dc3f482e30d942be3a2eb53d639d4bd&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>And the transaction id can be looked up on the ropsten blockexplorer:
- <a href="https://ropsten.etherscan.io/tx/0x4bffabf28b71e6f83a48f0accb850b232dc3f482e30d942be3a2eb53d639d4bd">https://ropsten.etherscan.io/tx/0x4bffabf28b71e6f83a48f0accb850b232dc3f482e30d942be3a2eb53d639d4bd</a></p>

<p>And after the confirmations has been confirmed, we can see in our receiving account, we received the funds:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt; eth.getBalance<span class="o">(</span>eth.accounts<span class="o">[</span>0<span class="o">])</span>
</span><span class='line'>21485608293038927543
</span></code></pre></td></tr></table></div></figure>


<h2>Web3</h2>

<p>Run a python environment:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>docker run -it python:3.8.5-slim bash
</span></code></pre></td></tr></table></div></figure>


<p>Install dependencies:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>apt update
</span><span class='line'>apt install python3-dev gcc -y
</span><span class='line'>pip install web3<span class="o">[</span>tester<span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>The examples I will be following was extracted from the documentation:
- <a href="https://ethereum.org/ml/developers/tutorials/a-developers-guide-to-ethereum-part-one/">https://ethereum.org/ml/developers/tutorials/a-developers-guide-to-ethereum-part-one/</a></p>

<p>Instantiate a client and connect to your geth node, [this documentation] provides different methods of connecting, but I will be using the <code>HTTPProvider</code> to connect over the network:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">web3</span> <span class="kn">import</span> <span class="n">Web3</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">w3</span> <span class="o">=</span> <span class="n">Web3</span><span class="p">(</span><span class="n">Web3</span><span class="o">.</span><span class="n">HTTPProvider</span><span class="p">(</span><span class="s">&#39;http://192.168.0.120:8545&#39;</span><span class="p">))</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">w3</span><span class="o">.</span><span class="n">isConnected</span><span class="p">()</span>
</span><span class='line'><span class="bp">True</span>
</span></code></pre></td></tr></table></div></figure>


<p>List the accounts:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python3'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">w3</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">accounts</span>
</span><span class='line'><span class="p">[</span><span class="s">&#39;0x2b1718CdF7dBcc381267CCF43D320C6e194D6aa8&#39;</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Get the balance in Wei:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python3'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">account</span> <span class="o">=</span> <span class="n">w3</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">accounts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">w3</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">get_balance</span><span class="p">(</span><span class="n">account</span><span class="p">)</span>
</span><span class='line'><span class="mi">300000000000000000</span>
</span></code></pre></td></tr></table></div></figure>


<p>Convert from Wei to ETH:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">balance_wei</span> <span class="o">=</span> <span class="n">w3</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">get_balance</span><span class="p">(</span><span class="n">account</span><span class="p">)</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">w3</span><span class="o">.</span><span class="n">fromWei</span><span class="p">(</span><span class="n">balance_wei</span><span class="p">,</span> <span class="s">&#39;ether&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;0.3&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Get the information about the latest block:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">w3</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">get_block</span><span class="p">(</span><span class="s">&#39;latest&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">AttributeDict</span><span class="p">({</span><span class="s">&#39;baseFeePerGas&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="s">&#39;difficulty&#39;</span><span class="p">:</span> <span class="mi">2073277081</span><span class="p">,</span> <span class="s">&#39;extraData&#39;</span><span class="p">:</span> <span class="n">HexBytes</span><span class="p">(</span><span class="s">&#39;0x63732e7064782e65647520676574682076312e31302e38&#39;</span><span class="p">),</span> <span class="s">&#39;gasLimit&#39;</span><span class="p">:</span> <span class="mi">8000000</span><span class="p">,</span> <span class="s">&#39;gasUsed&#39;</span><span class="p">:</span> <span class="mi">3361330</span><span class="p">,</span> <span class="s">&#39;hash&#39;</span><span class="p">:</span> <span class="n">HexBytes</span><span class="p">(</span><span class="s">&#39;0xd06a7a734413bcffa4d56617b7efb9ebd8e684c5fcc7fd4f3ec85b8b809b1a0b&#39;</span><span class="p">),</span> <span class="s">&#39;logsBloom&#39;</span><span class="p">:</span> <span class="n">HexBytes</span><span class="p">(</span><span class="s">&#39;0x00000004080000000001000000000000000000000000000000000000000000860000000000000400000000010000000000000000001000000000000080240000000000000000000000000018000000000000000000040000000000000000000002000000020000000000000000000800000000000000200000000010000000800000000000000002000000020000000040000000000000000001000000000000020800000000000000000000000000000000000000000000000000000000800000004002008000000001000000800000000000000000000000000000000062004010202800004000000000000000000000000040000000000002200000000000&#39;</span><span class="p">),</span> <span class="s">&#39;miner&#39;</span><span class="p">:</span> <span class="s">&#39;0xe9e7034AeD5CE7f5b0D281CFE347B8a5c2c53504&#39;</span><span class="p">,</span> <span class="s">&#39;mixHash&#39;</span><span class="p">:</span> <span class="n">HexBytes</span><span class="p">(</span><span class="s">&#39;0x42641ef2d13826f9cb070516f81515464af9c5c0a36edaa7c250fec62d18a193&#39;</span><span class="p">),</span> <span class="s">&#39;nonce&#39;</span><span class="p">:</span> <span class="n">HexBytes</span><span class="p">(</span><span class="s">&#39;0x670ce792aed73895&#39;</span><span class="p">),</span> <span class="s">&#39;number&#39;</span><span class="p">:</span> <span class="mi">11173874</span><span class="p">,</span> <span class="s">&#39;parentHash&#39;</span><span class="p">:</span> <span class="n">HexBytes</span><span class="p">(</span><span class="s">&#39;0xe26e265b264e5158a46ee213d39150d90b532db061497027f35ad36e98458895&#39;</span><span class="p">),</span> <span class="s">&#39;receiptsRoot&#39;</span><span class="p">:</span> <span class="n">HexBytes</span><span class="p">(</span><span class="s">&#39;0x08c15b7365caa993a3047a3093ae641d5b97c51aff058952ab48a56bdee9240b&#39;</span><span class="p">),</span> <span class="s">&#39;sha3Uncles&#39;</span><span class="p">:</span> <span class="n">HexBytes</span><span class="p">(</span><span class="s">&#39;0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347&#39;</span><span class="p">),</span> <span class="s">&#39;size&#39;</span><span class="p">:</span> <span class="mi">16130</span><span class="p">,</span> <span class="s">&#39;stateRoot&#39;</span><span class="p">:</span> <span class="n">HexBytes</span><span class="p">(</span><span class="s">&#39;0x9e2d99e11b4c71b93f14a563a87945c0ed89e577eefc860a7909bd6f3b8e669f&#39;</span><span class="p">),</span> <span class="s">&#39;timestamp&#39;</span><span class="p">:</span> <span class="mi">1633502988</span><span class="p">,</span> <span class="s">&#39;totalDifficulty&#39;</span><span class="p">:</span> <span class="mi">35015626783987398</span><span class="p">,</span> <span class="s">&#39;transactions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">HexBytes</span><span class="p">(</span><span class="s">&#39;0x9013555031ca4510e619968814b75ff428c595488c46a387a6b57774313f4686&#39;</span><span class="p">),</span> <span class="n">HexBytes</span><span class="p">(</span><span class="s">&#39;0x899f3dfa8cc0ce7eac397500a014dd624d50c0024e112fa3989403da5669b838&#39;</span><span class="p">),</span> <span class="n">HexBytes</span><span class="p">(</span><span class="s">&#39;0xf0c08c7e6849be5d23e0c603b405012a1baa4252884f8efac3244d3ed77b8622&#39;</span><span class="p">),</span> <span class="n">HexBytes</span><span class="p">(</span><span class="s">&#39;0xb6e03e10e0d6ced0a791f3a9474d760d7248301dc489c5b191aa82b1ef23e677&#39;</span><span class="p">),</span> <span class="n">HexBytes</span><span class="p">(</span><span class="s">&#39;0xb424a4da501df145346027c9c839ae9bf9a25f3672bf13fe097c39f46eda5028&#39;</span><span class="p">),</span> <span class="n">HexBytes</span><span class="p">(</span><span class="s">&#39;0xcb74ac5580485542ca532f5dc46798b84cb26d34ebc127871d6e2ffead6c32c7&#39;</span><span class="p">),</span> <span class="n">HexBytes</span><span class="p">(</span><span class="s">&#39;0xb61cf0eb92798885e4a6309d228e8a31e892e4353810593ba14a2737c1fcd53a&#39;</span><span class="p">),</span> <span class="n">HexBytes</span><span class="p">(</span><span class="s">&#39;0x20b27640c1b674be98d3051fac5dcf5ae50d5b7e957defc2336f07b99053fb2c&#39;</span><span class="p">),</span> <span class="n">HexBytes</span><span class="p">(</span><span class="s">&#39;0x2929a7384e5b47c4e414142623911a2deca95996e761bc10ccedf607342156af&#39;</span><span class="p">),</span> <span class="n">HexBytes</span><span class="p">(</span><span class="s">&#39;0x698af438f73bf384b7c35d4448c0e098d7744b4ce58327dc258a3d5706421c7e&#39;</span><span class="p">)],</span> <span class="s">&#39;transactionsRoot&#39;</span><span class="p">:</span> <span class="n">HexBytes</span><span class="p">(</span><span class="s">&#39;0x33cca53eabc2aed8cb0c8a5a7b771b9f14fd2e2aa2561195250411f0714ec768&#39;</span><span class="p">),</span> <span class="s">&#39;uncles&#39;</span><span class="p">:</span> <span class="p">[]})</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Mining</h2>

<p>Note: <code>Light clients do not support mining</code></p>

<p>From another node, im running the fast sync mode on ropsten:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">--</span><span class="n">syncmode</span> <span class="s">&quot;fast&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="https://geth.ethereum.org/docs/interface/mining">https://geth.ethereum.org/docs/interface/mining</a></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt; eth.hashrate
</span><span class='line'>43949
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt; eth.coinbase
</span><span class='line'><span class="s2">&quot;0x2b1718cdf7dbcc381267ccf43d320c6e194d6aa8&quot;</span>
</span><span class='line'>&gt; eth.getBalance<span class="o">(</span>eth.coinbase<span class="o">)</span>.toNumber<span class="o">()</span><span class="p">;</span>
</span><span class='line'>145000000000000000000
</span></code></pre></td></tr></table></div></figure>


<h2>Delete Data</h2>

<p>If we look at a fully synced ropsten &ldquo;fast&rdquo; node:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>du -h /blockchain/ethereum/
</span><span class='line'>4.0K  /blockchain/ethereum/data/keystore
</span><span class='line'>856K  /blockchain/ethereum/data/geth/triecache
</span><span class='line'>58G   /blockchain/ethereum/data/geth/chaindata/ancient
</span><span class='line'>69G   /blockchain/ethereum/data/geth/chaindata
</span><span class='line'>2.2M  /blockchain/ethereum/data/geth/nodes
</span><span class='line'>188M  /blockchain/ethereum/data/geth/ethash
</span><span class='line'>69G   /blockchain/ethereum/data/geth
</span><span class='line'>69G   /blockchain/ethereum/data
</span><span class='line'>69G   /blockchain/ethereum/
</span></code></pre></td></tr></table></div></figure>


<p>Remove the data with <code>removedb</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>geth --datadir /blockchain/ethereum/data removedb
</span><span class='line'>INFO <span class="o">[</span>10-06<span class="p">|</span>20:01:52.061<span class="o">]</span> Maximum peer count                       <span class="nv">ETH</span><span class="o">=</span><span class="m">50</span> <span class="nv">LES</span><span class="o">=</span><span class="m">0</span> <span class="nv">total</span><span class="o">=</span>50
</span><span class='line'>INFO <span class="o">[</span>10-06<span class="p">|</span>20:01:52.061<span class="o">]</span> Smartcard socket not found, disabling    <span class="nv">err</span><span class="o">=</span><span class="s2">&quot;stat /run/pcscd/pcscd.comm: no such file or directory&quot;</span>
</span><span class='line'>INFO <span class="o">[</span>10-06<span class="p">|</span>20:01:52.062<span class="o">]</span> Set global gas cap                       <span class="nv">cap</span><span class="o">=</span>50,000,000
</span><span class='line'>Remove full node state database <span class="o">(</span>/blockchain/ethereum/data/geth/chaindata<span class="o">)</span>? <span class="o">[</span>y/n<span class="o">]</span> y
</span><span class='line'>Remove full node state database <span class="o">(</span>/blockchain/ethereum/data/geth/chaindata<span class="o">)</span>? <span class="o">[</span>y/n<span class="o">]</span> y
</span><span class='line'>INFO <span class="o">[</span>10-06<span class="p">|</span>20:01:57.141<span class="o">]</span> Database successfully deleted            <span class="nv">path</span><span class="o">=</span>/blockchain/ethereum/data/geth/chaindata <span class="nv">elapsed</span><span class="o">=</span>2.482s
</span><span class='line'>Remove full node ancient database <span class="o">(</span>/blockchain/ethereum/data/geth/chaindata/ancient<span class="o">)</span>? <span class="o">[</span>y/n<span class="o">]</span> y
</span><span class='line'>Remove full node ancient database <span class="o">(</span>/blockchain/ethereum/data/geth/chaindata/ancient<span class="o">)</span>? <span class="o">[</span>y/n<span class="o">]</span> y
</span><span class='line'>INFO <span class="o">[</span>10-06<span class="p">|</span>20:02:05.645<span class="o">]</span> Database successfully deleted            <span class="nv">path</span><span class="o">=</span>/blockchain/ethereum/data/geth/chaindata/ancient <span class="nv">elapsed</span><span class="o">=</span>589.737ms
</span><span class='line'>INFO <span class="o">[</span>10-06<span class="p">|</span>20:02:05.645<span class="o">]</span> Light node database missing              <span class="nv">path</span><span class="o">=</span>/blockchain/ethereum/data/geth/lightchaindata
</span></code></pre></td></tr></table></div></figure>


<p>Now when we list the data directory, we can see the data was removed:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>du -h /blockchain/ethereum/
</span><span class='line'>8.0K  /blockchain/ethereum/data/keystore
</span><span class='line'>868K  /blockchain/ethereum/data/geth/triecache
</span><span class='line'>4.0K  /blockchain/ethereum/data/geth/chaindata/ancient
</span><span class='line'>180K  /blockchain/ethereum/data/geth/chaindata
</span><span class='line'>1.4M  /blockchain/ethereum/data/geth/nodes
</span><span class='line'>188M  /blockchain/ethereum/data/geth/ethash
</span><span class='line'>190M  /blockchain/ethereum/data/geth
</span><span class='line'>190M  /blockchain/ethereum/data
</span><span class='line'>190M  /blockchain/ethereum/
</span></code></pre></td></tr></table></div></figure>


<h2>Resources</h2>

<ul>
<li><a href="https://ethereum.org/ml/developers/tutorials/a-developers-guide-to-ethereum-part-one/">Use web3 in python</a></li>
<li><a href="https://www.linkedin.com/pulse/how-mine-ropsten-testnet-ether-keir-finlow-bates">How to mine ropsten testnet</a></li>
<li><a href="https://documenter.getpostman.com/view/4117254/ethereum-json-rpc/RVu7CT5J">Ethereum JSON RPC on Postman</a></li>
<li><a href="https://eth.wiki/json-rpc/API#personal_newAccount">ETH WIki - JSON RPC</a></li>
<li><a href="https://gist.github.com/swaldman/e58a866eafc4ff043c4099e394901a1e">https://gist.github.com/swaldman/e58a866eafc4ff043c4099e394901a1e</a></li>
<li><a href="https://ethereum.org/en/developers/tutorials/run-node-raspberry-pi/">Run Geth on a Raspberry Pi - ethereum.org</a></li>
</ul>


<h2>Thank You</h2>

<p>Thanks for reading, if you like my content, check out my <strong><a href="https://ruan.dev">website</a></strong> or follow me at <strong><a href="https://twitter.com/ruanbekker">@ruanbekker</a></strong> on Twitter.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2021/11/23/run-docker-containers-with-terraform/">Run Docker Containers With Terraform</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2021-11-23T11:06:03-05:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>23</span><span class='date-suffix'>rd</span>, <span class='date-year'>2021</span></span> <span class='time'>11:06 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In this post I will demonstrate how to use the terraform <a href="https://registry.terraform.io/providers/kreuzwerker/docker/latest/docs/resources/container">docker_container</a> resource from the <a href="https://github.com/kreuzwerker/terraform-provider-docker">docker provider</a> to run two docker containers, traefik and nginx and use the random provider to generate a random url for us.</p>

<h2>Pre-Requisites</h2>

<p>You will require <a href="https://www.terraform.io/downloads.html">terraform</a> and <a href="https://docs.docker.com/get-docker/">docker</a> to be installed.</p>

<h2>Project Structure</h2>

<p>The source code for this post is available on my github repository, but the project structure will look like the following:</p>

<p><img src="https://user-images.githubusercontent.com/567298/143061769-c619e7eb-c5b1-42bc-9fa4-ed59c15448fa.png" alt="image" /></p>

<p>Our <code>providers.tf</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>terraform {
</span><span class='line'>  required_providers {
</span><span class='line'>    docker = {
</span><span class='line'>      source  = "kreuzwerker/docker"
</span><span class='line'>      version = "2.15.0"
</span><span class='line'>    }
</span><span class='line'>    random = {
</span><span class='line'>      version = "~&gt; 3.0"
</span><span class='line'>    }
</span><span class='line'>  }
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>provider "docker" {
</span><span class='line'>  host = "unix:///var/run/docker.sock"
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>provider "random" {}</span></code></pre></td></tr></table></div></figure>


<p>Our <code>variables.tf</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>variable "domain" {
</span><span class='line'>  type    = string
</span><span class='line'>  default = "localdns.xyz"
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>Our <code>outputs.tf</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>output "nginx_container_name" {
</span><span class='line'>  value = docker_container.nginx.name
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>output "traefik_container_name" {
</span><span class='line'>  value = docker_container.traefik.name
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>output "traefik_url" {
</span><span class='line'>  value = "http://traefik.${var.domain}/"
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>output "nginx_url" {
</span><span class='line'>  value = "http://www.${random_string.nginx.result}.${var.domain}/"
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>Our <code>main.tf</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>resource "random_string" "nginx" {
</span><span class='line'>  length  = 8
</span><span class='line'>  upper   = false
</span><span class='line'>  special = false
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>resource "docker_image" "nginx" {
</span><span class='line'>  name = "nginx:stable-alpine"
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>resource "docker_image" "traefik" {
</span><span class='line'>  name = "traefik:1.7.14"
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>resource "docker_network" "nginx" {
</span><span class='line'>  name   = "docknet"
</span><span class='line'>  driver = "bridge"
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>resource "docker_container" "traefik" {
</span><span class='line'>  name  = "traefik"
</span><span class='line'>  image = docker_image.traefik.name
</span><span class='line'>
</span><span class='line'>  networks_advanced {
</span><span class='line'>    name    = docker_network.nginx.name
</span><span class='line'>    aliases = ["docknet"]
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  restart = "unless-stopped"
</span><span class='line'>  destroy_grace_seconds = 30
</span><span class='line'>  must_run = true
</span><span class='line'>  memory = 256
</span><span class='line'>
</span><span class='line'>  volumes {
</span><span class='line'>    host_path      = "/var/run/docker.sock"
</span><span class='line'>    container_path = "/var/run/docker.sock"
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  command = [
</span><span class='line'>    "--api",
</span><span class='line'>    "--docker",
</span><span class='line'>    "--docker.watch",
</span><span class='line'>    "--entrypoints=Name:http Address::80",
</span><span class='line'>    "--logLevel=INFO"
</span><span class='line'>  ]
</span><span class='line'>
</span><span class='line'>  ports {
</span><span class='line'>    internal = 80
</span><span class='line'>    external = 80
</span><span class='line'>    ip       = "0.0.0.0"
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  labels {
</span><span class='line'>    label = "traefik.enable"
</span><span class='line'>    value = true
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  labels {
</span><span class='line'>    label = "traefik.docker.network"
</span><span class='line'>    value = "docknet"
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  labels {
</span><span class='line'>    label = "traefik.frontend.rule"
</span><span class='line'>    value = "Host:traefik.${var.domain}"
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  labels {
</span><span class='line'>    label = "traefik.port"
</span><span class='line'>    value = 8080
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>resource "docker_container" "nginx" {
</span><span class='line'>  name  = "nginx"
</span><span class='line'>  image = docker_image.nginx.name
</span><span class='line'>
</span><span class='line'>  networks_advanced {
</span><span class='line'>    name    = docker_network.nginx.name
</span><span class='line'>    aliases = ["docknet"]
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  restart = "unless-stopped"
</span><span class='line'>  destroy_grace_seconds = 30
</span><span class='line'>  must_run = true
</span><span class='line'>  memory = 256
</span><span class='line'>
</span><span class='line'>  volumes {
</span><span class='line'>    host_path      = "/Users/ruan/personal/terraform-playground/docker-containers/html"
</span><span class='line'>    container_path = "/usr/share/nginx/html"
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  volumes {
</span><span class='line'>    host_path      = "/Users/ruan/personal/terraform-playground/docker-containers/configs/nginx.conf"
</span><span class='line'>    container_path = "/etc/nginx/nginx.conf"
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  volumes {
</span><span class='line'>    host_path      = "/Users/ruan/personal/terraform-playground/docker-containers/configs/app.conf"
</span><span class='line'>    container_path = "/etc/nginx/conf.d/app.conf"
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  env = [
</span><span class='line'>    "PUID=501",
</span><span class='line'>    "PGID=20"
</span><span class='line'>  ]
</span><span class='line'>
</span><span class='line'>  labels {
</span><span class='line'>    label = "traefik.enable"
</span><span class='line'>    value = true
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  labels {
</span><span class='line'>    label = "traefik.docker.network"
</span><span class='line'>    value = "docknet"
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  labels {
</span><span class='line'>    label = "traefik.frontend.rule"
</span><span class='line'>    value = "Host:www.${random_string.nginx.result}.${var.domain}"
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  labels {
</span><span class='line'>    label = "traefik.port"
</span><span class='line'>    value = 80
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  depends_on = [
</span><span class='line'>    docker_container.traefik,
</span><span class='line'>    random_string.nginx
</span><span class='line'>  ]
</span><span class='line'>
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>Our <code>html/index.html</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="cp">&lt;!doctype html&gt;</span>
</span><span class='line'><span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">&quot;en&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;head&gt;</span>
</span><span class='line'>        <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content=</span><span class="s">&quot;width=device-width, initial-scale=1&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;title&gt;</span>Welcome<span class="nt">&lt;/title&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="c">&lt;!-- Fonts --&gt;</span>
</span><span class='line'>        <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">&quot;https://fonts.googleapis.com/css?family=Nunito:200,600&quot;</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="c">&lt;!-- Styles --&gt;</span>
</span><span class='line'>        <span class="nt">&lt;style&gt;</span>
</span><span class='line'>            <span class="nt">html</span><span class="o">,</span> <span class="nt">body</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">background-color</span><span class="o">:</span> <span class="m">#fff</span><span class="p">;</span>
</span><span class='line'>                <span class="k">color</span><span class="o">:</span> <span class="m">#636b6f</span><span class="p">;</span>
</span><span class='line'>                <span class="k">font-family</span><span class="o">:</span> <span class="s1">&#39;Nunito&#39;</span><span class="o">,</span> <span class="k">sans-serif</span><span class="p">;</span>
</span><span class='line'>                <span class="k">font-weight</span><span class="o">:</span> <span class="m">200</span><span class="p">;</span>
</span><span class='line'>                <span class="k">height</span><span class="o">:</span> <span class="m">100</span><span class="n">vh</span><span class="p">;</span>
</span><span class='line'>                <span class="k">margin</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>            <span class="nc">.full-height</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">height</span><span class="o">:</span> <span class="m">100</span><span class="n">vh</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>            <span class="nc">.flex-center</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">align</span><span class="o">-</span><span class="n">items</span><span class="o">:</span> <span class="k">center</span><span class="p">;</span>
</span><span class='line'>                <span class="k">display</span><span class="o">:</span> <span class="n">flex</span><span class="p">;</span>
</span><span class='line'>                <span class="k">justify</span><span class="o">-</span><span class="k">content</span><span class="o">:</span> <span class="k">center</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>            <span class="nc">.position-ref</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">position</span><span class="o">:</span> <span class="k">relative</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>            <span class="nc">.top-right</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">position</span><span class="o">:</span> <span class="k">absolute</span><span class="p">;</span>
</span><span class='line'>                <span class="k">right</span><span class="o">:</span> <span class="m">10px</span><span class="p">;</span>
</span><span class='line'>                <span class="k">top</span><span class="o">:</span> <span class="m">18px</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>            <span class="nc">.content</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">text-align</span><span class="o">:</span> <span class="k">center</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>            <span class="nc">.title</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">font-size</span><span class="o">:</span> <span class="m">84px</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>            <span class="nc">.links</span> <span class="o">&gt;</span> <span class="nt">a</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">color</span><span class="o">:</span> <span class="m">#636b6f</span><span class="p">;</span>
</span><span class='line'>                <span class="k">padding</span><span class="o">:</span> <span class="m">0</span> <span class="m">25px</span><span class="p">;</span>
</span><span class='line'>                <span class="k">font-size</span><span class="o">:</span> <span class="m">13px</span><span class="p">;</span>
</span><span class='line'>                <span class="k">font-weight</span><span class="o">:</span> <span class="m">600</span><span class="p">;</span>
</span><span class='line'>                <span class="k">letter-spacing</span><span class="o">:</span> <span class="o">.</span><span class="m">1</span><span class="n">rem</span><span class="p">;</span>
</span><span class='line'>                <span class="k">text-decoration</span><span class="o">:</span> <span class="k">none</span><span class="p">;</span>
</span><span class='line'>                <span class="k">text-transform</span><span class="o">:</span> <span class="k">uppercase</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>            <span class="nc">.m-b-md</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">margin-bottom</span><span class="o">:</span> <span class="m">30px</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="nt">&lt;/style&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/head&gt;</span>
</span><span class='line'>    <span class="nt">&lt;body&gt;</span>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;flex-center position-ref full-height&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;content&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;title m-b-md&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                    Welcome
</span><span class='line'>                <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;links&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;https://ruan.dev&quot;</span> <span class="na">target=</span><span class="s">&quot;_blank&quot;</span><span class="nt">&gt;</span>About Me<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>                <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Our <code>configs/nginx.conf</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>user  nginx;
</span><span class='line'>worker_processes  auto;
</span><span class='line'>error_log  /var/log/nginx/error.log notice;
</span><span class='line'>pid        /var/run/nginx.pid;
</span><span class='line'>
</span><span class='line'>events {
</span><span class='line'>    worker_connections  1024;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>http {
</span><span class='line'>    include       /etc/nginx/mime.types;
</span><span class='line'>    default_type  application/octet-stream;
</span><span class='line'>
</span><span class='line'>    log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;
</span><span class='line'>                      &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;
</span><span class='line'>                      &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;
</span><span class='line'>
</span><span class='line'>    access_log  /var/log/nginx/access.log  main;
</span><span class='line'>    sendfile        on;
</span><span class='line'>    keepalive_timeout  65;
</span><span class='line'>
</span><span class='line'>    include /etc/nginx/conf.d/app.conf;
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<p>And lastly, our <code>configs/app.conf</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>server {
</span><span class='line'>  listen 80;
</span><span class='line'>  server_name _;
</span><span class='line'>
</span><span class='line'>  location / {
</span><span class='line'>    root   /usr/share/nginx/html;
</span><span class='line'>    index  index.html;
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  location /healthz {
</span><span class='line'>    return 200 &#39;up&#39;;
</span><span class='line'>  }
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<h2>Deployment</h2>

<p>Once everything is in place, or if you want to clone my repository, you can do that by:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>git clone https://github.com/ruanbekker/terraform-docker-container-example
</span><span class='line'>cd terraform-docker-container-example
</span></code></pre></td></tr></table></div></figure>


<p>Then we can initialize terraform by fetching the required plugins:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>terraform init
</span></code></pre></td></tr></table></div></figure>


<p>Once that completes we can run a plan:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>terraform plan
</span></code></pre></td></tr></table></div></figure>


<p>And that should output something more or less like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
<span class='line-number'>231</span>
<span class='line-number'>232</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with
</span><span class='line'>the following symbols:
</span><span class='line'>  + create
</span><span class='line'>
</span><span class='line'>Terraform will perform the following actions:
</span><span class='line'>
</span><span class='line'>  # docker_container.nginx will be created
</span><span class='line'>  + resource &quot;docker_container&quot; &quot;nginx&quot; {
</span><span class='line'>      + attach                = false
</span><span class='line'>      + bridge                = (known after apply)
</span><span class='line'>      + command               = (known after apply)
</span><span class='line'>      + container_logs        = (known after apply)
</span><span class='line'>      + destroy_grace_seconds = 30
</span><span class='line'>      + entrypoint            = (known after apply)
</span><span class='line'>      + env                   = [
</span><span class='line'>          + &quot;PGID=20&quot;,
</span><span class='line'>          + &quot;PUID=501&quot;,
</span><span class='line'>        ]
</span><span class='line'>      + exit_code             = (known after apply)
</span><span class='line'>      + gateway               = (known after apply)
</span><span class='line'>      + hostname              = (known after apply)
</span><span class='line'>      + id                    = (known after apply)
</span><span class='line'>      + image                 = &quot;nginx:stable-alpine&quot;
</span><span class='line'>      + init                  = (known after apply)
</span><span class='line'>      + ip_address            = (known after apply)
</span><span class='line'>      + ip_prefix_length      = (known after apply)
</span><span class='line'>      + ipc_mode              = (known after apply)
</span><span class='line'>      + log_driver            = &quot;json-file&quot;
</span><span class='line'>      + logs                  = false
</span><span class='line'>      + memory                = 256
</span><span class='line'>      + must_run              = true
</span><span class='line'>      + name                  = &quot;nginx&quot;
</span><span class='line'>      + network_data          = (known after apply)
</span><span class='line'>      + read_only             = false
</span><span class='line'>      + remove_volumes        = true
</span><span class='line'>      + restart               = &quot;unless-stopped&quot;
</span><span class='line'>      + rm                    = false
</span><span class='line'>      + security_opts         = (known after apply)
</span><span class='line'>      + shm_size              = (known after apply)
</span><span class='line'>      + start                 = true
</span><span class='line'>      + stdin_open            = false
</span><span class='line'>      + tty                   = false
</span><span class='line'>
</span><span class='line'>      + healthcheck {
</span><span class='line'>          + interval     = (known after apply)
</span><span class='line'>          + retries      = (known after apply)
</span><span class='line'>          + start_period = (known after apply)
</span><span class='line'>          + test         = (known after apply)
</span><span class='line'>          + timeout      = (known after apply)
</span><span class='line'>        }
</span><span class='line'>
</span><span class='line'>      + labels {
</span><span class='line'>          + label = &quot;traefik.docker.network&quot;
</span><span class='line'>          + value = &quot;docknet&quot;
</span><span class='line'>        }
</span><span class='line'>      + labels {
</span><span class='line'>          + label = &quot;traefik.enable&quot;
</span><span class='line'>          + value = &quot;true&quot;
</span><span class='line'>        }
</span><span class='line'>      + labels {
</span><span class='line'>          + label = &quot;traefik.frontend.rule&quot;
</span><span class='line'>          + value = (known after apply)
</span><span class='line'>        }
</span><span class='line'>      + labels {
</span><span class='line'>          + label = &quot;traefik.port&quot;
</span><span class='line'>          + value = &quot;80&quot;
</span><span class='line'>        }
</span><span class='line'>
</span><span class='line'>      + networks_advanced {
</span><span class='line'>          + aliases = [
</span><span class='line'>              + &quot;docknet&quot;,
</span><span class='line'>            ]
</span><span class='line'>          + name    = &quot;docknet&quot;
</span><span class='line'>        }
</span><span class='line'>
</span><span class='line'>      + volumes {
</span><span class='line'>          + container_path = &quot;/etc/nginx/conf.d/app.conf&quot;
</span><span class='line'>          + host_path      = &quot;/Users/ruan/personal/terraform-playground/docker-containers/configs/app.conf&quot;
</span><span class='line'>        }
</span><span class='line'>      + volumes {
</span><span class='line'>          + container_path = &quot;/etc/nginx/nginx.conf&quot;
</span><span class='line'>          + host_path      = &quot;/Users/ruan/personal/terraform-playground/docker-containers/configs/nginx.conf&quot;
</span><span class='line'>        }
</span><span class='line'>      + volumes {
</span><span class='line'>          + container_path = &quot;/usr/share/nginx/html&quot;
</span><span class='line'>          + host_path      = &quot;/Users/ruan/personal/terraform-playground/docker-containers/html&quot;
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>  # docker_container.traefik will be created
</span><span class='line'>  + resource &quot;docker_container&quot; &quot;traefik&quot; {
</span><span class='line'>      + attach                = false
</span><span class='line'>      + bridge                = (known after apply)
</span><span class='line'>      + command               = [
</span><span class='line'>          + &quot;--api&quot;,
</span><span class='line'>          + &quot;--docker&quot;,
</span><span class='line'>          + &quot;--docker.watch&quot;,
</span><span class='line'>          + &quot;--entrypoints=Name:http Address::80&quot;,
</span><span class='line'>          + &quot;--logLevel=INFO&quot;,
</span><span class='line'>        ]
</span><span class='line'>      + container_logs        = (known after apply)
</span><span class='line'>      + destroy_grace_seconds = 30
</span><span class='line'>      + entrypoint            = (known after apply)
</span><span class='line'>      + env                   = (known after apply)
</span><span class='line'>      + exit_code             = (known after apply)
</span><span class='line'>      + gateway               = (known after apply)
</span><span class='line'>      + hostname              = (known after apply)
</span><span class='line'>      + id                    = (known after apply)
</span><span class='line'>      + image                 = &quot;traefik:1.7.14&quot;
</span><span class='line'>      + init                  = (known after apply)
</span><span class='line'>      + ip_address            = (known after apply)
</span><span class='line'>      + ip_prefix_length      = (known after apply)
</span><span class='line'>      + ipc_mode              = (known after apply)
</span><span class='line'>      + log_driver            = &quot;json-file&quot;
</span><span class='line'>      + logs                  = false
</span><span class='line'>      + memory                = 256
</span><span class='line'>      + must_run              = true
</span><span class='line'>      + name                  = &quot;traefik&quot;
</span><span class='line'>      + network_data          = (known after apply)
</span><span class='line'>      + read_only             = false
</span><span class='line'>      + remove_volumes        = true
</span><span class='line'>      + restart               = &quot;unless-stopped&quot;
</span><span class='line'>      + rm                    = false
</span><span class='line'>      + security_opts         = (known after apply)
</span><span class='line'>      + shm_size              = (known after apply)
</span><span class='line'>      + start                 = true
</span><span class='line'>      + stdin_open            = false
</span><span class='line'>      + tty                   = false
</span><span class='line'>
</span><span class='line'>      + healthcheck {
</span><span class='line'>          + interval     = (known after apply)
</span><span class='line'>          + retries      = (known after apply)
</span><span class='line'>          + start_period = (known after apply)
</span><span class='line'>          + test         = (known after apply)
</span><span class='line'>          + timeout      = (known after apply)
</span><span class='line'>        }
</span><span class='line'>
</span><span class='line'>      + labels {
</span><span class='line'>          + label = &quot;traefik.docker.network&quot;
</span><span class='line'>          + value = &quot;docknet&quot;
</span><span class='line'>        }
</span><span class='line'>      + labels {
</span><span class='line'>          + label = &quot;traefik.enable&quot;
</span><span class='line'>          + value = &quot;true&quot;
</span><span class='line'>        }
</span><span class='line'>      + labels {
</span><span class='line'>          + label = &quot;traefik.frontend.rule&quot;
</span><span class='line'>          + value = &quot;Host:traefik.localdns.xyz&quot;
</span><span class='line'>        }
</span><span class='line'>      + labels {
</span><span class='line'>          + label = &quot;traefik.port&quot;
</span><span class='line'>          + value = &quot;8080&quot;
</span><span class='line'>        }
</span><span class='line'>
</span><span class='line'>      + networks_advanced {
</span><span class='line'>          + aliases = [
</span><span class='line'>              + &quot;docknet&quot;,
</span><span class='line'>            ]
</span><span class='line'>          + name    = &quot;docknet&quot;
</span><span class='line'>        }
</span><span class='line'>
</span><span class='line'>      + ports {
</span><span class='line'>          + external = 80
</span><span class='line'>          + internal = 80
</span><span class='line'>          + ip       = &quot;0.0.0.0&quot;
</span><span class='line'>          + protocol = &quot;tcp&quot;
</span><span class='line'>        }
</span><span class='line'>
</span><span class='line'>      + volumes {
</span><span class='line'>          + container_path = &quot;/var/run/docker.sock&quot;
</span><span class='line'>          + host_path      = &quot;/var/run/docker.sock&quot;
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>  # docker_image.nginx will be created
</span><span class='line'>  + resource &quot;docker_image&quot; &quot;nginx&quot; {
</span><span class='line'>      + id          = (known after apply)
</span><span class='line'>      + latest      = (known after apply)
</span><span class='line'>      + name        = &quot;nginx:stable-alpine&quot;
</span><span class='line'>      + output      = (known after apply)
</span><span class='line'>      + repo_digest = (known after apply)
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>  # docker_image.traefik will be created
</span><span class='line'>  + resource &quot;docker_image&quot; &quot;traefik&quot; {
</span><span class='line'>      + id          = (known after apply)
</span><span class='line'>      + latest      = (known after apply)
</span><span class='line'>      + name        = &quot;traefik:1.7.14&quot;
</span><span class='line'>      + output      = (known after apply)
</span><span class='line'>      + repo_digest = (known after apply)
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>  # docker_network.nginx will be created
</span><span class='line'>  + resource &quot;docker_network&quot; &quot;nginx&quot; {
</span><span class='line'>      + driver      = &quot;bridge&quot;
</span><span class='line'>      + id          = (known after apply)
</span><span class='line'>      + internal    = (known after apply)
</span><span class='line'>      + ipam_driver = &quot;default&quot;
</span><span class='line'>      + name        = &quot;docknet&quot;
</span><span class='line'>      + options     = (known after apply)
</span><span class='line'>      + scope       = (known after apply)
</span><span class='line'>
</span><span class='line'>      + ipam_config {
</span><span class='line'>          + aux_address = (known after apply)
</span><span class='line'>          + gateway     = (known after apply)
</span><span class='line'>          + ip_range    = (known after apply)
</span><span class='line'>          + subnet      = (known after apply)
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>  # random_string.nginx will be created
</span><span class='line'>  + resource &quot;random_string&quot; &quot;nginx&quot; {
</span><span class='line'>      + id          = (known after apply)
</span><span class='line'>      + length      = 8
</span><span class='line'>      + lower       = true
</span><span class='line'>      + min_lower   = 0
</span><span class='line'>      + min_numeric = 0
</span><span class='line'>      + min_special = 0
</span><span class='line'>      + min_upper   = 0
</span><span class='line'>      + number      = true
</span><span class='line'>      + result      = (known after apply)
</span><span class='line'>      + special     = false
</span><span class='line'>      + upper       = false
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>Plan: 6 to add, 0 to change, 0 to destroy.
</span><span class='line'>
</span><span class='line'>Changes to Outputs:
</span><span class='line'>  + nginx_container_name   = &quot;nginx&quot;
</span><span class='line'>  + nginx_url              = (known after apply)
</span><span class='line'>  + traefik_container_name = &quot;traefik&quot;
</span><span class='line'>  + traefik_url            = &quot;http://traefik.localdns.xyz/&quot;
</span></code></pre></td></tr></table></div></figure>


<p>Which we can see will create 2 containers, traefik and then nginx, map the configs and html in place and also sets the traefik hostname in the labels for our respective containers so that we can reach them via the specific host headers.</p>

<p>The we can deploy our containers:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>terraform apply -auto-approve
</span></code></pre></td></tr></table></div></figure>


<p>Which will provide us the output detail defined from our <code>outputs.tf</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>Apply complete! Resources: 6 added, 0 changed, 0 destroyed.
</span><span class='line'>
</span><span class='line'>Outputs:
</span><span class='line'>
</span><span class='line'>nginx_container_name = &quot;nginx&quot;
</span><span class='line'>nginx_url = &quot;http://www.5igjdfq9.localdns.xyz/&quot;
</span><span class='line'>traefik_container_name = &quot;traefik&quot;
</span><span class='line'>traefik_url = &quot;http://traefik.localdns.xyz/&quot;
</span></code></pre></td></tr></table></div></figure>


<h2>Access our Containers</h2>

<p>We can access our Traefik Dashboard on <a href="http://traefik.localdns.xyz">http://traefik.localdns.xyz</a> and should look something like this:</p>

<p><img src="https://user-images.githubusercontent.com/567298/143064031-23e9dbe4-522b-4f11-96f9-f30a2104ee44.png" alt="image" /></p>

<p>And when we access our Nginx container on <a href="http://www.5igjdfq9.localdns.xyz">http://www.5igjdfq9.localdns.xyz</a> it should look more or less like this:</p>

<p><img src="https://user-images.githubusercontent.com/567298/143064228-88107b75-31fc-41eb-aee0-f26ff976c42a.png" alt="image" /></p>

<p>Running a <code>docker ps</code> will show our running containers:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>docker ps
</span><span class='line'>CONTAINER ID   IMAGE                  COMMAND                  CREATED         STATUS                PORTS                NAMES
</span><span class='line'>e45158ae8cba   nginx:stable-alpine    &quot;/docker-entrypoint   3 minutes ago   Up 3 minutes          80/tcp               nginx
</span><span class='line'>ebdbe42a0fcb   traefik:1.7.14         &quot;/traefik --api       3 minutes ago   Up 3 minutes          0.0.0.0:80-&gt;80/tcp   traefik
</span></code></pre></td></tr></table></div></figure>


<h2>Cleanup</h2>

<p>We can delete our containers by running:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>terraform destroy -auto-approve
</span></code></pre></td></tr></table></div></figure>


<h2>Thank You</h2>

<p>Thanks for reading, if you like my content, check out my <strong><a href="https://ruan.dev">website</a></strong> or follow me at <strong><a href="https://twitter.com/ruanbekker">@ruanbekker</a></strong> on Twitter.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2021/11/03/setup-traefik-version-2-on-docker/">Setup Traefik Version 2 on Docker</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2021-11-03T01:20:27-04:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>3</span><span class='date-suffix'>rd</span>, <span class='date-year'>2021</span></span> <span class='time'>1:20 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In this tutorial we will be setting up <a href="https://traefik.io">Traefik </a> v2 as our reverse proxy with port 80 and 443 enabled, and then hook up a example application behind the application load balancer, and route incoiming requests via host headers.</p>

<h2>What is Traefik</h2>

<p>Traefik is a modern HTTP reverse proxy and load balancer that makes deploying microservices super easy by making use of docker labels to route your traffic based on host headers, path prefixes etc. Please check out <a href="https://doc.traefik.io/traefik/">their website</a> to find out more about them.</p>

<h2>Use Case</h2>

<p>In our example we want to route traefik from <code>http://app.selfhosted.co.za</code> to hit our proxy on port 80, then we want traefik to redirect port 80 to the 443 port configured on the proxy which is configured with letsencrypt and reverse proxy the connection to our application.</p>

<p>The application is being configured via docker labels, which we will get into later.</p>

<h2>Our Environment</h2>

<p>I will be using the domain <code>selfhosted.co.za</code>, so if you are following along, you can just replace this domain with yours.</p>

<p>For this demonstration I have spun up a VM at <a href="https://civo.com">Civo</a> as you can see below:</p>

<p><img src="https://user-images.githubusercontent.com/567298/125192278-5023a200-e247-11eb-97c6-cebd65f22f07.png" alt="image" /></p>

<p>From the provided public IP address, we will be creating a DNS A record for our domain, and then create a wildcard entry to CNAME to our initial dns name:</p>

<p><img src="https://user-images.githubusercontent.com/567298/125192297-6b8ead00-e247-11eb-9c01-740557838a12.png" alt="image" /></p>

<p>You might not want to point all the subdomains to that entry, but to simplify things, every application that needs to be routed via traefik, I can manage from a traefik config level, since my dns is already pointing to the public ip where traefik is running on.</p>

<p>So if I spin up a new container, lets say <code>bitwarden</code>, I can just set <code>bitwarden.selfhosted.co.za</code> in the labels of that container and due to the dns already pointing to traefik, traefik will route the connection to the correct container.</p>

<h2>Pre-Requisites</h2>

<p>In order to follow along you will need <a href="https://docs.docker.com/get-docker/">docker</a> and <a href="https://docs.docker.com/compose/install/">docker-compose</a> to be installed, and can be validated using:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>docker -v
</span><span class='line'>Docker version 20.10.7, build f0df350
</span><span class='line'>
</span><span class='line'>docker-compose -v
</span><span class='line'>docker-compose version 1.28.6, build 5db8d86f</span></code></pre></td></tr></table></div></figure>


<h2>Traefik on Docker</h2>

<p>We will have one <code>docker-compose.yml</code> file which has the proxy and the example application. Be sure to change the following to suite your environment:
- <code>traefik.http.routers.api.rule=Host()'</code>
- <code>--certificatesResolvers.letsencrypt.acme.email=youremail@yourdomain.net</code></p>

<p>The compose:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="nn">---</span>
</span><span class='line'><span class="l-Scalar-Plain">version</span><span class="p-Indicator">:</span> <span class="s">&#39;3.8&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">services</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">traefik</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">image</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">traefik:2.4</span>
</span><span class='line'>    <span class="l-Scalar-Plain">container_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">traefik</span>
</span><span class='line'>    <span class="l-Scalar-Plain">restart</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">unless-stopped</span>
</span><span class='line'>    <span class="l-Scalar-Plain">volumes</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">./traefik/acme.json:/acme.json</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">/var/run/docker.sock:/var/run/docker.sock</span>
</span><span class='line'>    <span class="l-Scalar-Plain">networks</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">docknet</span>
</span><span class='line'>    <span class="l-Scalar-Plain">labels</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="s">&#39;traefik.enable=true&#39;</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="s">&#39;traefik.http.routers.api.rule=Host(`traefik.selfhosted.co.za`)&#39;</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="s">&#39;traefik.http.routers.api.entrypoints=https&#39;</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="s">&#39;traefik.http.routers.api.service=api@internal&#39;</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="s">&#39;traefik.http.routers.api.tls=true&#39;</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="s">&#39;traefik.http.routers.api.tls.certresolver=letsencrypt&#39;</span>
</span><span class='line'>    <span class="l-Scalar-Plain">ports</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">80:80</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">443:443</span>
</span><span class='line'>    <span class="l-Scalar-Plain">command</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="s">&#39;--api&#39;</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="s">&#39;--providers.docker=true&#39;</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="s">&#39;--providers.docker.exposedByDefault=false&#39;</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="s">&#39;--entrypoints.http=true&#39;</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="s">&#39;--entrypoints.http.address=:80&#39;</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="s">&#39;--entrypoints.http.http.redirections.entrypoint.to=https&#39;</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="s">&#39;--entrypoints.http.http.redirections.entrypoint.scheme=https&#39;</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="s">&#39;--entrypoints.https=true&#39;</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="s">&#39;--entrypoints.https.address=:443&#39;</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="s">&#39;--certificatesResolvers.letsencrypt.acme.email=youremail@yourdomain.net&#39;</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="s">&#39;--certificatesResolvers.letsencrypt.acme.storage=acme.json&#39;</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="s">&#39;--certificatesResolvers.letsencrypt.acme.httpChallenge.entryPoint=http&#39;</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="s">&#39;--log=true&#39;</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="s">&#39;--log.level=INFO&#39;</span>
</span><span class='line'>    <span class="l-Scalar-Plain">logging</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="l-Scalar-Plain">driver</span><span class="p-Indicator">:</span> <span class="s">&quot;json-file&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">options</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">max-size</span><span class="p-Indicator">:</span> <span class="s">&quot;1m&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="l-Scalar-Plain">webapp</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">image</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">traefik/whoami</span>
</span><span class='line'>    <span class="l-Scalar-Plain">container_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">webapp</span>
</span><span class='line'>    <span class="l-Scalar-Plain">restart</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">unless-stopped</span>
</span><span class='line'>    <span class="l-Scalar-Plain">networks</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">docknet</span>
</span><span class='line'>    <span class="l-Scalar-Plain">labels</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="s">&#39;traefik.enable=true&#39;</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="s">&#39;traefik.http.routers.webapp.rule=Host(`app.selfhosted.co.za`)&#39;</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="s">&#39;traefik.http.routers.webapp.entrypoints=https&#39;</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="s">&#39;traefik.http.routers.webapp.tls=true&#39;</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="s">&#39;traefik.http.routers.webapp.tls.certresolver=letsencrypt&#39;</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="s">&#39;traefik.http.routers.webapp.service=webappservice&#39;</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="s">&#39;traefik.http.services.webappservice.loadbalancer.server.port=80&#39;</span>
</span><span class='line'>    <span class="l-Scalar-Plain">logging</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="l-Scalar-Plain">driver</span><span class="p-Indicator">:</span> <span class="s">&quot;json-file&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">options</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">max-size</span><span class="p-Indicator">:</span> <span class="s">&quot;1m&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">networks</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">docknet</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">docknet</span>
</span></code></pre></td></tr></table></div></figure>


<p>Prepare the <code>./traefik/acme.json</code> file:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">mkdir traefik</span>
</span><span class='line'><span class="l-Scalar-Plain">touch traefik/acme.json</span>
</span><span class='line'><span class="l-Scalar-Plain">chmod 600 traefik/acme.json</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you can see in order to wire a application onto the proxy we need the following labels:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'>  <span class="p-Indicator">-</span> <span class="s">&#39;traefik.enable=true&#39;</span>
</span><span class='line'>  <span class="p-Indicator">-</span> <span class="s">&#39;traefik.http.routers.webapp.rule=Host(`app.selfhosted.co.za`)&#39;</span>
</span><span class='line'>  <span class="p-Indicator">-</span> <span class="s">&#39;traefik.http.routers.webapp.entrypoints=https&#39;</span>
</span><span class='line'>  <span class="p-Indicator">-</span> <span class="s">&#39;traefik.http.routers.webapp.tls=true&#39;</span>
</span><span class='line'>  <span class="p-Indicator">-</span> <span class="s">&#39;traefik.http.routers.webapp.tls.certresolver=letsencrypt&#39;</span>
</span><span class='line'>  <span class="p-Indicator">-</span> <span class="s">&#39;traefik.http.routers.webapp.service=webappservice&#39;</span>
</span><span class='line'>  <span class="p-Indicator">-</span> <span class="s">&#39;traefik.http.services.webappservice.loadbalancer.server.port=80&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now boot our stack using docker-compose:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>docker-compose up -d
</span></code></pre></td></tr></table></div></figure>


<p>You can follow the logs to ensure everything works as expected:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>docker-compose logs -f
</span><span class='line'>Attaching to webapp, traefik
</span><span class='line'>traefik    <span class="p">|</span> <span class="nb">time</span><span class="o">=</span><span class="s2">&quot;2021-07-11T11:02:22Z&quot;</span> <span class="nv">level</span><span class="o">=</span>info <span class="nv">msg</span><span class="o">=</span><span class="s2">&quot;Configuration loaded from flags.&quot;</span>
</span><span class='line'>traefik    <span class="p">|</span> <span class="nb">time</span><span class="o">=</span><span class="s2">&quot;2021-07-11T11:02:22Z&quot;</span> <span class="nv">level</span><span class="o">=</span>info <span class="nv">msg</span><span class="o">=</span><span class="s2">&quot;Starting provider aggregator.ProviderAggregator {}&quot;</span>
</span><span class='line'>traefik    <span class="p">|</span> <span class="nb">time</span><span class="o">=</span><span class="s2">&quot;2021-07-11T11:02:22Z&quot;</span> <span class="nv">level</span><span class="o">=</span>info <span class="nv">msg</span><span class="o">=</span><span class="s2">&quot;Starting provider *traefik.Provider {}&quot;</span>
</span><span class='line'>traefik    <span class="p">|</span> <span class="nb">time</span><span class="o">=</span><span class="s2">&quot;2021-07-11T11:02:22Z&quot;</span> <span class="nv">level</span><span class="o">=</span>info <span class="nv">msg</span><span class="o">=</span><span class="s2">&quot;Starting provider *docker.Provider {\&quot;watch\&quot;:true,\&quot;endpoint\&quot;:\&quot;unix:///var/run/docker.so                                              ck\&quot;,\&quot;defaultRule\&quot;:\&quot;Host(``)\&quot;,\&quot;swarmModeRefreshSeconds\&quot;:\&quot;15s\&quot;}&quot;</span>
</span><span class='line'>traefik    <span class="p">|</span> <span class="nb">time</span><span class="o">=</span><span class="s2">&quot;2021-07-11T11:02:22Z&quot;</span> <span class="nv">level</span><span class="o">=</span>info <span class="nv">msg</span><span class="o">=</span><span class="s2">&quot;Starting provider *acme.ChallengeTLSALPN {\&quot;Timeout\&quot;:4000000000}&quot;</span>
</span><span class='line'>traefik    <span class="p">|</span> <span class="nb">time</span><span class="o">=</span><span class="s2">&quot;2021-07-11T11:02:22Z&quot;</span> <span class="nv">level</span><span class="o">=</span>info <span class="nv">msg</span><span class="o">=</span><span class="s2">&quot;Starting provider *acme.Provider {\&quot;email\&quot;:\&quot;youremail@domain.com\&quot;,\&quot;caServer\&quot;:\&quot;https://                                              acme-v02.api.letsencrypt.org/directory\&quot;,\&quot;storage\&quot;:\&quot;acme.json\&quot;,\&quot;keyType\&quot;:\&quot;RSA4096\&quot;,\&quot;httpChallenge\&quot;:{\&quot;entryPoint\&quot;:\&quot;http\&quot;},\&quot;ResolverNam                                              e\&quot;:\&quot;letsencrypt\&quot;,\&quot;store\&quot;:{},\&quot;TLSChallengeProvider\&quot;:{\&quot;Timeout\&quot;:4000000000},\&quot;HTTPChallengeProvider\&quot;:{}}&quot;</span>
</span><span class='line'>traefik    <span class="p">|</span> <span class="nb">time</span><span class="o">=</span><span class="s2">&quot;2021-07-11T11:02:22Z&quot;</span> <span class="nv">level</span><span class="o">=</span>info <span class="nv">msg</span><span class="o">=</span><span class="s2">&quot;Testing certificate renew...&quot;</span> <span class="nv">providerName</span><span class="o">=</span>letsencrypt.acme
</span><span class='line'>traefik    <span class="p">|</span> <span class="nb">time</span><span class="o">=</span><span class="s2">&quot;2021-07-11T11:02:24Z&quot;</span> <span class="nv">level</span><span class="o">=</span>info <span class="nv">msg</span><span class="o">=</span>Register... <span class="nv">providerName</span><span class="o">=</span>letsencrypt.acme
</span><span class='line'>webapp     <span class="p">|</span> Starting up on port 80
</span></code></pre></td></tr></table></div></figure>


<p>The certificate process might take anything from 5-30s in my experience.</p>

<h2>Test the Application</h2>

<p>Now that our <code>webapp</code> container is running, make a http request using curl against the configured host rule, which is <code>app.selfhosted.co.za</code> on <code>http</code> so that we can validate if traefik is doing a redirect to <code>https</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>curl -IL http://app.selfhosted.co.za:80
</span><span class='line'>
</span><span class='line'>HTTP/1.1 <span class="m">308</span> Permanent Redirect
</span><span class='line'>Location: https://app.selfhosted.co.za/
</span><span class='line'>Date: Sun, <span class="m">11</span> Jul <span class="m">2021</span> 11:05:47 GMT
</span><span class='line'>Content-Length: 18
</span><span class='line'>Content-Type: text/plain<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>utf-8
</span><span class='line'>
</span><span class='line'>HTTP/2 200
</span><span class='line'>content-type: text/plain<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>utf-8
</span><span class='line'>date: Sun, <span class="m">11</span> Jul <span class="m">2021</span> 11:05:47 GMT
</span><span class='line'>content-length: 343
</span></code></pre></td></tr></table></div></figure>


<p>If we access our <code>webapp</code> service in our web browser, we will see the following:</p>

<p><img src="https://user-images.githubusercontent.com/567298/125192768-c1fceb00-e249-11eb-8b67-7347b4d16a8f.png" alt="image" /></p>

<p>We can also validate that the certificate is valid:</p>

<p><img src="https://user-images.githubusercontent.com/567298/125196546-a9490100-e25a-11eb-8e94-0d7af307d2fb.png" alt="image" /></p>

<p>We can also access the traefik dashboard using the configured domain, in this case <code>traefik.selfhosted.co.za</code>, and you should see the pretty traefik dashboard:</p>

<p><img src="https://user-images.githubusercontent.com/567298/125196448-4bb4b480-e25a-11eb-906b-a221d1415f38.png" alt="image" /></p>

<h2>Future Posts</h2>

<p>In future posts I will be using this post as the base setup on getting traefik up and running, and future posts that uses traefik will be tagged under <a href="https://containers.fan/tags/traefik/">#traefik</a>.</p>

<h2>Thank You</h2>

<p>Thanks for reading, if you like my content, check out my <strong><a href="https://ruan.dev">website</a></strong> or follow me at <strong><a href="https://twitter.com/ruanbekker">@ruanbekker</a></strong> on Twitter.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2021/10/11/install-nodejs-on-linux-using-nvm/">Install Nodejs on Linux Using NVM</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2021-10-11T19:07:43-04:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>11</span><span class='date-suffix'>th</span>, <span class='date-year'>2021</span></span> <span class='time'>7:07 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In this post we will install Nodejs using Node Version Manager (nvm), which allows you to install and use different versions of node via the command line.</p>

<p>For more information on NVM, checkout their <a href="https://github.com/nvm-sh/nvm">github repository</a></p>

<h2>Install</h2>

<p>I will be using a debian based linux distribution, so I first will be updating my package manager&rsquo;s indexes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>apt update
</span></code></pre></td></tr></table></div></figure>


<p>Then I will install NVM using the instructions from <a href="https://github.com/nvm-sh/nvm#installing-and-updating">their</a> repository (always ensure that you are aware what you are installing when you curl, pipe, bash):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh <span class="p">|</span> bash
</span></code></pre></td></tr></table></div></figure>


<h2>Verify</h2>

<p>You can now log out and log back in for your path to be updated, or you can follow the instructions on your terminal to source your session so that your path to nvm is updated:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span><span class="nb">export </span><span class="nv">NVM_DIR</span><span class="o">=</span><span class="s2">&quot;$HOME/.nvm&quot;</span>
</span><span class='line'><span class="nv">$ </span><span class="o">[</span> -s <span class="s2">&quot;$NVM_DIR/bash_completion&quot;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="se">\.</span> <span class="s2">&quot;$NVM_DIR/bash_completion&quot;</span>
</span><span class='line'><span class="nv">$ </span><span class="o">[</span> -s <span class="s2">&quot;$NVM_DIR/nvm.sh&quot;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="se">\.</span> <span class="s2">&quot;$NVM_DIR/nvm.sh&quot;</span>
</span><span class='line'><span class="nv">$ </span><span class="o">[</span> -s <span class="s2">&quot;$NVM_DIR/bash_completion&quot;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="se">\.</span> <span class="s2">&quot;$NVM_DIR/bash_completion&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then you can verify if <code>nvm</code> is in your path:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span><span class="nb">command</span> -v nvm
</span><span class='line'>nvm
</span></code></pre></td></tr></table></div></figure>


<h2>Installing a Node Version</h2>

<p>Before we install a specific version of nodejs, let&rsquo;s first look at the LTS versions from the Fermium release:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>nvm ls-remote --lts<span class="o">=</span>fermium
</span><span class='line'>       v14.15.0   <span class="o">(</span>LTS: Fermium<span class="o">)</span>
</span><span class='line'>       v14.15.1   <span class="o">(</span>LTS: Fermium<span class="o">)</span>
</span><span class='line'>       v14.15.2   <span class="o">(</span>LTS: Fermium<span class="o">)</span>
</span><span class='line'>       v14.15.3   <span class="o">(</span>LTS: Fermium<span class="o">)</span>
</span><span class='line'>       v14.15.4   <span class="o">(</span>LTS: Fermium<span class="o">)</span>
</span><span class='line'>       v14.15.5   <span class="o">(</span>LTS: Fermium<span class="o">)</span>
</span><span class='line'>       v14.16.0   <span class="o">(</span>LTS: Fermium<span class="o">)</span>
</span><span class='line'>       v14.16.1   <span class="o">(</span>LTS: Fermium<span class="o">)</span>
</span><span class='line'>       v14.17.0   <span class="o">(</span>LTS: Fermium<span class="o">)</span>
</span><span class='line'>       v14.17.1   <span class="o">(</span>LTS: Fermium<span class="o">)</span>
</span><span class='line'>       v14.17.2   <span class="o">(</span>LTS: Fermium<span class="o">)</span>
</span><span class='line'>       v14.17.3   <span class="o">(</span>LTS: Fermium<span class="o">)</span>
</span><span class='line'>       v14.17.4   <span class="o">(</span>LTS: Fermium<span class="o">)</span>
</span><span class='line'>       v14.17.5   <span class="o">(</span>LTS: Fermium<span class="o">)</span>
</span><span class='line'>       v14.17.6   <span class="o">(</span>LTS: Fermium<span class="o">)</span>
</span><span class='line'>       v14.18.0   <span class="o">(</span>Latest LTS: Fermium<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>So I want to install <code>v14.8.0</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>nvm install 14.8.0
</span></code></pre></td></tr></table></div></figure>


<p>I also would like to make it my default version of node:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>nvm <span class="nb">alias </span>default node
</span><span class='line'>default -&gt; node <span class="o">(</span>-&gt; v14.8.0<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Verify Installation</h2>

<p>Now we can verify if <code>npm</code> is installed:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>npm -v
</span><span class='line'>6.14.7
</span></code></pre></td></tr></table></div></figure>


<p>as well as <code>node</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>node -v
</span><span class='line'>v14.8.0
</span></code></pre></td></tr></table></div></figure>


<h2>Thank You</h2>

<p>Thanks for reading, if you like my content, check out my <strong><a href="https://ruan.dev">website</a></strong> or follow me at <strong><a href="https://twitter.com/ruanbekker">@ruanbekker</a></strong> on Twitter.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2021/10/10/setup-basic-authentication-on-node-exporter-and-prometheus/">Setup TLS and Basic Authentication on Node Exporter for Prometheus</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2021-10-10T16:50:17-04:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>10</span><span class='date-suffix'>th</span>, <span class='date-year'>2021</span></span> <span class='time'>4:50 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I had a public VPS server that I wanted to scrape node-exporter metrics from, but my Prometheus instance was behind a Dynamic IP address, so to allow only my prometheus instance to scrape my Node Exporter instance, was a bit difficult, since the IP keep changing and I had to update my iptables firewall rules.</p>

<p>In this tutorial I will show you how to setup TLS and Basic Authentication on Node Exporter, and how to configure prometheus to pass the auhtentication to successfully scrape the node exporter metrics endpoint.</p>

<h2>Install Node Exporter</h2>

<p>On the node-exporter host, set the environment variables for the version, user and directory path where node exporter will be installed::</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ NODE_EXPORTER_VERSION</span><span class="o">=</span><span class="s2">&quot;1.1.2&quot;</span>
</span><span class='line'><span class="nv">$ NODE_EXPORTER_USER</span><span class="o">=</span><span class="s2">&quot;node_exporter&quot;</span>
</span><span class='line'><span class="nv">$ BIN_DIRECTORY</span><span class="o">=</span><span class="s2">&quot;/usr/local/bin&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Download and place the node-exporter binary in place:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>wget https://github.com/prometheus/node_exporter/releases/download/v<span class="k">${</span><span class="nv">NODE_EXPORTER_VERSION</span><span class="k">}</span>/node_exporter-<span class="k">${</span><span class="nv">NODE_EXPORTER_VERSION</span><span class="k">}</span>.linux-amd64.tar.gz
</span><span class='line'><span class="nv">$ </span>tar -xf node_exporter-<span class="k">${</span><span class="nv">NODE_EXPORTER_VERSION</span><span class="k">}</span>.linux-amd64.tar.gz
</span><span class='line'><span class="nv">$ </span>cp node_exporter-<span class="k">${</span><span class="nv">NODE_EXPORTER_VERSION</span><span class="k">}</span>.linux-amd64/node_exporter <span class="k">${</span><span class="nv">BIN_DIRECTORY</span><span class="k">}</span>/
</span><span class='line'><span class="nv">$ </span>chown <span class="k">${</span><span class="nv">NODE_EXPORTER_USER</span><span class="k">}</span>:<span class="k">${</span><span class="nv">NODE_EXPORTER_USER</span><span class="k">}</span> <span class="k">${</span><span class="nv">BIN_DIRECTORY</span><span class="k">}</span>/node_exporter
</span><span class='line'><span class="nv">$ </span>rm -rf node_exporter-<span class="k">${</span><span class="nv">NODE_EXPORTER_VERSION</span><span class="k">}</span>.linux-amd64*
</span><span class='line'><span class="nv">$ </span>mkdir /etc/node-exporter
</span></code></pre></td></tr></table></div></figure>


<h2>Configuration</h2>

<p>Create a self-signed cert for node-exporter:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>openssl req -new -newkey rsa:2048 -days <span class="m">365</span> -nodes -x509 -keyout node_exporter.key -out node_exporter.crt -subj <span class="s2">&quot;/C=ZA/ST=CT/L=SA/O=VPN/CN=localhost&quot;</span> -addext <span class="s2">&quot;subjectAltName = DNS:localhost&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Move the certs into the directory we created:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>mv node_exporter.* /etc/node-exporter/
</span></code></pre></td></tr></table></div></figure>


<p>Install htpasswd so that we can generate a password hash with bcrypt, which will prompt you for a password that we are setting for the prometheus user::</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>apt install apache2-utils
</span><span class='line'><span class="nv">$ </span>htpasswd -nBC <span class="m">10</span> <span class="s2">&quot;&quot;</span> <span class="p">|</span> tr -d <span class="s1">&#39;:\n&#39;</span><span class="p">;</span> <span class="nb">echo</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now populate the config for node-exporter:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>cat /etc/node-exporter/config.yml
</span><span class='line'>tls_server_config:
</span><span class='line'>  cert_file: node_exporter.crt
</span><span class='line'>  key_file: node_exporter.key
</span><span class='line'>basic_auth_users:
</span><span class='line'>  prometheus: &lt;the-output-value-of-htpasswd&gt;
</span></code></pre></td></tr></table></div></figure>


<p>Change the ownership of the node exporter directory:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>chown -R <span class="k">${</span><span class="nv">NODE_EXPORTER_USER</span><span class="k">}</span>:<span class="k">${</span><span class="nv">NODE_EXPORTER_USER</span><span class="k">}</span> /etc/node-exporter
</span></code></pre></td></tr></table></div></figure>


<p>Then create the systemd unit file:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>cat &gt; /etc/systemd/system/node_exporter.service <span class="s">&lt;&lt; EOF</span>
</span><span class='line'><span class="s">[Unit]</span>
</span><span class='line'><span class="s">Description=Node Exporter</span>
</span><span class='line'><span class="s">Wants=network-online.target</span>
</span><span class='line'><span class="s">After=network-online.target</span>
</span><span class='line'><span class="s">StartLimitIntervalSec=500</span>
</span><span class='line'><span class="s">StartLimitBurst=5</span>
</span><span class='line'><span class="s">[Service]</span>
</span><span class='line'><span class="s">User=${NODE_EXPORTER_USER}</span>
</span><span class='line'><span class="s">Group=${NODE_EXPORTER_USER}</span>
</span><span class='line'><span class="s">Type=simple</span>
</span><span class='line'><span class="s">Restart=on-failure</span>
</span><span class='line'><span class="s">RestartSec=5s</span>
</span><span class='line'><span class="s">ExecStart=${BIN_DIRECTORY}/node_exporter --web.config=/etc/node-exporter/config.yml</span>
</span><span class='line'><span class="s">[Install]</span>
</span><span class='line'><span class="s">WantedBy=multi-user.target</span>
</span><span class='line'><span class="s">EOF</span>
</span></code></pre></td></tr></table></div></figure>


<p>Reload systemd and start node-exporter</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>systemctl daemon-reload
</span><span class='line'><span class="nv">$ </span>systemctl <span class="nb">enable </span>node_exporter
</span><span class='line'><span class="nv">$ </span>systemctl restart node_exporter
</span></code></pre></td></tr></table></div></figure>


<h2>Prometheus Config</h2>

<p>Copy the <code>/etc/node-exporter/node_exporter.crt</code> from the node-exporter node to prometheus-node, then in the <code>/etc/prometheus/prometheus.yml</code> config:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">scrape_configs</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">job_name</span><span class="p-Indicator">:</span> <span class="s">&#39;node-exporter-tls&#39;</span>
</span><span class='line'>    <span class="l-Scalar-Plain">scheme</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">https</span>
</span><span class='line'>    <span class="l-Scalar-Plain">basic_auth</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="l-Scalar-Plain">username</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">prometheus</span>
</span><span class='line'>      <span class="l-Scalar-Plain">password</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;the-plain-text-password&gt;</span>
</span><span class='line'>    <span class="l-Scalar-Plain">tls_config</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="l-Scalar-Plain">ca_file</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">node_exporter.crt</span>
</span><span class='line'>      <span class="l-Scalar-Plain">insecure_skip_verify</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
</span><span class='line'>    <span class="l-Scalar-Plain">static_configs</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">targets</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="s">&#39;node-exporter-ip:9100&#39;</span><span class="p-Indicator">]</span>
</span><span class='line'>      <span class="l-Scalar-Plain">labels</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">instance</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">friendly-instance-name</span>
</span></code></pre></td></tr></table></div></figure>


<p>After you restart prometheus, you should see the metrics in prometheus' tsdb of the node exporter target that we are scraping.</p>

<h2>Thank You</h2>

<p>Thanks for reading, if you like my content, check out my <strong><a href="https://ruan.dev">website</a></strong> or follow me at <strong><a href="https://twitter.com/ruanbekker">@ruanbekker</a></strong> on Twitter.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2021/10/07/install-concourse-ci-v7-dot-4-on-ubuntu-linux/">Install Concourse CI v7.4 on Ubuntu Linux</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2021-10-07T19:27:05-04:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>7</span><span class='date-suffix'>th</span>, <span class='date-year'>2021</span></span> <span class='time'>7:27 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="https://i.snag.gy/gzkdu9.jpg?nocache=1511644783495" alt="" /></p>

<p>Concourse is a Pipeline Based Continious Integration system written in Go</p>

<h2>Resources:</h2>

<ul>
<li><a href="https://concourse-ci.org/">https://concourse-ci.org/</a></li>
<li><a href="https://github.com/concourse/concourse">https://github.com/concourse/concourse</a></li>
<li><a href="https://github.com/starkandwayne/concourse-tutorial">https://github.com/starkandwayne/concourse-tutorial</a></li>
</ul>


<h2>Older Version</h2>

<p>An older version is available:</p>

<ul>
<li><a href="https://blog.ruanbekker.com/blog/2021/04/06/install-concourse-ci-v6-on-ubuntu-20-dot-04/">Install Concourse CI V6 on Ubuntu 20.04</a></li>
<li><a href="https://blog.ruanbekker.com/blog/2017/11/07/setup-a-concourse-ci-server-on-ubuntu-16/">Setup Concourse CI v4 on Ubuntu 16.04</a></li>
</ul>


<h2>What is Concourse CI:</h2>

<p>Concourse CI is a Continious Integration Platform. Concourse enables you to construct pipelines with a yaml configuration that can consist out of 3 core concepts, tasks, resources, and jobs that compose them. For more information about this have a look at their <a href="https://concourse.ci/concepts.html">docs</a></p>

<h2>What will we be doing today</h2>

<p>We will setup a Concourse CI Server v6.7.6 (web and worker) on Ubuntu 20.04 and run the traditional <code>Hello, World</code> pipeline</p>

<h2>Setup the Server:</h2>

<p>Concourse needs <code>PostgresSQL</code> server:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>apt update <span class="o">&amp;&amp;</span> apt upgrade -y
</span><span class='line'><span class="nv">$ </span>apt install postgresql postgresql-contrib -y
</span><span class='line'><span class="nv">$ </span>systemctl <span class="nb">enable </span>postgresql
</span></code></pre></td></tr></table></div></figure>


<p>Create the Database and User for Concourse on Postgres:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>sudo -u postgres createuser concourse
</span><span class='line'><span class="nv">$ </span>sudo -u postgres createdb --owner<span class="o">=</span>concourse atc
</span></code></pre></td></tr></table></div></figure>


<p>Download the Concourse Binary:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span><span class="nb">export </span><span class="nv">CONCOURSE_VERSION</span><span class="o">=</span>7.4.0
</span><span class='line'><span class="nv">$ </span>wget https://github.com/concourse/concourse/releases/download/v<span class="k">${</span><span class="nv">CONCOURSE_VERSION</span><span class="k">}</span>/concourse-<span class="k">${</span><span class="nv">CONCOURSE_VERSION</span><span class="k">}</span>-linux-amd64.tgz
</span><span class='line'><span class="nv">$ </span>tar -xvf concourse-<span class="k">${</span><span class="nv">CONCOURSE_VERSION</span><span class="k">}</span>-linux-amd64.tgz -C /usr/local/
</span><span class='line'><span class="nv">$ </span>rm -rf concourse-*-linux-amd64.tgz
</span></code></pre></td></tr></table></div></figure>


<p>Create the Encryption Keys:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>mkdir /etc/concourse
</span><span class='line'><span class="nv">$ </span>ssh-keygen -t rsa -q -N <span class="s1">&#39;&#39;</span> -f /etc/concourse/tsa_host_key -m pem
</span><span class='line'><span class="nv">$ </span>ssh-keygen -t rsa -q -N <span class="s1">&#39;&#39;</span> -f /etc/concourse/worker_key -m pem
</span><span class='line'><span class="nv">$ </span>ssh-keygen -t rsa -q -N <span class="s1">&#39;&#39;</span> -f /etc/concourse/session_signing_key -m pem
</span><span class='line'><span class="nv">$ </span>cp /etc/concourse/worker_key.pub /etc/concourse/authorized_worker_keys -m pem
</span></code></pre></td></tr></table></div></figure>


<p>Set the IP Address:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span><span class="nb">export </span><span class="nv">IP_ADDRESS</span><span class="o">=</span><span class="k">$(</span>ifconfig <span class="k">$(</span>route -n <span class="p">|</span> grep <span class="s1">&#39;0.0.0.0&#39;</span> <span class="p">|</span> head -1 <span class="p">|</span> rev <span class="p">|</span> awk <span class="s1">&#39;{print $1}&#39;</span> <span class="p">|</span> rev<span class="k">)</span> <span class="p">|</span> grep -w <span class="s1">&#39;inet&#39;</span> <span class="p">|</span> awk <span class="s1">&#39;{print $2}&#39;</span><span class="k">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Concourse Web Process Configuration:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>cat &gt; /etc/concourse/web_environment <span class="s">&lt;&lt; EOF</span>
</span><span class='line'><span class="s">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/concourse/bin</span>
</span><span class='line'><span class="s">CONCOURSE_ADD_LOCAL_USER=ruan:$(openssl rand -hex 14)</span>
</span><span class='line'><span class="s">CONCOURSE_SESSION_SIGNING_KEY=/etc/concourse/session_signing_key</span>
</span><span class='line'><span class="s">CONCOURSE_TSA_HOST_KEY=/etc/concourse/tsa_host_key</span>
</span><span class='line'><span class="s">CONCOURSE_TSA_AUTHORIZED_KEYS=/etc/concourse/authorized_worker_keys</span>
</span><span class='line'><span class="s">CONCOURSE_POSTGRES_HOST=127.0.0.1</span>
</span><span class='line'><span class="s">CONCOURSE_POSTGRES_USER=concourse</span>
</span><span class='line'><span class="s">CONCOURSE_POSTGRES_PASSWORD=concourse</span>
</span><span class='line'><span class="s">CONCOURSE_POSTGRES_DATABASE=atc</span>
</span><span class='line'><span class="s">CONCOURSE_MAIN_TEAM_LOCAL_USER=ruan</span>
</span><span class='line'><span class="s">CONCOURSE_EXTERNAL_URL=http://$IP_ADDRESS:8080</span>
</span><span class='line'><span class="s">EOF</span>
</span></code></pre></td></tr></table></div></figure>


<p>Concourse Worker Process Configuration:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>cat &gt; /etc/concourse/worker_environment <span class="s">&lt;&lt; EOF</span>
</span><span class='line'><span class="s">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/concourse/bin</span>
</span><span class='line'><span class="s">CONCOURSE_WORK_DIR=/var/lib/concourse</span>
</span><span class='line'><span class="s">CONCOURSE_TSA_HOST=127.0.0.1:2222</span>
</span><span class='line'><span class="s">CONCOURSE_TSA_PUBLIC_KEY=/etc/concourse/tsa_host_key.pub</span>
</span><span class='line'><span class="s">CONCOURSE_TSA_WORKER_PRIVATE_KEY=/etc/concourse/worker_key</span>
</span><span class='line'><span class="s">CONCOURSE_GARDEN_DNS_SERVER=8.8.8.8</span>
</span><span class='line'><span class="s">EOF</span>
</span></code></pre></td></tr></table></div></figure>


<p>Create a Concourse user:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>mkdir /var/lib/concourse
</span><span class='line'><span class="nv">$ </span>sudo adduser --system --group concourse
</span><span class='line'><span class="nv">$ </span>sudo chown -R concourse:concourse /etc/concourse /var/lib/concourse
</span><span class='line'><span class="nv">$ </span>sudo chmod <span class="m">600</span> /etc/concourse/*_environment
</span></code></pre></td></tr></table></div></figure>


<p>Create SystemD Unit Files, first for the Web Service:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>cat &gt; /etc/systemd/system/concourse-web.service <span class="s">&lt;&lt; EOF</span>
</span><span class='line'><span class="s">[Unit]</span>
</span><span class='line'><span class="s">Description=Concourse CI web process (ATC and TSA)</span>
</span><span class='line'><span class="s">After=postgresql.service</span>
</span><span class='line'>
</span><span class='line'><span class="s">[Service]</span>
</span><span class='line'><span class="s">User=concourse</span>
</span><span class='line'><span class="s">Restart=on-failure</span>
</span><span class='line'><span class="s">EnvironmentFile=/etc/concourse/web_environment</span>
</span><span class='line'><span class="s">ExecStart=/usr/local/concourse/bin/concourse web</span>
</span><span class='line'>
</span><span class='line'><span class="s">[Install]</span>
</span><span class='line'><span class="s">WantedBy=multi-user.target</span>
</span><span class='line'><span class="s">EOF</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then the SystemD Unit File for the Worker Service:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>cat &gt; /etc/systemd/system/concourse-worker.service <span class="s">&lt;&lt; EOF</span>
</span><span class='line'><span class="s">[Unit]</span>
</span><span class='line'><span class="s">Description=Concourse CI worker process</span>
</span><span class='line'><span class="s">After=concourse-web.service</span>
</span><span class='line'>
</span><span class='line'><span class="s">[Service]</span>
</span><span class='line'><span class="s">User=root</span>
</span><span class='line'><span class="s">Restart=on-failure</span>
</span><span class='line'><span class="s">EnvironmentFile=/etc/concourse/worker_environment</span>
</span><span class='line'><span class="s">ExecStart=/usr/local/concourse/bin/concourse worker</span>
</span><span class='line'>
</span><span class='line'><span class="s">[Install]</span>
</span><span class='line'><span class="s">WantedBy=multi-user.target</span>
</span><span class='line'><span class="s">EOF</span>
</span></code></pre></td></tr></table></div></figure>


<p>Create a postgres password for the concourse user:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span><span class="nb">cd</span> /home/concourse/
</span><span class='line'><span class="nv">$ </span>sudo -u concourse psql atc
</span><span class='line'><span class="nv">atc</span><span class="o">=</span>&gt; ALTER USER concourse WITH PASSWORD <span class="s1">&#39;concourse&#39;</span><span class="p">;</span>
</span><span class='line'><span class="nv">atc</span><span class="o">=</span>&gt; <span class="se">\q</span>
</span></code></pre></td></tr></table></div></figure>


<p>Start and Enable the Services:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>systemctl start concourse-web concourse-worker
</span><span class='line'><span class="nv">$ </span>systemctl <span class="nb">enable </span>concourse-web concourse-worker postgresql
</span><span class='line'><span class="nv">$ </span>systemctl status concourse-web concourse-worker
</span><span class='line'>
</span><span class='line'><span class="nv">$ </span>systemctl is-active concourse-worker concourse-web
</span><span class='line'>active
</span><span class='line'>active
</span></code></pre></td></tr></table></div></figure>


<p>The listening ports should more or less look like the following:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>netstat -tulpn
</span><span class='line'>
</span><span class='line'>Active Internet connections <span class="o">(</span>only servers<span class="o">)</span>
</span><span class='line'>Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
</span><span class='line'>tcp        <span class="m">0</span>      <span class="m">0</span> 127.0.0.1:7777          0.0.0.0:*               LISTEN      4530/concourse
</span><span class='line'>tcp        <span class="m">0</span>      <span class="m">0</span> 127.0.0.1:7788          0.0.0.0:*               LISTEN      4530/concourse
</span><span class='line'>tcp        <span class="m">0</span>      <span class="m">0</span> 127.0.0.1:8079          0.0.0.0:*               LISTEN      4525/concourse
</span><span class='line'>tcp        <span class="m">0</span>      <span class="m">0</span> 0.0.0.0:22              0.0.0.0:*               LISTEN      1283/sshd
</span><span class='line'>tcp        <span class="m">0</span>      <span class="m">0</span> 127.0.0.1:5432          0.0.0.0:*               LISTEN      4047/postgres
</span><span class='line'>tcp6       <span class="m">0</span>      <span class="m">0</span> :::36159                :::*                    LISTEN      4525/concourse
</span><span class='line'>tcp6       <span class="m">0</span>      <span class="m">0</span> :::46829                :::*                    LISTEN      4525/concourse
</span><span class='line'>tcp6       <span class="m">0</span>      <span class="m">0</span> :::2222                 :::*                    LISTEN      4525/concourse
</span><span class='line'>tcp6       <span class="m">0</span>      <span class="m">0</span> :::8080                 :::*                    LISTEN      4525/concourse
</span><span class='line'>tcp6       <span class="m">0</span>      <span class="m">0</span> :::22                   :::*                    LISTEN      1283/sshd
</span><span class='line'>udp        <span class="m">0</span>      <span class="m">0</span> 0.0.0.0:68              0.0.0.0:*                           918/dhclient
</span><span class='line'>udp        <span class="m">0</span>      <span class="m">0</span> 0.0.0.0:42165           0.0.0.0:*                           4530/concourse
</span></code></pre></td></tr></table></div></figure>


<p>You can check the logs like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>sudo journalctl -fu concourse-web
</span><span class='line'><span class="nv">$ </span>sudo journalctl -fu concourse-worker
</span></code></pre></td></tr></table></div></figure>


<p>Make a request using the API:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>curl http://<span class="k">${</span><span class="nv">IP_ADDRESS</span><span class="k">}</span>:8080/api/v1/info
</span><span class='line'><span class="o">{</span><span class="s2">&quot;version&quot;</span>:<span class="s2">&quot;7.4.0&quot;</span>,<span class="s2">&quot;worker_version&quot;</span>:<span class="s2">&quot;2.3&quot;</span>,<span class="s2">&quot;feature_flags&quot;</span>:<span class="o">{</span><span class="s2">&quot;across_step&quot;</span>:false,<span class="s2">&quot;build_rerun&quot;</span>:false,<span class="s2">&quot;cache_streamed_volumes&quot;</span>:false,<span class="s2">&quot;global_resources&quot;</span>:false,<span class="s2">&quot;pipeline_instances&quot;</span>:false,<span class="s2">&quot;redact_secrets&quot;</span>:false,<span class="s2">&quot;resource_causality&quot;</span>:false<span class="o">}</span>,<span class="s2">&quot;external_url&quot;</span>:<span class="s2">&quot;http://x.x.x.x:8080&quot;</span><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Client Side:</h2>

<p>I will be using a the Fly cli from a Mac, so first we need to download the fly-cli for Mac:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span><span class="nb">export </span><span class="nv">CONCOURSE_VERSION</span><span class="o">=</span>7.4.0
</span><span class='line'><span class="nv">$ </span>wget https://github.com/concourse/concourse/releases/download/v<span class="k">${</span><span class="nv">CONCOURSE_VERSION</span><span class="k">}</span>/fly-<span class="k">${</span><span class="nv">CONCOURSE_VERSION</span><span class="k">}</span>-darwin-amd64.tgz
</span><span class='line'><span class="nv">$ </span>tar -xvf fly-<span class="k">${</span><span class="nv">CONCOURSE_VERSION</span><span class="k">}</span>-darwin-amd64.tgz
</span><span class='line'><span class="nv">$ </span>sudo mv fly /usr/local/bin/fly
</span><span class='line'><span class="nv">$ </span>rm -rf fly-<span class="k">${</span><span class="nv">CONCOURSE_VERSION</span><span class="k">}</span>-darwin-amd64.tgz
</span></code></pre></td></tr></table></div></figure>


<p>Next, we need to setup our Concourse Target by Authenticating against our Concourse Endpoint, lets setup our target with the name <code>ci</code>, and make sure to replace the ip address with the ip of your concourse server:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>fly -t ci login -c http://<span class="k">${</span><span class="nv">IP_ADDRESS</span><span class="k">}</span>:8080
</span><span class='line'>logging in to team <span class="s1">&#39;main&#39;</span>
</span><span class='line'>
</span><span class='line'>navigate to the following URL in your browser:
</span><span class='line'>
</span><span class='line'>  http://<span class="k">${</span><span class="nv">IP_ADDRESS</span><span class="k">}</span>:8080/login?fly_port<span class="o">=</span>42181
</span><span class='line'>
</span><span class='line'>or enter token manually <span class="o">(</span>input hidden<span class="o">)</span>:
</span><span class='line'>target saved
</span></code></pre></td></tr></table></div></figure>


<p>Lets list our targets:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>fly targets
</span><span class='line'>name  url                        team  expiry
</span><span class='line'>ci    http://x.x.x.x:8080        main  Wed, <span class="m">08</span> Nov <span class="m">2021</span> 15:32:59 UTC
</span></code></pre></td></tr></table></div></figure>


<p>Listing Registered Workers:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>fly -t ci workers
</span><span class='line'>name              containers  platform  tags  team  state    version
</span><span class='line'>x.x.x.x           <span class="m">0</span>           linux     none  none  running  1.2
</span></code></pre></td></tr></table></div></figure>


<p>Listing Active Containers:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>fly -t ci containers
</span><span class='line'>handle                                worker            pipeline     job            build <span class="c">#  build id  type   name                  attempt</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Hello World Pipeline:</h2>

<p>Let&rsquo;s create a basic pipeline, that will print out <code>Hello, World!</code>:</p>

<p>Our <code>hello-world.yml</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">jobs</span><span class="p-Indicator">:</span>
</span><span class='line'><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">my-job</span>
</span><span class='line'>  <span class="l-Scalar-Plain">plan</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">task</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">say-hello</span>
</span><span class='line'>    <span class="l-Scalar-Plain">config</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="l-Scalar-Plain">platform</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">linux</span>
</span><span class='line'>      <span class="l-Scalar-Plain">image_resource</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">docker-image</span>
</span><span class='line'>        <span class="l-Scalar-Plain">source</span><span class="p-Indicator">:</span>
</span><span class='line'>          <span class="l-Scalar-Plain">repository</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">alpine</span>
</span><span class='line'>          <span class="l-Scalar-Plain">tag</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">edge</span>
</span><span class='line'>      <span class="l-Scalar-Plain">run</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">path</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/bin/sh</span>
</span><span class='line'>        <span class="l-Scalar-Plain">args</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">-c</span>
</span><span class='line'>        <span class="p-Indicator">-</span> <span class="p-Indicator">|</span>
</span><span class='line'>          <span class="no">echo &quot;=============&quot;</span>
</span><span class='line'>          <span class="no">echo &quot;Hello, World!&quot;</span>
</span><span class='line'>          <span class="no">echo &quot;=============&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Applying the configuration to our pipeline:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>fly -t ci <span class="nb">set</span>-pipeline -p yeeehaa -c hello-world.yml
</span><span class='line'><span class="nb">jobs</span>:
</span><span class='line'>  job my-job has been added:
</span><span class='line'>    name: my-job
</span><span class='line'>    plan:
</span><span class='line'>    - task: say-hello
</span><span class='line'>      config:
</span><span class='line'>        platform: linux
</span><span class='line'>        image_resource:
</span><span class='line'>          <span class="nb">type</span>: docker-image
</span><span class='line'>          <span class="nb">source</span>:
</span><span class='line'>            repository: alpine
</span><span class='line'>            tag: edge
</span><span class='line'>        run:
</span><span class='line'>          path: /bin/sh
</span><span class='line'>          args:
</span><span class='line'>          - -c
</span><span class='line'>          - <span class="p">|</span>
</span><span class='line'>            <span class="nb">echo</span> <span class="s2">&quot;=============&quot;</span>
</span><span class='line'>            <span class="nb">echo</span> <span class="s2">&quot;Hello, World!&quot;</span>
</span><span class='line'>            <span class="nb">echo</span> <span class="s2">&quot;=============&quot;</span>
</span><span class='line'>
</span><span class='line'>apply configuration? <span class="o">[</span>yN<span class="o">]</span>: y
</span><span class='line'>pipeline created!
</span><span class='line'>you can view your pipeline here: http://x.x.x.x:8080/teams/main/pipelines/yeeehaa
</span><span class='line'>
</span><span class='line'>the pipeline is currently paused. to unpause, either:
</span><span class='line'>  - run the unpause-pipeline <span class="nb">command</span>
</span><span class='line'>  - click play next to the pipeline in the web ui
</span></code></pre></td></tr></table></div></figure>


<p>We can browse to the WebUI to unpause the pipeline, but since I like to do everything on cli as far as possible, I will unpause the pipeline via cli:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>fly -t ci unpause-pipeline -p yeeehaa
</span><span class='line'>unpaused <span class="s1">&#39;yeeehaa&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now our Pipeline is unpaused, but since we did not specify any triggers, we need to manually trigger the pipeline to run, you can either via the WebUI, select your pipeline which in this case will be named <code>yeeehaa</code> and then select the job, which will be <code>my-job</code> then hit the <code>+</code> sign, which will trigger the pipeline.</p>

<p>I will be using the cli:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>fly -t ci trigger-job --job yeeehaa/my-job
</span><span class='line'>started yeeehaa/my-job <span class="c">#1</span>
</span></code></pre></td></tr></table></div></figure>


<p>Via the WebUI on <code>http://x.x.x.x:8080/teams/main/pipelines/yeeehaa/jobs/my-job/builds/1</code> you should see the <code>Hello, World!</code> output, or via the cli, we also have the option to see the output, so let&rsquo;s trigger it again, but this time passing the <code>--watch</code> flag:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>fly -t ci trigger-job --job yeeehaa/my-job --watch
</span><span class='line'>started yeeehaa/my-job <span class="c">#2</span>
</span><span class='line'>
</span><span class='line'>initializing
</span><span class='line'>running /bin/sh -c <span class="nb">echo</span> <span class="s2">&quot;=============&quot;</span>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;Hello, World!&quot;</span>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;=============&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="o">=============</span>
</span><span class='line'>Hello, World!
</span><span class='line'><span class="o">=============</span>
</span><span class='line'>succeeded
</span></code></pre></td></tr></table></div></figure>


<p>Listing our Workers and Containers again:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>fly -t ci workers
</span><span class='line'>name              containers  platform  tags  team  state    version
</span><span class='line'>x.x.x.x            <span class="m">2</span>           linux     none  none  running  1.2
</span><span class='line'>
</span><span class='line'><span class="nv">$ </span>fly -t ci containers
</span><span class='line'>handle                                worker            pipeline     job         build <span class="c">#  build id  type   name           attempt</span>
</span><span class='line'>46282555-64cd-5h1b-67b8-316486h58eb8  x.x.x.x           yeeehaa      my-job      <span class="m">2</span>        <span class="m">729</span>       task   say-hello      n/a
</span></code></pre></td></tr></table></div></figure>


<h2>Thank You</h2>

<p>Thanks for reading, if you like my content, check out my <strong><a href="https://ruan.dev">website</a></strong> or follow me at <strong><a href="https://twitter.com/ruanbekker">@ruanbekker</a></strong> on Twitter.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2021/08/14/a-tour-with-vagrant-and-virtualbox-on-mac/">A Tour With Vagrant and Virtualbox on Mac</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2021-08-14T13:41:32-04:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>14</span><span class='date-suffix'>th</span>, <span class='date-year'>2021</span></span> <span class='time'>1:41 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="https://user-images.githubusercontent.com/567298/58658188-37cec280-8320-11e9-90ca-1226b3ccb292.png" alt="vagrant" /></p>

<p><a href="https://www.vagrantup.com/">Vagrant</a>, yet another amazing product from <a href="https://www.hashicorp.com/">Hashicorp</a>.</p>

<p>Vagrant makes it really easy to provision virtual servers for local development (not limited to), which they refer as &ldquo;boxes&rdquo;, that enables developers to run their jobs/tasks/applications in a really easy and fast way. Vagrant utilizes a declarative configuration model, so you can describe which OS you want, bootstrap them with installation instructions as soon as it boots, etc.</p>

<h2>What are we doing today?</h2>

<p>When completing this tutorial, you will have Vagrant and Virtualbox installed on your Mac and should be able to launch a Ubuntu Virtual Server locally with Vagrant and using the Virtualbox provider which will be responsible for running our VM&rsquo;s.</p>

<p>We will also look at different configuration options to configure the VM, bootstrapping software, using the shell, docker and ansible provisioner.</p>

<p>For this demonstration, I am using a Mac OSX, but you can run this on Mac, Windows or Linux. First we will use Homebrew to install Virtualbox, then Vagrant, then we will provision a Ubuntu box and I will also show how to inject shell commands into your Vagrantfile so that you can provision software to your VM, and also forward traffic to a web server from the host to the guest.</p>

<p>If you are looking for a Linux version instead of mac, you can look at this post:
* <a href="https://blog.ruanbekker.com/blog/2019/05/30/use-vagrant-to-setup-a-local-development-environment-on-linux/">Use Vagrant to Setup a Local Development Environment on Linux</a></p>

<h2>Pre-Requisites</h2>

<p>I will be installing Vagrant and Virtualbox with Homebrew, if you do not have homebrew installed, you can install homebrew with:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>ruby -e <span class="s2">&quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Once homebrew is installed, it&rsquo;s a good thing to update the indexes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>brew update
</span></code></pre></td></tr></table></div></figure>


<h2>Virtualbox</h2>

<p>Install <a href="https://www.virtualbox.org/">VirtualBox</a> using homebrew:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>brew install --cask virtualbox
</span></code></pre></td></tr></table></div></figure>


<h2>Vagrant</h2>

<p>Install <a href="https://www.vagrantup.com/">Vagrant</a> using homebrew:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>brew install --cask vagrant
</span></code></pre></td></tr></table></div></figure>


<p>Install the virtualbox guest additions plugin for vagrant:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>vagrant plugin install vagrant-vbguest
</span></code></pre></td></tr></table></div></figure>


<p>If you would like a vagrant manager utility to help you manage your vagrant boxes, you can install <a href="http://www.vagrantmanager.com/">vagrant-manager</a> using homebrew:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>brew install --cask vagrant-manager
</span></code></pre></td></tr></table></div></figure>


<h2>Create your first Vagrant Box</h2>

<p>From <a href="https://app.vagrantup.com/boxes/search">app.vagrantup.com/boxes/search</a> you can search for any box, such as ubuntu, centos, alpine etc and for this demonstration I am going with <a href="https://app.vagrantup.com/ubuntu/boxes/focal64">ubuntu/focal64</a>.</p>

<p>I am creating a new directory for my devbox:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>mkdir devbox
</span><span class='line'><span class="nv">$ </span><span class="nb">cd </span>devbox
</span></code></pre></td></tr></table></div></figure>


<p>Then initialize the Vagrantfile by running:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>vagrant init ubuntu/focal64
</span></code></pre></td></tr></table></div></figure>


<p>A <code>Vagrantfile</code> has been created in the current working directory:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>cat Vagrantfile <span class="p">|</span> grep -v <span class="s2">&quot;#&quot;</span>
</span><span class='line'>
</span><span class='line'>Vagrant.configure<span class="o">(</span><span class="s2">&quot;2&quot;</span><span class="o">)</span> <span class="k">do</span> <span class="p">|</span>config<span class="p">|</span>
</span><span class='line'>  config.vm.box <span class="o">=</span> <span class="s2">&quot;ubuntu/focal64&quot;</span>
</span><span class='line'>end
</span></code></pre></td></tr></table></div></figure>


<p>Boot the VM:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>vagrant up
</span></code></pre></td></tr></table></div></figure>


<p>The box should now be in a started state, and we can verify that by running:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>vagrant status
</span><span class='line'>Current machine states:
</span><span class='line'>
</span><span class='line'>default                   running <span class="o">(</span>virtualbox<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>We can now SSH to our VM by running:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>vagrant ssh
</span><span class='line'>vagrant@ubuntu-focal:~<span class="err">$</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Installing Software with Vagrant</h2>

<p>First let&rsquo;s destroy the VM that we created:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>vagrant destroy --force
</span></code></pre></td></tr></table></div></figure>


<p>Then edit the <code>Vagrantfile</code> and add the commands that we want to be executed when the VM boots, in our case, installing Nginx:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Vagrant</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s2">&quot;ubuntu/focal64&quot;</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="s2">&quot;forwarded_port&quot;</span><span class="p">,</span> <span class="ss">guest</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span> <span class="ss">host</span><span class="p">:</span> <span class="mi">8080</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&quot;shell&quot;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="o">&lt;&lt;-</span><span class="no">SHELL</span>
</span><span class='line'><span class="sh">     apt update</span>
</span><span class='line'><span class="sh">     apt install nginx -y</span>
</span><span class='line'><span class="no">  SHELL</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>You will also notice that we are forwarding port 8080 from our host, to port 80 on the VM so that we can access the webserver on port 8080 from our laptop. Then boot the VM:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span> <span class="n">vagrant</span> <span class="n">up</span>
</span></code></pre></td></tr></table></div></figure>


<p>Once the VM has booted and installed our software, we should be able to access the index document served by Nginx on our VM:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>curl -I http://localhost:8080/
</span><span class='line'>
</span><span class='line'>HTTP/1.1 <span class="m">200</span> OK
</span><span class='line'>Server: nginx/1.18.0 <span class="o">(</span>Ubuntu<span class="o">)</span>
</span><span class='line'>Date: Sat, <span class="m">14</span> Aug <span class="m">2021</span> 18:11:59 GMT
</span><span class='line'>Content-Type: text/html
</span><span class='line'>Content-Length: 612
</span><span class='line'>Last-Modified: Sat, <span class="m">14</span> Aug <span class="m">2021</span> 18:11:10 GMT
</span><span class='line'>Connection: keep-alive
</span><span class='line'>ETag: <span class="s2">&quot;6118073e-264&quot;</span>
</span><span class='line'>Accept-Ranges: bytes
</span></code></pre></td></tr></table></div></figure>


<h2>Shared Folders</h2>

<p>Let&rsquo;s say you want to map your local directory to your VM, in a scenario where you want to store your <code>index.html</code> on your laptop and map it to the VM, we can use <code>config.vm.synced_folder</code>.</p>

<p>On our laptop, create a <code>html</code> directory where we will store our <code>index.hml</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>mkdir html
</span></code></pre></td></tr></table></div></figure>


<p>Now create the content in the <code>index.html</code> under the <code>html</code> directory:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;Hello, World&quot;</span> &gt; html/index.html
</span></code></pre></td></tr></table></div></figure>


<p>Now we need to make vagrant aware of the folder that we are mapping to the VM, so we need to edit the <code>Vagrantfile</code> and it will now look like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># -*- mode: ruby -*-</span>
</span><span class='line'><span class="c1"># vi: set ft=ruby :</span>
</span><span class='line'>
</span><span class='line'><span class="no">Vagrant</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s2">&quot;ubuntu/focal64&quot;</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="s2">&quot;forwarded_port&quot;</span><span class="p">,</span> <span class="ss">guest</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span> <span class="ss">host</span><span class="p">:</span> <span class="mi">8080</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&quot;shell&quot;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="o">&lt;&lt;-</span><span class="no">SHELL</span>
</span><span class='line'><span class="sh">     apt update</span>
</span><span class='line'><span class="sh">     apt install nginx -y</span>
</span><span class='line'><span class="no">  SHELL</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">synced_folder</span> <span class="s2">&quot;html&quot;</span><span class="p">,</span> <span class="s2">&quot;/var/www/html&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>To reload the VM with our changes, we use <code>vagrant provision</code> to update our VM when changes to provisioners are made, and <code>vagrant reload</code> when we have config changes such as <code>config.vm.network</code>, but to restart the VM and forcing provisioners to run, we can use the following:</p>

<p>Thanks <a href="https://twitter.com/joshva_jebaraj">@joshva_jebaraj</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>vagrant reload --provision
</span></code></pre></td></tr></table></div></figure>


<p>Once the VM is up, we can verify the changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>curl http://localhost:8080/
</span><span class='line'>Hello, World
</span></code></pre></td></tr></table></div></figure>


<p>Now we can edit our content locally which is synced to our VM.</p>

<h2>Setting Hostname and Configure Memory</h2>

<p>We can also configure the hostname of our VM and configure the amount of memory that we want to allocate to our VM using:</p>

<ul>
<li><code>config.vm.hostname</code></li>
<li><code>vb.memory</code></li>
</ul>


<p>An example of that will look like the following:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># -*- mode: ruby -*-</span>
</span><span class='line'><span class="c1"># vi: set ft=ruby :</span>
</span><span class='line'>
</span><span class='line'><span class="no">Vagrant</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s2">&quot;ubuntu/focal64&quot;</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">hostname</span> <span class="o">=</span> <span class="s2">&quot;mydevbox&quot;</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="s2">&quot;forwarded_port&quot;</span><span class="p">,</span> <span class="ss">guest</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span> <span class="ss">host</span><span class="p">:</span> <span class="mi">8080</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&quot;shell&quot;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="o">&lt;&lt;-</span><span class="no">SHELL</span>
</span><span class='line'><span class="sh">     apt update</span>
</span><span class='line'><span class="sh">     apt install nginx -y</span>
</span><span class='line'><span class="no">  SHELL</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">synced_folder</span> <span class="s2">&quot;html&quot;</span><span class="p">,</span> <span class="s2">&quot;/var/www/html&quot;</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provider</span> <span class="s2">&quot;virtualbox&quot;</span> <span class="k">do</span> <span class="o">|</span><span class="n">vb</span><span class="o">|</span>
</span><span class='line'>    <span class="n">vb</span><span class="o">.</span><span class="n">memory</span> <span class="o">=</span> <span class="s2">&quot;1024&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>`</p>

<p>In this example our VM&rsquo;s hostname is <code>mydevbox</code> and we assigned 1024MB of memory to our VM.</p>

<h2>Provisioners: Shell</h2>

<p>We can also run scripts from our local directory on our laptop on our VM using the <a href="https://www.vagrantup.com/docs/provisioning/shell">shell provisioner</a>.</p>

<p>First we need to create the script on our local directory:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>cat bootstrap.sh
</span><span class='line'><span class="c">#!/usr/bin/env bash</span>
</span><span class='line'><span class="nb">set</span> -x
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;my hostname is $(hostname)&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then in our <code>Vagrantfile</code> we inform vagrant to execute the shell script:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># -*- mode: ruby -*-</span>
</span><span class='line'><span class="c1"># vi: set ft=ruby :</span>
</span><span class='line'>
</span><span class='line'><span class="no">Vagrant</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s2">&quot;ubuntu/focal64&quot;</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">hostname</span> <span class="o">=</span> <span class="s2">&quot;mydevbox&quot;</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="ss">:shell</span><span class="p">,</span> <span class="ss">:path</span> <span class="o">=&gt;</span> <span class="s2">&quot;bootstrap.sh&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Since my VM is already running, I will be doing a <code>reload</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>vagrant reload --provision
</span><span class='line'>...
</span><span class='line'><span class="o">==</span>&gt; default: Running provisioner: shell...
</span><span class='line'>    default: Running: /var/folders/04/r10yvb8d5dgfvd167jz5z23w0000gn/T/vagrant-shell20210814-70233-1p9dump.sh
</span><span class='line'>    default: ++ hostname
</span><span class='line'>    default: my hostname is mydevbox
</span><span class='line'>    default: + <span class="nb">echo</span> <span class="s1">&#39;my hostname is mydevbox&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you can see the shell script from our local directory was executed on our VM, you can use this method to automate installations as well, etc.</p>

<h2>Provisioners: Docker</h2>

<p>Vagrant offers a <a href="https://www.vagrantup.com/docs/provisioning/docker">docker provisioner</a>, and for this example we will be hosting a mysql server using docker container in our VM.</p>

<p>Our <code>Vagrantfile</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># -*- mode: ruby -*-</span>
</span><span class='line'><span class="c1"># vi: set ft=ruby :</span>
</span><span class='line'>
</span><span class='line'><span class="no">Vagrant</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s2">&quot;ubuntu/focal64&quot;</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">hostname</span> <span class="o">=</span> <span class="s2">&quot;mydevbox&quot;</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="s2">&quot;forwarded_port&quot;</span><span class="p">,</span> <span class="ss">guest</span><span class="p">:</span> <span class="mi">3306</span><span class="p">,</span> <span class="ss">host</span><span class="p">:</span> <span class="mi">3306</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&quot;docker&quot;</span> <span class="k">do</span> <span class="o">|</span><span class="n">d</span><span class="o">|</span>
</span><span class='line'>    <span class="n">d</span><span class="o">.</span><span class="n">run</span> <span class="s2">&quot;mysql&quot;</span><span class="p">,</span> <span class="ss">image</span><span class="p">:</span> <span class="s2">&quot;mysql:8.0&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">args</span><span class="p">:</span> <span class="s2">&quot;-p 3306:3306 -e MYSQL_ROOT_PASSWORD=password&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Since I don&rsquo;t have port <code>3306</code> listening locally, I have mapped port <code>3306</code> from my laptop to port <code>3306</code> on my VM and I am using the <code>mysql:8.0</code> container image from docker hub and passing the arguments which is specific to the container.</p>

<p>The convenient thing about the docker provisioner, is that it will install docker onto the VM for you.</p>

<p>Once the config has been set in your <code>Vagrantfile</code> do a reload:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>vagrant reload --provision
</span><span class='line'>...
</span><span class='line'>    default: /vagrant <span class="o">=</span>&gt; /Users/ruanbekker/workspace/vagrant/devbox
</span><span class='line'><span class="o">==</span>&gt; default: Running provisioner: docker...
</span><span class='line'>    default: Installing Docker onto machine...
</span><span class='line'><span class="o">==</span>&gt; default: Starting Docker containers...
</span><span class='line'><span class="o">==</span>&gt; default: -- Container: mysql
</span></code></pre></td></tr></table></div></figure>


<p>From our laptop we should be able to communicate with our mysql server:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>nc -vz localhost 3306
</span><span class='line'>found <span class="m">0</span> associations
</span><span class='line'>found <span class="m">1</span> connections:
</span><span class='line'>     1:   <span class="nv">flags</span><span class="o">=</span>82&lt;CONNECTED,PREFERRED&gt;
</span><span class='line'>  outif lo0
</span><span class='line'>  src 127.0.0.1 port 58745
</span><span class='line'>  dst 127.0.0.1 port 3306
</span><span class='line'>  rank info not available
</span><span class='line'>  TCP aux info available
</span><span class='line'>
</span><span class='line'>Connection to localhost port <span class="m">3306</span> <span class="o">[</span>tcp/mysql<span class="o">]</span> succeeded!
</span></code></pre></td></tr></table></div></figure>


<p>We can also SSH to our VM and verify if the container is running:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>vagrant ssh
</span></code></pre></td></tr></table></div></figure>


<p>And then list the containers:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span> docker ps
</span><span class='line'>CONTAINER ID   IMAGE       COMMAND                  CREATED         STATUS         PORTS                                                  NAMES
</span><span class='line'>30a843a486ae   mysql:8.0   <span class="err">&quot;</span>docker-entrypoint.sh    <span class="m">2</span> minutes ago   Up <span class="m">2</span> minutes   0.0.0.0:3306-&gt;3306/tcp, :::3306-&gt;3306/tcp, 33060/tcp   mysql
</span></code></pre></td></tr></table></div></figure>


<h2>Provisioners: Ansible</h2>

<p>We can also execute <a href="https://www.ansible.com/">Ansible</a> playbooks on our VM using the <a href="https://www.vagrantup.com/docs/provisioning/ansible">Ansible Provisioner</a>.</p>

<p>Something to note is that we use <code>ansible</code> to execute the playbook on the host, and <code>ansible_local</code> to execute the playbook on the VM.</p>

<p>First we will create our <a href="https://docs.ansible.com/playbooks_best_practices.html#directory-layout">project structure</a> for ansible, so that we have the following in place:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>.
</span><span class='line'>Vagrantfile
</span><span class='line'>provisioning/playbook.yml
</span><span class='line'>provisioning/group_vars/all
</span></code></pre></td></tr></table></div></figure>


<p>Create the <code>provisioning</code> directory:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>mkdir provisioning
</span></code></pre></td></tr></table></div></figure>


<p>Then the content for our <code>provisioning/playbook.yml</code> playbook:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="nn">---</span>
</span><span class='line'><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">hosts</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">all</span>
</span><span class='line'>  <span class="l-Scalar-Plain">become</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">yes</span>
</span><span class='line'>  <span class="l-Scalar-Plain">tasks</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">ensure ntpd is at the latest version</span>
</span><span class='line'>      <span class="l-Scalar-Plain">apt</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">pkg</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">ntp</span>
</span><span class='line'>        <span class="l-Scalar-Plain">state</span><span class="p-Indicator">:</span> <span class="s">&quot;&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">notify</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">restart ntpd</span>
</span><span class='line'>  <span class="l-Scalar-Plain">handlers</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">restart ntpd</span>
</span><span class='line'>      <span class="l-Scalar-Plain">service</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">ntp</span>
</span><span class='line'>        <span class="l-Scalar-Plain">state</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">restarted</span>
</span></code></pre></td></tr></table></div></figure>


<p>Our <code>provisioning/group_vars/all</code> file that will contain the variables for the all group:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">desired_state</span><span class="p-Indicator">:</span> <span class="s">&quot;latest&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>In our <code>Vagrantfile</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># -*- mode: ruby -*-</span>
</span><span class='line'><span class="c1"># vi: set ft=ruby :</span>
</span><span class='line'>
</span><span class='line'><span class="no">Vagrant</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s2">&quot;ubuntu/focal64&quot;</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">hostname</span> <span class="o">=</span> <span class="s2">&quot;mydevbox&quot;</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="ss">:ansible</span> <span class="k">do</span> <span class="o">|</span><span class="n">ansible</span><span class="o">|</span>
</span><span class='line'>    <span class="n">ansible</span><span class="o">.</span><span class="n">playbook</span> <span class="o">=</span> <span class="s2">&quot;provisioning/playbook.yml&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>When using ansible with vagrant the inventory is <a href="https://www.vagrantup.com/docs/provisioning/ansible_intro#auto-generated-inventory">auto-generated</a> when then inventory is not specified. Vagrant will store the inventory on the host at <code>.vagrant/provisioners/ansible/inventory/vagrant_ansible_inventory</code>.</p>

<p>To execute playbooks with ansible, we need ansible installed on our host machine, for this demonstration I will be using virtualenv and then install ansible using pip:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>python3 -m pip install virtualenv
</span><span class='line'><span class="nv">$ </span>virtualenv -p <span class="k">$(</span>which python3<span class="k">)</span> .venv
</span><span class='line'><span class="nv">$ </span><span class="nb">source</span> .venv/bin/activate
</span><span class='line'><span class="nv">$ </span>pip install ansible
</span></code></pre></td></tr></table></div></figure>


<p>Now that we have ansible installed, reload the VM to execute the playbook on our VM:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>vagrant reload --provision
</span><span class='line'>...
</span><span class='line'><span class="o">==</span>&gt; default: Running provisioner: ansible...
</span><span class='line'>    default: Running ansible-playbook...
</span><span class='line'>
</span><span class='line'>PLAY <span class="o">[</span>all<span class="o">]</span> *********************************************************************
</span><span class='line'>
</span><span class='line'>TASK <span class="o">[</span>Gathering Facts<span class="o">]</span> *********************************************************
</span><span class='line'>ok: <span class="o">[</span>default<span class="o">]</span>
</span><span class='line'>
</span><span class='line'>TASK <span class="o">[</span>ensure ntpd is at the latest version<span class="o">]</span> ************************************
</span><span class='line'>ok: <span class="o">[</span>default<span class="o">]</span>
</span><span class='line'>
</span><span class='line'>PLAY RECAP *********************************************************************
</span><span class='line'>default                    : <span class="nv">ok</span><span class="o">=</span><span class="m">2</span>    <span class="nv">changed</span><span class="o">=</span><span class="m">0</span>    <span class="nv">unreachable</span><span class="o">=</span><span class="m">0</span>    <span class="nv">failed</span><span class="o">=</span><span class="m">0</span>    <span class="nv">skipped</span><span class="o">=</span><span class="m">0</span>    <span class="nv">rescued</span><span class="o">=</span><span class="m">0</span>    <span class="nv">ignored</span><span class="o">=</span>0
</span></code></pre></td></tr></table></div></figure>


<p>Pretty neat right?</p>

<h2>Tear Down</h2>

<p>To destroy the VM:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>vagrant destroy --force
</span></code></pre></td></tr></table></div></figure>


<h2>Resources</h2>

<p>For more information on vagrant, check out their documentation:</p>

<ul>
<li><a href="https://www.vagrantup.com/docs">https://www.vagrantup.com/docs</a></li>
</ul>


<p>On provisioning documentation:</p>

<ul>
<li><a href="https://www.vagrantup.com/docs/provisioning/shell">https://www.vagrantup.com/docs/provisioning/shell</a></li>
<li><a href="https://www.vagrantup.com/docs/provisioning/docker">https://www.vagrantup.com/docs/provisioning/docker</a></li>
<li><a href="https://www.vagrantup.com/docs/provisioning/ansible_intro">https://www.vagrantup.com/docs/provisioning/ansible_intro</a></li>
</ul>


<p>I have a couple of example <code>Vagrantfile</code>s available on my github repository:</p>

<ul>
<li><a href="https://github.com/ruanbekker/vagrantfiles">https://github.com/ruanbekker/vagrantfiles</a></li>
</ul>


<h2>Thank You</h2>

<p>Thanks for reading, if you like my content, check out my <strong><a href="https://ruan.dev">website</a></strong> or follow me at <strong><a href="https://twitter.com/ruanbekker">@ruanbekker</a></strong> on Twitter.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/2">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Subscribe</h1>
  <!-- Begin MailChimp Signup Form -->
  <div id="mc_embed_signup">
  <form action="https://sysadmins.us15.list-manage.com/subscribe/post?u=3dfcff447b6ee598231eeb658&amp;id=3542f323a9" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
      <div class="indicates-required"><span class="asterisk"></span></div>
      <div class="mc-field-group">
	<label for="mce-EMAIL">Email Address:  <span class="asterisk"></span>
        </label>
	<input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL">
        </div>
	<div id="mce-responses" class="clear">
	  <div class="response" id="mce-error-response" style="display:none"></div>
	  <div class="response" id="mce-success-response" style="display:none"></div>
	</div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
      <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_3dfcff447b6ee598231eeb658_3542f323a9" tabindex="-1" value=""></div>
    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
    </div>
  </form>
</div>
<!--End mc_embed_signup-->
</section>

<section>
  <h1>Slack</h1>
  Join me on <a href="http://linux-hackers.slack.com">Slack</a>
</section>

<section>
  <h1>Twitter</h1>
  Follow me on Twitter: <a href="https://twitter.com/ruanbekker">@ruanbekker</a>
</section>

<section>
  <h1>Newsletter</h1>
  <p></p>View my newsletter on <a href="http://digests.ruanbekker.com/?via=ruanbekker-blog" target="_blank">digests.ruanbekker.com</a>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2022/03/20/run-openldap-with-a-ui-on-docker/">Run OpenLDAP With a UI on Docker</a>
      </li>
    
      <li class="post">
        <a href="/blog/2022/02/20/create-dns-records-with-terraform-on-cloudflare/">Create DNS Records With Terraform on Cloudflare</a>
      </li>
    
      <li class="post">
        <a href="/blog/2021/12/05/blockchain-basics/">Blockchain Basics</a>
      </li>
    
      <li class="post">
        <a href="/blog/2021/12/05/run-a-geth-ethereum-light-node/">Run a GETH Ethereum Light Node</a>
      </li>
    
      <li class="post">
        <a href="/blog/2021/11/23/run-docker-containers-with-terraform/">Run Docker Containers With Terraform</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Store</h1>
  <ul id=""></ul>
  <p></p>
  <strong>Check out my Store</strong>: Have a look at my latest cheatsheets in PDF format.
  <p></p>
  <a href="https://ruan.dev/store/elasticsearch-cheatsheet/?source=blog.ruanbekker.com"><img src="https://user-images.githubusercontent.com/567298/97010485-c2334a00-1545-11eb-9e1d-2333e5148da1.png" width="290" height="900"></a>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2022 - Ruan -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>
<script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="ruanbekker" data-description="Support me on Buy me a coffee!" data-message="" data-color="#FFDD00" data-position="Right" data-x_margin="18" data-y_margin="18"></script>



  <li>
    <a href="https://twitter.com/ruanbekker">
      <i class="fa fa-twitter"></i> Twitter
    </a>
  </li>



  <li>
    <a href="https://github.com/ruanbekker">
      <i class="fa fa-github"></i> GitHub
    </a>
  </li>



  <li>
    <a href="https://sysadmins.co.za">
      <i class="fa fa-bars"></i> My HowTo Blog
    </a>
  </li>


</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'blog-ruanbekker';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





      <script data-ad-client="ca-pub-1100086574264181" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <!-- old
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-1543437721119411",
        enable_page_level_ads: true
      });
    </script>
    -->


</body>
</html>
