
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Ruan Bekker's Blog</title>
  <meta name="author" content="Ruan">

  
  <meta name="description" content="Quick script to decrypt data that was encrypted with your KMS key: The Script: The script requires the encrypted scring as an argument: 1
2
3
4
5
6
7 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">


  <!-- font awesome --!>
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

  
  <link rel="canonical" href="http://blog.ruanbekker.com/posts/10/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Ruan Bekker's Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-105336110-1']);
    _gaq.push(['_setDomainName','ruanbekker.com']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Ruan Bekker's Blog</a></h1>
  
    <h2>From a Curious mind to Posts on Github</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://blog.ruanbekker.com/search/" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="blog.ruanbekker.com">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/blog/categories/aws/">AWS</a></li>
  <li><a href="/blog/categories/docker/">Docker</a></li>
  <li><a href="/blog/categories/devops/">DevOps</a></li>
  <li><a href="/blog/categories/python/">Python</a></li>
  <li><a target="_blank" href="https://sysadmins.co.za">My HowTo Blog</a></li>
  <li><a href="/awesome-links/">Awesome Links</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/10/20/python-script-to-decrypt-encrypted-data-with-aws-kms/">Python Script to Decrypt Encrypted Data With AWS KMS</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-10-20T04:54:51-04:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>4:54 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Quick script to decrypt data that was encrypted with your KMS key:</p>

<h2>The Script:</h2>

<p>The script requires the encrypted scring as an argument:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/env python</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">boto3</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">sys</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">base64</span> <span class="kn">import</span> <span class="n">b64decode</span>
</span><span class='line'>
</span><span class='line'><span class="k">try</span><span class="p">:</span>
</span><span class='line'>    <span class="n">encrypted_value</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span class='line'><span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
</span><span class='line'>    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Usage: {} {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&#39;the-encrypted-string&#39;</span><span class="p">))</span>
</span><span class='line'>    <span class="nb">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">session</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span>
</span><span class='line'>        <span class="n">region_name</span><span class="o">=</span><span class="s">&#39;eu-west-1&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="n">profile_name</span><span class="o">=</span><span class="s">&#39;default&#39;</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">kms</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s">&#39;kms&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">response</span> <span class="o">=</span> <span class="n">kms</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">CiphertextBlob</span><span class="o">=</span><span class="n">b64decode</span><span class="p">(</span><span class="n">encrypted_value</span><span class="p">))[</span><span class="s">&#39;Plaintext&#39;</span><span class="p">]</span>
</span><span class='line'><span class="k">print</span><span class="p">(</span><span class="s">&quot;Decrypted Value: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">response</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Change the permissions so that the file is executable:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>chmod +x decrypt.py
</span></code></pre></td></tr></table></div></figure>


<h2>Usage:</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>./decrypt.py asdlaskjdasidausd09q3uoijad09ujd38u309
</span><span class='line'>Decrypted Value: thisIsMyDecryptedValue
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/10/18/setup-kerberos-server-and-client-on-ubuntu/">Setup Kerberos Server and Client on Ubuntu</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-10-18T18:25:11-04:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>18</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>6:25 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Kerberos is a authentication protocol that provides a centralized authentication server, that works with the concepts of tickets that are encrypted.</p>

<p>Today we will setup a Kerberos Server (KDC) and setup and Kerberos Enabled Client, and then testing our setup by obtaining a Kerberos Ticket from our server.</p>

<h2>Setup the Server:</h2>

<p>Install Kerberos KDC and Admin Server:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>apt update <span class="o">&amp;&amp;</span> apt upgrade -y
</span><span class='line'><span class="nv">$ </span>apt install krb5-kdc krb5-admin-server krb5-config -y
</span><span class='line'><span class="nv">$ </span>krb5_newrealm
</span></code></pre></td></tr></table></div></figure>


<p>You will be prompted for realm, and hostnames, in my case I have setup the following:</p>

<ul>
<li>REALM: <code>LAN.RUANBEKER.COM</code></li>
<li>HOST: <code>localhost</code></li>
<li>ADMIN_SERVER: <code>localhost</code></li>
</ul>


<p>Then our master password:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>This script should be run on the master KDC/admin server to initialize
</span><span class='line'>a Kerberos realm.  It will ask you to <span class="nb">type </span>in a master key password.
</span><span class='line'>This password will be used to generate a key that is stored in
</span><span class='line'>/etc/krb5kdc/stash.  You should try to remember this password, but it
</span><span class='line'>is much more important that it be a strong password than that it be
</span><span class='line'>remembered.  However, <span class="k">if</span> you lose the password and /etc/krb5kdc/stash,
</span><span class='line'>you cannot decrypt your Kerberos database.
</span><span class='line'>Loading random data
</span><span class='line'>Initializing database <span class="s1">&#39;/var/lib/krb5kdc/principal&#39;</span> <span class="k">for</span> realm <span class="s1">&#39;LAN.RUANBEKKER.COM&#39;</span>,
</span><span class='line'>master key name <span class="s1">&#39;K/M@LAN.RUANBEKKER.COM&#39;</span>
</span><span class='line'>You will be prompted <span class="k">for</span> the database Master Password.
</span><span class='line'>It is important that you NOT FORGET this password.
</span><span class='line'>Enter KDC database master key:
</span><span class='line'>Re-enter KDC database master key to verify:
</span></code></pre></td></tr></table></div></figure>


<p>The output:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Now that your realm is <span class="nb">set </span>up you may wish to create an administrative
</span><span class='line'>principal using the addprinc subcommand of the kadmin.local program.
</span><span class='line'>Then, this principal can be added to /etc/krb5kdc/kadm5.acl so that
</span><span class='line'>you can use the kadmin program on other computers.  Kerberos admin
</span><span class='line'>principals usually belong to a single user and end in /admin.  For
</span><span class='line'>example, <span class="k">if</span> jruser is a Kerberos administrator, <span class="k">then</span> in addition to
</span><span class='line'>the normal jruser principal, a jruser/admin principal should be
</span><span class='line'>created.
</span><span class='line'>
</span><span class='line'>Don<span class="err">&#39;</span>t forget to <span class="nb">set </span>up DNS information so your clients can find your
</span><span class='line'>KDC and admin servers.  Doing so is documented in the administration
</span><span class='line'>guide.
</span></code></pre></td></tr></table></div></figure>


<p>Uncomment the last line which contains <code>admin</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>vi /etc/krb5kdc/kadm5.acl
</span></code></pre></td></tr></table></div></figure>


<p>a Kerberos principal is a unique identity to which Kerberos can assign tickets, lets add our first principal, <code>james</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>kadmin.local
</span><span class='line'>Authenticating as principal root/admin@LAN.RUANBEKKER.COM with password.
</span><span class='line'>kadmin.local:  addprinc james
</span><span class='line'>
</span><span class='line'>WARNING: no policy specified <span class="k">for</span> james@LAN.RUANBEKKER.COM<span class="p">;</span> defaulting to no policy
</span><span class='line'>Enter password <span class="k">for</span> principal <span class="s2">&quot;james@LAN.RUANBEKKER.COM&quot;</span>:
</span><span class='line'>Re-enter password <span class="k">for</span> principal <span class="s2">&quot;james@LAN.RUANBEKKER.COM&quot;</span>:
</span><span class='line'>Principal <span class="s2">&quot;james@LAN.RUANBEKKER.COM&quot;</span> created.
</span><span class='line'>kadmin.local:  <span class="nb">exit</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Setup the Client:</h2>

<p>Setup a Host Entry:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span><span class="nb">echo</span> <span class="s1">&#39;10.1.1.1 kdc.lan.ruanbekker.com kdc&#39;</span> &gt;&gt; /etc/hosts
</span></code></pre></td></tr></table></div></figure>


<p>Setup Kerberos Client:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>apt install krb5-user -y
</span><span class='line'>- realm
</span><span class='line'>- hostname
</span><span class='line'>- hostname
</span></code></pre></td></tr></table></div></figure>


<p>Obtain a Ticket from the Server:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>kinit -p james
</span><span class='line'>Password <span class="k">for</span> james@LAN.RUANBEKKER.COM:
</span><span class='line'>
</span><span class='line'><span class="nv">$ </span>klist
</span><span class='line'>Ticket cache: FILE:/tmp/krb5cc_0
</span><span class='line'>Default principal: james@LAN.RUANBEKKER.COM
</span><span class='line'>
</span><span class='line'>Valid starting     Expires            Service principal
</span><span class='line'>10/18/17 22:13:34  10/19/17 08:13:34  krbtgt/LAN.RUANBEKKER.COM@LAN.RUANBEKKER.COM
</span><span class='line'>  renew <span class="k">until</span> 10/19/17 22:13:30
</span></code></pre></td></tr></table></div></figure>


<h2>Resources:</h2>

<ul>
<li><a href="http://csetutorials.com/setup-kerberos-ubuntu.html">http://csetutorials.com/setup-kerberos-ubuntu.html</a></li>
<li><a href="https://www.rootusers.com/how-to-configure-linux-to-authenticate-using-kerberos/">https://www.rootusers.com/how-to-configure-linux-to-authenticate-using-kerberos/</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/10/14/using-python-to-build-a-dictionary-from-data-eg-sports-per-person/">Using Python to Build a Dictionary From Data Eg Sports Per Person</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-10-14T14:53:48-04:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>14</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>2:53 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I had to achieve a way to provide data in key-value format, where I wanted to see what sports people like, eg: <code>{"ruan": ["rugby", "cricket"]}</code></p>

<h2>The Idea</h2>

<p>So my idea was to have the <code>name</code> as the key, and the <code>sports</code> as the value in a list.</p>

<h2>Some Catches</h2>

<p>So for this post, I will be setting the data statically in the code, while at the time I was working data that was returned via a API.</p>

<p>I am looping through each occurence, adding the name, and when the name exists, I append the sport to the list of the person.</p>

<p>The catch was that, if there was any duplicated data, the person will only exists once in the dictionary that I am building, but the sport will be appended, so if there were 2 occurences of <code>rugby</code> it will show the sport 2 times. So I had to put some logic into the code to handle that.</p>

<h2>The Code</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="sd">&quot;&quot;&quot;|Info:</span>
</span><span class='line'>
</span><span class='line'><span class="sd">Printing Sports per Person, by looping through data, appending the sports to a list per person, which gets added to our dictionary.</span>
</span><span class='line'>
</span><span class='line'><span class="sd">Variables:</span>
</span><span class='line'><span class="sd"> group {dict} -- &quot;the dictionary that we are building up&quot;</span>
</span><span class='line'><span class="sd"> people {list} -- &quot;list of people with their sport choices&quot;</span>
</span><span class='line'><span class="sd"> for sportman in people: {[for-loop]} -- &quot;iterating through our data, if the sport exists, continue, if not, apeend it to the list&quot;</span>
</span><span class='line'><span class="sd"> print(group) {[dict]} -- &quot;printing the results&quot;</span>
</span><span class='line'><span class="sd">&quot;&quot;&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="n">group</span> <span class="o">=</span> <span class="p">{}</span>
</span><span class='line'><span class="n">people</span> <span class="o">=</span> <span class="p">[</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="s">&quot;name&quot;</span><span class="p">:</span> <span class="s">&quot;ruan&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;sport&quot;</span><span class="p">:</span> <span class="s">&quot;cricket&quot;</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="s">&quot;name&quot;</span><span class="p">:</span> <span class="s">&quot;stefan&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;sport&quot;</span><span class="p">:</span> <span class="s">&quot;rugby&quot;</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="s">&quot;name&quot;</span><span class="p">:</span> <span class="s">&quot;stefan&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;sport&quot;</span><span class="p">:</span> <span class="s">&quot;cricket&quot;</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="s">&quot;name&quot;</span><span class="p">:</span> <span class="s">&quot;james&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;sport&quot;</span><span class="p">:</span> <span class="s">&quot;rugby&quot;</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="s">&quot;name&quot;</span><span class="p">:</span> <span class="s">&quot;james&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;sport&quot;</span><span class="p">:</span> <span class="s">&quot;golf&quot;</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="s">&quot;name&quot;</span><span class="p">:</span> <span class="s">&quot;stefan&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;sport&quot;</span><span class="p">:</span> <span class="s">&quot;rugby&quot;</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="s">&quot;name&quot;</span><span class="p">:</span> <span class="s">&quot;james&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s">&quot;sport&quot;</span><span class="p">:</span> <span class="s">&quot;hockey&quot;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="k">for</span> <span class="n">sportman</span> <span class="ow">in</span> <span class="n">people</span><span class="p">:</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">sportman</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">group</span><span class="p">:</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">sportman</span><span class="p">[</span><span class="s">&#39;sport&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">group</span><span class="p">[</span><span class="n">sportman</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]]:</span>
</span><span class='line'>            <span class="n">group</span><span class="p">[</span><span class="n">sportman</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sportman</span><span class="p">[</span><span class="s">&#39;sport&#39;</span><span class="p">])</span>
</span><span class='line'>        <span class="k">else</span><span class="p">:</span>
</span><span class='line'>            <span class="k">pass</span>
</span><span class='line'>    <span class="k">else</span><span class="p">:</span>
</span><span class='line'>        <span class="n">group</span><span class="p">[</span><span class="n">sportman</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span class='line'>        <span class="n">group</span><span class="p">[</span><span class="n">sportman</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sportman</span><span class="p">[</span><span class="s">&#39;sport&#39;</span><span class="p">])</span>
</span><span class='line'>
</span><span class='line'><span class="k">print</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Running the Script:</h2>

<p>When running the script results in the following:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>python sports.py
</span><span class='line'><span class="o">{</span><span class="s1">&#39;james&#39;</span>: <span class="o">[</span><span class="s1">&#39;rugby&#39;</span>, <span class="s1">&#39;golf&#39;</span>, <span class="s1">&#39;hockey&#39;</span><span class="o">]</span>, <span class="s1">&#39;ruan&#39;</span>: <span class="o">[</span><span class="s1">&#39;cricket&#39;</span><span class="o">]</span>, <span class="s1">&#39;stefan&#39;</span>: <span class="o">[</span><span class="s1">&#39;rugby&#39;</span>, <span class="s1">&#39;cricket&#39;</span><span class="o">]}</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/10/11/customize-ubuntu-16-desktop-with-arc-dark-theme/">Customize Ubuntu 16 Desktop With Arc Dark Theme</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-10-11T15:56:10-04:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>11</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>3:56 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="https://i.snag.gy/g1ryLn.jpg" alt="" /></p>

<p>So I was running ApricityOS for quite some time, which is a Arch Distibution. But a couple of hours before PyConZa I was trying to do a update and found that their repositories were reporting 404 errors, and turns out they have stopped their project :( . I quite liked ApricityOS, as it&rsquo;s what you will expect when installing Arch with the basic applications and the numix icon/theme pack.</p>

<p>So I decided to use Ubuntu for a change.</p>

<h2>Customizations:</h2>

<p>For the Operating System, I am Ubuntu 16:</p>

<ul>
<li><a href="https://www.ubuntu.com/download/desktop">Ubuntu 16.04 (Operating System)</a></li>
</ul>


<p>For my theme I am using Arc Dark:</p>

<ul>
<li><a href="https://github.com/horst3180/arc-theme">Arch Teme</a> - <a href="https://askubuntu.com/questions/265471/autoreconf-not-found-error-during-making-qemu-1-4-0/490839">autoconf dependency required</a></li>
</ul>


<p><img src="https://i.snag.gy/u5fP4w.jpg" alt="" /></p>

<p>Moka Icon pack for my Icons:</p>

<ul>
<li><a href="https://snwh.org/moka/download">Moka Icon Themes</a></li>
</ul>


<p><img src="https://i.snag.gy/3JPi9W.jpg?nocache=1507753731895" alt="" /></p>

<p>Terminator for my terminal of choice:</p>

<ul>
<li><a href="http://www.linuxandubuntu.com/home/10-best-linux-terminals-for-ubuntu-and-fedora">Terminator Terminal</a></li>
</ul>


<p><img src="https://i.snag.gy/xqgXMc.jpg" alt="" /></p>

<p>And my config:</p>

<figure class='code'><figcaption><span>~/.config/terminator/config </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>global_config<span class="o">]</span>
</span><span class='line'>  <span class="nv">enabled_plugins</span> <span class="o">=</span> LaunchpadCodeURLHandler, APTURLHandler, LaunchpadBugURLHandler
</span><span class='line'>  <span class="nv">sticky</span> <span class="o">=</span> True
</span><span class='line'>  <span class="nv">window_state</span> <span class="o">=</span> maximise
</span><span class='line'><span class="o">[</span>keybindings<span class="o">]</span>
</span><span class='line'><span class="o">[</span>layouts<span class="o">]</span>
</span><span class='line'>  <span class="o">[[</span>default<span class="o">]]</span>
</span><span class='line'>    <span class="o">[[[</span>child1<span class="o">]]]</span>
</span><span class='line'>      <span class="nv">parent</span> <span class="o">=</span> window0
</span><span class='line'>      <span class="nv">profile</span> <span class="o">=</span> default
</span><span class='line'>      <span class="nb">type</span> <span class="o">=</span> Terminal
</span><span class='line'>    <span class="o">[[[</span>window0<span class="o">]]]</span>
</span><span class='line'>      <span class="nv">parent</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span class='line'>      <span class="nb">type</span> <span class="o">=</span> Window
</span><span class='line'>  <span class="o">[[</span>multi<span class="o">]]</span>
</span><span class='line'>    <span class="nv">foreground_color</span> <span class="o">=</span> <span class="s2">&quot;#ffffff&quot;</span>
</span><span class='line'>    <span class="nv">palette</span> <span class="o">=</span> <span class="s2">&quot;#62b9d6:#cc0000:#4e9a06:#c4a000:#3465a4:#75507b:#06989a:#d3d7cf:#77c529:#ef2929:#8ae234:#fce94f:#729fcf:#ad7fa8:#34e2e2:#eeeeec&quot;</span>
</span><span class='line'>    <span class="o">[[[</span>child0<span class="o">]]]</span>
</span><span class='line'>      <span class="nv">order</span> <span class="o">=</span> 0
</span><span class='line'>      <span class="nv">parent</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span class='line'>      <span class="nv">position</span> <span class="o">=</span> 0:25
</span><span class='line'>      <span class="nv">size</span> <span class="o">=</span> 1366, 768
</span><span class='line'>      <span class="nb">type</span> <span class="o">=</span> Window
</span><span class='line'>    <span class="o">[[[</span>child1<span class="o">]]]</span>
</span><span class='line'>      <span class="nv">order</span> <span class="o">=</span> 0
</span><span class='line'>      <span class="nv">parent</span> <span class="o">=</span> child0
</span><span class='line'>      <span class="nv">position</span> <span class="o">=</span> 632
</span><span class='line'>      <span class="nb">type</span> <span class="o">=</span> HPaned
</span><span class='line'>    <span class="o">[[[</span>child2<span class="o">]]]</span>
</span><span class='line'>      <span class="nv">order</span> <span class="o">=</span> 0
</span><span class='line'>      <span class="nv">parent</span> <span class="o">=</span> child1
</span><span class='line'>      <span class="nv">position</span> <span class="o">=</span> 354
</span><span class='line'>      <span class="nb">type</span> <span class="o">=</span> VPaned
</span><span class='line'>    <span class="o">[[[</span>child5<span class="o">]]]</span>
</span><span class='line'>      <span class="nv">order</span> <span class="o">=</span> 1
</span><span class='line'>      <span class="nv">parent</span> <span class="o">=</span> child1
</span><span class='line'>      <span class="nv">position</span> <span class="o">=</span> 354
</span><span class='line'>      <span class="nb">type</span> <span class="o">=</span> VPaned
</span><span class='line'>    <span class="o">[[[</span>terminal3<span class="o">]]]</span>
</span><span class='line'>      <span class="nb">command</span> <span class="o">=</span> top<span class="p">;</span> bash
</span><span class='line'>      <span class="nv">order</span> <span class="o">=</span> 0
</span><span class='line'>      <span class="nv">parent</span> <span class="o">=</span> child2
</span><span class='line'>      <span class="nv">profile</span> <span class="o">=</span> default
</span><span class='line'>      <span class="nb">type</span> <span class="o">=</span> Terminal
</span><span class='line'>    <span class="o">[[[</span>terminal4<span class="o">]]]</span>
</span><span class='line'>      <span class="nb">command</span> <span class="o">=</span> uptime<span class="p">;</span> bash
</span><span class='line'>      <span class="nv">order</span> <span class="o">=</span> 1
</span><span class='line'>      <span class="nv">parent</span> <span class="o">=</span> child2
</span><span class='line'>      <span class="nv">profile</span> <span class="o">=</span> default
</span><span class='line'>      <span class="nb">type</span> <span class="o">=</span> Terminal
</span><span class='line'>    <span class="o">[[[</span>terminal6<span class="o">]]]</span>
</span><span class='line'>      <span class="nb">command</span> <span class="o">=</span> <span class="nb">cd</span> ~/workspace<span class="p">;</span> bash
</span><span class='line'>      <span class="nv">order</span> <span class="o">=</span> 0
</span><span class='line'>      <span class="nv">parent</span> <span class="o">=</span> child5
</span><span class='line'>      <span class="nv">profile</span> <span class="o">=</span> default
</span><span class='line'>      <span class="nb">type</span> <span class="o">=</span> Terminal
</span><span class='line'>    <span class="o">[[[</span>terminal7<span class="o">]]]</span>
</span><span class='line'>      <span class="nb">command</span> <span class="o">=</span> <span class="nb">cd</span> ~/workspace<span class="p">;</span> bash
</span><span class='line'>      <span class="nv">order</span> <span class="o">=</span> 1
</span><span class='line'>      <span class="nv">parent</span> <span class="o">=</span> child5
</span><span class='line'>      <span class="nv">profile</span> <span class="o">=</span> default
</span><span class='line'>      <span class="nb">type</span> <span class="o">=</span> Terminal
</span><span class='line'>  <span class="o">[[</span>simples<span class="o">]]</span>
</span><span class='line'>    <span class="o">[[[</span>child0<span class="o">]]]</span>
</span><span class='line'>      <span class="nv">order</span> <span class="o">=</span> 0
</span><span class='line'>      <span class="nv">parent</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span class='line'>      <span class="nv">position</span> <span class="o">=</span> 0:25
</span><span class='line'>      <span class="nv">size</span> <span class="o">=</span> 715, 694
</span><span class='line'>      <span class="nb">type</span> <span class="o">=</span> Window
</span><span class='line'>    <span class="o">[[[</span>child1<span class="o">]]]</span>
</span><span class='line'>      <span class="nv">order</span> <span class="o">=</span> 0
</span><span class='line'>      <span class="nv">parent</span> <span class="o">=</span> child0
</span><span class='line'>      <span class="nv">position</span> <span class="o">=</span> 348
</span><span class='line'>      <span class="nb">type</span> <span class="o">=</span> VPaned
</span><span class='line'>    <span class="o">[[[</span>terminal2<span class="o">]]]</span>
</span><span class='line'>      <span class="nb">command</span> <span class="o">=</span> <span class="nb">cd</span> ~/workspace<span class="p">;</span> bash
</span><span class='line'>      <span class="nv">order</span> <span class="o">=</span> 0
</span><span class='line'>      <span class="nv">parent</span> <span class="o">=</span> child1
</span><span class='line'>      <span class="nv">profile</span> <span class="o">=</span> default
</span><span class='line'>      <span class="nb">type</span> <span class="o">=</span> Terminal
</span><span class='line'>    <span class="o">[[[</span>terminal3<span class="o">]]]</span>
</span><span class='line'>      <span class="nb">command</span> <span class="o">=</span> <span class="nb">cd</span> ~/workspace<span class="p">;</span> bash
</span><span class='line'>      <span class="nv">order</span> <span class="o">=</span> 1
</span><span class='line'>      <span class="nv">parent</span> <span class="o">=</span> child1
</span><span class='line'>      <span class="nv">profile</span> <span class="o">=</span> default
</span><span class='line'>      <span class="nb">type</span> <span class="o">=</span> Terminal
</span><span class='line'><span class="o">[</span>plugins<span class="o">]</span>
</span><span class='line'><span class="o">[</span>profiles<span class="o">]</span>
</span><span class='line'>  <span class="o">[[</span>default<span class="o">]]</span>
</span><span class='line'>    <span class="nv">background_image</span> <span class="o">=</span> None
</span><span class='line'>    <span class="nv">icon_bell</span> <span class="o">=</span> False
</span><span class='line'>    <span class="nv">scrollback_infinite</span> <span class="o">=</span> True
</span></code></pre></td></tr></table></div></figure>


<p>And to force color prompts:</p>

<figure class='code'><figcaption><span>~/.bashrc</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">force_color_prompt</span><span class="o">=</span>yes
</span></code></pre></td></tr></table></div></figure>


<p>And my Wallpaper:</p>

<ul>
<li><a href="https://www.pixelstalk.net/wp-content/uploads/2016/03/Black-lamborghini-wallpaper-HD.jpg">Lamborghini Wallpaper</a></li>
</ul>


<h2>Other Preferred Applications:</h2>

<ul>
<li><a href="https://www.docker.com/docker-ubuntu">Docker</a> &lt;&ndash; Of course! :D</li>
<li><a href="https://linuxcontainers.org/lxd/getting-started-cli/">LXD</a></li>
<li><a href="https://www.dropbox.com/">Cloud Storage: Dropbox</a></li>
<li><a href="https://www.sublimetext.com/">Text Editor: Sublime Text</a></li>
<li><a href="https://boostnote.io/">Note Taking: Boostnote</a></li>
<li><a href="https://www.nylas.com/nylas-mail/">Mail Client: Nylas</a> and <a href="https://wiki.gnome.org/Apps/Geary">Geary</a></li>
<li><a href="https://www.jetbrains.com/pycharm/">Python IDE: PyCharm</a> (however, I prefer to use VIM :D )</li>
<li><p><a href="https://netbeans.org/">Java IDE: Netbeans</a></p></li>
<li><p>Sysadmin Tools: (htop, netstat, tcpdump, nmap, vnstat, mysql-client, mongo-client, curl, nload, etc)</p></li>
</ul>


<p>I will update this page as I&rsquo;m getting new apps or modifications</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/10/11/display-php-content-through-html-files/">Display PHP Content Through HTML Files</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-10-11T02:43:55-04:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>11</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>2:43 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>While I was working with a root index page which is in <code>HTML</code> that had <code>PHP</code> content in, it did not render all of the <code>PHP</code> and some content was displayed as text, instead of rendered.</p>

<h2>The Issue:</h2>

<p>Some <code>PHP</code> content not rendered, as I am seeing this at the top of the page as plain text:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="p">;</span> <span class="nx">somePhpFunction</span><span class="p">();</span> <span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<h2>My Nginx Config:</h2>

<figure class='code'><figcaption><span>nginx.conf</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>http <span class="o">{</span>
</span><span class='line'>    include                     /etc/nginx/mime.types<span class="p">;</span>
</span><span class='line'>    default_type                application/octet-stream<span class="p">;</span>
</span><span class='line'>    sendfile                    on<span class="p">;</span>
</span><span class='line'>    access_log                  /var/log/nginx/access.log<span class="p">;</span>
</span><span class='line'>    keepalive_timeout           3000<span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    proxy_cache_path /var/cache/nginx/ <span class="nv">levels</span><span class="o">=</span>1:2 <span class="nv">keys_zone</span><span class="o">=</span>nginx_cache:10m <span class="nv">max_size</span><span class="o">=</span>16m <span class="nv">inactive</span><span class="o">=</span>60m<span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    server <span class="o">{</span>
</span><span class='line'>        listen                  80<span class="p">;</span>
</span><span class='line'>        root                    /www<span class="p">;</span>
</span><span class='line'>        index                   index.php index.html index.htm<span class="p">;</span>
</span><span class='line'>        server_name             _<span class="p">;</span>
</span><span class='line'>        client_max_body_size    32m<span class="p">;</span>
</span><span class='line'>        error_page              <span class="m">500</span> <span class="m">502</span> <span class="m">503</span> <span class="m">504</span>  /50x.html<span class="p">;</span>
</span><span class='line'>        proxy_cache       nginx_cache<span class="p">;</span>
</span><span class='line'>        add_header        X-Proxy-Cache <span class="s2">&quot;public&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nv">location</span> <span class="o">=</span> /50x.html <span class="o">{</span>
</span><span class='line'>              root              /var/lib/nginx/html<span class="p">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        location ~ <span class="se">\.</span>php<span class="nv">$ </span><span class="o">{</span>
</span><span class='line'>              fastcgi_pass      127.0.0.1:9000<span class="p">;</span>
</span><span class='line'>              fastcgi_index     index.php<span class="p">;</span>
</span><span class='line'>              include           fastcgi.conf<span class="p">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>The Fix:</h2>

<p>a <code>.htaccess</code> had to be placed in my root directory of the website:</p>

<figure class='code'><figcaption><span>.htaccess</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>AddType application/x-httpd-php .html .htm
</span></code></pre></td></tr></table></div></figure>


<p>After that was in place, all of the <code>PHP</code> was rendered</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/10/09/sending-mail-with-ssmtp-on-alpine-linux/">Sending Mail With SSMTP on Alpine Linux</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-10-09T16:36:35-04:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>9</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>4:36 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Quick Post on how to use ssmtp on Alpine Linux to Send Mail:</p>

<h2>Update and Install SSMTP</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>apk update
</span><span class='line'><span class="nv">$ </span>apk add ssmtp
</span></code></pre></td></tr></table></div></figure>


<h2>Configure SSMTP</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>cat &gt; /etc/ssmtp/ssmtp.conf <span class="s">&lt;&lt; EOF</span>
</span><span class='line'><span class="s">root=postmaster</span>
</span><span class='line'><span class="s">mailhub=mail.domain.com:25</span>
</span><span class='line'><span class="s">hostname=`hostname`</span>
</span><span class='line'><span class="s">FromLineOverride=YES</span>
</span><span class='line'><span class="s">EOF</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Create the Mail Content</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>cat &gt; mail.txt <span class="s">&lt;&lt; EOF</span>
</span><span class='line'><span class="s">To: recipient@domain.com</span>
</span><span class='line'><span class="s">From: sender@domain.com</span>
</span><span class='line'><span class="s">Subject: Mail with SSMTP</span>
</span><span class='line'>
</span><span class='line'><span class="s">Hello, this is a test mail.</span>
</span><span class='line'><span class="s">EOF</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Testing Mail Delivery</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>ssmtp recipient@domain.com &lt; file.txt
</span></code></pre></td></tr></table></div></figure>


<h2>Related:</h2>

<ul>
<li><a href="https://support.cloud.engineyard.com/hc/en-us/articles/205407478-Set-Up-SSMTP-for-Mail-Relay-to-AuthSMTP">Using Gmail as a Relay Host</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/10/03/backup-and-restore-mutliple-collections-from-a-database-with-mongodb/">Backup and Restore Mutliple Collections From a Database With MongoDB</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-10-03T16:42:34-04:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>3</span><span class='date-suffix'>rd</span>, <span class='date-year'>2017</span></span> <span class='time'>4:42 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>From a previous post we&rsquo;ve  <a href="http://blog.ruanbekker.com/blog/2017/09/02/setup-a-3-node-mongodb-replica-set-on-ubuntu-16/">Setup a MongoDB Cluster</a>, and in this post we will go through the steps of backing up a database and restoring it to another mongodb cluster.</p>

<p><a href="http://mlab.com/">MLab</a> offers a free Shared MongoDB Hosted Service with a limitation of 500MB, which I will be using to restore my data from my own hosted cluster to the free MLab service.</p>

<h2>Create the MongoDB Backup</h2>

<p>First we will need to create our backup path, and then backup our database, in my case, I am backing up my <code>rocketchat</code> database:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>mkdir -p /opt/backups/mongodb
</span><span class='line'><span class="nv">$ </span>mongodump --host mongodb.example.com --port <span class="m">27017</span> -u &lt;mongouser&gt; --authenticationDatabase &lt;authdb&gt; --db rocketchat --out /opt/backups/mongodb/
</span></code></pre></td></tr></table></div></figure>


<p>Change into the backup directory:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span><span class="nb">cd</span> /opt/backups/mongodb/rocketchat/
</span></code></pre></td></tr></table></div></figure>


<p>You will find the <code>bson</code> and <code>json metadata</code> files for each collection:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>ls -l <span class="p">|</span> awk <span class="s1">&#39;{print $9}&#39;</span> <span class="p">|</span> head -9
</span><span class='line'>custom_emoji.chunks.bson
</span><span class='line'>custom_emoji.chunks.metadata.json
</span><span class='line'>custom_emoji.files.bson
</span><span class='line'>custom_emoji.files.metadata.json
</span><span class='line'>instances.bson
</span><span class='line'>instances.metadata.json
</span><span class='line'>meteor_accounts_loginServiceConfiguration.bson
</span><span class='line'>meteor_accounts_loginServiceConfiguration.metadata.json
</span><span class='line'>...
</span></code></pre></td></tr></table></div></figure>


<h2>Restore MongoDB Database</h2>

<p>We will need to restore all the collections to our new mongodb service, I have created a bash script (<code>restore-mongodb.sh</code>) that will restore each collection to our <code>rocketchat</code> database:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/usr/bin/env bash</span>
</span><span class='line'>
</span><span class='line'><span class="nv">mongo_user</span><span class="o">=</span>&lt;mongouser&gt;
</span><span class='line'><span class="nv">mongo_pass</span><span class="o">=</span>&lt;mongopass&gt;
</span><span class='line'>
</span><span class='line'><span class="k">for</span> file in <span class="sb">`</span>ls <span class="p">|</span> grep bson<span class="sb">`</span>
</span><span class='line'>  <span class="k">do</span>
</span><span class='line'>    <span class="k">for</span> collection in <span class="sb">`</span><span class="nb">echo</span> <span class="nv">$file</span> <span class="p">|</span> sed <span class="s1">&#39;s/.bson//g&#39;</span><span class="sb">`</span>
</span><span class='line'>  <span class="k">do</span>
</span><span class='line'>    mongorestore --host mymongoid.mlab.com --port <span class="m">12345</span> -u <span class="nv">$mongo_user</span> -p <span class="nv">$mongo_pass</span> -d rocketchat -c <span class="nv">$collection</span> <span class="nv">$file</span>
</span><span class='line'>    sleep 2
</span><span class='line'>  <span class="k">done</span>
</span><span class='line'><span class="k">done</span>
</span></code></pre></td></tr></table></div></figure>


<p>Change the permissions of your script to make it executable and execute the script:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>chmod +x restore-mongodb.sh
</span><span class='line'><span class="nv">$ </span>./restore-mongodb.sh
</span><span class='line'>
</span><span class='line'>2017-10-03T22:05:39.138+0200    checking <span class="k">for</span> collection data in custom_emoji.chunks.bson
</span><span class='line'>2017-10-03T22:05:39.159+0200    reading metadata <span class="k">for</span> rocketchat.custom_emoji.chunks from custom_emoji.chunks.metadata.json
</span><span class='line'>2017-10-03T22:05:39.211+0200    restoring rocketchat.custom_emoji.chunks from custom_emoji.chunks.bson
</span><span class='line'>2017-10-03T22:05:39.900+0200    restoring indexes <span class="k">for</span> collection rocketchat.custom_emoji.chunks from metadata
</span><span class='line'>2017-10-03T22:05:39.922+0200    finished restoring rocketchat.custom_emoji.chunks <span class="o">(</span><span class="m">20</span> documents<span class="o">)</span>
</span><span class='line'>2017-10-03T22:05:39.922+0200    <span class="k">done</span>
</span><span class='line'>2017-10-03T22:05:42.188+0200    checking <span class="k">for</span> collection data in custom_emoji.files.bson
</span><span class='line'>2017-10-03T22:05:42.231+0200    reading metadata <span class="k">for</span> rocketchat.custom_emoji.files from custom_emoji.files.metadata.json
</span><span class='line'>2017-10-03T22:05:42.252+0200    restoring rocketchat.custom_emoji.files from custom_emoji.files.bson
</span><span class='line'>2017-10-03T22:05:42.623+0200    restoring indexes <span class="k">for</span> collection rocketchat.custom_emoji.files from metadata
</span><span class='line'>2017-10-03T22:05:42.645+0200    finished restoring rocketchat.custom_emoji.files <span class="o">(</span><span class="m">20</span> documents<span class="o">)</span>
</span><span class='line'>2017-10-03T22:05:42.645+0200    <span class="k">done</span>
</span><span class='line'>...
</span></code></pre></td></tr></table></div></figure>


<h2>Checkout the New MongoDB Database:</h2>

<p>Once the restore has been done, logon to your new mongodb database and have a look at the collections in the database:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>mongo mymongoid.mlab.com:12345/rocketchat -u &lt;mongouser&gt; -p
</span><span class='line'>MongoDB shell version v3.4.7
</span><span class='line'>Enter password:
</span><span class='line'>connecting to: mongodb://mymongoid.mlab.com:12345/rocketchat
</span><span class='line'>MongoDB server version: 3.4.9
</span><span class='line'>
</span><span class='line'>rs-mymongoid:PRIMARY&gt; show collections
</span><span class='line'>_raix_push_app_tokens
</span><span class='line'>_raix_push_notifications
</span><span class='line'>custom_emoji.chunks
</span><span class='line'>custom_emoji.files
</span><span class='line'>instances
</span></code></pre></td></tr></table></div></figure>


<h2>Resources:</h2>

<ul>
<li><a href="https://docs.mongodb.com/manual/reference/program/mongodump/">https://docs.mongodb.com/manual/reference/program/mongodump/</a></li>
<li><a href="https://docs.mongodb.com/manual/reference/program/mongorestore/">https://docs.mongodb.com/manual/reference/program/mongorestore/</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/09/24/creating-a-nodejs-hostname-app-with-docker-stacks-on-swarm/">Creating a Nodejs Hostname App With Docker Stacks on Swarm</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-09-24T17:52:51-04:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>24</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>5:52 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Create a Nodejs Application that responds GET requests with its Hostname.</p>

<p>Our nodejs application will sit beind a HAProxy Load Balancer, we are mounting the <code>docker.sock</code> from the host to the container, so as we scale our web application, our load balancer is aware of the changes, and scales as we scale our web application.</p>

<h2>Creating the Application:</h2>

<p>Our nodejs application:</p>

<figure class='code'><figcaption><span>app.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">os</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;os&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span> <span class="s1">&#39;text/html&#39;</span><span class="p">});</span>
</span><span class='line'>    <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="err">`</span><span class="nx">My</span> <span class="nx">Hostname</span><span class="o">:</span> <span class="nx">$</span><span class="p">{</span><span class="nx">os</span><span class="p">.</span><span class="nx">hostname</span><span class="p">()}</span><span class="err">\</span><span class="nx">n</span><span class="err">`</span><span class="p">);</span>
</span><span class='line'><span class="p">}).</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8080</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Our Dockerfile:</p>

<figure class='code'><figcaption><span>Dockerfile</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='docker'><span class='line'><span class="k">FROM</span> node:alpine
</span><span class='line'><span class="k">ADD</span> app.js /app.js
</span><span class='line'><span class="k">CMD</span> <span class="o">[</span><span class="s2">&quot;node&quot;</span>, <span class="s2">&quot;/app.js&quot;</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Build and Push to your registry, or you could use my image on Dockerhub: <a href="https://hub.docker.com/r/rbekker87/node-containername/">hub.docker.com/r/rbekker87/node-containername</a></p>

<figure class='code'><figcaption><span>Build and Push</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker login
</span><span class='line'><span class="nv">$ </span>docker build -t &lt;username&gt;/&lt;repo&gt;:&lt;tag&gt; .
</span><span class='line'><span class="nv">$ </span>docker push  &lt;username&gt;/&lt;repo&gt;:&lt;tag&gt;
</span></code></pre></td></tr></table></div></figure>


<h2>Creating the Compose file</h2>

<p>Create the compose file that will define our services:</p>

<figure class='code'><figcaption><span>docker-compose.yml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>version: <span class="s1">&#39;3&#39;</span>
</span><span class='line'>
</span><span class='line'>services:
</span><span class='line'>  node-app:
</span><span class='line'>    image: rbekker87/node-containername
</span><span class='line'>    networks:
</span><span class='line'>      - nodenet
</span><span class='line'>    environment:
</span><span class='line'>      - <span class="nv">SERVICE_PORTS</span><span class="o">=</span>8080
</span><span class='line'>    deploy:
</span><span class='line'>      replicas: 20
</span><span class='line'>      update_config:
</span><span class='line'>        parallelism: 5
</span><span class='line'>        delay: 10s
</span><span class='line'>      restart_policy:
</span><span class='line'>        condition: on-failure
</span><span class='line'>        max_attempts: 3
</span><span class='line'>        window: 120s
</span><span class='line'>
</span><span class='line'>  loadbalancer:
</span><span class='line'>    image: dockercloud/haproxy:latest
</span><span class='line'>    depends_on:
</span><span class='line'>      - node-app
</span><span class='line'>    environment:
</span><span class='line'>      - <span class="nv">BALANCE</span><span class="o">=</span>leastconn
</span><span class='line'>    volumes:
</span><span class='line'>      - /var/run/docker.sock:/var/run/docker.sock
</span><span class='line'>    ports:
</span><span class='line'>      - 80:80
</span><span class='line'>    networks:
</span><span class='line'>      - nodenet
</span><span class='line'>    deploy:
</span><span class='line'>      placement:
</span><span class='line'>        constraints: <span class="o">[</span>node.role <span class="o">==</span> manager<span class="o">]</span>
</span><span class='line'>
</span><span class='line'>networks:
</span><span class='line'>  nodenet:
</span><span class='line'>    driver: overlay
</span></code></pre></td></tr></table></div></figure>


<h2>Create the Stack:</h2>

<p>Deploy the Stack by specifying the compose file and name of our stack:</p>

<figure class='code'><figcaption><span>Deploy our Stack</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker stack deploy -c docker-compose.yml node
</span></code></pre></td></tr></table></div></figure>


<p>List the Services in the Stack:</p>

<figure class='code'><figcaption><span>List Services in our Stack</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker stack ls
</span><span class='line'>NAME                SERVICES
</span><span class='line'>node                2
</span></code></pre></td></tr></table></div></figure>


<p>List the Tasks in the Stack:</p>

<figure class='code'><figcaption><span>Tasks in our Stack</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker stack ps node
</span><span class='line'>ID                  NAME                  IMAGE                                 NODE     DESIRED STATE       CURRENT STATE            ERROR               PORTS
</span><span class='line'>l5ryfaedzzaq        node_loadbalancer.1   dockercloud/haproxy:latest            dsm-01   Running             Running <span class="m">40</span> minutes ago
</span><span class='line'>c8nrrcvek79h        node_node-app.5       rbekker87/node-containername:latest   dsm-01   Running             Running <span class="m">40</span> minutes ago
</span><span class='line'>dqii18b2q5nn        node_node-app.10      rbekker87/node-containername:latest   dsm-01   Running             Running <span class="m">40</span> minutes ago
</span><span class='line'>vkpw2rugy0ah        node_node-app.11      rbekker87/node-containername:latest   dsm-01   Running             Running <span class="m">40</span> minutes ago
</span><span class='line'>mm88nvnvy5lg        node_node-app.12      rbekker87/node-containername:latest   dsm-01   Running             Running <span class="m">40</span> minutes ago
</span><span class='line'>oyx8rfqc1xl2        node_node-app.16      rbekker87/node-containername:latest   dsm-01   Running             Running <span class="m">41</span> minutes ago
</span></code></pre></td></tr></table></div></figure>


<h2>Test out our Application</h2>

<p>Test out the Service:</p>

<figure class='code'><figcaption><span>GET Requests</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>curl -XGET http://127.0.0.1/
</span><span class='line'>My Hostname: a6e34246e73b
</span><span class='line'>
</span><span class='line'><span class="nv">$ </span>curl -XGET http://127.0.0.1/
</span><span class='line'>My Hostname: 5de71278be38
</span><span class='line'>
</span><span class='line'><span class="nv">$ </span>curl -XGET http://127.0.0.1/
</span><span class='line'>My Hostname: e0b7316fdd51
</span></code></pre></td></tr></table></div></figure>


<h2>Scaling Out:</h2>

<p>Scale our Application out to 30 replica&rsquo;s</p>

<figure class='code'><figcaption><span>Scaling Up</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker service scale node-app<span class="o">=</span>30
</span></code></pre></td></tr></table></div></figure>


<p>Scale our Application down to 10 replica&rsquo;s</p>

<figure class='code'><figcaption><span>Scaling Down</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker service scale node-app<span class="o">=</span>10
</span></code></pre></td></tr></table></div></figure>


<h2>Cleanup</h2>

<p>Remove the Stack:</p>

<figure class='code'><figcaption><span>Delete the Stack</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker stack rm node
</span><span class='line'>Removing service node_loadbalancer
</span><span class='line'>Removing service node_node-app
</span><span class='line'>Removing network node_nodenet
</span></code></pre></td></tr></table></div></figure>


<h2>Resources:</h2>

<ul>
<li><a href="https://github.com/ruanbekker/docker-node-containername">https://github.com/ruanbekker/docker-node-containername</a></li>
<li><a href="https://hub.docker.com/r/rbekker87/node-containername/">https://hub.docker.com/r/rbekker87/node-containername/</a></li>
<li><a href="https://medium.com/@nirgn/load-balancing-applications-with-haproxy-and-docker-d719b7c5b231">Resource 1</a> + <a href="http://anokun7.github.io/microservices-demo/">Resource 2</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/09/24/create-a-3-node-elasticsearch-stack-with-haproxy-on-docker-swarm/">Create a 3 Node Elasticsearch Stack With HAProxy on Docker Swarm</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-09-24T15:40:19-04:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>24</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>3:40 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Tried out creating a 3 node elasticsearch stack on docker swarm using docker-compose, that sits behind a haproxy service.</p>

<h2>Environment:</h2>

<p>Images:</p>

<ul>
<li><a href="https://hub.docker.com/r/dockercloud/haproxy/">dockercloud/haproxy</a></li>
<li><a href="https://github.com/ruanbekker/docker-elasticsearch">rbekker87/elasticsearch:master-5.6-alpine</a></li>
</ul>


<p>Stack:</p>

<ul>
<li>1 x haproxy</li>
<li>1 x elasticsearch master (haproxy wont send requests to this one)</li>
<li>2 x elasticsearch master/data</li>
<li>1 x esnet overlay network</li>
</ul>


<h2>Defining our Stack</h2>

<p>First we will create our compose file, which we will call <code>es-compose.yml</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">version</span><span class="p-Indicator">:</span> <span class="s">&#39;3&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">services</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">es-master</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">image</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">rbekker87/elasticsearch:master-5.6-alpine</span>
</span><span class='line'>    <span class="l-Scalar-Plain">networks</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">esnet</span>
</span><span class='line'>    <span class="l-Scalar-Plain">deploy</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="l-Scalar-Plain">replicas</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">1</span>
</span><span class='line'>
</span><span class='line'>  <span class="l-Scalar-Plain">es-data-1</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">image</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">rbekker87/elasticsearch:master-5.6-alpine</span>
</span><span class='line'>    <span class="l-Scalar-Plain">environment</span><span class="p-Indicator">:</span>
</span><span class='line'>     <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">SERVICE_PORTS=9200</span>
</span><span class='line'>    <span class="l-Scalar-Plain">networks</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">esnet</span>
</span><span class='line'>    <span class="l-Scalar-Plain">deploy</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="l-Scalar-Plain">replicas</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">2</span>
</span><span class='line'>
</span><span class='line'>  <span class="l-Scalar-Plain">es-data-2</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">image</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">rbekker87/elasticsearch:master-5.6-alpine</span>
</span><span class='line'>    <span class="l-Scalar-Plain">environment</span><span class="p-Indicator">:</span>
</span><span class='line'>     <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">SERVICE_PORTS=9200</span>
</span><span class='line'>    <span class="l-Scalar-Plain">networks</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">esnet</span>
</span><span class='line'>    <span class="l-Scalar-Plain">deploy</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="l-Scalar-Plain">replicas</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">2</span>
</span><span class='line'>
</span><span class='line'>  <span class="l-Scalar-Plain">loadbalancer</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">image</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">dockercloud/haproxy:latest</span>
</span><span class='line'>    <span class="l-Scalar-Plain">depends_on</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">es-data-1</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">es-data-2</span>
</span><span class='line'>    <span class="l-Scalar-Plain">environment</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">BALANCE=leastconn</span>
</span><span class='line'>    <span class="l-Scalar-Plain">volumes</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">/var/run/docker.sock:/var/run/docker.sock</span>
</span><span class='line'>    <span class="l-Scalar-Plain">ports</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">9200:80</span>
</span><span class='line'>    <span class="l-Scalar-Plain">networks</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">esnet</span>
</span><span class='line'>    <span class="l-Scalar-Plain">deploy</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="l-Scalar-Plain">placement</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">constraints</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">node.role == manager</span><span class="p-Indicator">]</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">networks</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">esnet</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">driver</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">overlay</span>
</span></code></pre></td></tr></table></div></figure>


<p>The above compose file defines that we want a overlay network, which we will associate with all our services, 3 elasticsearch services, haproxy service which will expose port 9200, then from haproxy it has a container port of 80, which sends to the backend <code>SERVICE_PORTS</code> of each elasticsearch service.</p>

<p>We have only defined <code>SERVICE_PORTS=9200</code> on our es-data services, as I just want to proxy client connections to them.</p>

<h2>Creating our Elasticsearch Stack</h2>

<p>Now that we have our compose file ready, let&rsquo;s create our stack using <code>docker stack deploy</code>:</p>

<figure class='code'><figcaption><span>Create the Stack</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker stack deploy -c es-compose.yml analytics
</span><span class='line'>
</span><span class='line'>Creating network analytics_esnet
</span><span class='line'>Creating service analytics_loadbalancer
</span><span class='line'>Creating service analytics_es-master
</span><span class='line'>Creating service analytics_es-data-1
</span><span class='line'>Creating service analytics_es-data-2
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s have a look at our stack:</p>

<figure class='code'><figcaption><span>Docker Stack Status </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker stack ps analytics
</span><span class='line'>ID                  NAME                       IMAGE                                       NODE                  DESIRED STATE       CURRENT STATE            ERROR               PORTS
</span><span class='line'>4t3ukxl2kch3        analytics_loadbalancer.1   dockercloud/haproxy:latest                  scw-swarm-master-01   Running             Running <span class="m">27</span> seconds ago
</span><span class='line'>jgbxtgqkg9jp        analytics_es-data-2.1      rbekker87/elasticsearch:master-5.6-alpine   scw-swarm-master-01   Running             Running <span class="m">33</span> seconds ago
</span><span class='line'>x5cq6pm7u7mn        analytics_es-data-1.1      rbekker87/elasticsearch:master-5.6-alpine   scw-swarm-master-01   Running             Running <span class="m">36</span> seconds ago
</span><span class='line'>5v22w1hvtdvm        analytics_es-master.1      rbekker87/elasticsearch:master-5.6-alpine   scw-swarm-master-01   Running             Running <span class="m">38</span> seconds ago
</span></code></pre></td></tr></table></div></figure>


<p>View the logs of our haproxy service:</p>

<figure class='code'><figcaption><span>HAProxy Service Logs</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker service logs -f analytics_loadbalancer
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> INFO:haproxy:dockercloud/haproxy 1.6.7 is running outside Docker Cloud
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> INFO:haproxy:Haproxy is running in SwarmMode, loading HAProxy definition through docker api
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> INFO:haproxy:dockercloud/haproxy PID: 7
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> INFO:haproxy:<span class="o">=</span>&gt; Add task: Initial start - Swarm Mode
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> INFO:haproxy:<span class="o">=</span>&gt; Executing task: Initial start - Swarm Mode
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> INFO:haproxy:<span class="o">==========</span><span class="nv">BEGIN</span><span class="o">==========</span>
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> INFO:haproxy:Linked service: analytics_es-data-1, analytics_es-data-2, analytics_es-master
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> INFO:haproxy:Linked container: analytics_es-data-1.1.u641c5bq5vkjklk8sb1scnnlc, analytics_es-data-2.1.ic9an6bzj6aejs0lx0vzfpia6, analytics_es-master.1.h4erlgwzit509p0zehzmozy3u
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> INFO:haproxy:HAProxy configuration:
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> global
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   log 127.0.0.1 local0
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   log 127.0.0.1 local1 notice
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   log-send-hostname
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   maxconn 4096
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   pidfile /var/run/haproxy.pid
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   user haproxy
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   group haproxy
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   daemon
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   stats socket /var/run/haproxy.stats level admin
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   ssl-default-bind-options no-sslv3
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   ssl-default-bind-ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:AES128-GCM-SHA256:AES128-SHA256:AES128-SHA:AES256-GCM-SHA384:AES256-SHA256:AES256-SHA:DHE-DSS-AES128-SHA:DES-CBC3-SHA
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> defaults
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   balance leastconn
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   log global
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   mode http
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   option redispatch
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   option httplog
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   option dontlognull
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   option forwardfor
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   timeout connect 5000
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   timeout client 50000
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   timeout server 50000
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> listen stats
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   <span class="nb">bind</span> :1936
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   mode http
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   stats <span class="nb">enable</span>
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   timeout connect 10s
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   timeout client 1m
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   timeout server 1m
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   stats hide-version
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   stats realm Haproxy<span class="se">\ </span>Statistics
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   stats uri /
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   stats auth stats:stats
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> frontend default_port_80
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   <span class="nb">bind</span> :80
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   reqadd X-Forwarded-Proto:<span class="se">\ </span>http
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   maxconn 4096
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   default_backend default_service
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> backend default_service
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   server analytics_es-data-1.1.u641c5bq5vkjklk8sb1scnnlc 10.0.7.5:9200 check inter <span class="m">2000</span> rise <span class="m">2</span> fall 3
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   server analytics_es-data-2.1.ic9an6bzj6aejs0lx0vzfpia6 10.0.7.7:9200 check inter <span class="m">2000</span> rise <span class="m">2</span> fall 3
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> INFO:haproxy:Launching HAProxy
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> INFO:haproxy:HAProxy has been launched<span class="o">(</span>PID: 10<span class="o">)</span>
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> INFO:haproxy:<span class="o">===========</span><span class="nv">END</span><span class="o">===========</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Testing Elasticsearch:</h2>

<p>Do a GET request on our HAProxy&rsquo;s Expose port: 9200</p>

<figure class='code'><figcaption><span>Test Elasticsearch on port 9200</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>curl -XGET http://127.0.0.1:9200
</span><span class='line'><span class="o">{</span>
</span><span class='line'>  <span class="s2">&quot;name&quot;</span> : <span class="s2">&quot;5306a0c2ee24&quot;</span>,
</span><span class='line'>  <span class="s2">&quot;cluster_name&quot;</span> : <span class="s2">&quot;es-cluster&quot;</span>,
</span><span class='line'>  <span class="s2">&quot;cluster_uuid&quot;</span> : <span class="s2">&quot;FUJmMekFQVq6zXofPCin2A&quot;</span>,
</span><span class='line'>  <span class="s2">&quot;version&quot;</span> : <span class="o">{</span>
</span><span class='line'>    <span class="s2">&quot;number&quot;</span> : <span class="s2">&quot;5.6.0&quot;</span>,
</span><span class='line'>    <span class="s2">&quot;build_hash&quot;</span> : <span class="s2">&quot;781a835&quot;</span>,
</span><span class='line'>    <span class="s2">&quot;build_date&quot;</span> : <span class="s2">&quot;2017-09-07T03:09:58.087Z&quot;</span>,
</span><span class='line'>    <span class="s2">&quot;build_snapshot&quot;</span> : <span class="nb">false</span>,
</span><span class='line'>    <span class="s2">&quot;lucene_version&quot;</span> : <span class="s2">&quot;6.6.0&quot;</span>
</span><span class='line'>  <span class="o">}</span>,
</span><span class='line'>  <span class="s2">&quot;tagline&quot;</span> : <span class="s2">&quot;You Know, for Search&quot;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Have a look at the <code>/_cat/nodes</code> API:</p>

<figure class='code'><figcaption><span>Get the Node Info</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span> curl -XGET http://127.0.0.1:9200/_cat/nodes?v
</span><span class='line'>ip       heap.percent ram.percent cpu load_1m load_5m load_15m node.role master name
</span><span class='line'>10.0.7.6           <span class="m">28</span>          <span class="m">84</span>  <span class="m">14</span>    3.09    2.28     1.49 mdi       -      56c1b0aebc5f
</span><span class='line'>10.0.7.2           <span class="m">27</span>          <span class="m">84</span>  <span class="m">15</span>    3.09    2.28     1.49 mdi       *      572c68bca904
</span><span class='line'>10.0.7.4           <span class="m">29</span>          <span class="m">84</span>  <span class="m">15</span>    3.09    2.28     1.49 mdi       -      5306a0c2ee24
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/09/24/simple-program-with-c-language-on-linux/">Simple Program With C Language on Linux</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-09-24T06:41:58-04:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>24</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>6:41 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Today the idea popped up on how to write a Simple &ldquo;Hello World&rdquo; Application using C Programming Language, as I just wanted to see how it works.</p>

<h2>Requirements:</h2>

<p>You will need the <code>gcc</code> package to compile the program:</p>

<figure class='code'><figcaption><span>RHEL</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>yum install gcc -y
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Debian</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>apt install gcc -y
</span></code></pre></td></tr></table></div></figure>


<h2>Writing our first Program:</h2>

<p>We will create a app that just prints out a static defined value:</p>

<p>Create any file with a <code>.c</code> extension, in my case it will be <code>app.c</code>:</p>

<figure class='code'><figcaption><span>app.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
</span><span class='line'>    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Hello, World</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now compile <code>app.c</code> with <code>gcc</code> and specify the output path of your app with <code>-o &lt;app-name&gt;</code></p>

<figure class='code'><figcaption><span>app.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="err">$</span> <span class="n">gcc</span> <span class="o">-</span><span class="n">o</span> <span class="n">app</span> <span class="n">app</span><span class="p">.</span><span class="n">c</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Testing our App:</h2>

<p>You will see that there is a executable file with the name that you have specified as the output:</p>

<figure class='code'><figcaption><span>app.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="err">$</span> <span class="p">.</span><span class="o">/</span><span class="n">app</span>
</span><span class='line'><span class="n">Hello</span><span class="p">,</span> <span class="n">World</span>
</span></code></pre></td></tr></table></div></figure>


<p>Really basic, but quite cool.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/11">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/9">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2018/08/21/send-emails-using-python-and-sendgrid-using-smtplib/">Send Emails Using Python and Sendgrid Using SMTPlib</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/08/20/using-iam-authentication-with-amazon-elasticsearch-service/">Using IAM Authentication With Amazon Elasticsearch Service</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/08/15/get-blogpost-titles-links-and-tags-from-a-rss-link-using-python-feedparser/">Get Blogpost Titles Links and Tags From a RSS Link Using Python Feedparser</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/08/14/tutorial-on-dynamodb-using-bash-and-the-aws-cli-tools-to-interact-with-a-music-dataset/">Tutorial on DynamoDB Using Bash and the AWS CLI Tools to Interact With a Music Dataset</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/08/09/ruby-tutorial-series-setup-and-variables/">Ruby Tutorial Series Setup and Variables</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2018 - Ruan -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>



  <li>
    <a href="https://twitter.com/ruanbekker">
      <i class="fa fa-twitter"></i> Twitter
    </a>
  </li>



  <li>
    <a href="https://github.com/ruanbekker">
      <i class="fa fa-github"></i> GitHub
    </a>
  </li>



  <li>
    <a href="https://sysadmins.co.za">
      <i class="fa fa-bars"></i> My HowTo Blog
    </a>
  </li>


</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'blog-ruanbekker';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
