
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Ruan Bekker's Blog</title>
  <meta name="author" content="Ruan">

  
  <meta name="description" content="In this post we will cover a lightweight development kubernetes called, &ldquo;k3d&rdquo; which we will deploy on a mac. What is k3d k3d is a binary &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">


  <!-- font awesome --!>
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

  <!-- samwize.com/2012/09/24/octopress-table-stylesheet --!>
  <link href="/stylesheets/data-table.css" media="screen, projection" rel="stylesheet" type="text/css" />

  
  <link rel="canonical" href="https://blog.ruanbekker.com/posts/2/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Ruan Bekker's Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-105336110-1']);
    _gaq.push(['_setDomainName','ruanbekker.com']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


  <!-- Matomo -->
<script type="text/javascript">
  var _paq = window._paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//piwik.ruan.dev/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '3']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<!-- End Matomo Code -->

  <!-- Twitter cards # www.brianbunke.com/blog/2017/09/06/twitter-cards-on-jekyll -->
<meta name="twitter:site"    content="@ruanbekker">
<meta name="twitter:creator" content="@">
<meta name="twitter:title"   content="">


<meta name="twitter:description" content="">



<meta name="twitter:card"  content="summary">
<meta name="twitter:image" content="https://user-images.githubusercontent.com/567298/69000657-c093e780-08db-11ea-8464-bcd3023e9923.png">

<!-- end of Twitter cards -->

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Ruan Bekker's Blog</a></h1>
  
    <h2>From a Curious mind to Posts on Github</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://blog.ruanbekker.com/search/" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="blog.ruanbekker.com">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/blog/categories/aws/">AWS</a></li>
  <li><a href="/blog/categories/docker/">Docker</a></li>
  <li><a href="/blog/categories/devops/">DevOps</a></li>
  <li><a href="/blog/categories/python/">Python</a></li>
  <li><a target="_blank" href="https://sysadmins.co.za">My Sysadmins Blog</a></li>
  <li><a href="https://ruan.dev/">About Me</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2020/02/12/lightweight-development-kubernetes-options-k3d/">Lightweight Development Kubernetes Options: K3d</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2020-02-12T00:27:00+02:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>12</span><span class='date-suffix'>th</span>, <span class='date-year'>2020</span></span> <span class='time'>12:27 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In this post we will cover a lightweight development kubernetes called, &ldquo;<a href="https://github.com/rancher/k3d">k3d</a>&rdquo; which we will deploy on a mac.</p>

<h2>What is k3d</h2>

<p><a href="https://github.com/rancher/k3d">k3d</a> is a binary that provisions a <a href="https://github.com/rancher/k3s">k3s</a> kubernetes cluster on docker</p>

<h2>Pre-Requirements</h2>

<p>You will require docker and we will be using brew to install k3d on a mac.</p>

<h2>Install k3d</h2>

<p>Installing k3d is as easy as:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>brew install k3d
</span></code></pre></td></tr></table></div></figure>


<p>Verify your installation:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>k3d --version
</span><span class='line'>k3d version v1.3.1
</span></code></pre></td></tr></table></div></figure>


<h2>Deploy a 3 Node Cluster</h2>

<p>Using k3d, we will deploy a 3 node k3s cluster:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>k3d create --name<span class="o">=</span><span class="s2">&quot;demo&quot;</span> --workers<span class="o">=</span><span class="s2">&quot;2&quot;</span> --publish<span class="o">=</span><span class="s2">&quot;80:80&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>This will deploy a master and 2 worker nodes and we will also publish our host port 80 to our container port 80 (k3s comes default with traefik)</p>

<p>Set your kubeconfig:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span><span class="nb">export </span><span class="nv">KUBECONFIG</span><span class="o">=</span><span class="s2">&quot;$(k3d get-kubeconfig --name=&#39;demo&#39;)&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Test it out by listing your nodes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>kubectl get nodes
</span><span class='line'>NAME                STATUS   ROLES    AGE    VERSION
</span><span class='line'>k3d-demo-server     Ready    master   102s   v1.14.6-k3s.1
</span><span class='line'>k3d-demo-worker-0   Ready    worker   102s   v1.14.6-k3s.1
</span><span class='line'>k3d-demo-worker-1   Ready    worker   102s   v1.14.6-k3s.1
</span></code></pre></td></tr></table></div></figure>


<p>That was easy right?</p>

<h2>Deploy a Sample App</h2>

<p>We will deploy a simple golang web application that will return the container name upon a http request. We will also make use of the traefik ingress for demonstration.</p>

<p>Our deployment manifest that I will save as <code>app.yml</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">apiVersion</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">extensions/v1beta1</span>
</span><span class='line'><span class="l-Scalar-Plain">kind</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Deployment</span>
</span><span class='line'><span class="l-Scalar-Plain">metadata</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">k3s-demo</span>
</span><span class='line'>  <span class="l-Scalar-Plain">namespace</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">default</span>
</span><span class='line'><span class="l-Scalar-Plain">spec</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">replicas</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">2</span>
</span><span class='line'>  <span class="l-Scalar-Plain">selector</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">matchLabels</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="l-Scalar-Plain">app</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">k3d-demo</span>
</span><span class='line'>  <span class="l-Scalar-Plain">template</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">metadata</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="l-Scalar-Plain">labels</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">app</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">k3d-demo</span>
</span><span class='line'>    <span class="l-Scalar-Plain">spec</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="l-Scalar-Plain">containers</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">k3d-demo</span>
</span><span class='line'>        <span class="l-Scalar-Plain">image</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">ruanbekker/hostname:latest</span>
</span><span class='line'><span class="nn">---</span>
</span><span class='line'><span class="l-Scalar-Plain">apiVersion</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">v1</span>
</span><span class='line'><span class="l-Scalar-Plain">kind</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Service</span>
</span><span class='line'><span class="l-Scalar-Plain">metadata</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">k3d-demo</span>
</span><span class='line'>  <span class="l-Scalar-Plain">namespace</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">default</span>
</span><span class='line'><span class="l-Scalar-Plain">spec</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">ports</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">http</span>
</span><span class='line'>    <span class="l-Scalar-Plain">targetPort</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">8000</span>
</span><span class='line'>    <span class="l-Scalar-Plain">port</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">80</span>
</span><span class='line'>  <span class="l-Scalar-Plain">selector</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">app</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">k3d-demo</span>
</span><span class='line'><span class="nn">---</span>
</span><span class='line'><span class="l-Scalar-Plain">apiVersion</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">extensions/v1beta1</span>
</span><span class='line'><span class="l-Scalar-Plain">kind</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Ingress</span>
</span><span class='line'><span class="l-Scalar-Plain">metadata</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">k3d-demo</span>
</span><span class='line'>  <span class="l-Scalar-Plain">annotations</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">kubernetes.io/ingress.class</span><span class="p-Indicator">:</span> <span class="s">&quot;traefik&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">spec</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">rules</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">host</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">k3d-demo.example.org</span>
</span><span class='line'>    <span class="l-Scalar-Plain">http</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="l-Scalar-Plain">paths</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">path</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/</span>
</span><span class='line'>        <span class="l-Scalar-Plain">backend</span><span class="p-Indicator">:</span>
</span><span class='line'>          <span class="l-Scalar-Plain">serviceName</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">k3d-demo</span>
</span><span class='line'>          <span class="l-Scalar-Plain">servicePort</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">http</span>
</span></code></pre></td></tr></table></div></figure>


<p>Deploy our application:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>kubectl apply -f app.yml
</span><span class='line'>deployment.extensions/k3s-demo created
</span><span class='line'>service/k3d-demo created
</span><span class='line'>ingress.extensions/k3d-demo created
</span></code></pre></td></tr></table></div></figure>


<p>Verify that the pods are running:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>kubectl get pods
</span><span class='line'>NAME                       READY   STATUS    RESTARTS   AGE
</span><span class='line'>k3s-demo-f76d866b9-dv5z9   1/1     Running   <span class="m">0</span>          10s
</span><span class='line'>k3s-demo-f76d866b9-qxltk   1/1     Running   <span class="m">0</span>          10s
</span></code></pre></td></tr></table></div></figure>


<p>Make a http request:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>curl -H <span class="s2">&quot;Host: k3d-demo.example.org&quot;</span> http://localhost
</span><span class='line'>Hostname: k3d-demo-f76d866b9-qxltk
</span></code></pre></td></tr></table></div></figure>


<h2>Deleting your Cluster</h2>

<p>To delete your cluster:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>k3d delete --name demo
</span></code></pre></td></tr></table></div></figure>


<h2>Thank You</h2>

<p>Thank you for reading. If you like my content, feel free to visit me at <strong><a href="https://ruan.dev/">ruan.dev</a></strong> or follow me on twitter at <strong><a href="https://twitter.com/ruanbekker">@ruanbekker</a></strong></p>

<p><a href="https://twitter.com/ruanbekker"><img src="https://user-images.githubusercontent.com/567298/71188576-e2410f80-2289-11ea-8667-08f0c14ab7b5.png" alt="" /></a></p>

<p><a href="https://ko-fi.com/A6423ZIQ"><img src="https://www.ko-fi.com/img/githubbutton_sm.svg" alt="ko-fi" /></a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2020/02/04/run-localstack-as-a-service-container-for-aws-mock-services-on-drone-ci/">Run Localstack as a Service Container for AWS Mock Services on Drone CI</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2020-02-04T23:43:30+02:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2020</span></span> <span class='time'>11:43 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In this tutorial we will setup a basic pipeline in drone to make use of service containers, we will provision localstack so that we can provision AWS mock services.</p>

<p>We will create a kinesis stream on localstack, when the service is up, we will create a stream, put 100 records in the stream, read them from the stream and delete the kinesis stream.</p>

<h2>Gitea and Drone Stack</h2>

<p>If you donâ€™t have the stack setup, have a look at <a href="https://blog.ruanbekker.com/blog/2020/02/04/setup-gitea-and-drone-on-docker-2020-edition/">this post</a> where I go into detail on how to get that setup.</p>

<h2>Create the Drone Config</h2>

<p>In gitea, I have created a new git repository and created my drone config as <code>.drone.yml</code> with this pipeline config:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>---
</span><span class='line'>kind: pipeline
</span><span class='line'>type: docker
</span><span class='line'>name: localstack
</span><span class='line'>
</span><span class='line'>platform:
</span><span class='line'>  os: linux
</span><span class='line'>  arch: amd64
</span><span class='line'>
</span><span class='line'>steps:
</span><span class='line'>  - name: wait-for-localstack
</span><span class='line'>    image: busybox
</span><span class='line'>    commands:
</span><span class='line'>      - sleep 10
</span><span class='line'>
</span><span class='line'>  - name: list-kinesis-streams
</span><span class='line'>    image: ruanbekker/awscli
</span><span class='line'>    environment:
</span><span class='line'>      AWS_ACCESS_KEY_ID: 123
</span><span class='line'>      AWS_SECRET_ACCESS_KEY: xyz
</span><span class='line'>      AWS_DEFAULT_REGION: eu-west-1
</span><span class='line'>    commands:
</span><span class='line'>      - aws --endpoint-url=http://localstack:4568 kinesis list-streams
</span><span class='line'>
</span><span class='line'>  - name: create-kinesis-streams
</span><span class='line'>    image: ruanbekker/awscli
</span><span class='line'>    environment:
</span><span class='line'>      AWS_ACCESS_KEY_ID: 123
</span><span class='line'>      AWS_SECRET_ACCESS_KEY: xyz
</span><span class='line'>      AWS_DEFAULT_REGION: eu-west-1
</span><span class='line'>    commands:
</span><span class='line'>      - aws --endpoint-url=http://localstack:4568 kinesis create-stream --stream-name mystream --shard-count 1
</span><span class='line'>
</span><span class='line'>  - name: describe-kinesis-streams
</span><span class='line'>    image: ruanbekker/awscli
</span><span class='line'>    environment:
</span><span class='line'>      AWS_ACCESS_KEY_ID: 123
</span><span class='line'>      AWS_SECRET_ACCESS_KEY: xyz
</span><span class='line'>      AWS_DEFAULT_REGION: eu-west-1
</span><span class='line'>    commands:
</span><span class='line'>      - aws --endpoint-url=http://localstack:4568 kinesis describe-stream --stream-name mystream
</span><span class='line'>
</span><span class='line'>  - name: put-record-into-kinesis
</span><span class='line'>    image: ruanbekker/awscli
</span><span class='line'>    environment:
</span><span class='line'>      AWS_ACCESS_KEY_ID: 123
</span><span class='line'>      AWS_SECRET_ACCESS_KEY: xyz
</span><span class='line'>      AWS_DEFAULT_REGION: eu-west-1
</span><span class='line'>    commands:
</span><span class='line'>      - for record in $$(seq 1 100); do aws --endpoint-url=http://localstack:4568 kinesis put-record --stream-name mystream --partition-key 123 --data testdata_$$record ; done
</span><span class='line'>
</span><span class='line'>  - name: get-record-from-kinesis
</span><span class='line'>    image: ruanbekker/awscli
</span><span class='line'>    environment:
</span><span class='line'>      AWS_ACCESS_KEY_ID: 123
</span><span class='line'>      AWS_SECRET_ACCESS_KEY: xyz
</span><span class='line'>      AWS_DEFAULT_REGION: eu-west-1
</span><span class='line'>    commands:
</span><span class='line'>      - SHARD_ITERATOR=$$(aws --endpoint-url=http://localstack:4568 kinesis get-shard-iterator --shard-id shardId-000000000000 --shard-iterator-type TRIM_HORIZON --stream-name mystream --query 'ShardIterator' --output text)
</span><span class='line'>      - for each in $$(aws --endpoint-url=http://localstack:4568 kinesis get-records --shard-iterator $$SHARD_ITERATOR | jq -cr '.Records[].Data'); do echo $each | base64 -d ; echo "" ; done
</span><span class='line'>
</span><span class='line'>  - name: delete-kinesis-stream
</span><span class='line'>    image: ruanbekker/awscli
</span><span class='line'>    environment:
</span><span class='line'>      AWS_ACCESS_KEY_ID: 123
</span><span class='line'>      AWS_SECRET_ACCESS_KEY: xyz
</span><span class='line'>      AWS_DEFAULT_REGION: eu-west-1
</span><span class='line'>    commands:
</span><span class='line'>      - aws --endpoint-url=http://localstack:4568 kinesis delete-stream --stream-name mystream
</span><span class='line'>
</span><span class='line'>services:
</span><span class='line'>  - name: localstack
</span><span class='line'>    image: localstack/localstack
</span><span class='line'>    privileged: true
</span><span class='line'>    environment:
</span><span class='line'>      DOCKER_HOST: unix:///var/run/docker.sock
</span><span class='line'>    volumes:
</span><span class='line'>      - name: docker-socket
</span><span class='line'>        path: /var/run/docker.sock
</span><span class='line'>      - name: localstack-vol
</span><span class='line'>        path: /tmp/localstack
</span><span class='line'>    ports:
</span><span class='line'>      - 8080
</span><span class='line'>
</span><span class='line'>volumes:
</span><span class='line'>- name: localstack-vol
</span><span class='line'>  temp: {}
</span><span class='line'>- name: docker-socket
</span><span class='line'>  host:
</span><span class='line'>    path: /var/run/docker.sock</span></code></pre></td></tr></table></div></figure>


<p>To explain what we are doing, we are bringing up localstack as a service container, then using the aws cli tools we point to the localstack kinesis endpoint, creating a kinesis stream, put 100 records to the stream, then we read from the stream and delete thereafter.</p>

<h2>Trigger the Pipeline</h2>

<p>Then I head to drone activate my new git repository and select the repository as &ldquo;Trusted&rdquo;. I commited a dummy file to trigger the pipeline and it should look like this:</p>

<p><img width="893" alt="image" src="https://user-images.githubusercontent.com/567298/73788817-63a32180-47a6-11ea-96c7-6abba7af2b27.png"></p>

<p>List Streams:</p>

<p><img width="974" alt="image" src="https://user-images.githubusercontent.com/567298/73788860-73bb0100-47a6-11ea-9c80-f2b8bfc18d53.png"></p>

<p>Put Records:</p>

<p><img width="896" alt="image" src="https://user-images.githubusercontent.com/567298/73788895-87666780-47a6-11ea-8d90-2c454ec9174a.png"></p>

<p>Delete Stream:</p>

<p><img width="924" alt="image" src="https://user-images.githubusercontent.com/567298/73788988-aebd3480-47a6-11ea-85d9-9ed7424c648b.png"></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2020/02/04/run-kubernetes-k3s-as-a-service-container-on-drone-ci/">Run Kubernetes (K3s) as a Service Container on Drone CI</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2020-02-04T22:37:06+02:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2020</span></span> <span class='time'>10:37 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="https://docs.drone.io/pipeline/docker/syntax/services/">Drone services</a> allow you to run a service container and will be available for the duration of your build, which is great if you want a ephemeral service to test your applications against.</p>

<p>Today we will experiment with services on <a href="https://github.com/drone/drone">drone</a>  and will deploy a <a href="https://github.com/rancher/k3s">k3s</a> (a kubernetes distribution built by rancher) cluster as a drone service and interact with our cluster using kubectl.</p>

<p>I will be using multiple pipelines, where we will first deploy our &ldquo;dev cluster&rdquo;, when it&rsquo;s up, we will use kubectl to interact with the cluster, once that is done, we will deploy our &ldquo;staging cluster&rdquo; and do the same.</p>

<p>This is very basic and we are not doing anything special, but this is a starting point and you can do pretty much whatever you want.</p>

<h2>What is Drone</h2>

<p>If you are not aware of Drone, Drone is a container-native continious deliver platform built on Go and you can check them out <a href="https://github.com/drone/drone">here: github.com/drone</a></p>

<h2>Setup Gitea and Drone</h2>

<p>If you don&rsquo;t have the stack setup, have a look at <a href="https://blog.ruanbekker.com/blog/2020/02/04/setup-gitea-and-drone-on-docker-2020-edition/">this post</a> where I go into detail on how to get that setup.</p>

<h2>Create your Git Repo</h2>

<p>Go ahead and create a git repo, you can name it anything, then it should look something like this:</p>

<p><img width="1171" alt="image" src="https://user-images.githubusercontent.com/567298/73783555-90ead200-479c-11ea-8386-12518fb21b22.png"></p>

<p>Create a drone configuration, <code>.drone.yml</code> my pipeline will look like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>---
</span><span class='line'>kind: pipeline
</span><span class='line'>type: docker
</span><span class='line'>name: dev
</span><span class='line'>
</span><span class='line'>platform:
</span><span class='line'>  os: linux
</span><span class='line'>  arch: amd64
</span><span class='line'>
</span><span class='line'>steps:
</span><span class='line'>  - name: wait-for-k3s
</span><span class='line'>    image: ruanbekker/build-tools
</span><span class='line'>    commands:
</span><span class='line'>      - sleep 30
</span><span class='line'>
</span><span class='line'>  - name: prepare-k3s-kubeconfig
</span><span class='line'>    image: alpine
</span><span class='line'>    volumes:
</span><span class='line'>      - name: k3s-kubeconfig
</span><span class='line'>        path: /k3s-kubeconfig
</span><span class='line'>    detach: false
</span><span class='line'>    commands:
</span><span class='line'>      - sed -i -e "s/127.0.0.1/k3s/g" /k3s-kubeconfig/kubeconfig.yaml
</span><span class='line'>
</span><span class='line'>  - name: test-kubernetes
</span><span class='line'>    image: ruanbekker/kubectl
</span><span class='line'>    volumes:
</span><span class='line'>      - name: k3s-kubeconfig
</span><span class='line'>        path: /tmp
</span><span class='line'>    environment:
</span><span class='line'>      KUBECONFIG: /tmp/kubeconfig.yaml
</span><span class='line'>    commands:
</span><span class='line'>      - kubectl get nodes -o wide
</span><span class='line'>
</span><span class='line'>services:
</span><span class='line'>  - name: k3s
</span><span class='line'>    image: rancher/k3s:v0.9.1
</span><span class='line'>    privileged: true
</span><span class='line'>    command:
</span><span class='line'>      - server
</span><span class='line'>    environment:
</span><span class='line'>      K3S_KUBECONFIG_OUTPUT: /k3s-kubeconfig/kubeconfig.yaml
</span><span class='line'>      K3S_KUBECONFIG_MODE: 777
</span><span class='line'>    volumes:
</span><span class='line'>      - name: k3s-kubeconfig
</span><span class='line'>        path: /k3s-kubeconfig
</span><span class='line'>    ports:
</span><span class='line'>      - 6443
</span><span class='line'>
</span><span class='line'>volumes:
</span><span class='line'>- name: k3s-kubeconfig
</span><span class='line'>  temp: {}
</span><span class='line'>
</span><span class='line'>---
</span><span class='line'>kind: pipeline
</span><span class='line'>type: docker
</span><span class='line'>name: staging
</span><span class='line'>
</span><span class='line'>platform:
</span><span class='line'>  os: linux
</span><span class='line'>  arch: amd64
</span><span class='line'>
</span><span class='line'>steps:
</span><span class='line'>  - name: wait-for-k3s
</span><span class='line'>    image: ruanbekker/build-tools
</span><span class='line'>    commands:
</span><span class='line'>      - sleep 30
</span><span class='line'>
</span><span class='line'>  - name: prepare-k3s-kubeconfig
</span><span class='line'>    image: alpine
</span><span class='line'>    volumes:
</span><span class='line'>      - name: k3s-kubeconfig
</span><span class='line'>        path: /k3s-kubeconfig
</span><span class='line'>    detach: false
</span><span class='line'>    commands:
</span><span class='line'>      - sed -i -e "s/127.0.0.1/k3s/g" /k3s-kubeconfig/kubeconfig.yaml
</span><span class='line'>
</span><span class='line'>  - name: test-kubernetes
</span><span class='line'>    image: ruanbekker/kubectl
</span><span class='line'>    volumes:
</span><span class='line'>      - name: k3s-kubeconfig
</span><span class='line'>        path: /tmp
</span><span class='line'>    environment:
</span><span class='line'>      KUBECONFIG: /tmp/kubeconfig.yaml
</span><span class='line'>    commands:
</span><span class='line'>      - kubectl get nodes -o wide
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>services:
</span><span class='line'>  - name: k3s
</span><span class='line'>    image: rancher/k3s:v0.9.1
</span><span class='line'>    privileged: true
</span><span class='line'>    command:
</span><span class='line'>      - server
</span><span class='line'>    environment:
</span><span class='line'>      K3S_KUBECONFIG_OUTPUT: /k3s-kubeconfig/kubeconfig.yaml
</span><span class='line'>      K3S_KUBECONFIG_MODE: 777
</span><span class='line'>    volumes:
</span><span class='line'>      - name: k3s-kubeconfig
</span><span class='line'>        path: /k3s-kubeconfig
</span><span class='line'>    ports:
</span><span class='line'>      - 6443
</span><span class='line'>
</span><span class='line'>volumes:
</span><span class='line'>- name: k3s-kubeconfig
</span><span class='line'>  temp: {}
</span><span class='line'>
</span><span class='line'>depends_on:
</span><span class='line'>- dev</span></code></pre></td></tr></table></div></figure>


<p>In this pipeline you can see that the staging pipeline depends on dev, so dev pipeline will start by creating the k3s service container, once its up I am using a step just to sleep for 30 seconds to allow it to boot.</p>

<p>Then I have defined a volume that will be persistent during the build time, which we will use to dump our kubeconfig file and update the hostname of our kubernetes endpoint. Once that is done our last step will set that file to the environment and use kubectl to interact with kubernetes.</p>

<p>Once our dev pipeline has finished, our staging pipeline will start.</p>

<h2>Activate the Repo in Drone</h2>

<p>Head over to drone on port <code>80</code> and activate the newly created git repo (and make sure that you select &ldquo;Trusted&rdquo;) and you will see the activity feed being empty:</p>

<p><img width="1008" alt="image" src="https://user-images.githubusercontent.com/567298/73784085-80872700-479d-11ea-9005-4cac54ac000d.png"></p>

<p>Commit a dummy file to git and you should see your pipeline being triggered:</p>

<p><img width="1013" alt="image" src="https://user-images.githubusercontent.com/567298/73784286-dd82dd00-479d-11ea-93f4-6363da53c1c1.png"></p>

<p>Once your pipeline has finished and everything succeeded, you should see the output of your nodes in your kubernetes service container:</p>

<p><img width="1068" alt="image" src="https://user-images.githubusercontent.com/567298/73784435-220e7880-479e-11ea-8f9d-a9856632302d.png"></p>

<p>As I mentioned earlier, we are not doing anything special but service containers allows us to do some awesome things.</p>

<p>Thank you for reading. If you like my content, feel free to visit me at <strong><a href="https://ruan.dev/">ruan.dev</a></strong> or follow me on twitter at <strong><a href="https://twitter.com/ruanbekker">@ruanbekker</a></strong></p>

<p><a href="https://twitter.com/ruanbekker"><img src="https://user-images.githubusercontent.com/567298/71188576-e2410f80-2289-11ea-8667-08f0c14ab7b5.png" alt="" /></a></p>

<p><a href="https://ko-fi.com/A6423ZIQ"><img src="https://www.ko-fi.com/img/githubbutton_sm.svg" alt="ko-fi" /></a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2020/02/04/setup-gitea-and-drone-on-docker-2020-edition/">Setup Gitea and Drone on Docker 2020 Edition</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2020-02-04T21:58:39+02:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2020</span></span> <span class='time'>9:58 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This post will show how to setup gitea and drone on a docker host with docker-compose. The drone example in this tutorial will be very basic, but in future posts I will focus more on pipeline examples using drone.</p>

<p>As this post I will use to link back for those who needs to setup the stack first.</p>

<h2>Deploy Gitea and Drone</h2>

<p>Get the docker-compose.yml:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ wget -O docker-compose.yml https://gist.githubusercontent.com/ruanbekker/27d2cb2e3f4194ee5cfe2bcdc9c4bf52/raw/25590a23e87190a871d70fd57ab461ce303cd286/2020.02.04-gitea-drone_docker-compose.yml</span></code></pre></td></tr></table></div></figure>


<p>Verify the environment variables and adjust the defaults if you want to change something, if you want your git clone ssh url to point to a dns name as well as the url for gitea, then change the following to your dns:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  gitea:
</span><span class='line'>    ...
</span><span class='line'>    environment:
</span><span class='line'>      - ROOT_URL=http://gi.myresolvable.dns:3000
</span><span class='line'>      - SSH_DOMAIN=git.myresolvable.dns</span></code></pre></td></tr></table></div></figure>


<p>then deploy:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ docker-compose up -d</span></code></pre></td></tr></table></div></figure>


<h2>Access your Stack</h2>

<p>The default port for Gitea in this setup is port <code>3000</code>:</p>

<p><img width="1273" alt="image" src="https://user-images.githubusercontent.com/567298/73778916-9b08d280-4794-11ea-88a6-8aafcd6e2656.png"></p>

<p>Initial configuration will be pre-populated from our environment variables:</p>

<p><img width="859" alt="image" src="https://user-images.githubusercontent.com/567298/73778973-b378ed00-4794-11ea-8615-d8deeee07b32.png"></p>

<p>From the additional settings section, create your admin user (this user is referenced in our docker-compose as well)</p>

<p><img width="871" alt="image" src="https://user-images.githubusercontent.com/567298/73779102-df946e00-4794-11ea-9177-712904e9dbee.png"></p>

<p>Because I am using gitea as my hostname, you will be redirected to <code>http://gitea:3000/user/login</code>, if you don&rsquo;t have a host entry setup for that it will fail, but you can just replace your servers ip in the request url and it will take you to the login screen, and after logging on, you should see this screen:</p>

<p><img width="1269" alt="image" src="https://user-images.githubusercontent.com/567298/73779494-752ffd80-4795-11ea-9c34-ff9eee269b0c.png"></p>

<p>Access drone on port 80, you will be directed to the login screen:</p>

<p><img width="773" alt="image" src="https://user-images.githubusercontent.com/567298/73779560-9395f900-4795-11ea-8f90-e420aa4c383d.png"></p>

<p>Use the same credentials that you have used to sign up with gitea, and after logging on, you should see this:</p>

<p><img width="1280" alt="image" src="https://user-images.githubusercontent.com/567298/73779651-b2948b00-4795-11ea-9939-51531467b600.png"></p>

<p>If ever your login does not work, just delete the drone access token on gitea (gitea:3000/user/settings/applications)</p>

<h2>Create a Git Repository</h2>

<p>On gitea, create a new git repository:</p>

<p><img width="698" alt="image" src="https://user-images.githubusercontent.com/567298/73779800-fdae9e00-4795-11ea-9422-938a24c08eb3.png"></p>

<p>You should now see your git repository:</p>

<p><img width="1005" alt="image" src="https://user-images.githubusercontent.com/567298/73779843-10c16e00-4796-11ea-98c6-2f70519146f0.png"></p>

<p>Create a new file <code>.drone.yml</code> with the following content:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>kind: pipeline
</span><span class='line'>name: hello-world
</span><span class='line'>type: docker
</span><span class='line'>
</span><span class='line'>steps:
</span><span class='line'>  - name: say-hello
</span><span class='line'>    image: busybox
</span><span class='line'>    commands:
</span><span class='line'>      - echo hello-world</span></code></pre></td></tr></table></div></figure>


<p>It should look like this:</p>

<p><img width="1019" alt="image" src="https://user-images.githubusercontent.com/567298/73779989-4fefbf00-4796-11ea-8e65-8441d3440d19.png"></p>

<h2>Configure Drone</h2>

<p>Commit the file in your git repository and head over to drone (which should be available on port <code>80</code>) and select &ldquo;Sync&rdquo;, after a couple of seconds you should see the git repository:</p>

<p><img width="860" alt="image" src="https://user-images.githubusercontent.com/567298/73780087-7f063080-4796-11ea-92ce-3d216c4e4097.png"></p>

<p>Select &ldquo;Activate&rdquo; and &ldquo;Activate Repository&rdquo;, on the next screen select &ldquo;Trusted&rdquo;, verify that the configuration file name is the same as which we created, then select save:</p>

<p><img width="860" alt="image" src="https://user-images.githubusercontent.com/567298/73780208-b543b000-4796-11ea-98f1-0f072eeae0ef.png"></p>

<h2>Trigger the Build</h2>

<p>If you click on &ldquo;Activity Feed&rdquo; you should see a empty feed. Head back to git and commit a dummy file to trigger the build to start. I will create a file name <code>trigger</code> with the value as <code>1</code> for my dummy file.</p>

<p>After committing the file, you will see on drone that the build started:</p>

<p><img width="900" alt="image" src="https://user-images.githubusercontent.com/567298/73780444-297e5380-4797-11ea-94e6-58c01ae11143.png"></p>

<p>When we select the build, you can see we have a clone step and the step that we defined to echo &ldquo;hello-world&rdquo;:</p>

<p><img width="851" alt="image" src="https://user-images.githubusercontent.com/567298/73780516-46b32200-4797-11ea-8a07-0563dea90d83.png"></p>

<h2>Thank You</h2>

<p>This was a basic introduction for gitea and drone, but I will use this post in conjunction with more gitea examples in the future.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2020/02/01/setup-thanos-on-docker-a-highly-available-prometheus/">Setup Thanos on Docker: A Highly Available Prometheus</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2020-02-01T01:28:12+02:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>1</span><span class='date-suffix'>st</span>, <span class='date-year'>2020</span></span> <span class='time'>1:28 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Today we will look at Thanos, a open source, highly available prometheus setup with long term storage capabilites, that we will run on docker to simplify the setup.</p>

<p>Note that running this proof of concept does not make it highly available as we will run everything on one host, but it will give you a feel what Thanos is about. In a future post, I will setup Thanos in a multi node environment.</p>

<h2>Prometheus</h2>

<p>If you are not familiar with <a href="https://prometheus.io">Prometheus</a>, then have a look at their documentation, but in short, prometheus is a open source monitoring system and time series database developed by soundcloud.</p>

<p>Prometheus is a monitoring system includes a rich, multidimensional data model, a concise and powerful query language called PromQL, an efficient embedded timeseries database, and over 150 integrations with third-party systems.</p>

<h2>Thanos</h2>

<p>Thanos is a highly available prometheus setup with long term storage capabilities.</p>

<p>Thanos allows you to ship your data to S3/Minio for long storage capabilites, so you could for example only store your &ldquo;live&rdquo; data on prometheus for 2 weeks, then everything older than that gets sent to object storage such as amazon s3 or minio. This helps your prometheus instance not to be flooded with data or prevents you from running out of storage space. The nice thing is, when you query for data older than 2 weeks, it will fetch the data from object storage.</p>

<p>Thanos has a global query view, which essentially means you can query your prometheus metrics from one endpoint backed by multiple prometheus servers or cluster.</p>

<p>You can still use the same tools such as Grafana as it utilizes the same Prometheus Query API.</p>

<p>Thanos provides downsampling and compaction, so that you downsample your historical data for massive query speedup when querying large time ranges.</p>

<h2>Thanos Components</h2>

<p>Thanos is a clustered system of components which can be categorized as follows:</p>

<ul>
<li><p>Metric sources</p>

<ul>
<li>Thanos provides two components that act as data sources: Prometheus Sidecar and Rule Nodes</li>
<li>Sidecar implements gRPC service on top of Prometheus</li>
<li>Rule Node directly implements it on top of the Prometheus storage engine it is running</li>
<li>Data sources that persist their data for long term storage, do so via the Prometheus 2.0 storage engine</li>
<li>Storage engine periodically produces immutable blocks of data for a fixed time range</li>
<li>A blocks top-level directory includes chunks, index and meta.json files</li>
<li>Chunk files hold a few hundred MB worth of chunks each</li>
<li>The index file holds all information needed to lookup specific series by their labels and the positions of their chunks.</li>
<li>The <code>meta.json</code> file holds metadata about block like stats, time range, and compaction level</li>
</ul>
</li>
<li><p>Stores</p>

<ul>
<li>A Store Node acts as a Gateway to block data that is stored in an object storage bucket</li>
<li>It implements the same gRPC API as Data Sources to provide access to all metric data found in the bucket</li>
<li>Continuously synchronizes which blocks exist in the bucket and translates requests for metric data into object storage requests</li>
<li>Implements various strategies to minimize the number of requests to the object storage</li>
<li>Prometheus 2.0 storage layout is optimized for minimal read amplification</li>
<li>At this time of writing, only index data is cached</li>
<li>Stores and Data Sources are the same, store nodes and data sources expose the same gRPC Store API</li>
<li>Store API allows to look up data by a set of label matchers and a time range</li>
<li>It then returns compressed chunks of samples as they are found in the block data</li>
<li>So it&rsquo;s purely a data retrieval API and does not provide complex query execution</li>
</ul>
</li>
<li><p>Query Layer</p>

<ul>
<li>Queriers are stateless and horizontally scalable instances that implement PromQL on top of the Store APIs exposed in the cluster</li>
<li>Queriers participate in the cluster to be able to resiliently discover all data sources and store nodes</li>
<li>Rule nodes in return can discover query nodes to evaluate recording and alerting rules</li>
<li>Based on the metadata of store and source nodes, they attempt to minimize the request fanout to fetch data for a particular query</li>
<li>The only scalable components of Thanos is the query nodes as none of the Thanos components provide sharding</li>
<li>Scaling of storage capacity is ensured by relying on an external object storage system</li>
<li>Store, rule, and compactor nodes are all expected to scale significantly within a single instance or high availability pair</li>
</ul>
</li>
</ul>


<p>The information from above was retrieved from their <a href="https://thanos.io/design.md/">website</a>, feel free to check them out if you want to read more on the concepts of thanos.</p>

<p>The Architecture Overview of Thanos looks like this:</p>

<p><img src="https://github.com/thanos-io/thanos/blob/master/docs/img/arch.jpg?raw=true" alt="" /></p>

<h2>What are we doing today</h2>

<p>We will setup a Thanos Cluster with Minio, Node-Exporter, Grafana on Docker. Our Thanos setup will consist of 3 prometheus containers, each one running with a sidecar container, a store container, 2 query containers, then we have the remotewrite and receive containers which node-exporter will use to ship its metrics to.</p>

<p>The minio container will be used as our long-term storage and the mc container will be used to initialize the storage bucket which is used by thanos.</p>

<h2>Deploy the Cluster</h2>

<p>Below is the docker-compose.yml and the script to generate the configs for thanos:</p>

<script src="https://gist.github.com/ruanbekker/acd1b17d3aea4c71031e72dfc8ebbb4d.js"></script>


<p>Once you have saved the compose as <code>docker-compose.yml</code> and the script as <code>configs.sh</code> you can create the configs:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ bash configs.sh</span></code></pre></td></tr></table></div></figure>


<p>The script from above creates the data directory and place all the configs that thanos will use in there. Next deploy the thanos cluster:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ docker-compose -f docker-compose.yml up</span></code></pre></td></tr></table></div></figure>


<p>It should look something like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ docker-compose -f docker-compose.yml up
</span><span class='line'>Starting node-exporter ... done
</span><span class='line'>Starting minio         ... done
</span><span class='line'>Starting grafana        ... done
</span><span class='line'>Starting prometheus0    ... done
</span><span class='line'>Starting prometheus1     ... done
</span><span class='line'>Starting thanos-receive  ... done
</span><span class='line'>Starting thanos-store    ... done
</span><span class='line'>Starting prometheus2     ... done
</span><span class='line'>Starting mc             ... done
</span><span class='line'>Starting thanos-sidecar0 ... done
</span><span class='line'>Starting thanos-sidecar1     ... done
</span><span class='line'>Starting thanos-sidecar2     ... done
</span><span class='line'>Starting thanos-remote-write ... done
</span><span class='line'>Starting thanos-query1       ... done
</span><span class='line'>Starting thanos-query0       ... done
</span><span class='line'>Attaching to node-exporter, minio, grafana, mc, prometheus0, prometheus1, thanos-store, prometheus2, thanos-receive, thanos-sidecar0, thanos-sidecar1, thanos-sidecar2, thanos-remote-write, thanos-query0, thanos-query1</span></code></pre></td></tr></table></div></figure>


<p>Access the Query UI, which looks identical to the Prometheus UI:
- <a href="http://localhost:10904/graph">http://localhost:10904/graph</a></p>

<p>It will look more or less like this:</p>

<p><img width="1280" alt="image" src="https://user-images.githubusercontent.com/567298/73583506-4e26b280-449b-11ea-96ca-9b0cefec0acd.png"></p>

<p>When we access minio on:
- <a href="http://localhost:9000/minio">http://localhost:9000/minio</a></p>

<p>And under the thanos bucket you will see the objects being persisted:</p>

<p><img width="1278" alt="image" src="https://user-images.githubusercontent.com/567298/73583542-7ca48d80-449b-11ea-955c-7b1e766229a3.png"></p>

<p>When we access grafana on:
- <a href="http://localhost:3000/">http://localhost:3000/</a></p>

<p>Select datasources, add a prometheus datasource and select the endpoint: <code>http://query0:10904</code>, which should look like this:</p>

<p><img width="618" alt="image" src="https://user-images.githubusercontent.com/567298/73583601-d73de980-449b-11ea-9a71-c94e8184336f.png"></p>

<p>When we create a dashboard, you can test a query with <code>thanos_sidecar_prometheus_up</code> and it should look something like this:</p>

<p><img width="1279" alt="image" src="https://user-images.githubusercontent.com/567298/73583684-49aec980-449c-11ea-97bd-35145ff8330c.png"></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2020/01/24/save-output-to-local-file-with-ansible/">Save Output to Local File With Ansible</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2020-01-24T19:56:01+02:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>24</span><span class='date-suffix'>th</span>, <span class='date-year'>2020</span></span> <span class='time'>7:56 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="https://user-images.githubusercontent.com/567298/55700285-f3cdda00-59ce-11e9-9c00-a05b9d469e23.png" alt="" /></p>

<p>This playbook demonstrates how you can redirect shell output to a local file</p>

<h2>Inventory</h2>

<p>Our <code>inventory.ini</code> file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[localhost]
</span><span class='line'>localhost</span></code></pre></td></tr></table></div></figure>


<h2>The Script</h2>

<p>Our script: <code>/tmp/foo</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/usr/bin/env bash</span>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;foo&quot;</span>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;bar&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Apply executable permissions:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>chmod +x /tmp/foo
</span></code></pre></td></tr></table></div></figure>


<h2>Playbook</h2>

<p>Our playbook: <code>debug.yml</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="nn">---</span>
</span><span class='line'><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">hosts</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">localhost</span>
</span><span class='line'>  <span class="l-Scalar-Plain">tasks</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">shell</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/tmp/foo</span>
</span><span class='line'>      <span class="l-Scalar-Plain">register</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">foo_result</span>
</span><span class='line'>      <span class="l-Scalar-Plain">ignore_errors</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">True</span>
</span><span class='line'>    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">local_action</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">copy content= dest=file</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Running</h2>

<p>Running the Ansible Playbook:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">$ ansible-playbook -i inventory.ini debug.yml</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">PLAY [localhost] ********************************************************************************************************************************************************************</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">TASK [shell] ************************************************************************************************************************************************************************</span>
</span><span class='line'><span class="l-Scalar-Plain">changed</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">localhost</span><span class="p-Indicator">]</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">TASK [copy] *************************************************************************************************************************************************************************</span>
</span><span class='line'><span class="l-Scalar-Plain">changed</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">localhost -&gt; localhost</span><span class="p-Indicator">]</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">PLAY RECAP **************************************************************************************************************************************************************************</span>
</span><span class='line'><span class="l-Scalar-Plain">localhost</span>                  <span class="p-Indicator">:</span> <span class="l-Scalar-Plain">ok=2    changed=2    unreachable=0    failed=0</span>
</span></code></pre></td></tr></table></div></figure>


<p>View the local saved file:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">$ cat file</span>
</span><span class='line'><span class="l-Scalar-Plain">foo</span>
</span><span class='line'><span class="l-Scalar-Plain">bar</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Read More</h2>

<p>For more content on <a href="https://blog.ruanbekker.com/blog/categories/ansible/">Ansible</a> check out my <a href="https://blog.ruanbekker.com/blog/categories/ansible/">Ansible</a> category</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2020/01/24/environment-variables-with-ansible/">Environment Variables With Ansible</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2020-01-24T19:28:16+02:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>24</span><span class='date-suffix'>th</span>, <span class='date-year'>2020</span></span> <span class='time'>7:28 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="https://user-images.githubusercontent.com/567298/55700285-f3cdda00-59ce-11e9-9c00-a05b9d469e23.png" alt="" /></p>

<p>This is a quick post on how to use environment variables in ansible</p>

<h2>Inventory</h2>

<p>Our <code>inventory.ini</code> file looks like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[localhost]
</span><span class='line'>localhost</span></code></pre></td></tr></table></div></figure>


<h2>Across Tasks</h2>

<p>You can set environment variables across tasks, and let your tasks inherit the variables:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">hosts</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">localhost</span>
</span><span class='line'>  <span class="l-Scalar-Plain">vars</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">var_mysecret</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">secret123</span>
</span><span class='line'>
</span><span class='line'>  <span class="l-Scalar-Plain">tasks</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">echo my env var</span>
</span><span class='line'>      <span class="l-Scalar-Plain">environment</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">MYNAME</span><span class="p-Indicator">:</span> <span class="s">&quot;&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">shell</span><span class="p-Indicator">:</span> <span class="s">&quot;echo</span><span class="nv"> </span><span class="s">hello</span><span class="nv"> </span><span class="s">$MYNAME</span><span class="nv"> </span><span class="s">&gt;</span><span class="nv"> </span><span class="s">/tmp/bla.txt&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">args</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">creates</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/tmp/bla.txt</span>
</span></code></pre></td></tr></table></div></figure>


<p>When we run the task:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>ansible-playbook -i inventory.ini -u ruan task.yml
</span></code></pre></td></tr></table></div></figure>


<p>Check the output:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>cat /tmp/bla.txt
</span><span class='line'>hello secret123
</span></code></pre></td></tr></table></div></figure>


<h2>Environment Variables Per Task</h2>

<p>You can set environment variables per task:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">hosts</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">dev</span>
</span><span class='line'>  <span class="l-Scalar-Plain">tasks</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">echo my env var</span>
</span><span class='line'>      <span class="l-Scalar-Plain">environment</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">MYNAME</span><span class="p-Indicator">:</span> <span class="s">&quot;RUAN&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">shell</span><span class="p-Indicator">:</span> <span class="s">&quot;echo</span><span class="nv"> </span><span class="s">hello</span><span class="nv"> </span><span class="s">$MYNAME</span><span class="nv"> </span><span class="s">&gt;</span><span class="nv"> </span><span class="s">/tmp/bla2.txt&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">args</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">creates</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/tmp/bla2.txt</span>
</span></code></pre></td></tr></table></div></figure>


<p>Running the task:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">$ ansible-playbook -i inventory.ini -u ruan task.yml</span>
</span></code></pre></td></tr></table></div></figure>


<p>Checking the output:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">$ cat /tmp/bla2.txt</span>
</span><span class='line'><span class="l-Scalar-Plain">hello RUAN</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Read More</h2>

<p>Read more on environment variables in ansible in their <a href="https://docs.ansible.com/ansible/latest/plugins/lookup/env.html">documentation</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2020/01/11/setup-a-wireguard-vpn-server-on-linux/">Setup a WireGuard VPN Server on Linux</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2020-01-11T23:37:03+02:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>11</span><span class='date-suffix'>th</span>, <span class='date-year'>2020</span></span> <span class='time'>11:37 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>Installation</h2>

<p>I will be installing my wireguard vpn server on a ubuntu 18 server, for other distributions you can have a look at their <a href="https://www.wireguard.com/install/">docs</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo add-apt-repository ppa:wireguard/wireguard
</span><span class='line'>$ sudo apt update
</span><span class='line'>$ sudo apt install wireguard -y</span></code></pre></td></tr></table></div></figure>


<h2>Configuration</h2>

<p>On the Server, create they keys directory where we will save our keys:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ mkdir -p /etc/wireguard/keys</span></code></pre></td></tr></table></div></figure>


<p>Create the private and public key:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ wg genkey | tee privatekey | wg pubkey &gt; publickey</span></code></pre></td></tr></table></div></figure>


<p>Generate the pre-shared key:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ wg genpsk &gt; client.psk</span></code></pre></td></tr></table></div></figure>


<p>On the client, create the keys directory:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ mkdir -p ~/wireguard/keys</span></code></pre></td></tr></table></div></figure>


<p>Create the private and public keys:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cd ~/wireguard/keys
</span><span class='line'>$ wg genkey | tee privatekey | wg pubkey &gt; publickey</span></code></pre></td></tr></table></div></figure>


<p>Populate the server config:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat /etc/wireguard/wg0.conf
</span><span class='line'>[Interface]
</span><span class='line'>PrivateKey = &lt;output-of-client.privatekey&gt;
</span><span class='line'>Address = 192.168.199.1/32
</span><span class='line'>ListenPort = 8999
</span><span class='line'>PostUp = sysctl -w net.ipv4.ip_forward=1; iptables -A FORWARD -i %i -j ACCEPT; iptables -t nat -A POSTROUTING -o ens3 -j MASQUERADE
</span><span class='line'>PostDown = iptables -D FORWARD -i %i -j ACCEPT; iptables -t nat -D POSTROUTING -o ens3 -j MASQUERADE
</span><span class='line'>
</span><span class='line'>[Peer]
</span><span class='line'>PublicKey = &lt;output-of-server.publickey&gt;
</span><span class='line'>PresharedKey = &lt;output-of-client.psk&gt;
</span><span class='line'>AllowedIPs = 192.168.199.2/32</span></code></pre></td></tr></table></div></figure>


<p>Populate the client config:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat ~/wireguard/wg0.conf
</span><span class='line'>[Interface]
</span><span class='line'>PrivateKey = &lt;output-of-client.privatekey&gt;
</span><span class='line'>Address = 192.168.199.2/24
</span><span class='line'>DNS = 1.1.1.1
</span><span class='line'>
</span><span class='line'>[Peer]
</span><span class='line'>PublicKey = &lt;output-of-server.publickey&gt;
</span><span class='line'>PresharedKey = &lt;output-of-client.psk&gt;
</span><span class='line'>Endpoint = &lt;server-public-ip&gt;:8999
</span><span class='line'>AllowedIPs = 0.0.0.0/0
</span><span class='line'>PersistentKeepalive = 25</span></code></pre></td></tr></table></div></figure>


<h2>Start the Server</h2>

<p>On the server, enable and start the service:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ systemctl enable wg-quick@wg0.service
</span><span class='line'>$ wg-quick up wg0</span></code></pre></td></tr></table></div></figure>


<p>On the client, connect the VPN:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ wg-quick up ~/wireguard/wg0.conf</span></code></pre></td></tr></table></div></figure>


<p>Verify the status:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ wg show
</span><span class='line'>interface: wg0
</span><span class='line'>  public key: +Giwk8Y5KS5wx9mw0nEIdQODI+DsR+3TcbMxjJqfZys=
</span><span class='line'>  private key: (hidden)
</span><span class='line'>  listening port: 8999
</span><span class='line'>
</span><span class='line'>peer: Q8LGMj6CeCYQJp+sTu74mLMRoPFAprV8PsnS0cu9fDI=
</span><span class='line'>  preshared key: (hidden)
</span><span class='line'>  endpoint: 102.132.208.80:57800
</span><span class='line'>  allowed ips: 192.168.199.2/32
</span><span class='line'>  latest handshake: 22 seconds ago
</span><span class='line'>  transfer: 292.00 KiB received, 322.15 KiB sent</span></code></pre></td></tr></table></div></figure>


<p>Check if you can ping the private ip address of the VPN:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ping 192.168.199.2
</span><span class='line'>PING 192.168.199.2 (192.168.199.2): 56 data bytes
</span><span class='line'>64 bytes from 192.168.199.2: icmp_seq=0 ttl=63 time=304.844 ms</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2020/01/02/managing-background-processes-with-screen/">Managing Background Processes With Screen</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2020-01-02T10:42:54+02:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>2</span><span class='date-suffix'>nd</span>, <span class='date-year'>2020</span></span> <span class='time'>10:42 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="https://user-images.githubusercontent.com/567298/71659085-e6bbfc80-2d4e-11ea-9264-5ce0c848f9f3.png" alt="image" /></p>

<p>This is a quick post on how to create, manage and delete background processes with screen</p>

<h2>About</h2>

<p>Screen allows you to run processes in a different session, so when you exit your terminal the process will still be running.</p>

<h2>Install</h2>

<p>Install screen on the operating system of choice, for debian based systems it will be:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>sudo apt install screen -y
</span></code></pre></td></tr></table></div></figure>


<h2>Working with Screen</h2>

<p>To create a screen session, you can just run <code>screen</code> or you can provide an argument to provide a name:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>screen -S my-screen-session
</span></code></pre></td></tr></table></div></figure>


<p>Now you will be dropped into a screen session, run a ping:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>ping 8.8.8.8
</span></code></pre></td></tr></table></div></figure>


<p>Now to allow the ping process to run in the background, send the commands to detach the screen session:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Ctrl + a, <span class="k">then</span> press d
</span></code></pre></td></tr></table></div></figure>


<p>To view the screen session:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>screen -ls
</span><span class='line'>There is a screen on:
</span><span class='line'>  45916.my-screen-session <span class="o">(</span>Detached<span class="o">)</span>
</span><span class='line'><span class="m">1</span> Socket in /var/folders/jr/dld7mjhn0sx6881xs_0s7rtc0000gn/T/.screen.
</span></code></pre></td></tr></table></div></figure>


<p>To resume the screen session, pass the screen id or screen name as a argument:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>screen -r my-screen-session
</span><span class='line'><span class="m">64</span> bytes from 8.8.8.8: <span class="nv">icmp_seq</span><span class="o">=</span><span class="m">297</span> <span class="nv">ttl</span><span class="o">=</span><span class="m">55</span> <span class="nb">time</span><span class="o">=</span>7.845 ms
</span><span class='line'><span class="m">64</span> bytes from 8.8.8.8: <span class="nv">icmp_seq</span><span class="o">=</span><span class="m">298</span> <span class="nv">ttl</span><span class="o">=</span><span class="m">55</span> <span class="nb">time</span><span class="o">=</span>6.339 ms
</span></code></pre></td></tr></table></div></figure>


<h2>Scripting</h2>

<p>To use a one liner to send a process as a detached screen session for scripting as an example, you can do that like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>screen -S ping-process -m -d sh -c <span class="s2">&quot;ping 8.8.8.8&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Listing the screen session:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>screen -ls
</span><span class='line'>There is a screen on:
</span><span class='line'>  46051.ping-process  <span class="o">(</span>Detached<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Terminating the screen session:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>screen -S ping-process -X quit
</span></code></pre></td></tr></table></div></figure>


<h2>Thank You</h2>

<p>Let me know what you think. If you liked my content, feel free to visit me at <strong><a href="https://ruan.dev/">ruan.dev</a></strong> or follow me on twitter at <strong><a href="https://twitter.com/ruanbekker">@ruanbekker</a></strong></p>

<p><a href="https://twitter.com/ruanbekker"><img src="https://user-images.githubusercontent.com/567298/71188576-e2410f80-2289-11ea-8667-08f0c14ab7b5.png" alt="" /></a></p>

<p><a href="https://ko-fi.com/A6423ZIQ"><img src="https://www.ko-fi.com/img/githubbutton_sm.svg" alt="ko-fi" /></a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2020/01/01/2019-my-personal-highlights-for-the-year/">2019: My Personal Highlights for the Year</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2020-01-01T12:23:08+02:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>1</span><span class='date-suffix'>st</span>, <span class='date-year'>2020</span></span> <span class='time'>12:23 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="https://user-images.githubusercontent.com/567298/71640913-bd8e6400-2c9b-11ea-994c-b49231a6147e.png" alt="image" /></p>

<p>2019 was a great year! I met some awesome people from <a href="https://twitter.com/civocloud">Civo</a>, <a href="https://twitter.com/traefik">Traefik</a>, <a href="https://twitter.com/Rancher_Labs">Rancher</a>, <a href="https://twitter.com/openfaas">OpenFaas</a>, <a href="https://twitter.com/docker">Docker</a>, <a href="https://twitter.com/elastic">Elastic</a>, <a href="https://twitter.com/awscloud">AWS</a> and the list goes on.</p>

<p>Thank you to everyone of you that helped me during this year, to the ones inspired me, all the great motivation, support and shout outs! There&rsquo;s so many people to thank, even for the people that is not mentioned, if you ever interacted with me, helped me or supported me, thank you to each and everyone of you!</p>

<p>Below is a list of some of my personal highlights:</p>

<h2>Number of Blogposts per Website:</h2>

<ul>
<li><a href="https://blog.ruanbekker.com/blog/archives/">83 Posts on blog.ruanbekker.com</a></li>
<li><a href="https://sysadmins.co.za/author/ruan/">54 Posts on sysadmins.co.za</a></li>
<li><a href="https://medium.com/@ruanbekker">7 Posts on medium.com</a></li>
<li><a href="https://dev.to/ruanbekker">6 Posts on dev.to</a></li>
<li><a href="https://devconnected.com/author/ruan_bekker/">1 Post on devconnected.com</a></li>
<li><a href="https://www.civo.com/learn/setup-a-3-node-docker-swarm">1 Post on civo.com</a></li>
</ul>


<h2>Learnings</h2>

<ul>
<li>You cannot be good at everything</li>
<li>You need to switch off every now and then</li>
<li>Work / Life balance is important</li>
<li>A hobby other than work does wonders to help switch off every now and then</li>
</ul>


<h2>Contributions on Github</h2>

<p>Contributions for 2019:</p>

<p><a href="https://github.com/ruanbekker"><img src="https://user-images.githubusercontent.com/567298/71640391-c7ab6500-2c91-11ea-8b75-5c6016b38d6c.png" alt="image" /></a></p>

<p>Most Starred Github Repository:</p>

<p><a href="https://github.com/ruanbekker/ansible-docker-swarm"><img src="https://user-images.githubusercontent.com/567298/71640413-2cff5600-2c92-11ea-8f14-4ed0748c4a8d.png" alt="image" /></a></p>

<p>Most Starred Gist:</p>

<p><a href="https://gist.github.com/ruanbekker/e8a09604b14f37e8d2f743a87b930f93"><img src="https://user-images.githubusercontent.com/567298/71640429-646e0280-2c92-11ea-9075-23572e166e8c.png" alt="image" /></a></p>

<h2>Analytics</h2>

<p>Some analytics for my blog posts:</p>

<h3>blog.ruanbekker.com</h3>

<p>Analytics for <a href="https://blog.ruanbekker.com/?utm_source=blog&amp;utm_medium=blog-ruanbekker-com&amp;utm_campaign=year_in_review_2019">blog.ruanbekker.com</a>:</p>

<p><img src="https://user-images.githubusercontent.com/567298/71640457-ffff7300-2c92-11ea-9e3f-916614e70b7f.png" alt="image" /></p>

<p>Top 10 Most Viewed Pages:</p>

<p><img src="https://user-images.githubusercontent.com/567298/71640465-24f3e600-2c93-11ea-8cdc-fe74c5c80c13.png" alt="image" /></p>

<p>Most Viewed by Country:</p>

<p><img src="https://user-images.githubusercontent.com/567298/71640475-61bfdd00-2c93-11ea-923d-2099b46a75fd.png" alt="image" /></p>

<h4>sysadmins.co.za</h4>

<p>Analytics for <a href="https://sysadmins.co.za/?utm_source=blog&amp;utm_medium=blog-ruanbekker-com&amp;utm_campaign=year_in_review_2019">sysadmins.co.za</a>:</p>

<p><img src="https://user-images.githubusercontent.com/567298/71640485-a2b7f180-2c93-11ea-8d4e-fa1251070008.png" alt="image" /></p>

<p>Top 10 Most Viewed Pages:</p>

<p><img src="https://user-images.githubusercontent.com/567298/71640496-d85cda80-2c93-11ea-9983-230d6e85171d.png" alt="image" /></p>

<p>Most Viewed by Country:</p>

<p><img src="https://user-images.githubusercontent.com/567298/71640505-080be280-2c94-11ea-88f8-aaad194983b3.png" alt="image" /></p>

<h2>Authors on Blogposts:</h2>

<p>A list of places where I blog on:</p>

<ul>
<li><a href="https://devconnected.com/author/ruan_bekker/">devconnected.com</a></li>
<li><a href="https://medium.com/faun/tutorial-on-using-gitlab-ci-cd-pipelines-to-deploy-your-python-flask-restful-api-with-postgres-on-cad91a3638c4">faun.dev</a></li>
<li><a href="https://medium.com/@ruanbekker">medium.com</a></li>
<li><a href="https://www.civo.com/learn/setup-a-3-node-docker-swarm">civo.com</a></li>
<li><a href="https://dev.to/ruanbekker">dev.to</a></li>
<li><a href="http://blog.pistack.co.za/author/ruan/">blog.pistack.co.za</a></li>
<li><a href="https://sysadmins.co.za/author/ruan/">sysadmins.co.za</a></li>
<li><a href="https://blog.ruanbekker.com/blog/archives/">blog.ruanbekker.com</a></li>
<li><a href="https://ruan.dev/blog/">ruan.dev</a></li>
</ul>


<h2>Proud Moments</h2>

<p>Some of my proud moments on Twitter:</p>

<h4>2019.06.11 - Scaleway Tweet on Kapsule</h4>

<blockquote class="twitter-tweet"><p lang="en" dir="ltr">Thanks <a href="https://twitter.com/ruanbekker?ref_src=twsrc%5Etfw">@ruanbekker</a> for your series of blogposts about Scaleway Kapsule. ;) <a href="https://t.co/4IGUuXneA7">https://t.co/4IGUuXneA7</a></p>&mdash; Scaleway (@Scaleway) <a href="https://twitter.com/Scaleway/status/1138371911837200387?ref_src=twsrc%5Etfw">June 11, 2019</a></blockquote>


<h4>2019.06.11 - Traefik Tweet on Kubernetes</h4>

<blockquote class="twitter-tweet"><p lang="en" dir="ltr">ðŸŽ‰ Check out this great community post by <a href="https://twitter.com/ruanbekker?ref_src=twsrc%5Etfw">@ruanbekker</a>! &quot;Setup Traefik as an Ingress Controller on <a href="https://twitter.com/hashtag/Kubernetes?src=hash&amp;ref_src=twsrc%5Etfw">#Kubernetes</a>&quot; Thanks, Ruan! ðŸ¤—<a href="https://t.co/BHVmI46gmx">https://t.co/BHVmI46gmx</a> <a href="https://twitter.com/hashtag/traefik?src=hash&amp;ref_src=twsrc%5Etfw">#traefik</a> <a href="https://t.co/9N8NOkZNrk">pic.twitter.com/9N8NOkZNrk</a></p>&mdash; Traefik (@traefik) <a href="https://twitter.com/traefik/status/1138415586898264065?ref_src=twsrc%5Etfw">June 11, 2019</a></blockquote>


<h4>2019.07.13 - Mention from OpenFaas on VSCode Demo</h4>

<blockquote class="twitter-tweet"><p lang="en" dir="ltr">Run everything in your browser with VSCode! <a href="https://t.co/ZasPSfibI8">https://t.co/ZasPSfibI8</a></p>&mdash; OpenFaaS (@openfaas) <a href="https://twitter.com/openfaas/status/1150145331138613250?ref_src=twsrc%5Etfw">July 13, 2019</a></blockquote>


<h4>2019.07.14 - Elasticsearch Tweet from Devconnected</h4>

<blockquote class="twitter-tweet"><p lang="en" dir="ltr">Are you curious about how to setup a complete Elasticsearch (<a href="https://twitter.com/elastic?ref_src=twsrc%5Etfw">@elastic</a>) cluster on Ubuntu 18.04?<br><br>System Development Engineer <a href="https://twitter.com/ruanbekker?ref_src=twsrc%5Etfw">@ruanbekker</a> wrote an entire guide about it, and you should read it!<a href="https://t.co/fyoulehOce">https://t.co/fyoulehOce</a><a href="https://twitter.com/hashtag/elasticsearch?src=hash&amp;ref_src=twsrc%5Etfw">#elasticsearch</a> <a href="https://twitter.com/hashtag/devops?src=hash&amp;ref_src=twsrc%5Etfw">#devops</a> <a href="https://twitter.com/hashtag/opensource?src=hash&amp;ref_src=twsrc%5Etfw">#opensource</a> <a href="https://t.co/2uRrqjXDxC">pic.twitter.com/2uRrqjXDxC</a></p>&mdash; devconnected.com (@devconnectedcom) <a href="https://twitter.com/devconnectedcom/status/1150824768536489986?ref_src=twsrc%5Etfw">July 15, 2019</a></blockquote>


<h4>2019.08.14 - Rancher&rsquo;s Tweet on my Rpi K3s Blogpost</h4>

<blockquote class="twitter-tweet"><p lang="en" dir="ltr">&#39;Running Kubernetes (K3S) on RaspberryPi 4&#39; by <a href="https://twitter.com/ruanbekker?ref_src=twsrc%5Etfw">@ruanbekker</a> <a href="https://twitter.com/hashtag/kubernetes?src=hash&amp;ref_src=twsrc%5Etfw">#kubernetes</a> <a href="https://twitter.com/hashtag/k3s?src=hash&amp;ref_src=twsrc%5Etfw">#k3s</a> <a href="https://twitter.com/hashtag/RaspberryPi?src=hash&amp;ref_src=twsrc%5Etfw">#RaspberryPi</a> <a href="https://twitter.com/hashtag/arm?src=hash&amp;ref_src=twsrc%5Etfw">#arm</a> <a href="https://t.co/sukR1FwyG8">https://t.co/sukR1FwyG8</a></p>&mdash; Rancher Labs (@Rancher_Labs) <a href="https://twitter.com/Rancher_Labs/status/1161289162831605761?ref_src=twsrc%5Etfw">August 13, 2019</a></blockquote>


<h4>2019.08.19 - Civo Learn Guide</h4>

<blockquote class="twitter-tweet"><p lang="en" dir="ltr">Learn guide: Set up a 3 node <a href="https://twitter.com/Docker?ref_src=twsrc%5Etfw">@Docker</a> swarm on Ubuntu. Guide by <a href="https://twitter.com/ruanbekker?ref_src=twsrc%5Etfw">@ruanbekker</a> <a href="https://t.co/QxOxv6eRAy">https://t.co/QxOxv6eRAy</a> <a href="https://t.co/NgzSlprE06">pic.twitter.com/NgzSlprE06</a></p>&mdash; Civo Cloud (@CivoCloud) <a href="https://twitter.com/CivoCloud/status/1163448790675861504?ref_src=twsrc%5Etfw">August 19, 2019</a></blockquote>




<blockquote class="twitter-tweet"><p lang="en" dir="ltr">I have to say, this one made intuitively more sense to me than a lot of containerisation articles! And I&#39;m not just saying that because I hit publish on it :D</p>&mdash; Kai (@KaiPMDH) <a href="https://twitter.com/KaiPMDH/status/1163732578148462594?ref_src=twsrc%5Etfw">August 20, 2019</a></blockquote>


<h4>2019.10.09 - Civo Marketplace MongoDB</h4>

<ul>
<li><a href="https://github.com/civo/kubernetes-marketplace/pull/8">https://github.com/civo/kubernetes-marketplace/pull/8</a></li>
</ul>


<blockquote class="twitter-tweet"><p lang="en" dir="ltr">Thank you very much <a href="https://twitter.com/ruanbekker?ref_src=twsrc%5Etfw">@ruanbekker</a> for adding <a href="https://twitter.com/MongoDB?ref_src=twsrc%5Etfw">@MongoDB</a> to our open source Kubernetes marketplace! <a href="https://t.co/04Na1XFEtW">https://t.co/04Na1XFEtW</a> <a href="https://twitter.com/hashtag/kubernetes?src=hash&amp;ref_src=twsrc%5Etfw">#kubernetes</a> <a href="https://twitter.com/hashtag/k8s?src=hash&amp;ref_src=twsrc%5Etfw">#k8s</a> <a href="https://twitter.com/hashtag/k3s?src=hash&amp;ref_src=twsrc%5Etfw">#k3s</a> <a href="https://twitter.com/hashtag/KUBE100?src=hash&amp;ref_src=twsrc%5Etfw">#KUBE100</a> <a href="https://twitter.com/hashtag/mongodb?src=hash&amp;ref_src=twsrc%5Etfw">#mongodb</a> <a href="https://t.co/FMi4mMPn3A">pic.twitter.com/FMi4mMPn3A</a></p>&mdash; Civo Cloud (@CivoCloud) <a href="https://twitter.com/CivoCloud/status/1181910916469858305?ref_src=twsrc%5Etfw">October 9, 2019</a></blockquote>


<h4>2019.10.23 - Civo Marketplace Jenkins</h4>

<ul>
<li><a href="https://github.com/civo/kubernetes-marketplace/pull/12">https://github.com/civo/kubernetes-marketplace/pull/12</a></li>
</ul>


<blockquote class="twitter-tweet"><p lang="en" dir="ltr">Thanks to <a href="https://twitter.com/ruanbekker?ref_src=twsrc%5Etfw">@ruanbekker</a> for submitting <a href="https://twitter.com/jenkinsci?ref_src=twsrc%5Etfw">@jenkinsci</a> to our open Kubernetes Marketplace running on the world&#39;s first managed k3s service! <a href="https://twitter.com/hashtag/jenkins?src=hash&amp;ref_src=twsrc%5Etfw">#jenkins</a> <a href="https://twitter.com/hashtag/k3s?src=hash&amp;ref_src=twsrc%5Etfw">#k3s</a> <a href="https://twitter.com/hashtag/opensource?src=hash&amp;ref_src=twsrc%5Etfw">#opensource</a> <a href="https://twitter.com/hashtag/kubernetes?src=hash&amp;ref_src=twsrc%5Etfw">#kubernetes</a> <a href="https://t.co/aW1FVKOqfY">pic.twitter.com/aW1FVKOqfY</a></p>&mdash; Civo Cloud (@CivoCloud) <a href="https://twitter.com/CivoCloud/status/1186967773655773184?ref_src=twsrc%5Etfw">October 23, 2019</a></blockquote>


<h4>2019.11.05 - Traefik Swag</h4>

<blockquote class="twitter-tweet"><p lang="en" dir="ltr">We are honored to send that! Thanks for being an amazing community member, and writing awesome posts!! ðŸŽ<a href="https://twitter.com/hashtag/traefik?src=hash&amp;ref_src=twsrc%5Etfw">#traefik</a></p>&mdash; Traefik (@traefik) <a href="https://twitter.com/traefik/status/1191786730153639936?ref_src=twsrc%5Etfw">November 5, 2019</a></blockquote>


<h4>2019.11.14 - Mentions on Civo Blog for KUBE100</h4>

<blockquote class="twitter-tweet"><p lang="en" dir="ltr">New blog! <a href="https://twitter.com/hashtag/KUBE100?src=hash&amp;ref_src=twsrc%5Etfw">#KUBE100</a>: The Story So Far.<br><br>Detailing our journey launching the world&#39;s first managed k3s service!<br><br>ðŸ‘‰<a href="https://t.co/p7SyhcMXPb">https://t.co/p7SyhcMXPb</a><a href="https://twitter.com/hashtag/k8s?src=hash&amp;ref_src=twsrc%5Etfw">#k8s</a> <a href="https://twitter.com/hashtag/kubernetes?src=hash&amp;ref_src=twsrc%5Etfw">#kubernetes</a> <a href="https://twitter.com/hashtag/k3s?src=hash&amp;ref_src=twsrc%5Etfw">#k3s</a></p>&mdash; Civo Cloud (@CivoCloud) <a href="https://twitter.com/CivoCloud/status/1194994631240540160?ref_src=twsrc%5Etfw">November 14, 2019</a></blockquote>


<p>Some proud moments from mentions on blog posts:</p>

<h4>2019.08.06 - VPNCloud Peer to Peer Docs</h4>

<ul>
<li><a href="https://vpncloud.ddswd.de/docs/">https://vpncloud.ddswd.de/docs/</a></li>
</ul>


<p><img src="https://user-images.githubusercontent.com/30043398/62545960-efbda600-b862-11e9-9777-236ae30e15e3.png" alt="image" /></p>

<h4>2019.08.06 - MarkHeath Blog Post Mention</h4>

<ul>
<li><a href="https://markheath.net/post/exploring-elasticsearch-with-docker">https://markheath.net/post/exploring-elasticsearch-with-docker</a></li>
</ul>


<p><img src="https://user-images.githubusercontent.com/30043398/62548509-37463100-b867-11e9-9dba-046d6ec6f1cf.png" alt="image" /></p>

<h4>2019.08.08 - Civo Docker Swarm Blogpost</h4>

<ul>
<li><a href="https://www.civo.com/learn/setup-a-3-node-docker-swarm">https://www.civo.com/learn/setup-a-3-node-docker-swarm</a></li>
</ul>


<h4>2019.08.13 - Raspberry Pi Post (teamserverless)</h4>

<ul>
<li><a href="https://github.com/teamserverless/k8s-on-raspbian/pull/20">https://github.com/teamserverless/k8s-on-raspbian/pull/20</a></li>
</ul>


<h4>2019.10.11 - Serverless Email - Migration OpenFaas Blog post:</h4>

<ul>
<li><a href="https://serverless.email/issues/122">https://serverless.email/issues/122</a></li>
</ul>


<h2>Certifications:</h2>

<p>MongoDB Basics:</p>

<p><img src="https://user-images.githubusercontent.com/567298/71640576-435ae100-2c95-11ea-8f07-e29c1ebd2972.png" alt="image" /></p>

<p>MongoDB Cluster Administration:</p>

<p><img src="https://user-images.githubusercontent.com/567298/71640586-5968a180-2c95-11ea-82b5-7ae0f8d30cd2.png" alt="image" /></p>

<h2>Thank You</h2>

<p>Thank you for reading. If you like my content, feel free to visit me at <strong><a href="https://ruan.dev/">ruan.dev</a></strong> or follow me on twitter at <strong><a href="https://twitter.com/ruanbekker">@ruanbekker</a></strong></p>

<p><a href="https://twitter.com/ruanbekker"><img src="https://user-images.githubusercontent.com/567298/71188576-e2410f80-2289-11ea-8667-08f0c14ab7b5.png" alt="" /></a></p>

<p><a href="https://ko-fi.com/A6423ZIQ"><img src="https://www.ko-fi.com/img/githubbutton_sm.svg" alt="ko-fi" /></a></p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/3">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/index.html">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Subscribe</h1>
  <!-- Begin MailChimp Signup Form -->
  <div id="mc_embed_signup">
  <form action="https://sysadmins.us15.list-manage.com/subscribe/post?u=3dfcff447b6ee598231eeb658&amp;id=3542f323a9" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
      <div class="indicates-required"><span class="asterisk"></span></div>
      <div class="mc-field-group">
	<label for="mce-EMAIL">Email Address:  <span class="asterisk"></span>
        </label>
	<input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL">
        </div>
	<div id="mce-responses" class="clear">
	  <div class="response" id="mce-error-response" style="display:none"></div>
	  <div class="response" id="mce-success-response" style="display:none"></div>
	</div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
      <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_3dfcff447b6ee598231eeb658_3542f323a9" tabindex="-1" value=""></div>
    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
    </div>
  </form>
</div>
<!--End mc_embed_signup-->
</section>

<section>
  <h1>Slack</h1>
  Join me on <a href="http://linux-hackers.slack.com">Slack</a>
</section>

<section>
  <h1>Twitter</h1>
  Follow me on Twitter: <a href="https://twitter.com/ruanbekker">@ruanbekker</a>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2020/04/28/nginx-analysis-dashboard-using-grafana-and-elasticsearch/">Nginx Analysis Dashboard Using Grafana and Elasticsearch</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/04/27/how-to-do-port-forwarding-with-iptables/">How to Do Port Forwarding With Iptables</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/04/27/how-to-set-a-static-ip-in-ubuntu-18/">How to Set a Static IP in Ubuntu 18</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/04/26/graphing-covid-19-stats-with-grafana-and-elasticsearch-using-python/">Graphing Covid-19 Stats With Grafana and Elasticsearch Using Python</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/04/25/nginx-metrics-on-prometheus-with-the-nginx-log-exporter/">Nginx Metrics on Prometheus With the Nginx Log Exporter</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Free $100 Credit</h1>
  <ul id=""></ul>
  <p></p>
  <strong>May 2020</strong>: Receive $100 to test on Vultr when you sign up.
  <p></p>
  <a href="https://www.vultr.com/?ref=8373836-6G"><img src="https://www.vultr.com/media/banners/banner_160x600.png" width="160" height="600"></a>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2020 - Ruan -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>



  <li>
    <a href="https://twitter.com/ruanbekker">
      <i class="fa fa-twitter"></i> Twitter
    </a>
  </li>



  <li>
    <a href="https://github.com/ruanbekker">
      <i class="fa fa-github"></i> GitHub
    </a>
  </li>



  <li>
    <a href="https://sysadmins.co.za">
      <i class="fa fa-bars"></i> My HowTo Blog
    </a>
  </li>


</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'blog-ruanbekker';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





      <script data-ad-client="ca-pub-1100086574264181" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <!-- old
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-1543437721119411",
        enable_page_level_ads: true
      });
    </script>
    -->


</body>
</html>
