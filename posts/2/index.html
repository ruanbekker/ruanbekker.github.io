
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Ruan Bekker's Blog</title>
  <meta name="author" content="Ruan">

  
  <meta name="description" content="Quick Post on how to use ssmtp on Alpine Linux to Send Mail: Update and Install SSMTP 1
2
$ apk update
$ apk add ssmtp Configure SSMTP 1
2
3
4
5
6
$ &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">


  <!-- font awesome --!>
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

  
  <link rel="canonical" href="http://blog.ruanbekker.com/posts/2/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Ruan Bekker's Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-105336110-1']);
    _gaq.push(['_setDomainName','ruanbekker.com']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Ruan Bekker's Blog</a></h1>
  
    <h2>From a Curious mind to Posts on Github</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="blog.ruanbekker.com">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/blog/categories/aws/">AWS</a></li>
  <li><a href="/blog/categories/devops/">DevOps</a></li>
  <li><a href="/blog/categories/python/">Python</a></li>
  <li><a target="_blank" href="https://sysadmins.co.za">My HowTo Blog</a></li>
  <li><a href="/awesome-links/">Awesome Links</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/10/09/sending-mail-with-ssmtp-on-alpine-linux/">Sending Mail With SSMTP on Alpine Linux</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-10-09T16:36:35-04:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>9</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>4:36 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Quick Post on how to use ssmtp on Alpine Linux to Send Mail:</p>

<h2>Update and Install SSMTP</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>apk update
</span><span class='line'><span class="nv">$ </span>apk add ssmtp
</span></code></pre></td></tr></table></div></figure>


<h2>Configure SSMTP</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>cat &gt; /etc/ssmtp/ssmtp.conf <span class="s">&lt;&lt; EOF</span>
</span><span class='line'><span class="s">root=postmaster</span>
</span><span class='line'><span class="s">mailhub=mail.domain.com:25</span>
</span><span class='line'><span class="s">hostname=`hostname`</span>
</span><span class='line'><span class="s">FromLineOverride=YES</span>
</span><span class='line'><span class="s">EOF</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Create the Mail Content</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>cat &gt; mail.txt <span class="s">&lt;&lt; EOF</span>
</span><span class='line'><span class="s">To: recipient@domain.com</span>
</span><span class='line'><span class="s">From: sender@domain.com</span>
</span><span class='line'><span class="s">Subject: Mail with SSMTP</span>
</span><span class='line'>
</span><span class='line'><span class="s">Hello, this is a test mail.</span>
</span><span class='line'><span class="s">EOF</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Testing Mail Delivery</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>ssmtp recipient@domain.com &lt; file.txt
</span></code></pre></td></tr></table></div></figure>


<h2>Related:</h2>

<ul>
<li><a href="https://support.cloud.engineyard.com/hc/en-us/articles/205407478-Set-Up-SSMTP-for-Mail-Relay-to-AuthSMTP">Using Gmail as a Relay Host</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/10/03/backup-and-restore-mutliple-collections-from-a-database-with-mongodb/">Backup and Restore Mutliple Collections From a Database With MongoDB</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-10-03T16:42:34-04:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>3</span><span class='date-suffix'>rd</span>, <span class='date-year'>2017</span></span> <span class='time'>4:42 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>From a previous post we&rsquo;ve  <a href="http://blog.ruanbekker.com/blog/2017/09/02/setup-a-3-node-mongodb-replica-set-on-ubuntu-16/">Setup a MongoDB Cluster</a>, and in this post we will go through the steps of backing up a database and restoring it to another mongodb cluster.</p>

<p><a href="http://mlab.com/">MLab</a> offers a free Shared MongoDB Hosted Service with a limitation of 500MB, which I will be using to restore my data from my own hosted cluster to the free MLab service.</p>

<h2>Create the MongoDB Backup</h2>

<p>First we will need to create our backup path, and then backup our database, in my case, I am backing up my <code>rocketchat</code> database:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>mkdir -p /opt/backups/mongodb
</span><span class='line'><span class="nv">$ </span>mongodump --host mongodb.example.com --port <span class="m">27017</span> -u &lt;mongouser&gt; --authenticationDatabase &lt;authdb&gt; --db rocketchat --out /opt/backups/mongodb/
</span></code></pre></td></tr></table></div></figure>


<p>Change into the backup directory:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span><span class="nb">cd</span> /opt/backups/mongodb/rocketchat/
</span></code></pre></td></tr></table></div></figure>


<p>You will find the <code>bson</code> and <code>json metadata</code> files for each collection:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>ls -l <span class="p">|</span> awk <span class="s1">&#39;{print $9}&#39;</span> <span class="p">|</span> head -9
</span><span class='line'>custom_emoji.chunks.bson
</span><span class='line'>custom_emoji.chunks.metadata.json
</span><span class='line'>custom_emoji.files.bson
</span><span class='line'>custom_emoji.files.metadata.json
</span><span class='line'>instances.bson
</span><span class='line'>instances.metadata.json
</span><span class='line'>meteor_accounts_loginServiceConfiguration.bson
</span><span class='line'>meteor_accounts_loginServiceConfiguration.metadata.json
</span><span class='line'>...
</span></code></pre></td></tr></table></div></figure>


<h2>Restore MongoDB Database</h2>

<p>We will need to restore all the collections to our new mongodb service, I have created a bash script (<code>restore-mongodb.sh</code>) that will restore each collection to our <code>rocketchat</code> database:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/usr/bin/env bash</span>
</span><span class='line'>
</span><span class='line'><span class="nv">mongo_user</span><span class="o">=</span>&lt;mongouser&gt;
</span><span class='line'><span class="nv">mongo_pass</span><span class="o">=</span>&lt;mongopass&gt;
</span><span class='line'>
</span><span class='line'><span class="k">for</span> file in <span class="sb">`</span>ls <span class="p">|</span> grep bson<span class="sb">`</span>
</span><span class='line'>  <span class="k">do</span>
</span><span class='line'>    <span class="k">for</span> collection in <span class="sb">`</span><span class="nb">echo</span> <span class="nv">$file</span> <span class="p">|</span> sed <span class="s1">&#39;s/.bson//g&#39;</span><span class="sb">`</span>
</span><span class='line'>  <span class="k">do</span>
</span><span class='line'>    mongorestore --host mymongoid.mlab.com --port <span class="m">12345</span> -u <span class="nv">$mongo_user</span> -p <span class="nv">$mongo_pass</span> -d rocketchat -c <span class="nv">$collection</span> <span class="nv">$file</span>
</span><span class='line'>    sleep 2
</span><span class='line'>  <span class="k">done</span>
</span><span class='line'><span class="k">done</span>
</span></code></pre></td></tr></table></div></figure>


<p>Change the permissions of your script to make it executable and execute the script:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>chmod +x restore-mongodb.sh
</span><span class='line'><span class="nv">$ </span>./restore-mongodb.sh
</span><span class='line'>
</span><span class='line'>2017-10-03T22:05:39.138+0200    checking <span class="k">for</span> collection data in custom_emoji.chunks.bson
</span><span class='line'>2017-10-03T22:05:39.159+0200    reading metadata <span class="k">for</span> rocketchat.custom_emoji.chunks from custom_emoji.chunks.metadata.json
</span><span class='line'>2017-10-03T22:05:39.211+0200    restoring rocketchat.custom_emoji.chunks from custom_emoji.chunks.bson
</span><span class='line'>2017-10-03T22:05:39.900+0200    restoring indexes <span class="k">for</span> collection rocketchat.custom_emoji.chunks from metadata
</span><span class='line'>2017-10-03T22:05:39.922+0200    finished restoring rocketchat.custom_emoji.chunks <span class="o">(</span><span class="m">20</span> documents<span class="o">)</span>
</span><span class='line'>2017-10-03T22:05:39.922+0200    <span class="k">done</span>
</span><span class='line'>2017-10-03T22:05:42.188+0200    checking <span class="k">for</span> collection data in custom_emoji.files.bson
</span><span class='line'>2017-10-03T22:05:42.231+0200    reading metadata <span class="k">for</span> rocketchat.custom_emoji.files from custom_emoji.files.metadata.json
</span><span class='line'>2017-10-03T22:05:42.252+0200    restoring rocketchat.custom_emoji.files from custom_emoji.files.bson
</span><span class='line'>2017-10-03T22:05:42.623+0200    restoring indexes <span class="k">for</span> collection rocketchat.custom_emoji.files from metadata
</span><span class='line'>2017-10-03T22:05:42.645+0200    finished restoring rocketchat.custom_emoji.files <span class="o">(</span><span class="m">20</span> documents<span class="o">)</span>
</span><span class='line'>2017-10-03T22:05:42.645+0200    <span class="k">done</span>
</span><span class='line'>...
</span></code></pre></td></tr></table></div></figure>


<h2>Checkout the New MongoDB Database:</h2>

<p>Once the restore has been done, logon to your new mongodb database and have a look at the collections in the database:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>mongo mymongoid.mlab.com:12345/rocketchat -u &lt;mongouser&gt; -p
</span><span class='line'>MongoDB shell version v3.4.7
</span><span class='line'>Enter password:
</span><span class='line'>connecting to: mongodb://mymongoid.mlab.com:12345/rocketchat
</span><span class='line'>MongoDB server version: 3.4.9
</span><span class='line'>
</span><span class='line'>rs-mymongoid:PRIMARY&gt; show collections
</span><span class='line'>_raix_push_app_tokens
</span><span class='line'>_raix_push_notifications
</span><span class='line'>custom_emoji.chunks
</span><span class='line'>custom_emoji.files
</span><span class='line'>instances
</span></code></pre></td></tr></table></div></figure>


<h2>Resources:</h2>

<ul>
<li><a href="https://docs.mongodb.com/manual/reference/program/mongodump/">https://docs.mongodb.com/manual/reference/program/mongodump/</a></li>
<li><a href="https://docs.mongodb.com/manual/reference/program/mongorestore/">https://docs.mongodb.com/manual/reference/program/mongorestore/</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/09/24/creating-a-nodejs-hostname-app-with-docker-stacks-on-swarm/">Creating a Nodejs Hostname App With Docker Stacks on Swarm</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-09-24T17:52:51-04:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>24</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>5:52 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Create a Nodejs Application that responds GET requests with its Hostname.</p>

<p>Our nodejs application will sit beind a HAProxy Load Balancer, we are mounting the <code>docker.sock</code> from the host to the container, so as we scale our web application, our load balancer is aware of the changes, and scales as we scale our web application.</p>

<h2>Creating the Application:</h2>

<p>Our nodejs application:</p>

<figure class='code'><figcaption><span>app.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">os</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;os&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span> <span class="s1">&#39;text/html&#39;</span><span class="p">});</span>
</span><span class='line'>    <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="err">`</span><span class="nx">My</span> <span class="nx">Hostname</span><span class="o">:</span> <span class="nx">$</span><span class="p">{</span><span class="nx">os</span><span class="p">.</span><span class="nx">hostname</span><span class="p">()}</span><span class="err">\</span><span class="nx">n</span><span class="err">`</span><span class="p">);</span>
</span><span class='line'><span class="p">}).</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8080</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Our Dockerfile:</p>

<figure class='code'><figcaption><span>Dockerfile</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='docker'><span class='line'><span class="k">FROM</span> node:alpine
</span><span class='line'><span class="k">ADD</span> app.js /app.js
</span><span class='line'><span class="k">CMD</span> <span class="o">[</span><span class="s2">&quot;node&quot;</span>, <span class="s2">&quot;/app.js&quot;</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Build and Push to your registry, or you could use my image on Dockerhub: <a href="https://hub.docker.com/r/rbekker87/node-containername/">hub.docker.com/r/rbekker87/node-containername</a></p>

<figure class='code'><figcaption><span>Build and Push</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker login
</span><span class='line'><span class="nv">$ </span>docker build -t &lt;username&gt;/&lt;repo&gt;:&lt;tag&gt; .
</span><span class='line'><span class="nv">$ </span>docker push  &lt;username&gt;/&lt;repo&gt;:&lt;tag&gt;
</span></code></pre></td></tr></table></div></figure>


<h2>Creating the Compose file</h2>

<p>Create the compose file that will define our services:</p>

<figure class='code'><figcaption><span>docker-compose.yml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>version: <span class="s1">&#39;3&#39;</span>
</span><span class='line'>
</span><span class='line'>services:
</span><span class='line'>  node-app:
</span><span class='line'>    image: rbekker87/node-containername
</span><span class='line'>    networks:
</span><span class='line'>      - nodenet
</span><span class='line'>    environment:
</span><span class='line'>      - <span class="nv">SERVICE_PORTS</span><span class="o">=</span>8080
</span><span class='line'>    deploy:
</span><span class='line'>      replicas: 20
</span><span class='line'>      update_config:
</span><span class='line'>        parallelism: 5
</span><span class='line'>        delay: 10s
</span><span class='line'>      restart_policy:
</span><span class='line'>        condition: on-failure
</span><span class='line'>        max_attempts: 3
</span><span class='line'>        window: 120s
</span><span class='line'>
</span><span class='line'>  loadbalancer:
</span><span class='line'>    image: dockercloud/haproxy:latest
</span><span class='line'>    depends_on:
</span><span class='line'>      - node-app
</span><span class='line'>    environment:
</span><span class='line'>      - <span class="nv">BALANCE</span><span class="o">=</span>leastconn
</span><span class='line'>    volumes:
</span><span class='line'>      - /var/run/docker.sock:/var/run/docker.sock
</span><span class='line'>    ports:
</span><span class='line'>      - 80:80
</span><span class='line'>    networks:
</span><span class='line'>      - nodenet
</span><span class='line'>    deploy:
</span><span class='line'>      placement:
</span><span class='line'>        constraints: <span class="o">[</span>node.role <span class="o">==</span> manager<span class="o">]</span>
</span><span class='line'>
</span><span class='line'>networks:
</span><span class='line'>  nodenet:
</span><span class='line'>    driver: overlay
</span></code></pre></td></tr></table></div></figure>


<h2>Create the Stack:</h2>

<p>Deploy the Stack by specifying the compose file and name of our stack:</p>

<figure class='code'><figcaption><span>Deploy our Stack</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker stack deploy -c docker-compose.yml node
</span></code></pre></td></tr></table></div></figure>


<p>List the Services in the Stack:</p>

<figure class='code'><figcaption><span>List Services in our Stack</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker stack ls
</span><span class='line'>NAME                SERVICES
</span><span class='line'>node                2
</span></code></pre></td></tr></table></div></figure>


<p>List the Tasks in the Stack:</p>

<figure class='code'><figcaption><span>Tasks in our Stack</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker stack ps node
</span><span class='line'>ID                  NAME                  IMAGE                                 NODE     DESIRED STATE       CURRENT STATE            ERROR               PORTS
</span><span class='line'>l5ryfaedzzaq        node_loadbalancer.1   dockercloud/haproxy:latest            dsm-01   Running             Running <span class="m">40</span> minutes ago
</span><span class='line'>c8nrrcvek79h        node_node-app.5       rbekker87/node-containername:latest   dsm-01   Running             Running <span class="m">40</span> minutes ago
</span><span class='line'>dqii18b2q5nn        node_node-app.10      rbekker87/node-containername:latest   dsm-01   Running             Running <span class="m">40</span> minutes ago
</span><span class='line'>vkpw2rugy0ah        node_node-app.11      rbekker87/node-containername:latest   dsm-01   Running             Running <span class="m">40</span> minutes ago
</span><span class='line'>mm88nvnvy5lg        node_node-app.12      rbekker87/node-containername:latest   dsm-01   Running             Running <span class="m">40</span> minutes ago
</span><span class='line'>oyx8rfqc1xl2        node_node-app.16      rbekker87/node-containername:latest   dsm-01   Running             Running <span class="m">41</span> minutes ago
</span></code></pre></td></tr></table></div></figure>


<h2>Test out our Application</h2>

<p>Test out the Service:</p>

<figure class='code'><figcaption><span>GET Requests</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>curl -XGET http://127.0.0.1/
</span><span class='line'>My Hostname: a6e34246e73b
</span><span class='line'>
</span><span class='line'><span class="nv">$ </span>curl -XGET http://127.0.0.1/
</span><span class='line'>My Hostname: 5de71278be38
</span><span class='line'>
</span><span class='line'><span class="nv">$ </span>curl -XGET http://127.0.0.1/
</span><span class='line'>My Hostname: e0b7316fdd51
</span></code></pre></td></tr></table></div></figure>


<h2>Scaling Out:</h2>

<p>Scale our Application out to 30 replica&rsquo;s</p>

<figure class='code'><figcaption><span>Scaling Up</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker service scale node-app<span class="o">=</span>30
</span></code></pre></td></tr></table></div></figure>


<p>Scale our Application down to 10 replica&rsquo;s</p>

<figure class='code'><figcaption><span>Scaling Down</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker service scale node-app<span class="o">=</span>10
</span></code></pre></td></tr></table></div></figure>


<h2>Cleanup</h2>

<p>Remove the Stack:</p>

<figure class='code'><figcaption><span>Delete the Stack</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker stack rm node
</span><span class='line'>Removing service node_loadbalancer
</span><span class='line'>Removing service node_node-app
</span><span class='line'>Removing network node_nodenet
</span></code></pre></td></tr></table></div></figure>


<h2>Resources:</h2>

<ul>
<li><a href="https://github.com/ruanbekker/docker-node-containername">https://github.com/ruanbekker/docker-node-containername</a></li>
<li><a href="https://hub.docker.com/r/rbekker87/node-containername/">https://hub.docker.com/r/rbekker87/node-containername/</a></li>
<li><a href="https://medium.com/@nirgn/load-balancing-applications-with-haproxy-and-docker-d719b7c5b231">Resource 1</a> + <a href="http://anokun7.github.io/microservices-demo/">Resource 2</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/09/24/create-a-3-node-elasticsearch-stack-with-haproxy-on-docker-swarm/">Create a 3 Node Elasticsearch Stack With HAProxy on Docker Swarm</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-09-24T15:40:19-04:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>24</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>3:40 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Tried out creating a 3 node elasticsearch stack on docker swarm using docker-compose, that sits behind a haproxy service.</p>

<h2>Environment:</h2>

<p>Images:</p>

<ul>
<li><a href="https://hub.docker.com/r/dockercloud/haproxy/">dockercloud/haproxy</a></li>
<li><a href="https://github.com/ruanbekker/docker-elasticsearch">rbekker87/elasticsearch:master-5.6-alpine</a></li>
</ul>


<p>Stack:</p>

<ul>
<li>1 x haproxy</li>
<li>1 x elasticsearch master (haproxy wont send requests to this one)</li>
<li>2 x elasticsearch master/data</li>
<li>1 x esnet overlay network</li>
</ul>


<h2>Defining our Stack</h2>

<p>First we will create our compose file, which we will call <code>es-compose.yml</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">version</span><span class="p-Indicator">:</span> <span class="s">&#39;3&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">services</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">es-master</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">image</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">rbekker87/elasticsearch:master-5.6-alpine</span>
</span><span class='line'>    <span class="l-Scalar-Plain">networks</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">esnet</span>
</span><span class='line'>    <span class="l-Scalar-Plain">deploy</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="l-Scalar-Plain">replicas</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">1</span>
</span><span class='line'>
</span><span class='line'>  <span class="l-Scalar-Plain">es-data-1</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">image</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">rbekker87/elasticsearch:master-5.6-alpine</span>
</span><span class='line'>    <span class="l-Scalar-Plain">environment</span><span class="p-Indicator">:</span>
</span><span class='line'>     <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">SERVICE_PORTS=9200</span>
</span><span class='line'>    <span class="l-Scalar-Plain">networks</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">esnet</span>
</span><span class='line'>    <span class="l-Scalar-Plain">deploy</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="l-Scalar-Plain">replicas</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">2</span>
</span><span class='line'>
</span><span class='line'>  <span class="l-Scalar-Plain">es-data-2</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">image</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">rbekker87/elasticsearch:master-5.6-alpine</span>
</span><span class='line'>    <span class="l-Scalar-Plain">environment</span><span class="p-Indicator">:</span>
</span><span class='line'>     <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">SERVICE_PORTS=9200</span>
</span><span class='line'>    <span class="l-Scalar-Plain">networks</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">esnet</span>
</span><span class='line'>    <span class="l-Scalar-Plain">deploy</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="l-Scalar-Plain">replicas</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">2</span>
</span><span class='line'>
</span><span class='line'>  <span class="l-Scalar-Plain">loadbalancer</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">image</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">dockercloud/haproxy:latest</span>
</span><span class='line'>    <span class="l-Scalar-Plain">depends_on</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">es-data-1</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">es-data-2</span>
</span><span class='line'>    <span class="l-Scalar-Plain">environment</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">BALANCE=leastconn</span>
</span><span class='line'>    <span class="l-Scalar-Plain">volumes</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">/var/run/docker.sock:/var/run/docker.sock</span>
</span><span class='line'>    <span class="l-Scalar-Plain">ports</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">9200:80</span>
</span><span class='line'>    <span class="l-Scalar-Plain">networks</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">esnet</span>
</span><span class='line'>    <span class="l-Scalar-Plain">deploy</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="l-Scalar-Plain">placement</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">constraints</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">node.role == manager</span><span class="p-Indicator">]</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">networks</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">esnet</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">driver</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">overlay</span>
</span></code></pre></td></tr></table></div></figure>


<p>The above compose file defines that we want a overlay network, which we will associate with all our services, 3 elasticsearch services, haproxy service which will expose port 9200, then from haproxy it has a container port of 80, which sends to the backend <code>SERVICE_PORTS</code> of each elasticsearch service.</p>

<p>We have only defined <code>SERVICE_PORTS=9200</code> on our es-data services, as I just want to proxy client connections to them.</p>

<h2>Creating our Elasticsearch Stack</h2>

<p>Now that we have our compose file ready, let&rsquo;s create our stack using <code>docker stack deploy</code>:</p>

<figure class='code'><figcaption><span>Create the Stack</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker stack deploy -c es-compose.yml analytics
</span><span class='line'>
</span><span class='line'>Creating network analytics_esnet
</span><span class='line'>Creating service analytics_loadbalancer
</span><span class='line'>Creating service analytics_es-master
</span><span class='line'>Creating service analytics_es-data-1
</span><span class='line'>Creating service analytics_es-data-2
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s have a look at our stack:</p>

<figure class='code'><figcaption><span>Docker Stack Status </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker stack ps analytics
</span><span class='line'>ID                  NAME                       IMAGE                                       NODE                  DESIRED STATE       CURRENT STATE            ERROR               PORTS
</span><span class='line'>4t3ukxl2kch3        analytics_loadbalancer.1   dockercloud/haproxy:latest                  scw-swarm-master-01   Running             Running <span class="m">27</span> seconds ago
</span><span class='line'>jgbxtgqkg9jp        analytics_es-data-2.1      rbekker87/elasticsearch:master-5.6-alpine   scw-swarm-master-01   Running             Running <span class="m">33</span> seconds ago
</span><span class='line'>x5cq6pm7u7mn        analytics_es-data-1.1      rbekker87/elasticsearch:master-5.6-alpine   scw-swarm-master-01   Running             Running <span class="m">36</span> seconds ago
</span><span class='line'>5v22w1hvtdvm        analytics_es-master.1      rbekker87/elasticsearch:master-5.6-alpine   scw-swarm-master-01   Running             Running <span class="m">38</span> seconds ago
</span></code></pre></td></tr></table></div></figure>


<p>View the logs of our haproxy service:</p>

<figure class='code'><figcaption><span>HAProxy Service Logs</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker service logs -f analytics_loadbalancer
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> INFO:haproxy:dockercloud/haproxy 1.6.7 is running outside Docker Cloud
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> INFO:haproxy:Haproxy is running in SwarmMode, loading HAProxy definition through docker api
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> INFO:haproxy:dockercloud/haproxy PID: 7
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> INFO:haproxy:<span class="o">=</span>&gt; Add task: Initial start - Swarm Mode
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> INFO:haproxy:<span class="o">=</span>&gt; Executing task: Initial start - Swarm Mode
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> INFO:haproxy:<span class="o">==========</span><span class="nv">BEGIN</span><span class="o">==========</span>
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> INFO:haproxy:Linked service: analytics_es-data-1, analytics_es-data-2, analytics_es-master
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> INFO:haproxy:Linked container: analytics_es-data-1.1.u641c5bq5vkjklk8sb1scnnlc, analytics_es-data-2.1.ic9an6bzj6aejs0lx0vzfpia6, analytics_es-master.1.h4erlgwzit509p0zehzmozy3u
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> INFO:haproxy:HAProxy configuration:
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> global
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   log 127.0.0.1 local0
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   log 127.0.0.1 local1 notice
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   log-send-hostname
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   maxconn 4096
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   pidfile /var/run/haproxy.pid
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   user haproxy
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   group haproxy
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   daemon
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   stats socket /var/run/haproxy.stats level admin
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   ssl-default-bind-options no-sslv3
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   ssl-default-bind-ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:AES128-GCM-SHA256:AES128-SHA256:AES128-SHA:AES256-GCM-SHA384:AES256-SHA256:AES256-SHA:DHE-DSS-AES128-SHA:DES-CBC3-SHA
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> defaults
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   balance leastconn
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   log global
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   mode http
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   option redispatch
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   option httplog
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   option dontlognull
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   option forwardfor
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   timeout connect 5000
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   timeout client 50000
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   timeout server 50000
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> listen stats
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   <span class="nb">bind</span> :1936
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   mode http
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   stats <span class="nb">enable</span>
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   timeout connect 10s
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   timeout client 1m
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   timeout server 1m
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   stats hide-version
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   stats realm Haproxy<span class="se">\ </span>Statistics
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   stats uri /
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   stats auth stats:stats
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> frontend default_port_80
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   <span class="nb">bind</span> :80
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   reqadd X-Forwarded-Proto:<span class="se">\ </span>http
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   maxconn 4096
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   default_backend default_service
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> backend default_service
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   server analytics_es-data-1.1.u641c5bq5vkjklk8sb1scnnlc 10.0.7.5:9200 check inter <span class="m">2000</span> rise <span class="m">2</span> fall 3
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span>   server analytics_es-data-2.1.ic9an6bzj6aejs0lx0vzfpia6 10.0.7.7:9200 check inter <span class="m">2000</span> rise <span class="m">2</span> fall 3
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> INFO:haproxy:Launching HAProxy
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> INFO:haproxy:HAProxy has been launched<span class="o">(</span>PID: 10<span class="o">)</span>
</span><span class='line'>analytics_loadbalancer.1.lcpgiz0ooeas@scw-swarm-master-01    <span class="p">|</span> INFO:haproxy:<span class="o">===========</span><span class="nv">END</span><span class="o">===========</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Testing Elasticsearch:</h2>

<p>Do a GET request on our HAProxy&rsquo;s Expose port: 9200</p>

<figure class='code'><figcaption><span>Test Elasticsearch on port 9200</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>curl -XGET http://127.0.0.1:9200
</span><span class='line'><span class="o">{</span>
</span><span class='line'>  <span class="s2">&quot;name&quot;</span> : <span class="s2">&quot;5306a0c2ee24&quot;</span>,
</span><span class='line'>  <span class="s2">&quot;cluster_name&quot;</span> : <span class="s2">&quot;es-cluster&quot;</span>,
</span><span class='line'>  <span class="s2">&quot;cluster_uuid&quot;</span> : <span class="s2">&quot;FUJmMekFQVq6zXofPCin2A&quot;</span>,
</span><span class='line'>  <span class="s2">&quot;version&quot;</span> : <span class="o">{</span>
</span><span class='line'>    <span class="s2">&quot;number&quot;</span> : <span class="s2">&quot;5.6.0&quot;</span>,
</span><span class='line'>    <span class="s2">&quot;build_hash&quot;</span> : <span class="s2">&quot;781a835&quot;</span>,
</span><span class='line'>    <span class="s2">&quot;build_date&quot;</span> : <span class="s2">&quot;2017-09-07T03:09:58.087Z&quot;</span>,
</span><span class='line'>    <span class="s2">&quot;build_snapshot&quot;</span> : <span class="nb">false</span>,
</span><span class='line'>    <span class="s2">&quot;lucene_version&quot;</span> : <span class="s2">&quot;6.6.0&quot;</span>
</span><span class='line'>  <span class="o">}</span>,
</span><span class='line'>  <span class="s2">&quot;tagline&quot;</span> : <span class="s2">&quot;You Know, for Search&quot;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Have a look at the <code>/_cat/nodes</code> API:</p>

<figure class='code'><figcaption><span>Get the Node Info</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span> curl -XGET http://127.0.0.1:9200/_cat/nodes?v
</span><span class='line'>ip       heap.percent ram.percent cpu load_1m load_5m load_15m node.role master name
</span><span class='line'>10.0.7.6           <span class="m">28</span>          <span class="m">84</span>  <span class="m">14</span>    3.09    2.28     1.49 mdi       -      56c1b0aebc5f
</span><span class='line'>10.0.7.2           <span class="m">27</span>          <span class="m">84</span>  <span class="m">15</span>    3.09    2.28     1.49 mdi       *      572c68bca904
</span><span class='line'>10.0.7.4           <span class="m">29</span>          <span class="m">84</span>  <span class="m">15</span>    3.09    2.28     1.49 mdi       -      5306a0c2ee24
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/09/24/simple-program-with-c-language-on-linux/">Simple Program With C Language on Linux</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-09-24T06:41:58-04:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>24</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>6:41 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Today the idea popped up on how to write a Simple &ldquo;Hello World&rdquo; Application using C Programming Language, as I just wanted to see how it works.</p>

<h2>Requirements:</h2>

<p>You will need the <code>gcc</code> package to compile the program:</p>

<figure class='code'><figcaption><span>RHEL</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>yum install gcc -y
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Debian</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>apt install gcc -y
</span></code></pre></td></tr></table></div></figure>


<h2>Writing our first Program:</h2>

<p>We will create a app that just prints out a static defined value:</p>

<p>Create any file with a <code>.c</code> extension, in my case it will be <code>app.c</code>:</p>

<figure class='code'><figcaption><span>app.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
</span><span class='line'>    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Hello, World</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now compile <code>app.c</code> with <code>gcc</code> and specify the output path of your app with <code>-o &lt;app-name&gt;</code></p>

<figure class='code'><figcaption><span>app.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="err">$</span> <span class="n">gcc</span> <span class="o">-</span><span class="n">o</span> <span class="n">app</span> <span class="n">app</span><span class="p">.</span><span class="n">c</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Testing our App:</h2>

<p>You will see that there is a executable file with the name that you have specified as the output:</p>

<figure class='code'><figcaption><span>app.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="err">$</span> <span class="p">.</span><span class="o">/</span><span class="n">app</span>
</span><span class='line'><span class="n">Hello</span><span class="p">,</span> <span class="n">World</span>
</span></code></pre></td></tr></table></div></figure>


<p>Really basic, but quite cool.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/09/22/using-the-aws-cli-tools-to-grab-cloudwatch-metrics-for-elasticsearch/">Using the AWS CLI Tools to Grab CloudWatch Metrics for Elasticsearch</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-09-22T18:06:23-04:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>22</span><span class='date-suffix'>nd</span>, <span class='date-year'>2017</span></span> <span class='time'>6:06 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Using the AWS CLI Tools to get CloudWatch Metrics for Elasticsearch.</p>

<h2>Elasticsearch:</h2>

<p>List the JVM Memory Pressure Metric:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>aws cloudwatch list-metrics --namespace AWS/ES --metric-name JVMMemoryPressure
</span><span class='line'><span class="o">{</span>
</span><span class='line'>    <span class="s2">&quot;Metrics&quot;</span>: <span class="o">[</span>
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;Namespace&quot;</span>: <span class="s2">&quot;AWS/ES&quot;</span>,
</span><span class='line'>            <span class="s2">&quot;Dimensions&quot;</span>: <span class="o">[</span>
</span><span class='line'>                <span class="o">{</span>
</span><span class='line'>                    <span class="s2">&quot;Name&quot;</span>: <span class="s2">&quot;DomainName&quot;</span>,
</span><span class='line'>                    <span class="s2">&quot;Value&quot;</span>: <span class="s2">&quot;elasticsearch-cluster&quot;</span>
</span><span class='line'>                <span class="o">}</span>,
</span><span class='line'>                <span class="o">{</span>
</span><span class='line'>                    <span class="s2">&quot;Name&quot;</span>: <span class="s2">&quot;ClientId&quot;</span>,
</span><span class='line'>                    <span class="s2">&quot;Value&quot;</span>: <span class="s2">&quot;123456789012&quot;</span>
</span><span class='line'>                <span class="o">}</span>
</span><span class='line'>            <span class="o">]</span>,
</span><span class='line'>            <span class="s2">&quot;MetricName&quot;</span>: <span class="s2">&quot;JVMMemoryPressure&quot;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">]</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Metric: JVMMemoryPressure</h2>

<p>Getting Metrics for JVMMemoryPressure, every 10 Minutes for Max Statistic:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>aws cloudwatch get-metric-statistics --namespace AWS/ES --dimensions <span class="nv">Name</span><span class="o">=</span>DomainName,Value<span class="o">=</span>elasticsearch-cluster <span class="nv">Name</span><span class="o">=</span>ClientId,Value<span class="o">=</span><span class="m">123456789012</span> --metric-name JVMMemoryPressure --start-time 2017-09-08T04:00:00 --end-time 2017-09-08T05:00:00 --period <span class="m">600</span> --statistics Maximum
</span><span class='line'><span class="o">{</span>
</span><span class='line'>    <span class="s2">&quot;Datapoints&quot;</span>: <span class="o">[</span>
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;Timestamp&quot;</span>: <span class="s2">&quot;2017-09-08T04:40:00Z&quot;</span>,
</span><span class='line'>            <span class="s2">&quot;Maximum&quot;</span>: 58.7,
</span><span class='line'>            <span class="s2">&quot;Unit&quot;</span>: <span class="s2">&quot;Percent&quot;</span>
</span><span class='line'>        <span class="o">}</span>,
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;Timestamp&quot;</span>: <span class="s2">&quot;2017-09-08T04:00:00Z&quot;</span>,
</span><span class='line'>            <span class="s2">&quot;Maximum&quot;</span>: 58.5,
</span><span class='line'>            <span class="s2">&quot;Unit&quot;</span>: <span class="s2">&quot;Percent&quot;</span>
</span><span class='line'>        <span class="o">}</span>,
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;Timestamp&quot;</span>: <span class="s2">&quot;2017-09-08T04:30:00Z&quot;</span>,
</span><span class='line'>            <span class="s2">&quot;Maximum&quot;</span>: 58.7,
</span><span class='line'>            <span class="s2">&quot;Unit&quot;</span>: <span class="s2">&quot;Percent&quot;</span>
</span><span class='line'>        <span class="o">}</span>,
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;Timestamp&quot;</span>: <span class="s2">&quot;2017-09-08T04:20:00Z&quot;</span>,
</span><span class='line'>            <span class="s2">&quot;Maximum&quot;</span>: 58.5,
</span><span class='line'>            <span class="s2">&quot;Unit&quot;</span>: <span class="s2">&quot;Percent&quot;</span>
</span><span class='line'>        <span class="o">}</span>,
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;Timestamp&quot;</span>: <span class="s2">&quot;2017-09-08T04:50:00Z&quot;</span>,
</span><span class='line'>            <span class="s2">&quot;Maximum&quot;</span>: 58.7,
</span><span class='line'>            <span class="s2">&quot;Unit&quot;</span>: <span class="s2">&quot;Percent&quot;</span>
</span><span class='line'>        <span class="o">}</span>,
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;Timestamp&quot;</span>: <span class="s2">&quot;2017-09-08T04:10:00Z&quot;</span>,
</span><span class='line'>            <span class="s2">&quot;Maximum&quot;</span>: 58.5,
</span><span class='line'>            <span class="s2">&quot;Unit&quot;</span>: <span class="s2">&quot;Percent&quot;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">]</span>,
</span><span class='line'>    <span class="s2">&quot;Label&quot;</span>: <span class="s2">&quot;JVMMemoryPressure&quot;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Metric: WriteIOPS</h2>

<p>Getting Metrics for WriteIOPS, Every 10 Minutes for Max Statistic:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>aws cloudwatch get-metric-statistics --namespace AWS/ES --dimensions <span class="nv">Name</span><span class="o">=</span>DomainName,Value<span class="o">=</span>elasticsearch-cluster <span class="nv">Name</span><span class="o">=</span>ClientId,Value<span class="o">=</span><span class="m">123456789012</span> --metric-name WriteIOPS --start-time 2017-09-08T04:00:00 --end-time 2017-09-08T05:00:00 --period <span class="m">600</span> --statistics Maximum
</span><span class='line'><span class="o">{</span>
</span><span class='line'>    <span class="s2">&quot;Datapoints&quot;</span>: <span class="o">[</span>
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;Timestamp&quot;</span>: <span class="s2">&quot;2017-09-08T04:30:00Z&quot;</span>,
</span><span class='line'>            <span class="s2">&quot;Maximum&quot;</span>: 0.5266666666666666,
</span><span class='line'>            <span class="s2">&quot;Unit&quot;</span>: <span class="s2">&quot;Count/Second&quot;</span>
</span><span class='line'>        <span class="o">}</span>,
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;Timestamp&quot;</span>: <span class="s2">&quot;2017-09-08T04:00:00Z&quot;</span>,
</span><span class='line'>            <span class="s2">&quot;Maximum&quot;</span>: 0.0,
</span><span class='line'>            <span class="s2">&quot;Unit&quot;</span>: <span class="s2">&quot;Count/Second&quot;</span>
</span><span class='line'>        <span class="o">}</span>,
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;Timestamp&quot;</span>: <span class="s2">&quot;2017-09-08T04:40:00Z&quot;</span>,
</span><span class='line'>            <span class="s2">&quot;Maximum&quot;</span>: 0.09666666666666666,
</span><span class='line'>            <span class="s2">&quot;Unit&quot;</span>: <span class="s2">&quot;Count/Second&quot;</span>
</span><span class='line'>        <span class="o">}</span>,
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;Timestamp&quot;</span>: <span class="s2">&quot;2017-09-08T04:10:00Z&quot;</span>,
</span><span class='line'>            <span class="s2">&quot;Maximum&quot;</span>: 0.0,
</span><span class='line'>            <span class="s2">&quot;Unit&quot;</span>: <span class="s2">&quot;Count/Second&quot;</span>
</span><span class='line'>        <span class="o">}</span>,
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;Timestamp&quot;</span>: <span class="s2">&quot;2017-09-08T04:50:00Z&quot;</span>,
</span><span class='line'>            <span class="s2">&quot;Maximum&quot;</span>: 0.07,
</span><span class='line'>            <span class="s2">&quot;Unit&quot;</span>: <span class="s2">&quot;Count/Second&quot;</span>
</span><span class='line'>        <span class="o">}</span>,
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;Timestamp&quot;</span>: <span class="s2">&quot;2017-09-08T04:20:00Z&quot;</span>,
</span><span class='line'>            <span class="s2">&quot;Maximum&quot;</span>: 0.0,
</span><span class='line'>            <span class="s2">&quot;Unit&quot;</span>: <span class="s2">&quot;Count/Second&quot;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">]</span>,
</span><span class='line'>    <span class="s2">&quot;Label&quot;</span>: <span class="s2">&quot;WriteIOPS&quot;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Metric: FreeStorageSpace</h2>

<p>Getting Metrics for FreeStorageSpace in Megabytes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>aws cloudwatch get-metric-statistics --namespace AWS/ES --dimensions <span class="nv">Name</span><span class="o">=</span>DomainName,Value<span class="o">=</span>elasticsearch-cluster <span class="nv">Name</span><span class="o">=</span>ClientId,Value<span class="o">=</span><span class="m">123456789012</span> --metric-name FreeStorageSpace --start-time 2017-09-11T05:00:00 --end-time 2017-09-11T06:00:00 --period <span class="m">600</span> --statistics Minimum --unit Megabytes
</span><span class='line'><span class="o">{</span>
</span><span class='line'>    <span class="s2">&quot;Datapoints&quot;</span>: <span class="o">[</span>
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;Timestamp&quot;</span>: <span class="s2">&quot;2017-09-11T05:50:00Z&quot;</span>,
</span><span class='line'>            <span class="s2">&quot;Minimum&quot;</span>: 25510.438,
</span><span class='line'>            <span class="s2">&quot;Unit&quot;</span>: <span class="s2">&quot;Megabytes&quot;</span>
</span><span class='line'>        <span class="o">}</span>,
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;Timestamp&quot;</span>: <span class="s2">&quot;2017-09-11T05:10:00Z&quot;</span>,
</span><span class='line'>            <span class="s2">&quot;Minimum&quot;</span>: 25573.032,
</span><span class='line'>            <span class="s2">&quot;Unit&quot;</span>: <span class="s2">&quot;Megabytes&quot;</span>
</span><span class='line'>        <span class="o">}</span>,
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;Timestamp&quot;</span>: <span class="s2">&quot;2017-09-11T05:20:00Z&quot;</span>,
</span><span class='line'>            <span class="s2">&quot;Minimum&quot;</span>: 25554.051,
</span><span class='line'>            <span class="s2">&quot;Unit&quot;</span>: <span class="s2">&quot;Megabytes&quot;</span>
</span><span class='line'>        <span class="o">}</span>,
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;Timestamp&quot;</span>: <span class="s2">&quot;2017-09-11T05:30:00Z&quot;</span>,
</span><span class='line'>            <span class="s2">&quot;Minimum&quot;</span>: 25540.957,
</span><span class='line'>            <span class="s2">&quot;Unit&quot;</span>: <span class="s2">&quot;Megabytes&quot;</span>
</span><span class='line'>        <span class="o">}</span>,
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;Timestamp&quot;</span>: <span class="s2">&quot;2017-09-11T05:40:00Z&quot;</span>,
</span><span class='line'>            <span class="s2">&quot;Minimum&quot;</span>: 25525.473,
</span><span class='line'>            <span class="s2">&quot;Unit&quot;</span>: <span class="s2">&quot;Megabytes&quot;</span>
</span><span class='line'>        <span class="o">}</span>,
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;Timestamp&quot;</span>: <span class="s2">&quot;2017-09-11T05:00:00Z&quot;</span>,
</span><span class='line'>            <span class="s2">&quot;Minimum&quot;</span>: 25584.383,
</span><span class='line'>            <span class="s2">&quot;Unit&quot;</span>: <span class="s2">&quot;Megabytes&quot;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">]</span>,
</span><span class='line'>    <span class="s2">&quot;Label&quot;</span>: <span class="s2">&quot;FreeStorageSpace&quot;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/09/18/using-the-python-sys-library-to-read-data-from-stdin/">Using the Python Sys Library to Read Data From Stdin</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-09-18T11:42:01-04:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>18</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>11:42 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Using Python&rsquo;s <code>sys</code> library to read data from <code>stdin</code>.</p>

<p>In this basic example we will strip our input, delimited by the comma character, add it to a list, and print it out</p>

<h2>Python: Read Data from Standard Input</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">sys</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">json</span>
</span><span class='line'>
</span><span class='line'><span class="n">mylist</span> <span class="o">=</span> <span class="p">[]</span>
</span><span class='line'>
</span><span class='line'><span class="n">data_input</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span class='line'><span class="n">destroy_newline</span> <span class="o">=</span> <span class="n">data_input</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">mylist</span> <span class="o">=</span> <span class="n">destroy_newline</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;, &#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">print</span><span class="p">(</span><span class="s">&quot;Stripping each word and adding it to &#39;mylist&#39;&quot;</span><span class="p">)</span>
</span><span class='line'><span class="k">print</span><span class="p">(</span><span class="s">&quot;Found: {} words in &#39;mylist&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mylist</span><span class="p">)))</span>
</span><span class='line'><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">mylist</span><span class="p">:</span>
</span><span class='line'>    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Word: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>We will echo three words and pipe it into our python script:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;one, two, three&quot;</span> <span class="p">|</span> python basic-stdin.py
</span><span class='line'>Stripping each word and adding it to <span class="s1">&#39;mylist&#39;</span>
</span><span class='line'>Found: <span class="m">3</span> words in <span class="s1">&#39;mylist&#39;</span>
</span><span class='line'>Word: one
</span><span class='line'>Word: two
</span><span class='line'>Word: three
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/09/16/setup-a-postfix-relay-server-that-uses-ses-to-relay-outbound-mail/">Setup a Postfix Relay Server That Uses SES to Relay Outbound Mail</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-09-16T18:01:49-04:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>16</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>6:01 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>We will setup a Postfix Relay Servcer which our clients will use to send out mail, the Postfix server will use Amazon&rsquo;s SES Service to send out mail, which we will configure as a relay host in Postfix.</p>

<h2>Setup EC2 Instance to Relay through AWS SES:</h2>

<p>Install Postfix and SASL:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>apt install postfix mailutils libsasl2-2 sasl2-bin libsasl2-modules -y
</span></code></pre></td></tr></table></div></figure>


<p>Section we need to configure in <code>/etc/nginx/main.cf</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">relayhost</span> <span class="o">=</span> <span class="o">[</span>email-smtp.eu-west-1.amazonaws.com<span class="o">]</span>:587
</span><span class='line'><span class="nv">smtp_use_tls</span> <span class="o">=</span> yes
</span><span class='line'><span class="nv">smtp_sasl_auth_enable</span> <span class="o">=</span> yes
</span><span class='line'><span class="nv">smtp_sasl_security_options</span> <span class="o">=</span>
</span><span class='line'><span class="nv">smtp_sasl_password_maps</span> <span class="o">=</span> <span class="nb">hash</span>:/etc/postfix/sasl_passwd
</span><span class='line'><span class="nv">smtp_tls_CAfile</span> <span class="o">=</span> /etc/ssl/certs/ca-certificates.crt
</span></code></pre></td></tr></table></div></figure>


<p>Populate SASL Passwd:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>cat /etc/postfix/sasl_passwd
</span><span class='line'><span class="o">[</span>email-smtp.eu-west-1.amazonaws.com<span class="o">]</span>:587    AKIAABCDEFGHIJKLM:SomeRandomSecretString
</span></code></pre></td></tr></table></div></figure>


<p>Postmap the changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>postmap /etc/postfix/sasl_passwd
</span></code></pre></td></tr></table></div></figure>


<p>Restart Postfix:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>sudo /etc/init.d/postfix restart
</span></code></pre></td></tr></table></div></figure>


<p>Test the Mail Flow:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span><span class="nb">echo test</span> <span class="p">|</span> mail -r ruan@ruanbekker.com -s <span class="s1">&#39;ses test mail &#39;</span> ruan@ruanbekker.com <span class="o">&amp;&amp;</span> tail -f /var/log/mail.log
</span><span class='line'>
</span><span class='line'>Jul <span class="m">18</span> 11:29:06 ip-10-1-4-250 postfix/smtp<span class="o">[</span>5056<span class="o">]</span>: 9FDCB469AA: <span class="nv">to</span><span class="o">=</span>&lt;ruan@ruanbekker.com&gt;, <span class="nv">relay</span><span class="o">=</span>email-smtp.eu-west-1.amazonaws.com<span class="o">[</span>52.10.20.30<span class="o">]</span>:587, <span class="nv">delay</span><span class="o">=</span>0.29, <span class="nv">delays</span><span class="o">=</span>0.02/0.03/0.12/0.13, <span class="nv">dsn</span><span class="o">=</span>2.0.0, <span class="nv">status</span><span class="o">=</span>sent <span class="o">(</span><span class="m">250</span> Ok 0234567d557572f2-76f56252-0a00-4d94-af87-38bd213914d2-000000<span class="o">)</span>
</span><span class='line'>Jul <span class="m">18</span> 11:29:06 ip-10-1-4-250 postfix/qmgr<span class="o">[</span>4392<span class="o">]</span>: 9FDCB469AA: removed
</span></code></pre></td></tr></table></div></figure>


<p>If your output looks more or less like the snippet from above, your mail should be working fine.</p>

<center>
<script type='text/javascript' src='https://ko-fi.com/widgets/widget_2.js'></script><script type='text/javascript'>kofiwidget2.init('Buy Me a Coffee', '#46b798', 'A6423ZIQ');kofiwidget2.draw();</script> 
</center>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/09/16/nginx-reverse-proxy-for-elasticsearch-and-kibana-5-on-aws/">Nginx Reverse Proxy for Elasticsearch and Kibana 5 on AWS</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-09-16T17:24:32-04:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>16</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>5:24 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>As up untill today, there&rsquo;s currently no VPC Support for Amazon&rsquo;s Elasticsearch Service.</p>

<p>So for scenarios where you would like to allow private network traffic to Elasticsearch is impossible straight out of the box as Amazon&rsquo;s Elasticsearch Services, only sees Public Internet Traffic.</p>

<p>We will setup 2 configs, one for Kibana and one for Elasticsearch, each one having its own FQDN:</p>

<ul>
<li>Kibana: <code>http://kibana.domain.com</code></li>
<li>Elasticsearch: <code>http://elasticsearch.domain.com</code></li>
</ul>


<h2>Workaround:</h2>

<p>There&rsquo;s a couple of workarounds, which includes:</p>

<ul>
<li>Nginx Reverse Proxy</li>
<li>NAT Gateway</li>
<li>Allow IAM Users/Roles</li>
</ul>


<p>Today we will tackle the Nginx Reverse Proxy Route.</p>

<p>The benefit of this, would be to associate an EIP to the Nginx EC2 Instnace, then whitelist your EIP with Elasticsearch, so the only traffic that will be accepted will be the traffic that is coming from the Nginx Instance. We will also apply an additional layer of security, in this case we will use HTTP Basic Authentication, then also authorize network sources on a Security Group level.</p>

<h2>Installing Nginx:</h2>

<p>In this case I am using Ubuntu 16.04, so we will need to install <code>nginx</code> and <code>apache2-utils</code> for creating the Basic HTTP Auth accounts.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>apt update <span class="o">&amp;&amp;</span> apt upgrade -y
</span><span class='line'><span class="nv">$ </span>apt install nginx apache2-utils -y
</span></code></pre></td></tr></table></div></figure>


<h2>Configure Nginx:</h2>

<p>Our main config: <code>/etc/nginx/nginx.conf</code>:</p>

<figure class='code'><figcaption><span>/etc/nginx/nginx.conf</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>user www-data<span class="p">;</span>
</span><span class='line'>worker_processes auto<span class="p">;</span>
</span><span class='line'>pid /run/nginx.pid<span class="p">;</span>
</span><span class='line'>error_log /var/log/nginx/error.log<span class="p">;</span>
</span><span class='line'>
</span><span class='line'>events <span class="o">{</span>
</span><span class='line'>  worker_connections 1024<span class="p">;</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'>http <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="c"># Basic Settings</span>
</span><span class='line'>  sendfile on<span class="p">;</span>
</span><span class='line'>  tcp_nopush on<span class="p">;</span>
</span><span class='line'>  tcp_nodelay on<span class="p">;</span>
</span><span class='line'>  keepalive_timeout 65<span class="p">;</span>
</span><span class='line'>  types_hash_max_size 2048<span class="p">;</span>
</span><span class='line'>  server_names_hash_bucket_size 128<span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  include /etc/nginx/mime.types<span class="p">;</span>
</span><span class='line'>  default_type application/octet-stream<span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c"># Logging Settings</span>
</span><span class='line'>        log_format  main  <span class="s1">&#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span>
</span><span class='line'>                      <span class="s1">&#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span>
</span><span class='line'>                      <span class="s1">&#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  access_log /var/log/nginx/access.log main<span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c"># Gzip Settings</span>
</span><span class='line'>  gzip on<span class="p">;</span>
</span><span class='line'>  gzip_disable <span class="s2">&quot;msie6&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c"># Elasticsearch and Kibana Configs</span>
</span><span class='line'>  include /etc/nginx/conf.d/elasticsearch.conf<span class="p">;</span>
</span><span class='line'>  include /etc/nginx/conf.d/kibana.conf<span class="p">;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Our <code>/etc/nginx/conf.d/elasticsearch.conf</code> configuration:</p>

<figure class='code'><figcaption><span>/etc/nginx/conf.d/elasticsearch.conf</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>server <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  listen 80<span class="p">;</span>
</span><span class='line'>  server_name elasticsearch.domain.com<span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c"># error logging</span>
</span><span class='line'>  error_log /var/log/nginx/elasticsearch_error.log<span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c"># authentication: elasticsearch</span>
</span><span class='line'>  auth_basic <span class="s2">&quot;Elasticsearch Auth&quot;</span><span class="p">;</span>
</span><span class='line'>  auth_basic_user_file /etc/nginx/.secrets_elasticsearch<span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  location / <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    proxy_http_version 1.1<span class="p">;</span>
</span><span class='line'>    proxy_set_header Host https://search-elasticsearch-name.eu-west-1.es.amazonaws.com<span class="p">;</span>
</span><span class='line'>    proxy_set_header X-Real-IP &lt;ELASTIC-IP&gt;<span class="p">;</span>
</span><span class='line'>    proxy_set_header Connection <span class="s2">&quot;Keep-Alive&quot;</span><span class="p">;</span>
</span><span class='line'>    proxy_set_header Proxy-Connection <span class="s2">&quot;Keep-Alive&quot;</span><span class="p">;</span>
</span><span class='line'>    proxy_set_header Authorization <span class="s2">&quot;&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    proxy_pass https://search-elasticsearch-name.eu-west-1.es.amazonaws.com/<span class="p">;</span>
</span><span class='line'>    proxy_redirect https://search-elasticsearch-name.eu-west-1.es.amazonaws.com/ http://&lt;ELASTIC-IP&gt;/<span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="c"># ELB Health Checks</span>
</span><span class='line'>  location /status <span class="o">{</span>
</span><span class='line'>    root /usr/share/nginx/html/<span class="p">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Our <code>/etc/nginx/conf.d/kibana.conf</code> configuration:</p>

<figure class='code'><figcaption><span>/etc/nginx/conf.d/kibana.conf</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>server <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  listen 80<span class="p">;</span>
</span><span class='line'>  server_name kibana.domain.com<span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c"># error logging</span>
</span><span class='line'>  error_log /var/log/nginx/kibana_error.log<span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c"># authentication: kibana</span>
</span><span class='line'>  auth_basic <span class="s2">&quot;Kibana Auth&quot;</span><span class="p">;</span>
</span><span class='line'>  auth_basic_user_file /etc/nginx/.secrets_kibana<span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  location / <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    proxy_http_version 1.1<span class="p">;</span>
</span><span class='line'>    proxy_set_header Host https://search.elasticsearch-name.eu-west-1.es.amazonaws.com<span class="p">;</span>
</span><span class='line'>    proxy_set_header X-Real-IP &lt;ELASTIC-IP&gt;<span class="p">;</span>
</span><span class='line'>    proxy_set_header Connection <span class="s2">&quot;Keep-Alive&quot;</span><span class="p">;</span>
</span><span class='line'>    proxy_set_header Proxy-Connection <span class="s2">&quot;Keep-Alive&quot;</span><span class="p">;</span>
</span><span class='line'>    proxy_set_header Authorization <span class="s2">&quot;&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    proxy_pass https://search.elasticsearch-name.eu-west-1.es.amazonaws.com/_plugin/kibana/<span class="p">;</span>
</span><span class='line'>    proxy_redirect https://search.elasticsearch-name.eu-west-1.es.amazonaws.com/_plugin/kibana/ http://&lt;ELASTIC-IP&gt;/kibana/<span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>      location ~ <span class="o">(</span>/app/kibana<span class="p">|</span>/app/timelion<span class="p">|</span>/bundles<span class="p">|</span>/es_admin<span class="p">|</span>/plugins<span class="p">|</span>/api<span class="p">|</span>/ui<span class="p">|</span>/elasticsearch<span class="o">)</span> <span class="o">{</span>
</span><span class='line'>         proxy_pass              https://search.elasticsearch-name.eu-west-1.es.amazonaws.com<span class="p">;</span>
</span><span class='line'>         proxy_set_header        Host <span class="nv">$host</span><span class="p">;</span>
</span><span class='line'>         proxy_set_header        X-Real-IP <span class="nv">$remote_addr</span><span class="p">;</span>
</span><span class='line'>         proxy_set_header        X-Forwarded-For <span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
</span><span class='line'>         proxy_set_header        X-Forwarded-Proto <span class="nv">$scheme</span><span class="p">;</span>
</span><span class='line'>         proxy_set_header        X-Forwarded-Host <span class="nv">$http_host</span><span class="p">;</span>
</span><span class='line'>         proxy_set_header      Authorization  <span class="s2">&quot;&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Once you have replaced the elasticsearch endpoint and your EPI values, we can go ahead and create the auth accounts.</p>

<h2>Create User Accounts for HTTP Basic Auth</h2>

<p>Create the 2 accounts for authentication on kibana and elasticsearch:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>htpasswd -c /etc/nginx/.secrets_elasticsearch elasticsearch-admin
</span><span class='line'><span class="nv">$ </span>htpasswd -c /etc/nginx/.secrets_kibana kibana-admin
</span></code></pre></td></tr></table></div></figure>


<h2>Restart Nginx:</h2>

<p>Restart and enable Nginx on boot:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>systemctl <span class="nb">enable </span>nginx
</span><span class='line'><span class="nv">$ </span>systemctl restart nginx
</span></code></pre></td></tr></table></div></figure>


<p>Once your Nginx Service is running, you should be able to access Kibana and Elasticsearch using the credentials that you created.</p>

<h2>Resources:</h2>

<ul>
<li><a href="https://www.nginx.com/blog/tcp-load-balancing-udp-load-balancing-nginx-tips-tricks/">https://www.nginx.com/blog/tcp-load-balancing-udp-load-balancing-nginx-tips-tricks/</a></li>
<li><a href="https://www.elastic.co/blog/playing-http-tricks-nginx">https://www.elastic.co/blog/playing-http-tricks-nginx</a></li>
<li><a href="https://sysadmins.co.za/aws-access-kibana-5-behind-elb-via-nginx-reverse-proxy-on-custom-dns/">https://sysadmins.co.za/aws-access-kibana-5-behind-elb-via-nginx-reverse-proxy-on-custom-dns/</a></li>
</ul>


<center>
<script type='text/javascript' src='https://ko-fi.com/widgets/widget_2.js'></script><script type='text/javascript'>kofiwidget2.init('Buy Me a Coffee', '#46b798', 'A6423ZIQ');kofiwidget2.draw();</script> 
</center>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/09/15/aws-iam-s3-policy-for-cyberduck-to-allow-listing-buckets-and-access-to-one-bucket/">AWS: IAM S3 Policy for Cyberduck to Allow Listing Buckets and Access to One Bucket</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-09-15T11:18:17-04:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>15</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>11:18 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>When using Cyberduck to access S3, and a account has restrictive policies, you may find error <code>Listing Directory: /</code> failed.</p>

<p>If you have restrictive IAM Policies in your account, this may be due to the fact that <code>S3:ListMyBuckets</code> is not allowed.</p>

<p>In this post we want to allow a user to list all buckets, so that Cyberduck can do the initial list after configuration / launch, and we would like to give the user access to their designated bucket.</p>

<h2>Creating the IAM Policy:</h2>

<p>We will create this IAM Policy and associate the policy to the user&rsquo;s account:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;Version&quot;</span><span class="p">:</span> <span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;Statement&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="nt">&quot;Sid&quot;</span><span class="p">:</span> <span class="s2">&quot;Stmt1480515305000&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="nt">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="nt">&quot;Action&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class='line'>                <span class="s2">&quot;s3:ListAllMyBuckets&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="s2">&quot;s3:GetBucketLocation&quot;</span>
</span><span class='line'>            <span class="p">],</span>
</span><span class='line'>            <span class="nt">&quot;Resource&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class='line'>                <span class="s2">&quot;arn:aws:s3:::*&quot;</span>
</span><span class='line'>            <span class="p">]</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="nt">&quot;Sid&quot;</span><span class="p">:</span> <span class="s2">&quot;Stmt1480515305002&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="nt">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="nt">&quot;Action&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class='line'>                <span class="s2">&quot;s3:List*&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="s2">&quot;s3:GetObject&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="s2">&quot;s3:PutObject&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="s2">&quot;s3:DeleteObject&quot;</span>
</span><span class='line'>            <span class="p">],</span>
</span><span class='line'>            <span class="nt">&quot;Resource&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class='line'>                <span class="s2">&quot;arn:aws:s3:::allowed-bucket&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="s2">&quot;arn:aws:s3:::allowed-bucket/*&quot;</span>
</span><span class='line'>            <span class="p">]</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">]</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>So here we should be able to list the buckets:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>aws --profile cyberduck s3 ls /
</span><span class='line'>2017-06-08 08:27:01 allowed-bucket
</span><span class='line'>2017-05-21 13:39:21 private-bucket
</span><span class='line'>2016-12-21 08:23:45 confidential-bucket
</span><span class='line'>2017-08-10 14:18:19 <span class="nb">test</span>-bucket
</span><span class='line'>2016-08-03 12:38:29 datalake-bucket
</span></code></pre></td></tr></table></div></figure>


<p>Able to list inside the bucket, as well as Get, Put etc.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>aws --profile cyberduck s3 ls allowed-bucket/
</span><span class='line'>                           PRE data/
</span></code></pre></td></tr></table></div></figure>


<p>Unable to list the buckets content which is expected, as we did not mention in the policy:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>aws --profile cyberduck s3 ls confidential-bucket/
</span><span class='line'>
</span><span class='line'>An error occurred <span class="o">(</span>AccessDenied<span class="o">)</span> when calling the ListObjects operation: Access Denied
</span></code></pre></td></tr></table></div></figure>


<h2>Resources:</h2>

<ul>
<li><a href="https://aws.amazon.com/blogs/security/writing-iam-policies-how-to-grant-access-to-an-amazon-s3-bucket/">https://aws.amazon.com/blogs/security/writing-iam-policies-how-to-grant-access-to-an-amazon-s3-bucket/</a></li>
</ul>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/3">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/index.html">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2017/10/25/your-first-hello-world-app-with-golang/">Your First Hello World App With Golang</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/10/25/new-posts-on-github-pages-with-octopress-not-showing-on-your-blog/">New Posts on Github Pages With Octopress Not Showing on Your Blog</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/10/24/running-java-web-applications-on-tomcat-with-docker-swarm/">Running Java Web Applications on Tomcat With Docker Swarm</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/10/24/managing-traefik-configuration-with-consul-on-docker-swarm/">Managing Traefik Configuration With Consul on Docker Swarm</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/10/22/basic-example-with-python-to-create-a-module-that-consists-of-classes-and-functions/">Basic Example With Python to Create a Module That Consists of Classes and Functions</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2017 - Ruan -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>



  <li>
    <a href="https://twitter.com/ruanbekker">
      <i class="fa fa-twitter"></i> Twitter
    </a>
  </li>



  <li>
    <a href="https://github.com/ruanbekker">
      <i class="fa fa-github"></i> GitHub
    </a>
  </li>



  <li>
    <a href="https://sysadmins.co.za">
      <i class="fa fa-bars"></i> My HowTo Blog
    </a>
  </li>


</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'blog-ruanbekker';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
