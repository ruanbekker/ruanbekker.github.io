
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Ruan Bekker's Blog</title>
  <meta name="author" content="Ruan">

  
  <meta name="description" content="When you make a configuration change on Amazon&rsquo;s Elasticsearch, it does a blue/green deployment. So new nodes will be allocated to the cluster &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- font awesome --!>
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

  <!-- samwize.com/2012/09/24/octopress-table-stylesheet --!>
  <link href="/stylesheets/data-table.css" media="screen, projection" rel="stylesheet" type="text/css" />

  
  <link rel="canonical" href="https://blog.ruanbekker.com/posts/21/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Ruan Bekker's Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-105336110-1']);
    _gaq.push(['_setDomainName','ruanbekker.com']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


  <!-- Fathom - simple website analytics - https://github.com/usefathom/fathom -->
<script>
(function(f, a, t, h, o, m){
	a[h]=a[h]||function(){
		(a[h].q=a[h].q||[]).push(arguments)
	};
	o=f.createElement('script'),
	m=f.getElementsByTagName('script')[0];
	o.async=1; o.src=t; o.id='fathom-script';
	m.parentNode.insertBefore(o,m)
})(document, window, '//fh-blog-ruanbekker-com.home.ruan.dev/tracker.js', 'fathom');
fathom('set', 'siteId', 'MWBHH');
fathom('trackPageview');
</script>
<!-- / Fathom -->

  <!-- Twitter cards # www.brianbunke.com/blog/2017/09/06/twitter-cards-on-jekyll -->
<meta name="twitter:site"    content="@ruanbekker">
<meta name="twitter:creator" content="@">
<meta name="twitter:title"   content="">


<meta name="twitter:description" content="">



<meta name="twitter:card"  content="summary">
<meta name="twitter:image" content="https://user-images.githubusercontent.com/567298/69000657-c093e780-08db-11ea-8464-bcd3023e9923.png">

<!-- end of Twitter cards -->

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Ruan Bekker's Blog</a></h1>
  
    <h2>From a Curious mind to Posts on Github</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://blog.ruanbekker.com/search/" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="blog.ruanbekker.com">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/blog/categories/aws/">AWS</a></li>
  <li><a href="/blog/categories/docker/">Docker</a></li>
  <li><a href="/blog/categories/devops/">DevOps</a></li>
  <li><a href="/blog/categories/python/">Python</a></li>
  <li><a target="_blank" href="https://sysadmins.co.za">My Sysadmins Blog</a></li>
  <li><a href="https://ruan.dev/">About Me</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2018/04/16/how-to-monitor-a-amazon-elasticsearch-service-cluster-update-process/">How to Monitor a Amazon Elasticsearch Service Cluster Update Process</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2018-04-16T03:24:09-04:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>16</span><span class='date-suffix'>th</span>, <span class='date-year'>2018</span></span> <span class='time'>3:24 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>When you make a configuration change on Amazon&rsquo;s Elasticsearch, it does a blue/green deployment. So new nodes will be allocated to the cluster (which you will notice from CloudWatch when looking at the nodes metrics). Once these nodes are deployed, data gets copied accross to the new nodes, and traffic gets directed to the new nodes, and once its done, the old nodes gets terminated.</p>

<p>Note: While there will be more nodes in the cluster, you will not get billed for the extra nodes.</p>

<p>While this process is going, you can monitor your cluster to see the progress:</p>

<h2>The Shards API:</h2>

<p>Using the <code>/_cat/shards</code> API, you will find that the shards are in a RELOCATING state (keeping in mind, this is when the change is still busy)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>curl -s -XGET <span class="s1">&#39;https://search-example-elasticsearch-cluster-6-abc123defghijkl5airxticzvjaqy.eu-west-1.es.amazonaws.com/_cat/shards?v&#39;</span> <span class="p">|</span> grep -v <span class="s1">&#39;STARTED&#39;</span>
</span><span class='line'>index                                   shard prirep state         docs    store ip            node
</span><span class='line'>example-app1-2018.02.23                 <span class="m">4</span>     r      RELOCATING  <span class="m">323498</span> 1018.3mb x.x.x.x x2mKoe_ -&gt; x.x.x.x GyNiRJyeSTifN_9JZisGuQ GyNiRJy
</span><span class='line'>example-app1-2018.02.28                 <span class="m">2</span>     p      RELOCATING  <span class="m">477609</span>    1.5gb x.x.x.x x2mKoe_ -&gt; x.x.x.x sOihejw1SrKtag_LO1RGIA sOihejw
</span><span class='line'>example-app1-2018.03.01                 <span class="m">3</span>     r      RELOCATING  <span class="m">463143</span>    1.5gb x.x.x.x  ZZfv-Ha -&gt; x.x.x.x jOchdCZWQq-TAPZNTadNoA jOchdCZ
</span><span class='line'>fortinet-syslog-2018.02                 <span class="m">0</span>     p      RELOCATING <span class="m">1218556</span>  462.2mb x.x.x.x  moQA57Y -&gt; x.x.x.x sOihejw1SrKtag_LO1RGIA sOihejw
</span><span class='line'>example-app1-2018.03.23                 <span class="m">3</span>     r      RELOCATING  <span class="m">821254</span>    2.4gb x.x.x.x  moQA57Y -&gt; x.x.x.x GyNiRJyeSTifN_9JZisGuQ GyNiRJy
</span><span class='line'>example-app1-2018.04.02                 <span class="m">2</span>     p      RELOCATING <span class="m">1085279</span>    3.4gb x.x.x.x x2mKoe_ -&gt; x.x.x.x jOchdCZWQq-TAPZNTadNoA jOchdCZ
</span><span class='line'>example-app1-2018.02.08                 <span class="m">3</span>     p      RELOCATING  <span class="m">136321</span>    125mb x.x.x.x ZUZSFWu -&gt; x.x.x.x tyU_V_KLS5mZXEwnF-YEAQ tyU_V_K
</span><span class='line'>fortinet-syslog-2018.04                 <span class="m">4</span>     r      RELOCATING <span class="m">7513842</span>    2.8gb x.x.x.x  ZZfv-Ha -&gt; x.x.x.x il1WsroNSgGmXJugds_aMQ il1Wsro
</span><span class='line'>example-app1-2018.04.09                 <span class="m">1</span>     r      RELOCATING <span class="m">1074581</span>    3.5gb x.x.x.x  ZRzKGe5 -&gt; x.x.x.x il1WsroNSgGmXJugds_aMQ il1Wsro
</span><span class='line'>example-app1-2018.04.09                 <span class="m">0</span>     p      RELOCATING <span class="m">1074565</span>    3.5gb x.x.x.x  moQA57Y -&gt; x.x.x.x tyU_V_KLS5mZXEwnF-YEAQ tyU_V_K
</span></code></pre></td></tr></table></div></figure>


<h2>The Recovery API:</h2>

<p>We can then use the <code>/_cat/recovery</code> API, which will show the progress of the shards transferring to the other nodes, you will find the following:</p>

<ul>
<li><code>index, shard, time, type, stage, source_host, target_host, files, files_percent, bytes, bytes_percent</code></li>
</ul>


<p>As Amazon masks their node ip addresses, we will find that the ips are not available. To make it more human readable, we will only pass the columns that we are interested in and not to show the shards that has been set to <code>done</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>curl -s -XGET <span class="s1">&#39;https://search-example-elasticsearch-cluster-6-abc123defghijkl5airxticzvjaqy.eu-west-1.es.amazonaws.com/_cat/recovery?v&amp;h=i,s,t,ty,st,shost,thost,f,fp,b,bp&#39;</span> <span class="p">|</span> grep -v <span class="s1">&#39;done&#39;</span>
</span><span class='line'>i                                       s t     ty          st       shost         thost         f   fp     b          bp
</span><span class='line'>example-app1-2018.04.11                 <span class="m">1</span> 2m    peer        index    x.x.x.x x.x.x.x  <span class="m">139</span> 97.1%  <span class="m">3435483673</span> 65.9%
</span><span class='line'>web-syslog-2018.04                 <span class="m">4</span> 7.6m  peer        finalize x.x.x.x x.x.x.x  <span class="m">109</span> 100.0% <span class="m">2854310892</span> 100.0%
</span><span class='line'>example-app1-2018.04.16                 <span class="m">3</span> 2.9m  peer        translog x.x.x.x x.x.x.x  <span class="m">130</span> 100.0% <span class="m">446180036</span>  100.0%
</span><span class='line'>example-app1-2018.03.30                 <span class="m">3</span> 2.1m  peer        index    x.x.x.x  x.x.x.x  <span class="m">127</span> 97.6%  <span class="m">3862498583</span> 62.5%
</span><span class='line'>example-app1-2018.04.01                 <span class="m">0</span> 4.4m  peer        index    x.x.x.x  x.x.x.x  <span class="m">140</span> 99.3%  <span class="m">3410543270</span> 87.9%
</span><span class='line'>example-app1-2018.04.06                 <span class="m">0</span> 5.1m  peer        index    x.x.x.x x.x.x.x  <span class="m">128</span> 97.7%  <span class="m">4291421948</span> 66.3%
</span><span class='line'>example-app1-2018.04.07                 <span class="m">0</span> 52.2s peer        index    x.x.x.x x.x.x.x <span class="m">149</span> 91.9%  <span class="m">3969581277</span> 27.4%
</span><span class='line'>network-capture-2018.04.01               <span class="m">2</span> 11.4s peer        index    x.x.x.x  x.x.x.x <span class="m">107</span> 95.3%  <span class="m">359987163</span>  55.0%
</span><span class='line'>example-app1-2018.03.17                 <span class="m">1</span> 1.7m  peer        index    x.x.x.x  x.x.x.x <span class="m">117</span> 98.3%  <span class="m">2104196548</span> 74.5%
</span><span class='line'>example-app1-2018.02.25                 <span class="m">3</span> 58.4s peer        index    x.x.x.x  x.x.x.x <span class="m">102</span> 98.0%  <span class="m">945437614</span>  74.7%
</span></code></pre></td></tr></table></div></figure>


<p>We can also see the human readable output, which is displayed in json format, with much more detail:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>curl -s -XGET <span class="s1">&#39;https://search-example-elasticsearch-cluster-6-abc123defghijkl5airxticzvjaqy.eu-west-1.es.amazonaws.com/example-app1-2018.04.03/_recovery?human&#39;</span> <span class="p">|</span> python -m json.tool
</span><span class='line'><span class="o">{</span>
</span><span class='line'>    <span class="s2">&quot;example-app1-2018.04.03&quot;</span>: <span class="o">{</span>
</span><span class='line'>        <span class="s2">&quot;shards&quot;</span>: <span class="o">[</span>
</span><span class='line'>            <span class="o">{</span>
</span><span class='line'>                <span class="s2">&quot;id&quot;</span>: 0,
</span><span class='line'>                <span class="s2">&quot;index&quot;</span>: <span class="o">{</span>
</span><span class='line'>                    <span class="s2">&quot;files&quot;</span>: <span class="o">{</span>
</span><span class='line'>                        <span class="s2">&quot;percent&quot;</span>: <span class="s2">&quot;100.0%&quot;</span>,
</span><span class='line'>                        <span class="s2">&quot;recovered&quot;</span>: 103,
</span><span class='line'>                        <span class="s2">&quot;reused&quot;</span>: 0,
</span><span class='line'>                        <span class="s2">&quot;total&quot;</span>: 103
</span><span class='line'>                    <span class="o">}</span>,
</span><span class='line'>                    <span class="s2">&quot;size&quot;</span>: <span class="o">{</span>
</span><span class='line'>                        <span class="s2">&quot;percent&quot;</span>: <span class="s2">&quot;100.0%&quot;</span>,
</span><span class='line'>                        <span class="s2">&quot;recovered&quot;</span>: <span class="s2">&quot;3.6gb&quot;</span>,
</span><span class='line'>                        <span class="s2">&quot;recovered_in_bytes&quot;</span>: 3926167091,
</span><span class='line'>                        <span class="s2">&quot;reused&quot;</span>: <span class="s2">&quot;0b&quot;</span>,
</span><span class='line'>                        <span class="s2">&quot;reused_in_bytes&quot;</span>: 0,
</span><span class='line'>                        <span class="s2">&quot;total&quot;</span>: <span class="s2">&quot;3.6gb&quot;</span>,
</span><span class='line'>                        <span class="s2">&quot;total_in_bytes&quot;</span>: 3926167091
</span><span class='line'>                    <span class="o">}</span>,
</span><span class='line'>                    <span class="s2">&quot;source_throttle_time&quot;</span>: <span class="s2">&quot;2m&quot;</span>,
</span><span class='line'>                    <span class="s2">&quot;source_throttle_time_in_millis&quot;</span>: 121713,
</span><span class='line'>                    <span class="s2">&quot;target_throttle_time&quot;</span>: <span class="s2">&quot;2.1m&quot;</span>,
</span><span class='line'>                    <span class="s2">&quot;target_throttle_time_in_millis&quot;</span>: 126170,
</span><span class='line'>                    <span class="s2">&quot;total_time&quot;</span>: <span class="s2">&quot;7.2m&quot;</span>,
</span><span class='line'>                    <span class="s2">&quot;total_time_in_millis&quot;</span>: 434142
</span><span class='line'>                <span class="o">}</span>,
</span><span class='line'>                <span class="s2">&quot;primary&quot;</span>: <span class="nb">true</span>,
</span><span class='line'>                <span class="s2">&quot;source&quot;</span>: <span class="o">{</span>
</span><span class='line'>                    <span class="s2">&quot;host&quot;</span>: <span class="s2">&quot;x.x.x.x&quot;</span>,
</span><span class='line'>                    <span class="s2">&quot;id&quot;</span>: <span class="s2">&quot;ZRzKGe5WSg2SzilZGb3RbA&quot;</span>,
</span><span class='line'>                    <span class="s2">&quot;ip&quot;</span>: <span class="s2">&quot;x.x.x.x&quot;</span>,
</span><span class='line'>                    <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;ZRzKGe5&quot;</span>,
</span><span class='line'>                    <span class="s2">&quot;transport_address&quot;</span>: <span class="s2">&quot;x.x.x.x:9300&quot;</span>
</span><span class='line'>                <span class="o">}</span>,
</span><span class='line'>                <span class="s2">&quot;stage&quot;</span>: <span class="s2">&quot;DONE&quot;</span>,
</span><span class='line'>                <span class="s2">&quot;start_time&quot;</span>: <span class="s2">&quot;2018-04-10T19:26:48.668Z&quot;</span>,
</span><span class='line'>                <span class="s2">&quot;start_time_in_millis&quot;</span>: 1523388408668,
</span><span class='line'>                <span class="s2">&quot;stop_time&quot;</span>: <span class="s2">&quot;2018-04-10T19:34:04.980Z&quot;</span>,
</span><span class='line'>                <span class="s2">&quot;stop_time_in_millis&quot;</span>: 1523388844980,
</span><span class='line'>                <span class="s2">&quot;target&quot;</span>: <span class="o">{</span>
</span><span class='line'>                    <span class="s2">&quot;host&quot;</span>: <span class="s2">&quot;x.x.x.x&quot;</span>,
</span><span class='line'>                    <span class="s2">&quot;id&quot;</span>: <span class="s2">&quot;x2mKoe_GTpe3b1CnXOKisA&quot;</span>,
</span><span class='line'>                    <span class="s2">&quot;ip&quot;</span>: <span class="s2">&quot;x.x.x.x&quot;</span>,
</span><span class='line'>                    <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;x2mKoe_&quot;</span>,
</span><span class='line'>                    <span class="s2">&quot;transport_address&quot;</span>: <span class="s2">&quot;x.x.x.x:9300&quot;</span>
</span><span class='line'>                <span class="o">}</span>,
</span><span class='line'>                <span class="s2">&quot;total_time&quot;</span>: <span class="s2">&quot;7.2m&quot;</span>,
</span><span class='line'>                <span class="s2">&quot;total_time_in_millis&quot;</span>: 436311,
</span><span class='line'>                <span class="s2">&quot;translog&quot;</span>: <span class="o">{</span>
</span><span class='line'>                    <span class="s2">&quot;percent&quot;</span>: <span class="s2">&quot;100.0%&quot;</span>,
</span><span class='line'>                    <span class="s2">&quot;recovered&quot;</span>: 0,
</span><span class='line'>                    <span class="s2">&quot;total&quot;</span>: 0,
</span><span class='line'>                    <span class="s2">&quot;total_on_start&quot;</span>: 0,
</span><span class='line'>                    <span class="s2">&quot;total_time&quot;</span>: <span class="s2">&quot;1.1s&quot;</span>,
</span><span class='line'>                    <span class="s2">&quot;total_time_in_millis&quot;</span>: 1154
</span><span class='line'>                <span class="o">}</span>,
</span><span class='line'>                <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;PEER&quot;</span>,
</span><span class='line'>                <span class="s2">&quot;verify_index&quot;</span>: <span class="o">{</span>
</span><span class='line'>                    <span class="s2">&quot;check_index_time&quot;</span>: <span class="s2">&quot;0s&quot;</span>,
</span><span class='line'>                    <span class="s2">&quot;check_index_time_in_millis&quot;</span>: 0,
</span><span class='line'>                    <span class="s2">&quot;total_time&quot;</span>: <span class="s2">&quot;0s&quot;</span>,
</span><span class='line'>                    <span class="s2">&quot;total_time_in_millis&quot;</span>: 0
</span><span class='line'>                <span class="o">}</span>
</span><span class='line'>            <span class="o">}</span>,
</span></code></pre></td></tr></table></div></figure>


<h2>The Cluster Health API:</h2>

<p>Amazon restricts most of the <code>/_cluster</code> API actions, but we can however see the health endpoint, where we can see the number of <code>nodes</code>, <code>active_shards</code>, <code>relocating_shards</code>, <code>number_of_pending_tasks</code> etc:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>curl -XGET https://search-example-elasticsearch-cluster-6-abc123defghijkl5airxticzvjaqy.eu-west-1.es.amazonaws.com/_cluster/health?pretty
</span><span class='line'><span class="o">{</span>
</span><span class='line'>  <span class="s2">&quot;cluster_name&quot;</span> : <span class="s2">&quot;0123456789012:example-elasticsearch-cluster-6&quot;</span>,
</span><span class='line'>  <span class="s2">&quot;status&quot;</span> : <span class="s2">&quot;green&quot;</span>,
</span><span class='line'>  <span class="s2">&quot;timed_out&quot;</span> : <span class="nb">false</span>,
</span><span class='line'>  <span class="s2">&quot;number_of_nodes&quot;</span> : 16,
</span><span class='line'>  <span class="s2">&quot;number_of_data_nodes&quot;</span> : 10,
</span><span class='line'>  <span class="s2">&quot;active_primary_shards&quot;</span> : 803,
</span><span class='line'>  <span class="s2">&quot;active_shards&quot;</span> : 1606,
</span><span class='line'>  <span class="s2">&quot;relocating_shards&quot;</span> : 10,
</span><span class='line'>  <span class="s2">&quot;initializing_shards&quot;</span> : 0,
</span><span class='line'>  <span class="s2">&quot;unassigned_shards&quot;</span> : 0,
</span><span class='line'>  <span class="s2">&quot;delayed_unassigned_shards&quot;</span> : 0,
</span><span class='line'>  <span class="s2">&quot;number_of_pending_tasks&quot;</span> : 0,
</span><span class='line'>  <span class="s2">&quot;number_of_in_flight_fetch&quot;</span> : 0,
</span><span class='line'>  <span class="s2">&quot;task_max_waiting_in_queue_millis&quot;</span> : 0,
</span><span class='line'>  <span class="s2">&quot;active_shards_percent_as_number&quot;</span> : 100.0
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>The Pending Tasks API:</h2>

<p>We also have some insights into the <code>/_cat/pending_tasks</code> API:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>curl -s -XGET <span class="s1">&#39;https://search-example-elasticsearch-cluster-6-abc123defghijkl5airxticzvjaqy.eu-west-1.es.amazonaws.com/_cat/pending_tasks?v&#39;</span>
</span><span class='line'>insertOrder timeInQueue priority <span class="nb">source</span>
</span><span class='line'><span class="m">1757</span>        53ms URGENT   shard-started shard id <span class="o">[[</span>network-metrics-2018.04.13<span class="o">][</span>0<span class="o">]]</span>, allocation id <span class="o">[</span>Qh91o_OGRX-lFnY8KxYgQw<span class="o">]</span>, primary term <span class="o">[</span>0<span class="o">]</span>, message <span class="o">[</span>after peer recovery<span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Resources:</h2>

<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/cat-recovery.html#cat-recovery">https://www.elastic.co/guide/en/elasticsearch/reference/current/cat-recovery.html#cat-recovery</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-recovery.html">https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-recovery.html</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2018/04/15/experimenting-with-python-and-tinymongo-a-mongodb-wrapper-for-tinydb/">Experimenting With Python and TinyMongo a MongoDB Wrapper for TinyDB</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2018-04-15T16:39:22-04:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>15</span><span class='date-suffix'>th</span>, <span class='date-year'>2018</span></span> <span class='time'>4:39 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="https://github.com/schapman1974/tinymongo">TinyMongo</a> is a wrapper for MongoDB on top of TinyDB.</p>

<p>This is awesome for testing, where you need a local document orientated database which is backed by a flat file. It feels just like using MongoDB, except that its local, lightweight and using TinyDB in the backend.</p>

<h2>Installing Dependencies:</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>pip install tinymongo
</span></code></pre></td></tr></table></div></figure>


<h2>Usage Examples:</h2>

<p>Initialize tinymongo and create the database and collection:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">tinymongo</span> <span class="kn">import</span> <span class="n">TinyMongoClient</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">TinyMongoClient</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">)</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">db_init</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">mydb</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">db</span> <span class="o">=</span> <span class="n">db_init</span><span class="o">.</span><span class="n">users</span>
</span></code></pre></td></tr></table></div></figure>


<p>Insert a Document, catch the document id and search for that document:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">record_id</span> <span class="o">=</span> <span class="n">db</span> <span class="o">.</span><span class="n">insert_one</span><span class="p">({</span><span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="s">&#39;ruanb&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;ruan&#39;</span><span class="p">,</span> <span class="s">&#39;age&#39;</span><span class="p">:</span> <span class="mi">31</span><span class="p">,</span> <span class="s">&#39;gender&#39;</span><span class="p">:</span> <span class="s">&#39;male&#39;</span><span class="p">,</span> <span class="s">&#39;location&#39;</span><span class="p">:</span> <span class="s">&#39;south africa&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">inserted_id</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">user_info</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s">&quot;_id&quot;</span><span class="p">:</span> <span class="n">record_id</span><span class="p">})</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">user_info</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span><span class="s">u&#39;username&#39;</span><span class="p">:</span> <span class="s">u&#39;ruanb&#39;</span><span class="p">,</span> <span class="s">u&#39;name&#39;</span><span class="p">:</span> <span class="s">u&#39;ruan&#39;</span><span class="p">,</span> <span class="s">u&#39;gender&#39;</span><span class="p">:</span> <span class="s">u&#39;male&#39;</span><span class="p">,</span> <span class="s">u&#39;age&#39;</span><span class="p">:</span> <span class="mi">31</span><span class="p">,</span> <span class="s">u&#39;_id&#39;</span><span class="p">:</span> <span class="s">u&#39;8d2ce01140ec11e888110242ac110004&#39;</span><span class="p">,</span> <span class="s">u&#39;location&#39;</span><span class="p">:</span> <span class="s">u&#39;south africa&#39;</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Update a document: Update the age attribute from 31 to 32</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">update_one</span><span class="p">({</span><span class="s">&#39;_id&#39;</span><span class="p">:</span> <span class="s">&#39;8d2ce01140ec11e888110242ac110004&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s">&#39;$set&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;age&#39;</span><span class="p">:</span> <span class="mi">32</span> <span class="p">}})</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">user_info</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span><span class="s">u&#39;username&#39;</span><span class="p">:</span> <span class="s">u&#39;ruanb&#39;</span><span class="p">,</span> <span class="s">u&#39;name&#39;</span><span class="p">:</span> <span class="s">u&#39;ruan&#39;</span><span class="p">,</span> <span class="s">u&#39;gender&#39;</span><span class="p">:</span> <span class="s">u&#39;male&#39;</span><span class="p">,</span> <span class="s">u&#39;age&#39;</span><span class="p">:</span> <span class="mi">32</span><span class="p">,</span> <span class="s">u&#39;_id&#39;</span><span class="p">:</span> <span class="s">u&#39;8d2ce01140ec11e888110242ac110004&#39;</span><span class="p">,</span> <span class="s">u&#39;location&#39;</span><span class="p">:</span> <span class="s">u&#39;south africa&#39;</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Insert some more data:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">record_id</span> <span class="o">=</span> <span class="n">db</span> <span class="o">.</span><span class="n">insert_one</span><span class="p">({</span><span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="s">&#39;stefanb&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;stefan&#39;</span><span class="p">,</span> <span class="s">&#39;age&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="s">&#39;gender&#39;</span><span class="p">:</span> <span class="s">&#39;male&#39;</span><span class="p">,</span> <span class="s">&#39;location&#39;</span><span class="p">:</span> <span class="s">&#39;south africa&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">inserted_id</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">record_id</span> <span class="o">=</span> <span class="n">db</span> <span class="o">.</span><span class="n">insert_one</span><span class="p">({</span><span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="s">&#39;alexa&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;alex&#39;</span><span class="p">,</span> <span class="s">&#39;age&#39;</span><span class="p">:</span> <span class="mi">34</span><span class="p">,</span> <span class="s">&#39;gender&#39;</span><span class="p">:</span> <span class="s">&#39;male&#39;</span><span class="p">,</span> <span class="s">&#39;location&#39;</span><span class="p">:</span> <span class="s">&#39;south africa&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">inserted_id</span>
</span></code></pre></td></tr></table></div></figure>


<p>Find all the users, sorted by descending age, oldest to youngest:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">sort</span><span class="o">=</span><span class="p">[(</span><span class="s">&#39;age&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)])</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
</span><span class='line'><span class="o">...</span>     <span class="k">print</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
</span><span class='line'><span class="o">...</span>
</span><span class='line'><span class="p">{</span><span class="s">u&#39;username&#39;</span><span class="p">:</span> <span class="s">u&#39;alexa&#39;</span><span class="p">,</span> <span class="s">u&#39;name&#39;</span><span class="p">:</span> <span class="s">u&#39;alex&#39;</span><span class="p">,</span> <span class="s">u&#39;gender&#39;</span><span class="p">:</span> <span class="s">u&#39;male&#39;</span><span class="p">,</span> <span class="s">u&#39;age&#39;</span><span class="p">:</span> <span class="mi">34</span><span class="p">,</span> <span class="s">u&#39;_id&#39;</span><span class="p">:</span> <span class="s">u&#39;66b1cc3d40ee11e892980242ac110004&#39;</span><span class="p">,</span> <span class="s">u&#39;location&#39;</span><span class="p">:</span> <span class="s">u&#39;south africa&#39;</span><span class="p">}</span>
</span><span class='line'><span class="p">{</span><span class="s">u&#39;username&#39;</span><span class="p">:</span> <span class="s">u&#39;ruanb&#39;</span><span class="p">,</span> <span class="s">u&#39;name&#39;</span><span class="p">:</span> <span class="s">u&#39;ruan&#39;</span><span class="p">,</span> <span class="s">u&#39;gender&#39;</span><span class="p">:</span> <span class="s">u&#39;male&#39;</span><span class="p">,</span> <span class="s">u&#39;age&#39;</span><span class="p">:</span> <span class="mi">32</span><span class="p">,</span> <span class="s">u&#39;_id&#39;</span><span class="p">:</span> <span class="s">u&#39;8d2ce01140ec11e888110242ac110004&#39;</span><span class="p">,</span> <span class="s">u&#39;location&#39;</span><span class="p">:</span> <span class="s">u&#39;south africa&#39;</span><span class="p">}</span>
</span><span class='line'><span class="p">{</span><span class="s">u&#39;username&#39;</span><span class="p">:</span> <span class="s">u&#39;stefanb&#39;</span><span class="p">,</span> <span class="s">u&#39;name&#39;</span><span class="p">:</span> <span class="s">u&#39;stefan&#39;</span><span class="p">,</span> <span class="s">u&#39;gender&#39;</span><span class="p">:</span> <span class="s">u&#39;male&#39;</span><span class="p">,</span> <span class="s">u&#39;age&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="s">u&#39;_id&#39;</span><span class="p">:</span> <span class="s">u&#39;fbe9da8540ed11e88c5e0242ac110004&#39;</span><span class="p">,</span> <span class="s">u&#39;location&#39;</span><span class="p">:</span> <span class="s">u&#39;south africa&#39;</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Find the number of documents in the collection:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</span><span class='line'><span class="mi">3</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Resources:</h2>

<ul>
<li><a href="https://github.com/schapman1974/tinymongo">TinyMongo</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2018/04/15/experimenting-with-python-and-flata-the-lightweight-document-orientated-database/">Experimenting With Python and Flata the Lightweight Document Orientated Database</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2018-04-15T15:09:25-04:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>15</span><span class='date-suffix'>th</span>, <span class='date-year'>2018</span></span> <span class='time'>3:09 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="https://i.snag.gy/l298Y7.jpg" alt="" /></p>

<p><a href="https://github.com/harryho/flata">Flata</a> is a lightweight document orientated database, which was inspired by <a href="https://github.com/msiemens/tinydb">TinyDB</a> and <a href="https://github.com/typicode/lowdb">LowDB</a>.</p>

<script id="mNCC" language="javascript">
    medianet_width = "728";
    medianet_height = "90";
    medianet_crid = "218284798";
    medianet_versionId = "3111299"; 
  </script>


<script src="//contextual.media.net/nmedianet.js?cid=8CUD78FSV"></script>


<h2>Why Flata?</h2>

<p>Most of the times my mind gets in its curious states and I think about alternative ways on doing things, especially testing lightweight apps and today I wondered if theres any NoSQL-like software out there that is easy to spin up and is backed by a flat file, something like <code>sqlite</code> for SQL-like services, so this time just something for NoSQL-like.</p>

<p>So I stumbled upon TinyDB and Flata which is really easy to use and awesome!</p>

<h2>What will we be doing today:</h2>

<ul>
<li>Create Database / Table</li>
<li>Write to the Table</li>
<li>Update Documents from the Table</li>
<li>Scan the Table</li>
<li>Query the Table</li>
<li>Delete Documents from the Table</li>
<li>Purge the Table</li>
</ul>


<h2>Getting the Dependencies:</h2>

<p>Flata is written in Python, so no external dependencies is needed. To install it:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>pip install flata
</span></code></pre></td></tr></table></div></figure>


<h2>Usage Examples:</h2>

<p>My home working directory:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span><span class="nb">pwd</span>
</span><span class='line'>/home/ruan
</span></code></pre></td></tr></table></div></figure>


<p>This will be the directory where we will save our database in <code>.json</code> format.</p>

<p>Import the Dependencies:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">flata</span> <span class="kn">import</span> <span class="n">Flata</span><span class="p">,</span> <span class="n">Query</span><span class="p">,</span> <span class="n">where</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">flata.storages</span> <span class="kn">import</span> <span class="n">JSONStorage</span>
</span></code></pre></td></tr></table></div></figure>


<p>Create the Database file where all the data will be persisted:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">db_init</span> <span class="o">=</span> <span class="n">Flata</span><span class="p">(</span><span class="s">&#39;mydb.json&#39;</span><span class="p">,</span> <span class="n">storage</span><span class="o">=</span><span class="n">JSONStorage</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Create the collection / table, with a custom id field. If the resource already exists a retrieve will be done:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">db_init</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s">&#39;collection1&#39;</span><span class="p">,</span> <span class="n">id_field</span> <span class="o">=</span> <span class="s">&#39;uid&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>List the tables:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">db_init</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span><span class="s">u&#39;collection1&#39;</span><span class="p">:</span> <span class="p">{}}</span>
</span></code></pre></td></tr></table></div></figure>


<p>a get method can only be done if the resource exists, and we will assign it to the <code>db</code> object:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">db</span> <span class="o">=</span> <span class="n">db_init</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;collection1&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Insert some data into our table:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">insert</span><span class="p">({</span><span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="s">&#39;ruanb&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;ruan&#39;</span><span class="p">,</span> <span class="s">&#39;age&#39;</span><span class="p">:</span> <span class="mi">31</span><span class="p">,</span> <span class="s">&#39;gender&#39;</span><span class="p">:</span> <span class="s">&#39;male&#39;</span><span class="p">,</span> <span class="s">&#39;location&#39;</span><span class="p">:</span> <span class="s">&#39;south africa&#39;</span><span class="p">})</span>
</span><span class='line'><span class="p">{</span><span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="s">&#39;ruanb&#39;</span><span class="p">,</span> <span class="s">&#39;uid&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;gender&#39;</span><span class="p">:</span> <span class="s">&#39;male&#39;</span><span class="p">,</span> <span class="s">&#39;age&#39;</span><span class="p">:</span> <span class="mi">31</span><span class="p">,</span> <span class="s">&#39;location&#39;</span><span class="p">:</span> <span class="s">&#39;south africa&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;ruan&#39;</span><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">insert</span><span class="p">({</span><span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="s">&#39;stefanb&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;stefan&#39;</span><span class="p">,</span> <span class="s">&#39;age&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="s">&#39;gender&#39;</span><span class="p">:</span> <span class="s">&#39;male&#39;</span><span class="p">,</span> <span class="s">&#39;location&#39;</span><span class="p">:</span> <span class="s">&#39;south africa&#39;</span><span class="p">})</span>
</span><span class='line'><span class="p">{</span><span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="s">&#39;stefanb&#39;</span><span class="p">,</span> <span class="s">&#39;uid&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;gender&#39;</span><span class="p">:</span> <span class="s">&#39;male&#39;</span><span class="p">,</span> <span class="s">&#39;age&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="s">&#39;location&#39;</span><span class="p">:</span> <span class="s">&#39;south africa&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;stefan&#39;</span><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">insert</span><span class="p">({</span><span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="s">&#39;mikec&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;mike&#39;</span><span class="p">,</span> <span class="s">&#39;age&#39;</span><span class="p">:</span> <span class="mi">28</span><span class="p">,</span> <span class="s">&#39;gender&#39;</span><span class="p">:</span> <span class="s">&#39;male&#39;</span><span class="p">,</span> <span class="s">&#39;location&#39;</span><span class="p">:</span> <span class="s">&#39;south africa&#39;</span><span class="p">})</span>
</span><span class='line'><span class="p">{</span><span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="s">&#39;mikec&#39;</span><span class="p">,</span> <span class="s">&#39;uid&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;gender&#39;</span><span class="p">:</span> <span class="s">&#39;male&#39;</span><span class="p">,</span> <span class="s">&#39;age&#39;</span><span class="p">:</span> <span class="mi">28</span><span class="p">,</span> <span class="s">&#39;location&#39;</span><span class="p">:</span> <span class="s">&#39;south africa&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;mike&#39;</span><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">insert</span><span class="p">({</span><span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="s">&#39;sam&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;samantha&#39;</span><span class="p">,</span> <span class="s">&#39;age&#39;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span> <span class="s">&#39;gender&#39;</span><span class="p">:</span> <span class="s">&#39;female&#39;</span><span class="p">,</span> <span class="s">&#39;location&#39;</span><span class="p">:</span> <span class="s">&#39;south africa&#39;</span><span class="p">})</span>
</span><span class='line'><span class="p">{</span><span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="s">&#39;sam&#39;</span><span class="p">,</span> <span class="s">&#39;uid&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s">&#39;gender&#39;</span><span class="p">:</span> <span class="s">&#39;female&#39;</span><span class="p">,</span> <span class="s">&#39;age&#39;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span> <span class="s">&#39;location&#39;</span><span class="p">:</span> <span class="s">&#39;south africa&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;samantha&#39;</span><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">insert</span><span class="p">({</span><span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="s">&#39;michellek&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;michelle&#39;</span><span class="p">,</span> <span class="s">&#39;age&#39;</span><span class="p">:</span> <span class="mi">32</span><span class="p">,</span> <span class="s">&#39;gender&#39;</span><span class="p">:</span> <span class="s">&#39;female&#39;</span><span class="p">,</span> <span class="s">&#39;location&#39;</span><span class="p">:</span> <span class="s">&#39;south africa&#39;</span><span class="p">})</span>
</span><span class='line'><span class="p">{</span><span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="s">&#39;michellek&#39;</span><span class="p">,</span> <span class="s">&#39;uid&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s">&#39;gender&#39;</span><span class="p">:</span> <span class="s">&#39;female&#39;</span><span class="p">,</span> <span class="s">&#39;age&#39;</span><span class="p">:</span> <span class="mi">32</span><span class="p">,</span> <span class="s">&#39;location&#39;</span><span class="p">:</span> <span class="s">&#39;south africa&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;michelle&#39;</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Scan the whole table:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span class='line'><span class="p">[{</span><span class="s">u&#39;username&#39;</span><span class="p">:</span> <span class="s">u&#39;ruanb&#39;</span><span class="p">,</span> <span class="s">u&#39;uid&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">u&#39;name&#39;</span><span class="p">:</span> <span class="s">u&#39;ruan&#39;</span><span class="p">,</span> <span class="s">u&#39;gender&#39;</span><span class="p">:</span> <span class="s">u&#39;male&#39;</span><span class="p">,</span> <span class="s">u&#39;age&#39;</span><span class="p">:</span> <span class="mi">31</span><span class="p">,</span> <span class="s">u&#39;location&#39;</span><span class="p">:</span> <span class="s">u&#39;south africa&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s">u&#39;username&#39;</span><span class="p">:</span> <span class="s">u&#39;stefanb&#39;</span><span class="p">,</span> <span class="s">u&#39;uid&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s">u&#39;name&#39;</span><span class="p">:</span> <span class="s">u&#39;stefan&#39;</span><span class="p">,</span> <span class="s">u&#39;gender&#39;</span><span class="p">:</span> <span class="s">u&#39;male&#39;</span><span class="p">,</span> <span class="s">u&#39;age&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="s">u&#39;location&#39;</span><span class="p">:</span> <span class="s">u&#39;south africa&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s">u&#39;username&#39;</span><span class="p">:</span> <span class="s">u&#39;mikec&#39;</span><span class="p">,</span> <span class="s">u&#39;uid&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s">u&#39;name&#39;</span><span class="p">:</span> <span class="s">u&#39;mike&#39;</span><span class="p">,</span> <span class="s">u&#39;gender&#39;</span><span class="p">:</span> <span class="s">u&#39;male&#39;</span><span class="p">,</span> <span class="s">u&#39;age&#39;</span><span class="p">:</span> <span class="mi">28</span><span class="p">,</span> <span class="s">u&#39;location&#39;</span><span class="p">:</span> <span class="s">u&#39;south africa&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s">u&#39;username&#39;</span><span class="p">:</span> <span class="s">u&#39;sam&#39;</span><span class="p">,</span> <span class="s">u&#39;uid&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s">u&#39;name&#39;</span><span class="p">:</span> <span class="s">u&#39;samantha&#39;</span><span class="p">,</span> <span class="s">u&#39;gender&#39;</span><span class="p">:</span> <span class="s">u&#39;female&#39;</span><span class="p">,</span> <span class="s">u&#39;age&#39;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span> <span class="s">u&#39;location&#39;</span><span class="p">:</span> <span class="s">u&#39;south africa&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s">u&#39;username&#39;</span><span class="p">:</span> <span class="s">u&#39;michellek&#39;</span><span class="p">,</span> <span class="s">u&#39;uid&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s">u&#39;name&#39;</span><span class="p">:</span> <span class="s">u&#39;michelle&#39;</span><span class="p">,</span> <span class="s">u&#39;gender&#39;</span><span class="p">:</span> <span class="s">u&#39;female&#39;</span><span class="p">,</span> <span class="s">u&#39;age&#39;</span><span class="p">:</span> <span class="mi">32</span><span class="p">,</span> <span class="s">u&#39;location&#39;</span><span class="p">:</span> <span class="s">u&#39;south africa&#39;</span><span class="p">}]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Query data from the table.</p>

<p>Query the table for the <code>username =&gt; ruanb</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">json</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">q</span> <span class="o">=</span> <span class="n">Query</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">username</span> <span class="o">==</span> <span class="s">&#39;ruanb&#39;</span><span class="p">)</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</span><span class='line'><span class="p">[</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="s">u&#39;username&#39;</span><span class="p">:</span> <span class="s">u&#39;ruanb&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">u&#39;uid&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>    <span class="s">u&#39;name&#39;</span><span class="p">:</span> <span class="s">u&#39;ruan&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">u&#39;gender&#39;</span><span class="p">:</span> <span class="s">u&#39;male&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">u&#39;age&#39;</span><span class="p">:</span> <span class="mi">31</span><span class="p">,</span>
</span><span class='line'>    <span class="s">u&#39;location&#39;</span><span class="p">:</span> <span class="s">u&#39;south africa&#39;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Query the table for everyone that is older than <code>29</code> and only <code>male</code> genders:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">search</span><span class="p">((</span> <span class="n">q</span><span class="o">.</span><span class="n">gender</span> <span class="o">==</span> <span class="s">&#39;male&#39;</span> <span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">age</span> <span class="o">&gt;=</span> <span class="mi">29</span> <span class="p">))</span>
</span><span class='line'><span class="p">[</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="s">u&#39;username&#39;</span><span class="p">:</span> <span class="s">u&#39;ruanb&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">u&#39;uid&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>    <span class="s">u&#39;name&#39;</span><span class="p">:</span> <span class="s">u&#39;ruan&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">u&#39;gender&#39;</span><span class="p">:</span> <span class="s">u&#39;male&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">u&#39;age&#39;</span><span class="p">:</span> <span class="mi">31</span><span class="p">,</span>
</span><span class='line'>    <span class="s">u&#39;location&#39;</span><span class="p">:</span> <span class="s">u&#39;south africa&#39;</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="s">u&#39;username&#39;</span><span class="p">:</span> <span class="s">u&#39;stefanb&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">u&#39;uid&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</span><span class='line'>    <span class="s">u&#39;name&#39;</span><span class="p">:</span> <span class="s">u&#39;stefan&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">u&#39;gender&#39;</span><span class="p">:</span> <span class="s">u&#39;male&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">u&#39;age&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
</span><span class='line'>    <span class="s">u&#39;location&#39;</span><span class="p">:</span> <span class="s">u&#39;south africa&#39;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Query the table for everyone that is younger than 25 or males:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">search</span><span class="p">((</span> <span class="n">q</span><span class="o">.</span><span class="n">age</span> <span class="o">&lt;</span> <span class="mi">25</span> <span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">gender</span> <span class="o">==</span> <span class="s">&#39;male&#39;</span> <span class="p">)</span> <span class="p">)</span>
</span><span class='line'><span class="p">[</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="s">&quot;username&quot;</span><span class="p">:</span> <span class="s">&quot;ruanb&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&quot;uid&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&quot;name&quot;</span><span class="p">:</span> <span class="s">&quot;ruan&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&quot;gender&quot;</span><span class="p">:</span> <span class="s">&quot;male&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&quot;age&quot;</span><span class="p">:</span> <span class="mi">31</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&quot;location&quot;</span><span class="p">:</span> <span class="s">&quot;south africa&quot;</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="s">&quot;username&quot;</span><span class="p">:</span> <span class="s">&quot;stefanb&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&quot;uid&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&quot;name&quot;</span><span class="p">:</span> <span class="s">&quot;stefan&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&quot;gender&quot;</span><span class="p">:</span> <span class="s">&quot;male&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&quot;age&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&quot;location&quot;</span><span class="p">:</span> <span class="s">&quot;south africa&quot;</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="s">&quot;username&quot;</span><span class="p">:</span> <span class="s">&quot;mikec&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&quot;uid&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&quot;name&quot;</span><span class="p">:</span> <span class="s">&quot;mike&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&quot;gender&quot;</span><span class="p">:</span> <span class="s">&quot;male&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&quot;age&quot;</span><span class="p">:</span> <span class="mi">28</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&quot;location&quot;</span><span class="p">:</span> <span class="s">&quot;south africa&quot;</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="s">&quot;username&quot;</span><span class="p">:</span> <span class="s">&quot;sam&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&quot;uid&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&quot;name&quot;</span><span class="p">:</span> <span class="s">&quot;samantha&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&quot;gender&quot;</span><span class="p">:</span> <span class="s">&quot;female&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&quot;age&quot;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span>
</span><span class='line'>    <span class="s">&quot;location&quot;</span><span class="p">:</span> <span class="s">&quot;south africa&quot;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Update the location value: Lets say Samantha relocated to New Zealand, and we need to update her location from <code>South Africa</code> to <code>New Zealand</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;location&#39;</span><span class="p">:</span> <span class="s">&#39;new zealand&#39;</span><span class="p">},</span> <span class="n">where</span><span class="p">(</span><span class="s">&#39;username&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;sam&#39;</span> <span class="p">)</span>
</span><span class='line'><span class="p">([</span><span class="mi">4</span><span class="p">],</span> <span class="p">[{</span><span class="s">u&#39;username&#39;</span><span class="p">:</span> <span class="s">u&#39;sam&#39;</span><span class="p">,</span> <span class="s">u&#39;uid&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s">u&#39;name&#39;</span><span class="p">:</span> <span class="s">u&#39;samantha&#39;</span><span class="p">,</span> <span class="s">u&#39;gender&#39;</span><span class="p">:</span> <span class="s">u&#39;female&#39;</span><span class="p">,</span> <span class="s">u&#39;age&#39;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span> <span class="s">u&#39;location&#39;</span><span class="p">:</span> <span class="s">&#39;new zealand&#39;</span><span class="p">}])</span>
</span><span class='line'>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">username</span> <span class="o">==</span> <span class="s">&#39;sam&#39;</span><span class="p">)</span>
</span><span class='line'><span class="p">[{</span><span class="s">u&#39;username&#39;</span><span class="p">:</span> <span class="s">u&#39;sam&#39;</span><span class="p">,</span> <span class="s">u&#39;uid&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s">u&#39;name&#39;</span><span class="p">:</span> <span class="s">u&#39;samantha&#39;</span><span class="p">,</span> <span class="s">u&#39;gender&#39;</span><span class="p">:</span> <span class="s">u&#39;female&#39;</span><span class="p">,</span> <span class="s">u&#39;age&#39;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span> <span class="s">u&#39;location&#39;</span><span class="p">:</span> <span class="s">u&#39;new zealand&#39;</span><span class="p">}]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Delete a document by its id:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">ids</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
</span><span class='line'><span class="p">([</span><span class="mi">4</span><span class="p">],</span> <span class="p">[])</span>
</span></code></pre></td></tr></table></div></figure>


<p>Delete all documents matching a query, for this example, all people with the gender: <code>male</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">gender</span> <span class="o">==</span> <span class="s">&#39;male&#39;</span><span class="p">)</span>
</span><span class='line'><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[])</span>
</span></code></pre></td></tr></table></div></figure>


<p>Delete all the data in the table:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">purge</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>When we exit, you will find the database file, which we created:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>ls
</span><span class='line'>mydb.json
</span></code></pre></td></tr></table></div></figure>


<h2>Resources:</h2>

<ul>
<li><a href="https://github.com/harryho/flata">Flata</a></li>
<li><a href="https://github.com/msiemens/tinydb">TinyDB</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2018/04/07/set-docker-environment-variables-during-build-time/">Set Docker Environment Variables During Build Time</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2018-04-07T09:51:35-04:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>7</span><span class='date-suffix'>th</span>, <span class='date-year'>2018</span></span> <span class='time'>9:51 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>When using that <code>ARG</code> option in your Dockerfile, you can specify the <code>--build-args</code> option to define the value for the key that you specify in your Dockerfile to use for a environment variable as an example.</p>

<p>Today we will use the <code>arg</code> and <code>env</code> to set environment variables at build time.</p>

<h2>The Dockerfile:</h2>

<p>Our Dockerfile</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='dockerfile'><span class='line'><span class="k">FROM</span> alpine:edge
</span><span class='line'>ARG NAME
</span><span class='line'><span class="k">ENV</span> <span class="nv">OWNER</span><span class="o">=</span><span class="k">${</span><span class="nv">NAME</span><span class="k">:-</span><span class="nv">NOT_DEFINED</span><span class="k">}</span>
</span><span class='line'><span class="k">CMD</span> <span class="o">[</span><span class="s2">&quot;sh&quot;</span>, <span class="s2">&quot;-c&quot;</span>, <span class="s2">&quot;echo env var: ${OWNER}&quot;</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Building our Image, we will pass the value to our NAME argument:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker build --build-arg <span class="nv">NAME</span><span class="o">=</span>james -t ruan:test .
</span></code></pre></td></tr></table></div></figure>


<p>Now when we run our container, we will notice that the build time argument has passed through to our environment variable from the running container:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker run -it ruan:test
</span><span class='line'>env var: james
</span></code></pre></td></tr></table></div></figure>


<p>When we build the image without specifying build arguments, and running the container:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker build -t ruan:test .
</span><span class='line'><span class="nv">$ </span>docker run -it ruan:test
</span><span class='line'>env var: NOT_DEFINED
</span></code></pre></td></tr></table></div></figure>


<h2>Thank You</h2>

<p>Please feel free to show support by, <strong>sharing</strong> this post, making a <strong>donation</strong>, <strong>subscribing</strong> or <strong>reach out to me</strong> if you want me to demo and write up on any specific tech topic.</p>

<center>
<form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
<input type="hidden" name="cmd" value="_s-xclick" />
<input type="hidden" name="hosted_button_id" value="W7CBGYTCWGANQ" />
<input type="image" src="https://user-images.githubusercontent.com/567298/49853901-461c3700-fdf1-11e8-9d80-8a424a3173af.png" border="0" name="submit" title="PayPal - The safer, easier way to pay online!" alt="Donate with PayPal button" />
</form>
</center>


<p><br></p>

<p>Ad space:</p>

<script type="text/javascript">
  ( function() {
    if (window.CHITIKA === undefined) { window.CHITIKA = { 'units' : [] }; };
    var unit = {"calltype":"async[2]","publisher":"rbekker87","width":728,"height":90,"sid":"Chitika Default"};
    var placement_id = window.CHITIKA.units.length;
    window.CHITIKA.units.push(unit);
    document.write('<div id="chitikaAdBlock-' + placement_id + '"></div>');
}());
</script>


<script type="text/javascript" src="//cdn.chitika.net/getads.js" async></script>




<p><p></p>

<p>Thanks for reading!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2018/04/07/docker-environment-substitution-with-dockerfile/">Docker Environment Substitution With Dockerfile</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2018-04-07T09:18:20-04:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>7</span><span class='date-suffix'>th</span>, <span class='date-year'>2018</span></span> <span class='time'>9:18 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The <a href="https://12factor.net/">12 Factor</a> way, is a general guideline that provides best practices when building applications. One of them is using environment variables to store application configuration.</p>

<script id="mNCC" language="javascript">
    medianet_width = "728";
    medianet_height = "90";
    medianet_crid = "218284798";
    medianet_versionId = "3111299"; 
  </script>


<script src="//contextual.media.net/nmedianet.js?cid=8CUD78FSV"></script>


<h2>What will we be doing:</h2>

<p>In this post we will build a simple docker application that returns the environment variable&rsquo;s value to standard out. We are using environment substitution, so if the environment variable is not provided, we will set a default value of <code>NOT_DEFINED</code>.</p>

<p>We will have the environment variable <code>OWNER</code> and when no value is set for that Environment Variable, the <code>NOT_DEFINED</code> value will be returned.</p>

<h2>The Dockerfile</h2>

<p>Our Dockerfile:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='dockerfile'><span class='line'><span class="k">FROM</span> alpine:edge
</span><span class='line'><span class="k">ENV</span> <span class="nv">OWNER</span><span class="o">=</span><span class="k">${</span><span class="nv">OWNER</span><span class="k">:-</span><span class="nv">NOT_DEFINED</span><span class="k">}</span>
</span><span class='line'><span class="k">CMD</span> <span class="o">[</span><span class="s2">&quot;sh&quot;</span>, <span class="s2">&quot;-c&quot;</span>, <span class="s2">&quot;echo env var: ${OWNER}&quot;</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Building the image:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker build -t <span class="nb">test</span>:envs .
</span></code></pre></td></tr></table></div></figure>


<h2>Putting it to action:</h2>

<p>Now we will run a container and pass the <code>OWNER</code> environment variable as an option:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker run -it -e <span class="nv">OWNER</span><span class="o">=</span>ruan <span class="nb">test</span>:envs .
</span><span class='line'>env var: ruan
</span></code></pre></td></tr></table></div></figure>


<p>When we run a container without specifying the environment variable:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker run -it ruan:test
</span><span class='line'>env var: NOT_DEFINED
</span></code></pre></td></tr></table></div></figure>


<h2>Resources:</h2>

<ul>
<li><a href="https://stackify.com/config-values-docker-containers-environment-variables/">https://stackify.com/config-values-docker-containers-environment-variables/</a></li>
<li><a href="https://tryolabs.com/blog/2015/03/26/configurable-docker-containers-for-multiple-environments/">https://tryolabs.com/blog/2015/03/26/configurable-docker-containers-for-multiple-environments/</a></li>
</ul>


<h2>Thank You</h2>

<p>Please feel free to show support by, <strong>sharing</strong> this post, making a <strong>donation</strong>, <strong>subscribing</strong> or <strong>reach out to me</strong> if you want me to demo and write up on any specific tech topic.</p>

<center>
<form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
<input type="hidden" name="cmd" value="_s-xclick" />
<input type="hidden" name="hosted_button_id" value="W7CBGYTCWGANQ" />
<input type="image" src="https://user-images.githubusercontent.com/567298/49853901-461c3700-fdf1-11e8-9d80-8a424a3173af.png" border="0" name="submit" title="PayPal - The safer, easier way to pay online!" alt="Donate with PayPal button" />
</form>
</center>


<p><br></p>

<p>Ad space:</p>

<script type="text/javascript">
  ( function() {
    if (window.CHITIKA === undefined) { window.CHITIKA = { 'units' : [] }; };
    var unit = {"calltype":"async[2]","publisher":"rbekker87","width":728,"height":90,"sid":"Chitika Default"};
    var placement_id = window.CHITIKA.units.length;
    window.CHITIKA.units.push(unit);
    document.write('<div id="chitikaAdBlock-' + placement_id + '"></div>');
}());
</script>


<script type="text/javascript" src="//cdn.chitika.net/getads.js" async></script>




<p><p></p>

<p>Thanks for reading!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2018/04/04/using-aws-ssm-parameter-store-to-retrieve-secrets-encrypted-by-kms-using-python/">Using AWS SSM Parameter Store to Retrieve Secrets Encrypted by KMS Using Python</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2018-04-04T16:47:16-04:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2018</span></span> <span class='time'>4:47 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="https://i.snag.gy/4ytE3W.jpg" alt="" /></p>

<p>Today we will use Amazon Web Services SSM Service to store secrets in their Parameter Store which we will encyrpt using KMS.</p>

<p>Then we will read the data from SSM and decrypt using our KMS key. We will then end it off by writing a Python Script that reads the AWS credentials, authenticates with SSM and then read the secret values that we stored.</p>

<h2>The Do List:</h2>

<p>We will break up this post in the following topics:</p>

<ul>
<li>Create a KMS Key which will use to Encrypt/Decrypt the Parameter in SSM</li>
<li>Create the IAM Policy which will be used to authorize the Encrypt/Decrypt by the KMS ID</li>
<li>Create the KMS Alias</li>
<li>Create the Parameter using PutParameter as a SecureString to use Encryption with KMS</li>
<li>Describe the Parameters</li>
<li>Read the Parameter with and without Decryption to determine the difference using GetParameter</li>
<li>Read the Parameters using GetParameters</li>
<li>Environment Variable Example</li>
</ul>


<h2>Create the KMS Key:</h2>

<p>As the administrator, or root account, create the KMS Key:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">boto3</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">session</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span><span class="n">region_name</span><span class="o">=</span><span class="s">&#39;eu-west-1&#39;</span><span class="p">,</span> <span class="n">profile_name</span><span class="o">=</span><span class="s">&#39;personal&#39;</span><span class="p">)</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">iam</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s">&#39;iam&#39;</span><span class="p">)</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">kms</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s">&#39;kms&#39;</span><span class="p">)</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">kms</span><span class="o">.</span><span class="n">create_key</span><span class="p">(</span>
</span><span class='line'>    <span class="n">Description</span><span class="o">=</span><span class="s">&#39;Ruan Test Key&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="n">KeyUsage</span><span class="o">=</span><span class="s">&#39;ENCRYPT_DECRYPT&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="n">Origin</span><span class="o">=</span><span class="s">&#39;AWS_KMS&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="n">BypassPolicyLockoutSafetyCheck</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
</span><span class='line'>    <span class="n">Tags</span><span class="o">=</span><span class="p">[{</span><span class="s">&#39;TagKey&#39;</span><span class="p">:</span> <span class="s">&#39;Name&#39;</span><span class="p">,</span> <span class="s">&#39;TagValue&#39;</span><span class="p">:</span> <span class="s">&#39;RuanTestKey&#39;</span><span class="p">}]</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s">&#39;KeyMetadata&#39;</span><span class="p">][</span><span class="s">&#39;KeyId&#39;</span><span class="p">])</span>
</span><span class='line'><span class="n">foobar</span><span class="o">-</span><span class="mi">2162</span><span class="o">-</span><span class="mi">4363</span><span class="o">-</span><span class="n">ba02</span><span class="o">-</span><span class="n">a953729e5ce6</span>
</span></code></pre></td></tr></table></div></figure>


<p>Create the IAM Policy:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">iam</span><span class="o">.</span><span class="n">create_policy</span><span class="p">(</span>
</span><span class='line'>    <span class="n">PolicyName</span><span class="o">=</span><span class="s">&#39;ruan-kms-test-policy&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="n">PolicyDocument</span><span class="o">=</span><span class="s">&#39;{</span>
</span><span class='line'>        <span class="s">&quot;Version&quot;</span><span class="p">:</span> <span class="s">&quot;2012-10-17&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&quot;Statement&quot;</span><span class="p">:</span> <span class="p">[{</span>
</span><span class='line'>            <span class="s">&quot;Sid&quot;</span><span class="p">:</span> <span class="s">&quot;Stmt1517212478199&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&quot;Action&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class='line'>                <span class="s">&quot;kms:Decrypt&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="s">&quot;kms:Encrypt&quot;</span>
</span><span class='line'>            <span class="p">],</span>
</span><span class='line'>            <span class="s">&quot;Effect&quot;</span><span class="p">:</span> <span class="s">&quot;Allow&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&quot;Resource&quot;</span><span class="p">:</span> <span class="s">&quot;arn:aws:kms:eu-west-1:0123456789012:key/foobar-2162-4363-ba02-a953729e5ce6&quot;</span>
</span><span class='line'>        <span class="p">}]</span>
</span><span class='line'>    <span class="p">}</span><span class="s">&#39;, </span>
</span><span class='line'>    <span class="n">Description</span><span class="o">=</span><span class="s">&#39;Ruan KMS Test Policy&#39;</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s">&#39;Policy&#39;</span><span class="p">][</span><span class="s">&#39;Arn&#39;</span><span class="p">])</span>
</span><span class='line'><span class="n">arn</span><span class="p">:</span><span class="n">aws</span><span class="p">:</span><span class="n">iam</span><span class="p">::</span><span class="mo">01234567</span><span class="mi">89012</span><span class="p">:</span><span class="n">policy</span><span class="o">/</span><span class="n">ruan</span><span class="o">-</span><span class="n">kms</span><span class="o">-</span><span class="n">test</span><span class="o">-</span><span class="n">policy</span>
</span></code></pre></td></tr></table></div></figure>


<p>Create the KMS Alias:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">kms</span><span class="o">.</span><span class="n">create_alias</span><span class="p">(</span><span class="n">AliasName</span><span class="o">=</span><span class="s">&#39;alias/ruan-test-kms&#39;</span><span class="p">,</span> <span class="n">TargetKeyId</span><span class="o">=</span><span class="s">&#39;foobar-2162-4363-ba02-a953729e5ce6&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Publish the Secrets to SSM:</h2>

<p>As the administrator, write the secret values to the parameter store in SSM. We will publish a secret with the Parameter: <code>/test/ruan/mysql/db01/mysql_hostname</code> and the Value: <code>db01.eu-west-1.mycompany.com</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">getpass</span> <span class="kn">import</span> <span class="n">getpass</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">secretvalue</span> <span class="o">=</span> <span class="n">getpass</span><span class="p">()</span>
</span><span class='line'><span class="n">Password</span><span class="p">:</span>
</span><span class='line'>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">secretvalue</span><span class="p">)</span>
</span><span class='line'><span class="n">db01</span><span class="o">.</span><span class="n">eu</span><span class="o">-</span><span class="n">west</span><span class="o">-</span><span class="mf">1.</span><span class="n">mycompany</span><span class="o">.</span><span class="n">com</span>
</span><span class='line'>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">ssm</span><span class="o">.</span><span class="n">put_parameter</span><span class="p">(</span>
</span><span class='line'>    <span class="n">Name</span><span class="o">=</span><span class="s">&#39;/test/ruan/mysql/db01/mysql_hostname&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="n">Description</span><span class="o">=</span><span class="s">&#39;RuanTest MySQL Hostname&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="n">Value</span><span class="o">=</span><span class="n">secretvalue</span><span class="p">,</span>
</span><span class='line'>    <span class="n">Type</span><span class="o">=</span><span class="s">&#39;SecureString&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="n">KeyId</span><span class="o">=</span><span class="s">&#39;foobar-2162-4363-ba02-a953729e5ce6&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="n">Overwrite</span><span class="o">=</span><span class="bp">False</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Describe Parameters</h2>

<p>Describe the Parameter that we written to SSM:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">ssm</span><span class="o">.</span><span class="n">describe_parameters</span><span class="p">(</span>
</span><span class='line'>    <span class="n">Filters</span><span class="o">=</span><span class="p">[{</span><span class="s">&#39;Key&#39;</span><span class="p">:</span> <span class="s">&#39;Name&#39;</span><span class="p">,</span> <span class="s">&#39;Values&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;/test/ruan/mysql/db01/mysql_hostname&#39;</span><span class="p">]}]</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s">&#39;ResponseMetadata&#39;</span><span class="p">][</span><span class="s">&#39;Parameters&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;Name&#39;</span><span class="p">])</span>
</span><span class='line'><span class="s">&#39;/test/ruan/mysql/db01/mysql_hostname&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Reading from SSM:</h2>

<p>Read the Parameter value from SSM without using decryption via KMS:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">ssm</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="n">Name</span><span class="o">=</span><span class="s">&#39;/test/ruan/mysql/db01/mysql_hostname&#39;</span><span class="p">)</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s">&#39;Parameter&#39;</span><span class="p">][</span><span class="s">&#39;Value&#39;</span><span class="p">])</span>
</span><span class='line'><span class="n">AQICAHh7jazUUBgNxMQbYFeve2</span><span class="o">/</span><span class="n">p</span><span class="o">+</span><span class="n">UWTuyAd5F3ZJkZkf9</span><span class="o">+</span><span class="n">hwgF</span><span class="o">+</span><span class="n">H</span><span class="o">+</span><span class="n">kSABfPCTEarjXqYBaJAAAAejB4BgkqhkiG9w0BBwagazBpAgEAMGQGCSqGSIb3DQEHATAeBglghkgBZQMEAS4wEQQMJUEuT8wDGCQ3zRBmAgEQgDc8LhLgFe</span><span class="o">+</span><span class="n">Rutgi0hOKnjTEVQa2lKTy3MmTDZEeLy3Tlr5VUl6AVJNBpd4IWJTbj5YuqrrAAWWJ</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you can see the value is encrypted, this time read the parameter value with specifying decryption via KMS:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">ssm</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="n">Name</span><span class="o">=</span><span class="s">&#39;/test/ruan/mysql/db01/mysql_hostname&#39;</span><span class="p">,</span> <span class="n">WithDecryption</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s">&#39;Parameter&#39;</span><span class="p">][</span><span class="s">&#39;Value&#39;</span><span class="p">])</span>
</span><span class='line'><span class="n">db01</span><span class="o">.</span><span class="n">eu</span><span class="o">-</span><span class="n">west</span><span class="o">-</span><span class="mf">1.</span><span class="n">mycompany</span><span class="o">.</span><span class="n">com</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Grant Permissions to Instance Profile:</h2>

<p>Now we will create a policy that can only decrypt and read values from SSM that matches the path: <code>/test/ruan/mysql/db01/mysql_*</code>. This policy will be associated to a instance profile role, which will be used by EC2, where our application will read the values from.</p>

<p>Our policy will look like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="nt">&quot;Version&quot;</span><span class="p">:</span> <span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;Statement&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>      <span class="nt">&quot;Sid&quot;</span><span class="p">:</span> <span class="s2">&quot;Stmt1517398919242&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="nt">&quot;Action&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class='line'>        <span class="s2">&quot;kms:Decrypt&quot;</span>
</span><span class='line'>      <span class="p">],</span>
</span><span class='line'>      <span class="nt">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="nt">&quot;Resource&quot;</span><span class="p">:</span> <span class="s2">&quot;arn:aws:kms:eu-west-1:0123456789012:key/foobar-2162-4363-ba02-a953729e5ce6&quot;</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>      <span class="nt">&quot;Sid&quot;</span><span class="p">:</span> <span class="s2">&quot;Stmt1517399021096&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="nt">&quot;Action&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class='line'>        <span class="s2">&quot;ssm:GetParameter&quot;</span>
</span><span class='line'>      <span class="p">],</span>
</span><span class='line'>      <span class="nt">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="nt">&quot;Resource&quot;</span><span class="p">:</span> <span class="s2">&quot;arn:aws:ssm:eu-west-1:0123456789012:parameter/test/ruan/mysql/db01/mysql_*&quot;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">]</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Create the Policy:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">pol</span> <span class="o">=</span> <span class="s">&#39;{&quot;Version&quot;: &quot;2012-10-17&quot;,&quot;Statement&quot;: [{&quot;Sid&quot;: &quot;Stmt1517398919242&quot;,&quot;Action&quot;: [&quot;kms:Decrypt&quot;],&quot;Effect&quot;: &quot;Allow&quot;,&quot;Resource&quot;: &quot;arn:aws:kms:eu-west-1:0123456789012:key/foobar-2162-4363-ba02-a953729e5ce6&quot;},{&quot;Sid&quot;: &quot;Stmt1517399021096&quot;,&quot;Action&quot;: [&quot;ssm:GetParameter&quot;],&quot;Effect&quot;: &quot;Allow&quot;,&quot;Resource&quot;: &quot;arn:aws:ssm:eu-west-1:0123456789012:parameter/test/ruan/mysql/db01/mysql_*&quot;}]}&#39;</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">iam</span><span class="o">.</span><span class="n">create_policy</span><span class="p">(</span><span class="n">PolicyName</span><span class="o">=</span><span class="s">&#39;RuanGetSSM-Policy&#39;</span><span class="p">,</span> <span class="n">PolicyDocument</span><span class="o">=</span><span class="n">pol</span><span class="p">,</span> <span class="n">Description</span><span class="o">=</span><span class="s">&#39;Test Policy to Get SSM Parameters&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Create the instance profile:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">iam</span><span class="o">.</span><span class="n">create_instance_profile</span><span class="p">(</span><span class="n">InstanceProfileName</span><span class="o">=</span><span class="s">&#39;RuanTestSSMInstanceProfile&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Create the Role:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">iam</span><span class="o">.</span><span class="n">create_role</span><span class="p">(</span><span class="n">RoleName</span><span class="o">=</span><span class="s">&#39;RuanTestGetSSM-Role&#39;</span><span class="p">,</span> <span class="n">AssumeRolePolicyDocument</span><span class="o">=</span><span class="s">&#39;{&quot;Version&quot;: &quot;2012-10-17&quot;,&quot;Statement&quot;: [{&quot;Sid&quot;: &quot;&quot;,&quot;Effect&quot;: &quot;Allow&quot;,&quot;Principal&quot;: {&quot;Service&quot;: &quot;ec2.amazonaws.com&quot;},&quot;Action&quot;: &quot;sts:AssumeRole&quot;}]}&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Associate the Role and Instance Profile:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">iam</span><span class="o">.</span><span class="n">add_role_to_instance_profile</span><span class="p">(</span><span class="n">InstanceProfileName</span><span class="o">=</span><span class="s">&#39;RuanTestSSMInstanceProfile&#39;</span><span class="p">,</span> <span class="n">RoleName</span><span class="o">=</span><span class="s">&#39;RuanTestGetSSM-Role&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Attach the Policy to the Role:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">iam</span><span class="o">.</span><span class="n">put_role_policy</span><span class="p">(</span><span class="n">RoleName</span><span class="o">=</span><span class="s">&#39;RuanTestGetSSM-Role&#39;</span><span class="p">,</span> <span class="n">PolicyName</span><span class="o">=</span><span class="s">&#39;RuanTestGetSSMPolicy1&#39;</span><span class="p">,</span> <span class="n">PolicyDocument</span><span class="o">=</span><span class="n">pol</span><span class="s">&#39;)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Launch the EC2 instance with the above mentioned Role. Create the <code>get_ssm.py</code> and run it to decrypt and read the value from SSM:</p>

<figure class='code'><figcaption><span>get_ssm.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">boto3</span>
</span><span class='line'><span class="n">session</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span><span class="n">region_name</span><span class="o">=</span><span class="s">&#39;eu-west-1&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">ssm</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s">&#39;ssm&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">hostname</span> <span class="o">=</span> <span class="n">ssm</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="n">Name</span><span class="o">=</span><span class="s">&#39;/test/ruan/mysql/db01/mysql_hostname&#39;</span><span class="p">,</span> <span class="n">WithDecryption</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'><span class="k">print</span><span class="p">(</span><span class="n">hostname</span><span class="p">[</span><span class="s">&#39;Parameter&#39;</span><span class="p">][</span><span class="s">&#39;Value&#39;</span><span class="p">])</span>
</span></code></pre></td></tr></table></div></figure>


<p>Run it:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>python get_ssm.py
</span><span class='line'>db01.eu-west-1.mycompany.com
</span></code></pre></td></tr></table></div></figure>


<h2>Reading with GetParameters:</h2>

<p>So say that we created more than one parameter in the path that we allowed, lets use <code>GetParameters</code> to read more than one Parameter:</p>

<figure class='code'><figcaption><span>get_parameters.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">boto3</span>
</span><span class='line'><span class="n">session</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span><span class="n">region_name</span><span class="o">=</span><span class="s">&#39;eu-west-1&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">ssm</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s">&#39;ssm&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">response</span> <span class="o">=</span> <span class="n">ssm</span><span class="o">.</span><span class="n">get_parameters</span><span class="p">(</span>
</span><span class='line'>    <span class="n">Names</span><span class="o">=</span><span class="p">[</span>
</span><span class='line'>        <span class="s">&#39;/test/ruan/mysql/db01/mysql_hostname&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;/test/ruan/mysql/db01/mysql_user&#39;</span>
</span><span class='line'>    <span class="p">],</span>
</span><span class='line'>    <span class="n">WithDecryption</span><span class="o">=</span><span class="bp">True</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">for</span> <span class="n">secrets</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s">&#39;Parameters&#39;</span><span class="p">]:</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">secrets</span><span class="p">[</span><span class="s">&#39;Name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;/test/ruan/mysql/db01/mysql_hostname&#39;</span><span class="p">:</span>
</span><span class='line'>        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Hostname: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">secrets</span><span class="p">[</span><span class="s">&#39;Value&#39;</span><span class="p">]))</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">secrets</span><span class="p">[</span><span class="s">&#39;Name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;/test/ruan/mysql/db01/mysql_user&#39;</span><span class="p">:</span>
</span><span class='line'>        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Username: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">secrets</span><span class="p">[</span><span class="s">&#39;Value&#39;</span><span class="p">]))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Run it:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>python get_parameters.py
</span><span class='line'>Hostname: db01.eu-west-1.mycompany.com
</span><span class='line'>Username: super_dba
</span></code></pre></td></tr></table></div></figure>


<h2>Environment Variable Example from an Application:</h2>

<p>Set the Environment Variable value to the SSM key:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span><span class="nb">export </span><span class="nv">MYSQL_HOSTNAME</span><span class="o">=</span><span class="s2">&quot;/test/ruan/mysql/db01/mysql_hostname&quot;</span>
</span><span class='line'><span class="nv">$ </span><span class="nb">export </span><span class="nv">MYSQL_USERNAME</span><span class="o">=</span><span class="s2">&quot;/test/ruan/mysql/db01/mysql_user&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The application code:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">os</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">boto3</span>
</span><span class='line'>
</span><span class='line'><span class="n">session</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span><span class="n">region_name</span><span class="o">=</span><span class="s">&#39;eu-west-1&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">ssm</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s">&#39;ssm&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">MYSQL_HOSTNAME</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;MYSQL_HOSTNAME&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">MYSQL_USERNAME</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;MYSQL_USERNAME&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">hostname</span> <span class="o">=</span> <span class="n">ssm</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="n">Name</span><span class="o">=</span><span class="n">MYSQL_HOSTNAME</span><span class="p">,</span> <span class="n">WithDecryption</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'><span class="n">username</span> <span class="o">=</span> <span class="n">ssm</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span><span class="n">Name</span><span class="o">=</span><span class="n">MYSQL_USERNAME</span><span class="p">,</span> <span class="n">WithDecryption</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">print</span><span class="p">(</span><span class="s">&quot;Hostname: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hostname</span><span class="p">[</span><span class="s">&#39;Parameter&#39;</span><span class="p">][</span><span class="s">&#39;Value&#39;</span><span class="p">]))</span>
</span><span class='line'><span class="k">print</span><span class="p">(</span><span class="s">&quot;Username: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">username</span><span class="p">[</span><span class="s">&#39;Parameter&#39;</span><span class="p">][</span><span class="s">&#39;Value&#39;</span><span class="p">]))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Let the application transform the key to the SSM Value:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>python app.py
</span><span class='line'>Hostname: db01.eu-west-1.mycompany.com
</span><span class='line'>Username: super_dba
</span></code></pre></td></tr></table></div></figure>


<h2>Resources:</h2>

<p>Great thanks to the following resources:</p>

<ul>
<li><a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/sysman-paramstore-su-organize.html">https://docs.aws.amazon.com/systems-manager/latest/userguide/sysman-paramstore-su-organize.html</a></li>
<li><a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-roles.html">https://docs.aws.amazon.com/cli/latest/userguide/cli-roles.html</a></li>
<li><a href="https://github.com/iMilnb/awstools/blob/master/platforms/roles/mkrole.py">https://github.com/iMilnb/awstools/blob/master/platforms/roles/mkrole.py</a></li>
<li><a href="https://github.com/ktruckenmiller/ssm-get-parameter-by-path/blob/master/python.py">https://github.com/ktruckenmiller/ssm-get-parameter-by-path/blob/master/python.py</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2018/04/03/using-python-boto3-and-dreamhosts-dreamobjects-to-interact-with-their-object-storage-offering/">Using Python Boto3 and DreamHosts DreamObjects to Interact With Their Object Storage Offering</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2018-04-03T07:19:27-04:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>3</span><span class='date-suffix'>rd</span>, <span class='date-year'>2018</span></span> <span class='time'>7:19 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="https://i.snag.gy/uxK5qy.jpg" alt="" /></p>

<p>In this post I will demonstrate how to interact with Dreamhost&rsquo;s Object Storage Service Offering called DreamObjects using Python Boto3 library. Dreamhost offers Object Storage at great pricing, for more information have a look at their <a href="https://goo.gl/N7Xws8">Documentation</a></p>

<h2>Whats on the Menu:</h2>

<p>We will do the following:</p>

<ul>
<li>List Buckets</li>
<li>List Objects</li>
<li>Put Object</li>
<li>Get Object</li>
<li>Upload Object</li>
<li>Download Object</li>
<li>Delete Object(s)</li>
</ul>


<h2>Configuration</h2>

<p>First we need to configure credentials, by providing the access key and access secret key, that is provided by DreamHost:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>pip install awscli
</span><span class='line'><span class="nv">$ </span>aws configure --profile dreamhost
</span></code></pre></td></tr></table></div></figure>


<p>After your credentials is set to your profile, we will need to import boto3 and instantiate the s3 client with our profile name, region name and endpoint url:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">boto3</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">session</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span><span class="n">region_name</span><span class="o">=</span><span class="s">&#39;us-west-2&#39;</span><span class="p">,</span> <span class="n">profile_name</span><span class="o">=</span><span class="s">&#39;dreamhost&#39;</span><span class="p">)</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">s3</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s">&#39;s3&#39;</span><span class="p">,</span> <span class="n">endpoint_url</span><span class="o">=</span><span class="s">&#39;https://objects-us-west-1.dream.io&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>List Buckets:</h2>

<p>To list our Buckets:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">s3</span><span class="o">.</span><span class="n">list_buckets</span><span class="p">()</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span><span class="s">u&#39;Owner&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">u&#39;DisplayName&#39;</span><span class="p">:</span> <span class="s">&#39;foobar&#39;</span><span class="p">,</span> <span class="s">u&#39;ID&#39;</span><span class="p">:</span> <span class="s">&#39;foobar&#39;</span><span class="p">},</span> <span class="s">u&#39;Buckets&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s">u&#39;CreationDate&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2017</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">921000</span><span class="p">,</span> <span class="n">tzinfo</span><span class="o">=</span><span class="n">tzutc</span><span class="p">()),</span> <span class="s">u&#39;Name&#39;</span><span class="p">:</span> <span class="s">&#39;ruanbucket&#39;</span><span class="p">}],</span> <span class="s">&#39;ResponseMetadata&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;HTTPStatusCode&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="s">&#39;RetryAttempts&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;HostId&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;RequestId&#39;</span><span class="p">:</span> <span class="s">&#39;tx00000000000000003cd88-005ac361f5-foobar-default&#39;</span><span class="p">,</span> <span class="s">&#39;HTTPHeaders&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;date&#39;</span><span class="p">:</span> <span class="s">&#39;Tue, 03 Apr 2018 11:13:57 GMT&#39;</span><span class="p">,</span> <span class="s">&#39;content-length&#39;</span><span class="p">:</span> <span class="s">&#39;306&#39;</span><span class="p">,</span> <span class="s">&#39;x-amz-request-id&#39;</span><span class="p">:</span> <span class="s">&#39;tx00000000000000003cd88-005ac361f5-foobar-default&#39;</span><span class="p">,</span> <span class="s">&#39;content-type&#39;</span><span class="p">:</span> <span class="s">&#39;application/xml&#39;</span><span class="p">}}}</span>
</span><span class='line'>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">bucket</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s">&#39;Buckets&#39;</span><span class="p">]:</span>
</span><span class='line'><span class="o">...</span>     <span class="k">print</span><span class="p">(</span><span class="n">bucket</span><span class="p">[</span><span class="s">&#39;Name&#39;</span><span class="p">])</span>
</span><span class='line'><span class="o">...</span>
</span><span class='line'><span class="n">ruanbucket</span>
</span></code></pre></td></tr></table></div></figure>


<h2>List Objects:</h2>

<p>List all the Objects, after the given prefix:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">s3</span><span class="o">.</span><span class="n">list_objects</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="s">&#39;ruanbucket&#39;</span><span class="p">,</span> <span class="n">Prefix</span><span class="o">=</span><span class="s">&#39;logs/sysadmins.co.za/access/&#39;</span><span class="p">)</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s">&#39;Contents&#39;</span><span class="p">]:</span>
</span><span class='line'><span class="o">...</span>     <span class="k">print</span> <span class="n">obj</span><span class="p">[</span><span class="s">&#39;Key&#39;</span><span class="p">]</span>
</span><span class='line'><span class="o">...</span>
</span><span class='line'><span class="n">logs</span><span class="o">/</span><span class="n">sysadmins</span><span class="o">.</span><span class="n">co</span><span class="o">.</span><span class="n">za</span><span class="o">/</span><span class="n">access</span><span class="o">/</span><span class="n">access</span><span class="o">.</span><span class="n">log</span><span class="o">-</span><span class="mi">2017</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mf">10.</span><span class="n">gz</span>
</span><span class='line'><span class="n">logs</span><span class="o">/</span><span class="n">sysadmins</span><span class="o">.</span><span class="n">co</span><span class="o">.</span><span class="n">za</span><span class="o">/</span><span class="n">access</span><span class="o">/</span><span class="n">access</span><span class="o">.</span><span class="n">log</span><span class="o">-</span><span class="mi">2017</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mf">11.</span><span class="n">gz</span>
</span><span class='line'><span class="n">logs</span><span class="o">/</span><span class="n">sysadmins</span><span class="o">.</span><span class="n">co</span><span class="o">.</span><span class="n">za</span><span class="o">/</span><span class="n">access</span><span class="o">/</span><span class="n">access</span><span class="o">.</span><span class="n">log</span><span class="o">-</span><span class="mi">2017</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mf">12.</span><span class="n">gz</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Put Object:</h2>

<p>Write text as the body to the destination key on the Bucket:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">s3</span><span class="o">.</span><span class="n">put_object</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="s">&#39;ruanbucket&#39;</span><span class="p">,</span> <span class="n">Body</span><span class="o">=</span><span class="s">&#39;My Name is Ruan</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">Key</span><span class="o">=</span><span class="s">&#39;uploads/docs/file.txt&#39;</span><span class="p">)</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span><span class="s">u&#39;Body&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">botocore</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">StreamingBody</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x13cde10</span><span class="o">&gt;</span><span class="p">,</span> <span class="s">u&#39;AcceptRanges&#39;</span><span class="p">:</span> <span class="s">&#39;bytes&#39;</span><span class="p">,</span> <span class="s">u&#39;ContentType&#39;</span><span class="p">:</span> <span class="s">&#39;binary/octet-stream&#39;</span><span class="p">,</span> <span class="s">&#39;ResponseMetadata&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;HTTPStatusCode&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="s">&#39;RetryAttempts&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;HostId&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;RequestId&#39;</span><span class="p">:</span> <span class="s">&#39;tx0000000000000000053f2-005ac3e0db-foobar-default&#39;</span><span class="p">,</span> <span class="s">&#39;HTTPHeaders&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;content-length&#39;</span><span class="p">:</span> <span class="s">&#39;16&#39;</span><span class="p">,</span> <span class="s">&#39;accept-ranges&#39;</span><span class="p">:</span> <span class="s">&#39;bytes&#39;</span><span class="p">,</span> <span class="s">&#39;last-modified&#39;</span><span class="p">:</span> <span class="s">&#39;Tue, 03 Apr 2018 20:14:54 GMT&#39;</span><span class="p">,</span> <span class="s">&#39;etag&#39;</span><span class="p">:</span> <span class="s">&#39;&quot;292edceea84d1234465f725c3921fc2a&quot;&#39;</span><span class="p">,</span> <span class="s">&#39;x-amz-request-id&#39;</span><span class="p">:</span> <span class="s">&#39;tx0000000000000000053f2-005ac3e0db-foobar-default&#39;</span><span class="p">,</span> <span class="s">&#39;date&#39;</span><span class="p">:</span> <span class="s">&#39;Tue, 03 Apr 2018 20:15:23 GMT&#39;</span><span class="p">,</span> <span class="s">&#39;content-type&#39;</span><span class="p">:</span> <span class="s">&#39;binary/octet-stream&#39;</span><span class="p">}},</span> <span class="s">u&#39;LastModified&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">54</span><span class="p">,</span> <span class="n">tzinfo</span><span class="o">=</span><span class="n">tzutc</span><span class="p">()),</span> <span class="s">u&#39;ContentLength&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span> <span class="s">u&#39;ETag&#39;</span><span class="p">:</span> <span class="s">&#39;&quot;292edceea84d1234465f725c3921fc2a&quot;&#39;</span><span class="p">,</span> <span class="s">u&#39;Metadata&#39;</span><span class="p">:</span> <span class="p">{}}</span>
</span></code></pre></td></tr></table></div></figure>


<p>List the Object that we have created in the Bucket::</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">s3</span><span class="o">.</span><span class="n">list_objects</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="s">&#39;ruanbucket&#39;</span><span class="p">,</span> <span class="n">Prefix</span><span class="o">=</span><span class="s">&#39;uploads/&#39;</span><span class="p">)</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s">&#39;Contents&#39;</span><span class="p">]:</span>
</span><span class='line'><span class="o">...</span>     <span class="k">print</span> <span class="n">obj</span><span class="p">[</span><span class="s">&#39;Key&#39;</span><span class="p">]</span>
</span><span class='line'><span class="o">...</span>
</span><span class='line'><span class="n">uploads</span><span class="o">/</span><span class="n">docs</span><span class="o">/</span><span class="nb">file</span><span class="o">.</span><span class="n">txt</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Get Object:</h2>

<p>Read the value from the key that was uploaded:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">s3</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="s">&#39;ruanbucket&#39;</span><span class="p">,</span> <span class="n">Key</span><span class="o">=</span><span class="s">&#39;uploads/docs/file.txt&#39;</span><span class="p">)</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s">&#39;Body&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span><span class='line'><span class="n">My</span> <span class="n">Name</span> <span class="ow">is</span> <span class="n">Ruan</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Upload Files:</h2>

<p>Upload the file from disk to the Bucket:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;myfile.txt&#39;</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">data</span><span class="p">:</span>
</span><span class='line'><span class="o">...</span>     <span class="n">s3</span><span class="o">.</span><span class="n">upload_fileobj</span><span class="p">(</span><span class="n">Fileobj</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">Bucket</span><span class="o">=</span><span class="s">&#39;ruanbucket&#39;</span><span class="p">,</span> <span class="n">Key</span><span class="o">=</span><span class="s">&#39;uploads/docs/uploadobj.txt&#39;</span><span class="p">)</span>
</span><span class='line'><span class="o">...</span>
</span></code></pre></td></tr></table></div></figure>


<p>Read the contents from the uploaded file:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">s3</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="s">&#39;ruanbucket&#39;</span><span class="p">,</span> <span class="n">Key</span><span class="o">=</span><span class="s">&#39;uploads/docs/uploadobj.txt&#39;</span><span class="p">)</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s">&#39;Body&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span><span class='line'><span class="n">This</span> <span class="ow">is</span> <span class="n">some</span> <span class="n">text</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Download File:</h2>

<p>Download the file from the Bucket to the local disk:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;downloaded.txt&#39;</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">data</span><span class="p">:</span>
</span><span class='line'><span class="o">...</span>     <span class="n">s3</span><span class="o">.</span><span class="n">download_fileobj</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="s">&#39;ruanbucket&#39;</span><span class="p">,</span> <span class="n">Key</span><span class="o">=</span><span class="s">&#39;uploads/docs/uploadobj.txt&#39;</span><span class="p">,</span> <span class="n">Fileobj</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</span><span class='line'><span class="o">...</span>
</span></code></pre></td></tr></table></div></figure>


<p>Read the file&rsquo;s content from disk:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s">&#39;downloaded.txt&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span><span class='line'><span class="n">This</span> <span class="ow">is</span> <span class="n">some</span> <span class="n">text</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Delete Object:</h2>

<p>Delete one object:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">s3</span><span class="o">.</span><span class="n">delete_object</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="s">&#39;ruanbucket&#39;</span><span class="p">,</span> <span class="n">Key</span><span class="o">=</span><span class="s">&#39;uploads/docs/uploadobj.txt&#39;</span><span class="p">)</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span><span class="s">&#39;ResponseMetadata&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;HTTPStatusCode&#39;</span><span class="p">:</span> <span class="mi">204</span><span class="p">,</span> <span class="s">&#39;RetryAttempts&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;HostId&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;RequestId&#39;</span><span class="p">:</span> <span class="s">&#39;tx00000000000000000be5a-005ac3e61a-foobar-default&#39;</span><span class="p">,</span> <span class="s">&#39;HTTPHeaders&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;date&#39;</span><span class="p">:</span> <span class="s">&#39;Tue, 03 Apr 2018 20:37:46 GMT&#39;</span><span class="p">,</span> <span class="s">&#39;x-amz-request-id&#39;</span><span class="p">:</span> <span class="s">&#39;tx00000000000000000be5a-005ac3e61a-foobar-default&#39;</span><span class="p">}}}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Delete Objects:</h2>

<p>Delete more than one object with a single API call:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">s3</span><span class="o">.</span><span class="n">delete_objects</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="s">&#39;ruanbucket&#39;</span><span class="p">,</span> <span class="n">Delete</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;Objects&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s">&#39;Key&#39;</span><span class="p">:</span> <span class="s">&#39;uploads/docs/file.txt&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s">&#39;Key&#39;</span><span class="p">:</span> <span class="s">&#39;uploads/docs/file2.txt&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s">&#39;Key&#39;</span><span class="p">:</span> <span class="s">&#39;uploads/docs/file3.txt&#39;</span><span class="p">}]})</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span><span class="s">u&#39;Deleted&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s">u&#39;Key&#39;</span><span class="p">:</span> <span class="s">&#39;uploads/docs/file.txt&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s">u&#39;Key&#39;</span><span class="p">:</span> <span class="s">&#39;uploads/docs/file2.txt&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s">u&#39;Key&#39;</span><span class="p">:</span> <span class="s">&#39;uploads/docs/file3.txt&#39;</span><span class="p">}],</span> <span class="s">&#39;ResponseMetadata&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;HTTPStatusCode&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="s">&#39;RetryAttempts&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;HostId&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;RequestId&#39;</span><span class="p">:</span> <span class="s">&#39;tx000000000000000011008-005ac3e951-foobar-default&#39;</span><span class="p">,</span> <span class="s">&#39;HTTPHeaders&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;date&#39;</span><span class="p">:</span> <span class="s">&#39;Tue, 03 Apr 2018 20:51:29 GMT&#39;</span><span class="p">,</span> <span class="s">&#39;content-length&#39;</span><span class="p">:</span> <span class="s">&#39;270&#39;</span><span class="p">,</span> <span class="s">&#39;x-amz-request-id&#39;</span><span class="p">:</span> <span class="s">&#39;tx000000000000000011008-005ac3e951-217c0ac5-default&#39;</span><span class="p">,</span> <span class="s">&#39;content-type&#39;</span><span class="p">:</span> <span class="s">&#39;application/xml&#39;</span><span class="p">}}}</span>
</span></code></pre></td></tr></table></div></figure>


<p>For more information on the above, have a look at <a href="http://boto3.readthedocs.io/en/latest/guide/quickstart.html">Boto&rsquo;s Documentation</a> and <a href="https://www.dreamhost.com/">DreamHost&rsquo;s Website</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2018/04/01/setup-mongodb-server-on-arm64-using-scaleway/">Setup MongoDB Server on ARM64 Using Scaleway</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2018-04-01T18:46:27-04:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>1</span><span class='date-suffix'>st</span>, <span class='date-year'>2018</span></span> <span class='time'>6:46 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="https://preview.ibb.co/bBRhn7/scw.png" alt="" /></p>

<p>I&rsquo;ve been using Scaleway for the past 18 months and I must admit, I love hosting my Applications on their Infrastructure. They have expanded rapidly recently, and currently deploying more infrstructure due to the high demand.</p>

<p>Scaleway is a Cloud Division of Online.net. They provide Baremetal and Cloud SSD Virtual Servers. Im currently hosting a Docker Swarm Cluster, Blogs, Payara Java Application Servers, Elasticsearch and MongoDB Clusters with them and really happy with the performance and stability of their services.</p>

<h2>What will we be doing today:</h2>

<p>Today I will be deploying MongoDB Server on a ARM64-2GB Instance, which costs you 2.99 Euros per month, absolutely awesome pricing! After we install MongoDB we will setup authentication, and then just a few basic examples on writing and reading from MongoDB.</p>

<h2>Getting Started:</h2>

<p>Logon to <a href="cloud.scaleway.com">cloud.scaleway.com</a> then launch an instance, which will look like the following:</p>

<p><img src="https://image.ibb.co/e7T9jn/scw_launch.png" alt="" /></p>

<p>After you deployed your instance, SSH to your instance, and it should look like this:</p>

<p><img src="https://preview.ibb.co/k16C4n/scw_ssh.png" alt="" /></p>

<h2>Dependencies:</h2>

<p>Get the repository and install MongoDB:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>apt update
</span><span class='line'><span class="nv">$ </span>apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 2930ADAE8CAF5059EE73BB4B58712A2291FA4AD5
</span><span class='line'><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu xenial/mongodb-org/3.6 multiverse&quot;</span> <span class="p">|</span> sudo tee /etc/apt/sources.list.d/mongodb-org-3.6.list
</span><span class='line'><span class="nv">$ </span>apt update <span class="o">&amp;&amp;</span> apt upgrade -y
</span><span class='line'><span class="nv">$ </span>apt install mongodb-org -y
</span></code></pre></td></tr></table></div></figure>


<p>Enable MongoDB on Boot:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>systemctl <span class="nb">enable </span>mongod
</span></code></pre></td></tr></table></div></figure>


<h2>Configuration:</h2>

<p>Your configuration might look different from mine, so I recommend to backup your config first, as the following command will overwrite the config to the configuration that I will be using for this demonstration:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>cat &gt; /etc/mongod.conf <span class="s">&lt;&lt; EOF</span>
</span><span class='line'><span class="s">storage:</span>
</span><span class='line'><span class="s">  dbPath: /var/lib/mongodb</span>
</span><span class='line'><span class="s">  journal:</span>
</span><span class='line'><span class="s">    enabled: false</span>
</span><span class='line'>
</span><span class='line'><span class="s">storage:</span>
</span><span class='line'><span class="s">  mmapv1:</span>
</span><span class='line'><span class="s">    smallFiles: true</span>
</span><span class='line'>
</span><span class='line'><span class="s">systemLog:</span>
</span><span class='line'><span class="s">  destination: file</span>
</span><span class='line'><span class="s">  logAppend: true</span>
</span><span class='line'><span class="s">  path: /var/log/mongodb/mongod.log</span>
</span><span class='line'>
</span><span class='line'><span class="s">net:</span>
</span><span class='line'><span class="s">  port: 27017</span>
</span><span class='line'><span class="s">  bindIp: 0.0.0.0</span>
</span><span class='line'>
</span><span class='line'><span class="s">processManagement:</span>
</span><span class='line'><span class="s">  timeZoneInfo: /usr/share/zoneinfo</span>
</span><span class='line'>
</span><span class='line'><span class="s">security:</span>
</span><span class='line'><span class="s">  authorization: enabled</span>
</span><span class='line'><span class="s">EOF</span>
</span></code></pre></td></tr></table></div></figure>


<p>Restart MongoDB for the config changes to take affect:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>systemctl restart mongod
</span></code></pre></td></tr></table></div></figure>


<h2>Authentication:</h2>

<p>Create the Authentication:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>mongo
</span><span class='line'>MongoDB shell version v3.6.3
</span><span class='line'>connecting to: mongodb://127.0.0.1:27017
</span><span class='line'>MongoDB server version: 3.6.3
</span><span class='line'>Welcome to the MongoDB shell.
</span><span class='line'>
</span><span class='line'>&gt; use admin
</span><span class='line'>&gt; db.createUser<span class="o">({</span>user: <span class="s2">&quot;ruan&quot;</span>, <span class="nb">pwd</span>: <span class="s2">&quot;pass123&quot;</span>, roles:<span class="o">[{</span>role: <span class="s2">&quot;root&quot;</span>, db: <span class="s2">&quot;admin&quot;</span><span class="o">}]})</span>
</span><span class='line'>Successfully added user: <span class="o">{</span>
</span><span class='line'>        <span class="s2">&quot;user&quot;</span> : <span class="s2">&quot;ruan&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;roles&quot;</span> : <span class="o">[</span>
</span><span class='line'>                <span class="o">{</span>
</span><span class='line'>                        <span class="s2">&quot;role&quot;</span> : <span class="s2">&quot;root&quot;</span>,
</span><span class='line'>                        <span class="s2">&quot;db&quot;</span> : <span class="s2">&quot;admin&quot;</span>
</span><span class='line'>                <span class="o">}</span>
</span><span class='line'>        <span class="o">]</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'>&gt; <span class="nb">exit</span>
</span></code></pre></td></tr></table></div></figure>


<p>Restart MongoDB and logon with your credentials:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>systemctl restart mongod
</span><span class='line'>
</span><span class='line'><span class="nv">$ </span>mongo --authenticationDatabase admin --host localhost --port <span class="m">27017</span> -u ruan -p
</span><span class='line'>MongoDB shell version v3.6.3
</span><span class='line'>Enter password:
</span><span class='line'>connecting to: mongodb://localhost:27017/
</span><span class='line'>MongoDB server version: 3.6.3
</span><span class='line'>&gt;
</span></code></pre></td></tr></table></div></figure>


<h2>Write and Read from MongoDB</h2>

<p>While you are on the MongoDB Shell, we will insert a couple of documents, first drop in to the database that you would like to write to:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt; use testdb
</span><span class='line'>switched to db testdb
</span></code></pre></td></tr></table></div></figure>


<p>Now we will write to the collection: <code>collection1</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt; db.collection1.insert<span class="o">({</span><span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;ruan&quot;</span>, <span class="s2">&quot;surname&quot;</span>: <span class="s2">&quot;bekker&quot;</span>, <span class="s2">&quot;age&quot;</span>: 31, <span class="s2">&quot;country&quot;</span>: <span class="s2">&quot;south africa&quot;</span><span class="o">})</span>
</span><span class='line'>WriteResult<span class="o">({</span> <span class="s2">&quot;nInserted&quot;</span> : <span class="m">1</span> <span class="o">})</span>
</span><span class='line'>
</span><span class='line'>&gt; db.collection1.insert<span class="o">({</span><span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;stefan&quot;</span>, <span class="s2">&quot;surname&quot;</span>: <span class="s2">&quot;bester&quot;</span>, <span class="s2">&quot;age&quot;</span>: 30, <span class="s2">&quot;country&quot;</span>: <span class="s2">&quot;south africa&quot;</span><span class="o">})</span>
</span><span class='line'>WriteResult<span class="o">({</span> <span class="s2">&quot;nInserted&quot;</span> : <span class="m">1</span> <span class="o">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>To find all the documents in our collection:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt; db.collection1.find<span class="o">()</span>
</span><span class='line'><span class="o">{</span> <span class="s2">&quot;_id&quot;</span> : ObjectId<span class="o">(</span><span class="s2">&quot;5ac15ff0f4a5500484defd23&quot;</span><span class="o">)</span>, <span class="s2">&quot;name&quot;</span> : <span class="s2">&quot;ruan&quot;</span>, <span class="s2">&quot;surname&quot;</span> : <span class="s2">&quot;bekker&quot;</span>, <span class="s2">&quot;age&quot;</span> : 31, <span class="s2">&quot;country&quot;</span> : <span class="s2">&quot;south africa&quot;</span> <span class="o">}</span>
</span><span class='line'><span class="o">{</span> <span class="s2">&quot;_id&quot;</span> : ObjectId<span class="o">(</span><span class="s2">&quot;5ac16003f4a5500484defd24&quot;</span><span class="o">)</span>, <span class="s2">&quot;name&quot;</span> : <span class="s2">&quot;stefan&quot;</span>, <span class="s2">&quot;surname&quot;</span> : <span class="s2">&quot;bester&quot;</span>, <span class="s2">&quot;age&quot;</span> : 30, <span class="s2">&quot;country&quot;</span> : <span class="s2">&quot;south africa&quot;</span> <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>To prettify the output:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt; db.collection1.find<span class="o">()</span>.pretty<span class="o">()</span>
</span><span class='line'><span class="o">{</span>
</span><span class='line'>        <span class="s2">&quot;_id&quot;</span> : ObjectId<span class="o">(</span><span class="s2">&quot;5ac15ff0f4a5500484defd23&quot;</span><span class="o">)</span>,
</span><span class='line'>        <span class="s2">&quot;name&quot;</span> : <span class="s2">&quot;ruan&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;surname&quot;</span> : <span class="s2">&quot;bekker&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;age&quot;</span> : 31,
</span><span class='line'>        <span class="s2">&quot;country&quot;</span> : <span class="s2">&quot;south africa&quot;</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="o">{</span>
</span><span class='line'>        <span class="s2">&quot;_id&quot;</span> : ObjectId<span class="o">(</span><span class="s2">&quot;5ac16003f4a5500484defd24&quot;</span><span class="o">)</span>,
</span><span class='line'>        <span class="s2">&quot;name&quot;</span> : <span class="s2">&quot;stefan&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;surname&quot;</span> : <span class="s2">&quot;bester&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;age&quot;</span> : 30,
</span><span class='line'>        <span class="s2">&quot;country&quot;</span> : <span class="s2">&quot;south africa&quot;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>To find a document with the key/value of <code>name: ruan</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt; db.collection1.find<span class="o">({</span><span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;ruan&quot;</span><span class="o">})</span>.pretty<span class="o">()</span>
</span><span class='line'><span class="o">{</span>
</span><span class='line'>        <span class="s2">&quot;_id&quot;</span> : ObjectId<span class="o">(</span><span class="s2">&quot;5ac15ff0f4a5500484defd23&quot;</span><span class="o">)</span>,
</span><span class='line'>        <span class="s2">&quot;name&quot;</span> : <span class="s2">&quot;ruan&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;surname&quot;</span> : <span class="s2">&quot;bekker&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;age&quot;</span> : 31,
</span><span class='line'>        <span class="s2">&quot;country&quot;</span> : <span class="s2">&quot;south africa&quot;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>To view the database that you are currently switched to:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt; db
</span><span class='line'>testdb
</span></code></pre></td></tr></table></div></figure>


<p>To view all the databases:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt; show dbs
</span><span class='line'>admin   0.000GB
</span><span class='line'>config  0.000GB
</span><span class='line'><span class="nb">local   </span>0.000GB
</span><span class='line'>testdb  0.000GB
</span></code></pre></td></tr></table></div></figure>


<p>To view the collections in the database:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt; show collections
</span><span class='line'>collection1
</span><span class='line'>
</span><span class='line'>&gt; <span class="nb">exit</span>
</span></code></pre></td></tr></table></div></figure>


<p>That was just a quick post on installing MongoDB on ARM64 using Scaleway. Try them out, and they are also hiring: <a href="https://careers.scaleway.com/">careers.scaleway.com</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2018/03/30/create-a-logical-volume-using-lvm-on-ubuntu/">Create a Logical Volume Using LVM on Ubuntu</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2018-03-30T20:38:18-04:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>30</span><span class='date-suffix'>th</span>, <span class='date-year'>2018</span></span> <span class='time'>8:38 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Logical Volume Manager (LVM) - adds an extra layer between the physical disks and the file system, which allows you to resize your storage on the fly, use multiple disks, instead of one, etc.</p>

<h2>Concepts:</h2>

<p>Physical Volume:
- Physical Volume represents the actual disk / block device.</p>

<p>Volume Group:
- Volume Groups combines the collection of Logical Volumes and Physical Volumes into one administrative unit.</p>

<p>Logical Volume:
- A Logical Volume is the conceptual equivalent of a disk partition in a non-LVM system.</p>

<p>File Systems:
- File systems are built on top of logical volumes.</p>

<h2>What we are doing today:</h2>

<p>We have a disk installed on our server which is 150GB that is located on <code>/dev/vdb</code>, which we will manage via LVM and will be mounted under <code>/mnt</code></p>

<h2>Dependencies:</h2>

<p>Update and Install LVM:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ apt update && apt upgrade -y
</span><span class='line'>$ apt install lvm2 -y
</span><span class='line'>$ systemctl enable lvm2-lvmetad
</span><span class='line'>$ systemctl start lvm2-lvmetad</span></code></pre></td></tr></table></div></figure>


<h2>Create the Logical Volume:</h2>

<p>Initialize the Physical Volume to be managed by LVM, then create the Volume Group, then go ahead to create the Logical Volume:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ pvcreate /dev/vdb
</span><span class='line'>$ vgcreate vg1 /dev/vdb
</span><span class='line'>$ lvcreate -l 100%FREE -n vol1 vg1</span></code></pre></td></tr></table></div></figure>


<p>Build the Linux Filesystem with ext4 and mount the volume to the <code>/mnt</code> partition:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ mkfs.ext4 /dev/vg1/vol1
</span><span class='line'>$ mount /dev/vg1/vol1 /mnt
</span><span class='line'>$ echo '/dev/mapper/vg1-vol1 /mnt ext4 defaults,nofail 0 0' &gt;&gt; /etc/fstab</span></code></pre></td></tr></table></div></figure>


<h2>Other useful commands:</h2>

<p>To list Physical Volume Info:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ pvs
</span><span class='line'>PV         VG   Fmt  Attr PSize   PFree
</span><span class='line'>/dev/vdb   vg1  lvm2 a--  139.70g    0
</span></code></pre></td></tr></table></div></figure>


<p>To list Volume Group Info:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vgs
</span><span class='line'>VG   #PV #LV #SN Attr   VSize   VFree
</span><span class='line'>vg1    1   1   0 wz--n- 139.70g    0
</span></code></pre></td></tr></table></div></figure>


<p>And viewing the logical volume size from the volume group:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vgs -o +lv_size,lv_name
</span><span class='line'>VG   #PV #LV #SN Attr   VSize   VFree LSize   LV
</span><span class='line'>vg1    1   1   0 wz--n- 139.70g    0  139.70g vol1</span></code></pre></td></tr></table></div></figure>


<p>Information about Logical Volumes:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ lvs
</span><span class='line'>LV   VG   Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
</span><span class='line'>vol1 vg1  -wi-ao---- 139.70g</span></code></pre></td></tr></table></div></figure>


<h2>Resources:</h2>

<ul>
<li><a href="https://www.thegeekdiary.com/redhat-centos-a-beginners-guide-to-lvm-logical-volume-manager/">1</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2018/03/29/setup-payara-application-server-on-ubuntu-16-dot-04/">Setup Payara Application Server on Ubuntu 16.04</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2018-03-29T19:57:40-04:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>29</span><span class='date-suffix'>th</span>, <span class='date-year'>2018</span></span> <span class='time'>7:57 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="https://i.snag.gy/CJMlTj.jpg" alt="" /></p>

<p>Today we will setup Payara 5 on Ubuntu 16.04</p>

<h2>About:</h2>

<p>Payara is an Open Source Java Application Server.</p>

<h2>Pre-Requirements:</h2>

<p>Update and Install Java 8:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>apt update <span class="o">&amp;&amp;</span> apt upgrade -y
</span><span class='line'><span class="nv">$ </span>apt-get install wget curl unzip software-properties-common python-software-properties -y
</span><span class='line'><span class="nv">$ </span>add-apt-repository ppa:webupd8team/java
</span><span class='line'><span class="nv">$ </span>apt-get update
</span><span class='line'><span class="nv">$ </span>apt-get install oracle-java8-installer -y
</span><span class='line'><span class="nv">$ </span><span class="nb">source</span> /etc/profile.d/jdk.sh
</span></code></pre></td></tr></table></div></figure>


<h2>Install Payara:</h2>

<p>Download and Install Payara 5:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span><span class="nb">cd</span> /usr/local
</span><span class='line'><span class="nv">$ </span>wget --content-disposition <span class="s1">&#39;https://info.payara.fish/cs/c/?cta_guid=b9609f35-f630-492f-b3c0-238fc55f489b&amp;placement_guid=7cca6202-06a3-4c29-aee0-ca58af60528a&amp;portal_id=334594&amp;redirect_url=APefjpGt1aFvHUflpzz7Lec8jDz7CbeIIHZmgORmDSpteTCT2XjiMvjEzeY8yte3kiHi7Ph9mWDB7qUDEr96P0JS8Ev2ZFqahif2huSBfQV6lt4S6YUQpzPMrpHgf_n4VPV62NjKe8vLZBLnYkUALyR2mkrU3vWe7ME9XjHJqYPsHtxkHn-W7bYPFgY2LjEzKIYrdUsCviMgGrUh_LIbLxCESBa0N90vzaWKjK5EwZT021VaPP0jgfgvt0gF2UdtBQGcsTHrAlrb&amp;hsutk=c279766888b67917a591ec4e209cb29a&amp;canon=https%3A%2F%2Fwww.payara.fish%2Fall_downloads&amp;click=5bad781c-f4f5-422d-ba2b-5e0c2bff7098&amp;utm_referrer=https%3A%2F%2Fwww.google.co.za%2F&amp;__hstc=229474563.c279766888b67917a591ec4e209cb29a.1519832301251.1521408251653.1521485598794.4&amp;__hssc=229474563.7.1521485598794&amp;__hsfp=2442083907&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$ </span>unzip payara-5.181.zip
</span><span class='line'><span class="nv">$ </span>mv payara5 payara
</span><span class='line'><span class="nv">$ </span>rm -rf payara-5.181.zip
</span></code></pre></td></tr></table></div></figure>


<h2>Permissions:</h2>

<p>Create the Payara user and Grant Permissions:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span><span class="nb">echo</span> <span class="s1">&#39;export PATH=/usr/local/payara/glassfish/bin:$PATH&#39;</span> &gt; /etc/profile.d/payara.sh
</span><span class='line'><span class="nv">$ </span>addgroup --system payara
</span><span class='line'><span class="nv">$ </span>adduser --system --shell /bin/bash --ingroup payara payara
</span><span class='line'><span class="nv">$ </span><span class="nb">echo</span> <span class="s1">&#39;payara soft nofile 32768&#39;</span> &gt;&gt; /etc/security/limits.conf
</span><span class='line'><span class="nv">$ </span><span class="nb">echo</span> <span class="s1">&#39;payara hard nofile 65536&#39;</span> &gt;&gt; /etc/security/limits.conf
</span><span class='line'><span class="nv">$ </span>chown -R payara:payara /usr/local/payara
</span></code></pre></td></tr></table></div></figure>


<h2>Setup the Payara Domain:</h2>

<p>Switch to the Payara user, delete the default domain and start the production domain. It is useful to configure the JVM Options under the domains config directory according to your servers resources.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>su - payara
</span><span class='line'>
</span><span class='line'><span class="nv">$ </span>asadmin delete-domain domain1
</span><span class='line'><span class="nv">$ </span>asadmin change-admin-password --domain_name production <span class="c"># default blank pass for admin</span>
</span><span class='line'><span class="nv">$ </span>asadmin --port <span class="m">4848</span> <span class="nb">enable</span>-secure-admin production
</span><span class='line'>
</span><span class='line'><span class="nv">$ </span>asadmin start-domain production
</span><span class='line'><span class="nv">$ </span>asadmin stop-domain production
</span><span class='line'>
</span><span class='line'><span class="nv">$ </span><span class="nb">exit</span>
</span></code></pre></td></tr></table></div></figure>


<h2>SystemD Unit File:</h2>

<p>Create the SystemD Unit File to be able to manage the state of the Payara Server via SystemD:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>cat &gt; /etc/systemd/system/payara.service <span class="s">&lt;&lt; EOF</span>
</span><span class='line'><span class="s">[Unit]</span>
</span><span class='line'><span class="s">Description=Payara Server</span>
</span><span class='line'><span class="s">After=network.target remote-fs.target</span>
</span><span class='line'><span class="s"> </span>
</span><span class='line'><span class="s">[Service]</span>
</span><span class='line'><span class="s">User=payara</span>
</span><span class='line'><span class="s">WorkingDirectory=/usr/local/payara/glassfish</span>
</span><span class='line'><span class="s">Environment=PATH=/usr/local/payara/glassfish/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/lib/jvm/java-8-oracle/bin:/usr/lib/jvm/java-8-oracle/db/bin:/usr/lib/jvm/java-8-oracle/jre/bin</span>
</span><span class='line'><span class="s">Type=oneshot</span>
</span><span class='line'><span class="s">RemainAfterExit=yes</span>
</span><span class='line'><span class="s">ExecStart=/usr/local/payara/glassfish/bin/asadmin start-domain production</span>
</span><span class='line'><span class="s">ExecReload=/usr/local/payara/glassfish/bin/asadmin restart-domain production</span>
</span><span class='line'><span class="s">ExecStop=/usr/local/payara/glassfish/bin/asadmin stop-domain production</span>
</span><span class='line'><span class="s">TimeoutStartSec=300</span>
</span><span class='line'><span class="s">TimeoutStopSec=30</span>
</span><span class='line'><span class="s"> </span>
</span><span class='line'><span class="s">[Install]</span>
</span><span class='line'><span class="s">WantedBy = multi-user.target</span>
</span><span class='line'><span class="s">EOF</span>
</span></code></pre></td></tr></table></div></figure>


<p>Reload the systemd daemon:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>systemctl daemon-reload
</span></code></pre></td></tr></table></div></figure>


<p>Start the Payara Service:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>systemctl <span class="nb">enable </span>payara
</span><span class='line'><span class="nv">$ </span>systemctl start payara
</span></code></pre></td></tr></table></div></figure>


<p>Verify that port 4848, 8080 and 8181 is running:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>netstat -tulpn <span class="p">|</span> grep java
</span><span class='line'>tcp        <span class="m">0</span>      <span class="m">0</span> :::8080                     :::*                        LISTEN      24542/java
</span><span class='line'>tcp        <span class="m">0</span>      <span class="m">0</span> :::4848                     :::*                        LISTEN      24542/java
</span><span class='line'>tcp        <span class="m">0</span>      <span class="m">0</span> :::8181                     :::*                        LISTEN      24542/java
</span><span class='line'>...
</span></code></pre></td></tr></table></div></figure>


<h2>Access Payara Admin UI:</h2>

<p>Access the Payara DAS via <code>https://ip-of-payara-server:4848</code></p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/22">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/20">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Subscribe</h1>
  <!-- Begin MailChimp Signup Form -->
  <div id="mc_embed_signup">
  <form action="https://sysadmins.us15.list-manage.com/subscribe/post?u=3dfcff447b6ee598231eeb658&amp;id=3542f323a9" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
      <div class="indicates-required"><span class="asterisk"></span></div>
      <div class="mc-field-group">
	<label for="mce-EMAIL">Email Address:  <span class="asterisk"></span>
        </label>
	<input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL">
        </div>
	<div id="mce-responses" class="clear">
	  <div class="response" id="mce-error-response" style="display:none"></div>
	  <div class="response" id="mce-success-response" style="display:none"></div>
	</div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
      <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_3dfcff447b6ee598231eeb658_3542f323a9" tabindex="-1" value=""></div>
    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
    </div>
  </form>
</div>
<!--End mc_embed_signup-->
</section>

<section>
  <h1>Slack</h1>
  Join me on <a href="http://linux-hackers.slack.com">Slack</a>
</section>

<section>
  <h1>Twitter</h1>
  Follow me on Twitter: <a href="https://twitter.com/ruanbekker">@ruanbekker</a>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2020/10/26/easy-ad-hoc-vpns-with-sshuttle/">Easy Ad-Hoc VPNs With Sshuttle</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/10/26/use-a-ssh-jump-host-with-ansible/">Use a SSH Jump Host With Ansible</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/10/23/basic-ping-role-with-ansible-in-a-playbook/">Basic Ping Role With Ansible in a Playbook</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/10/08/using-the-libvirt-provisioner-with-terraform-for-kvm/">Using the Libvirt Provisioner With Terraform for KVM</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/10/07/setup-a-kvm-host-for-virtualization-on-oneprovider/">Setup a KVM Host for Virtualization on OneProvider</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Store</h1>
  <ul id=""></ul>
  <p></p>
  <strong>Check out my Store</strong>: Have a look at my latest cheatsheets in PDF format.
  <p></p>
  <a href="https://ruan.dev/store/elasticsearch-cheatsheet/?source=blog.ruanbekker.com"><img src="https://user-images.githubusercontent.com/567298/97010485-c2334a00-1545-11eb-9e1d-2333e5148da1.png" width="290" height="900"></a>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2020 - Ruan -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>



  <li>
    <a href="https://twitter.com/ruanbekker">
      <i class="fa fa-twitter"></i> Twitter
    </a>
  </li>



  <li>
    <a href="https://github.com/ruanbekker">
      <i class="fa fa-github"></i> GitHub
    </a>
  </li>



  <li>
    <a href="https://sysadmins.co.za">
      <i class="fa fa-bars"></i> My HowTo Blog
    </a>
  </li>


</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'blog-ruanbekker';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





      <script data-ad-client="ca-pub-1100086574264181" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <!-- old
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-1543437721119411",
        enable_page_level_ads: true
      });
    </script>
    -->


</body>
</html>
