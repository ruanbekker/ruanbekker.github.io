
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Ruan Bekker's Blog</title>
  <meta name="author" content="Ruan">

  
  <meta name="description" content="While testing DynamoDB for a specific use case I picked up at times where a GetItem will incur about 150ms in RequestLatency on the Max Statistic. &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">


  <!-- font awesome --!>
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

  
  <link rel="canonical" href="http://blog.ruanbekker.com/posts/5/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Ruan Bekker's Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-105336110-1']);
    _gaq.push(['_setDomainName','ruanbekker.com']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Ruan Bekker's Blog</a></h1>
  
    <h2>From a Curious mind to Posts on Github</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://blog.ruanbekker.com/search/" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="blog.ruanbekker.com">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/blog/categories/aws/">AWS</a></li>
  <li><a href="/blog/categories/docker/">Docker</a></li>
  <li><a href="/blog/categories/devops/">DevOps</a></li>
  <li><a href="/blog/categories/python/">Python</a></li>
  <li><a target="_blank" href="https://sysadmins.co.za">My Sysadmins Blog</a></li>
  <li><a href="/awesome-links/">Awesome Links</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2018/09/05/investigating-high-request-latencies-on-amazon-dynamodb/">Investigating High Request Latencies on Amazon DynamoDB</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2018-09-05T18:03:09-04:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>5</span><span class='date-suffix'>th</span>, <span class='date-year'>2018</span></span> <span class='time'>6:03 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>While testing DynamoDB for a specific use case I picked up at times where a GetItem will incur about 150ms in RequestLatency on the Max Statistic. This made me want to understand the behavior that I&rsquo;m observing.</p>

<p>I will go through my steps drilling down on pointers where latency can be reduced.</p>

<script id="mNCC" language="javascript">
    medianet_width = "728";
    medianet_height = "90";
    medianet_crid = "218284798";
    medianet_versionId = "3111299"; 
  </script>


<script src="//contextual.media.net/nmedianet.js?cid=8CUD78FSV"></script>


<h2>DynamoDB Performance Testing Overview</h2>

<p>Tests:</p>

<ul>
<li>Create 2 Tables with 10 WCU / 10 RCU, one encrypted, one non-encrypted</li>
<li>Seed both tables with 10 items, 18KB per item</li>
<li>Do 4 tests:

<ul>
<li>Encrypted: Consistent Reads</li>
<li>Encrypted: Eventual Consistent Reads</li>
<li>Non-Encrypted: Consistent Reads</li>
<li>Non-Encrypted: Eventual Consistent Reads</li>
</ul>
</li>
</ul>


<h2>Seed the Table(s):</h2>

<p>Seed the Table with 10 items, 18KB per item:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>from boto3 import Session as boto3_session
</span><span class='line'>from time import sleep, strftime
</span><span class='line'>from random import sample
</span><span class='line'>
</span><span class='line'># session ids that will be fetched in a random.choice order
</span><span class='line'>session_ids = [
</span><span class='line'>    '77c81e29-c86a-411e-a5b3-9a8fb3b2595f',
</span><span class='line'>    'b9a2b8ee-17ab-423c-8dbc-91020cd66097',
</span><span class='line'>    'cbe01734-c506-4998-8727-45f1aa0de7e3',
</span><span class='line'>    'e789f69b-420b-4e6d-9095-cd4482820454',
</span><span class='line'>    'c808a4e6-311e-48d2-b3fd-e9b0602a16ac',
</span><span class='line'>    '2ddf0416-6206-4c95-b6e5-d88b5325a7b1',
</span><span class='line'>    'e8157439-95f4-49a9-91e3-d1afc60a812f',
</span><span class='line'>    'f032115b-b04f-423c-9dfe-e004445b771b',
</span><span class='line'>    'dd6904c5-b65b-4da4-b0b2-f9e1c5895086',
</span><span class='line'>    '075e59be-9114-447b-8187-a0acf1b2f127'
</span><span class='line'>]
</span><span class='line'>
</span><span class='line'>generated_string = 'DHUijK8WK03hU0OF3UusjI0hhNd0hLRg03Vh430hJdUh9JsFi2hwO0s00FwO3wwI90Ju28UH94UUHU90fj9S99IfhVu89fU3o0OF04D8ljKNLsK83HJsLK8hUfsffURuuJfgR984h98jjF3sjsL0I3W0g039FJ8I0gh0IPI0Wisd8hhUg3308W3iVOJ34uO9OfhFJ900uL30oFu9JkwjfFUR4008OFkiO8H49DD4ONkKu0hUuiL0hR3NLNjh9uu0J0h09hH33gKf9980JhVL9483Ngh0h0fII4IOUOhHuIWodJlF90wuuK8uF84J4uRL00i30IO0d8g0UhIHo0I90D8U0Jwh0u08f9R9r9j00ujsOKJ3HU0hI90hrR8Sjs9jwhj0WFWrfo9g3j09IUu0ufjU83uHWK89i3r4Of8N00KN04O3I9DF09hfUOSdjHhs8I30hPkV0iRUhk9UN0J9983i9UIWioNFSUSWP0903U04RS84f0UI80j3U9I0wUFd90u9JJ9kJk9Hff43ul99hhhU0wdwIHusuh0HoV9Jh4I3U3hj4KH40NLH8L008N9FU8hjsWUjwUIO9N8FUs9fhkfV8NjF8g0OKU9UuS8I44009J8UJu99NVDhjH9S9wDO00fKh3uJgu3JosJD899jPR4L8839Duj9J0SjjLI90Uhhhh4hIsN8uIrjhJjIoi80084wf9KH0LiuNwPhOFOFhIO0o80UF0s308shwIj9iOJhkRUOI3J8fPUJhfN8uJhj8LU0804Ji803OwOHWgU90NU8N3hFF0fJ8008hh98jU9JJ0OFwfJ92JR909909Uh8sFf9P9lUgIH9IOI93rsIJlHKNH0hf099h9Nl98IskhV0hIN8oUo0JhfDs4JlhFl0I99jRhO80J9JoPjN008F03H94U9PHrPuOsPV0FIogD40Js94LIw3JwRP8S3LFk09uj8WFWUJ0iRJjhLh9UoOIjP403kji9hsswRfwNh940jwHwKLIsRL8suouIl9IiH99h0j04h0H989O0uLKhJSjN0D39jffOO88K8hKu8R3V9VRU3Hug09WF0ssJhofU4fW8Fj08KKs2IjVI0i3NjfD0uPFLsO2IIFJdH90KJNR8uR0h90H3J9UFR0890OJI88jfs4Kgf99w800JUHIlh9rs98k3u8249ghju9UFuO8Iks0OOfKO00w94KL980Fw88UiO9IfFh903OIF8dIO3IN99hJh4ufFO3hNUS2i9P9rKlIVl00WH3I3hKP9Rs0u09HNhNHUVhd98IL9fhu0DUhgH0OrJIPsJ0d8fIj9uJOF090R9O8JokI00U9jOLH9h8Us9ifiIhw00g4HKiK09oK8Ij09IUh9US3h8F9FhN39Kd09r99R0dI30huhfR0jL0Hs8u898ji8WjNORuiJKf39kJ099V99h300gJFwl0gUs0j0h0I0wI4Uh9o0l0hNIKjNO02JIj0jJj90iIR0uLhJH09L9H9h4SVsF89hiJV8hh8fhu394uIshIkLH8JKI9JFhsiOJ4s9gk0hu9kfOh8HP9jo4hN0k8JfogI48hr0FwfRjU0SijwNh8VF9J9jUk80J92H93F8h0S29j392RiSuNoh9i00HhFL8I9jN08OHhj0IIh0RKIJ8N0j03uHd0fDUhJ090033FH9luhjugfRhUL8JwH0if8f0hH9h8hfOjiVL8giJSsWgkh9UhOwhjOLhiUL8IjF3JsUJ3HFDh9KKF9Fuh8FDju3uwNFJhPH29shJjjJUOr0f9P94Ff8NIDHOR09WKhUI9hUURhN8FwJP990of9dVsH8W8h889j9g800I8wJjKPR9fu04uINkujF94f9w0O939f0I0ORL94f00O0ujDrIUI0D8rUK9fu4I9lFwogio9WLj0flf8SV0w8F0OUJNVhjWO0KI2RIjh49h3I9NUiIhHUsgDkhhhsJJj9iH8KjI0h0fkUfUsIujOVrLjUi8098Rjih943380D9wss9Kugdh3SH400N888h0j9IPg0Fu8joJ9Lf4U2oJJN833JJ8Fu94kfwR3Oh0iuIH2SFFIh3J93Jj03J39hKI9D8Ouhh0ih8IJsI000I8NRhkI80hkfgjJN0N9hhr09wULF3is0uJ9jV0POIdIO0gu808KH3FF8O2P39r9003dPOIJ9iK3lNI30h0wJN0II4803KNjf9uW9490j080I009H0R9uJ33ggVhlk9j0Hs09uIfdJ009oU9hiiRLi0s8fhFN83d303hhF0N9l0h9F3SF9998gddu0iK9RuiS4ow8Ssg9hi0JNKffOj33Iuh98IHO8sjNRusK0ushWN0JsKO43fd98F490NJg0iU8hhUUFPOJNjg4HO3hh00P0ihUI9wgw9JO0hr0NhOr0wF890U8FK44hhOVN89Kh99IFS90UOI0UIJ8UwjKj9i48jj0sU00ho39RrUIfIuOK8h0O0h0RP8dJ0SOI9sON9l0wl9jo38LOFIURuk0KJiu9L9uI9J3LfdhODujHoW0DIOD3RLUI8Ih0VIFhu80LOO9FJ0hJI89jhfF00HIJuh9gKR8UNfhV8wiI0sIN40iN0fOKIRukDO48JRIIFO0g3IR9fHFhi4uFIN9393JH89g0OVhi8lONuJ8UkW0K098J8INUh9uOjKuJu88gjsWDFJjOLf0OFww93FjiJSH90F0ujPOhwO2oPUNUOkj0uH9j409jh3hJhf0rV8JfwI3PhIIOukffuhDhU2ujh80IJLU0IIuU0wF3g8iu9ik09jF09fhO90449H8uIFLOjFR9RiI84f88oug4jJ3gIhHfKHi2S0u9JFUNS0U4OsOlUIdI3JrikU80h93iRL8fu3ffuIH0U8ulo29Owh39us9I9900DjJwg90rR8JhHhw4ODuRrL8Lgg34jsN00OJhRuJJJuHjSFS0Nh8hjIfsi90494i0Low0u3w83D4j0RRuNI8JL2hKNRIRJ0dNhL83uwL9hfFIdFJO0wJF90OIP0O2Ig94Ww8NKH09w9DO3090OJ89DOo0h0L8s0f888fUdhfPWr090oI3UwNjNKfNUUW3hHifDS4Ji9IHK000hh88u09OufIKI3l0098hO0030O0I8W980lRI0J94JW9j9lRJOh4uNiJP0fhUf9h02uFoFjIOU88i4hj48W99fUjko0L8FSJ8fjf99I2oi4J0d0jPjJj9Lo8fjh0K8u9JsU3f8FUh8F3k8HFU900wU8U9Rhwfsw0U90oF84008Uf98wfRJ003w2uUhhlW0L0Vh9H9OuoIUj08L898KU9388UUh0093g3fFJU8kF3j0WFoFhL90N9KI9838IKfr9djgK08ghVFW098N89hJJ0JU3fhh0jU0F83dhgV8lVLh020L3L2VWOD3ldL080hh8JiuhUjFN9uIjwIFk2FhP8K99Joi9s093034hU3r4r0FO0j3IIK903ff08kU988ohru4whO4uRh8Iuj9oIuhFJIJwhugLF8KW0j9hwsKf3wH0J83RjN3LhKINJK9DSUFJNU083sF03KfRhI830lj9h90i4FiJW9NRhi0suh990jJOR9woIUU99HK29R8H0J9VJh9LRf40Fshukj990IFgf902uiH009FKFJKNOU0o4fI9WhVV0ulVh3ROfiHf9FJLwI30d2ii0OOWhDwR00NN2juf8U90IPWfJ0JOFh00wsh8gg99l083lNJNuF039JFssPh09DO0O2UV9FO0guK0oLKrjklj909u880gN9iWDKl40uOhu8o0r9hwIoKN0rOk0h3S3SUhuw0F0Hrh9fIjVFjVVUNJ8VjkhU0Us0f009U8URhj4Iw89O9sod39NFhw9hHUUhfd3uR0hfhhhP9f00JVLI3O90JjORH0FFs2J8if288jd0h8hFf0j89KRNh9kN080lhURiJ0jFPjW498LuhJh9OgK0wNJ803f9hfV0O989Jhk8wf0UrKFuU9hf9LF0DdOuHI4I800j4wD0w899jF9kJ8f0u0P4iPWf8u8I9hF9Is8gHJ9hIDfI00Jd99OKsIO30UdI88800N993JsJF089OswgFiwhu9sj880l9RkwHJw0K9ULLw80h080J49o00U0Osks89N2lwIL08u0kOg800h9NWHjjgF8Lj3kKlOfRh9h0L990N8lSfLu92hjhR9hkIf093sl9uJf0s9I0IPF3Sh9IK08U9dO3S80dJI94LlsVJ0hNVuh8R909h3I8fuh408R3o89h0uW9J0sHw0RF8iD0I9OU2hH9fPS9fjPP4fUgPhi0J9jJOOu8h9Du0L0998U98UsRs99jsID408URP09jk9fiJLiiL89IhV9Ks94U2fULHr00D809JjVi94u4FI2N0INhJHu903988U98hUsRg08F08UjfJF0Uk0fhHI89oRhl9N0ufoO3Is9hhju3rIgRJ0OkPFLOh9i0JfJhOhhuuNIhI8003uL9ljH39L9h2L4SJ0Hi8uKh398K9gh9H0SI9WJK98hUjj09J00DL9URNJNihI39H0sKu00fj880HIUwFI44iNL9UshH99jwI8lH39H9NWRO9LUURK8uoS80J893lr8P399OJjJ24wV409IjN9u0I4s8IJfhfh49udF9hlj00uIsUhfNdFIkK9h999UJi8Hh0lKL04hh308UVl0J4O9g48fHh4Of909Il09higwR9I9WUR28V8OIk9K088hiih204I9o9K89dIijL000HN0RKrS94IOwWdSW8s0wiJ0JlRjVIId988Wu93Kk3u0fw8930808HsisF3LUPdNrL9LP9IJPOL083Id8wJ9h0oHJUoW0JJ38f8u3ws43JRr9Oj9OKf8oJ0ohiF898UjDuLhj0LW9U8hN2j0I2iJO038u49Phs9RUj883HOfWIO480wRUh000fj0HNh4VL9Jjh0W2FJdJJfJOR099g3gk0oI0R0Og9jU0jgiOOfOIjdULJIfI94HN9gJo0I9909O83UOJS0rJ8J0L09d9og8w090DUhfKhPshRKIIIf90Vf8Sf8I0K40us8LFj88W0Fh23922O80JNsJoKwLSwhKhW4Ir8Pi8JNhi9KUIifs88UN3j0HiH0L9NjDPsIL00s8jJh9890dUWNj9NsIhh9J9o8g00dk4s8hJH8IjhFg348W9uOgO9h9RlhHFi0WJhwdiPfKgJuuuh0hOi3Jd8hF008hjJ9j90WJhhiUWJhuOjDwHPsUw4L8wUKU0Sh8wh9h02h8KiU09j800PNu08dhlSuIN0oi9uJD38w9IR0hhdLHhJo2wJWI0RhHIhi0J4dFi3ugV0F498hhLsI0Ui0Od8jKSRghU2wP9H99J30Wj0hj8IJF8hU09FSrF0FWrjhf0Luo0I9j8V3JfuKR880j0Ofi9Su8uUj98hIuOJid3h0FwJJFhoUI909SWjoF9I90H90LowN00sU929JsjFdij0gh0NrJHHhRs9hh880FIL93h9J0038PoIh83N00J8PjUJf0899Fhi309l98IJiSISPRFL0HK8ji0k0LUjwgJ00hu48FoIPW0hHu0HDJjK40uhUOLIU8H8hN9IUf2gSNU8NNOlg8LwOw0uRjJHhSPO8NFf84Hh893hD932LV90300FUuJKh8F08uOhwK3LI9V00hI9hlRs8WL8J9IhJrDNWwHVKifUh0fNLU8h99Rhh3hs9whgJh2Jf8UhIuJLksodj0UlIuJwJ904jDjW9s0i9S90i8NK03i299w3dw3fFjHI0ssN4009KiUSKNf9hNUhKDi80i9OL0fKK8hIJgJO2ULJOgfN8h0iIIhwJJ0uf99uKIO9j80f9RuRIHIoU3PhIW3K40Jud8h902w03h09UhIO3OwJIIgHujf488HgFOhdhiis8OLf0kIJJWHJojV4Rh08ODOO8FLg9fUf98jJJ9484L8hji9J3f9ROWFiO409hP00090WU9ww9Ih3H4KDjHF8UuwWOOw00OOig3IIJfI0k0Oi098UifRPJJ4D99us9FDIgRijI9UfR84wU0F9V0hIhI8rs9KrRh0jRF9uUw8K4HhSh8UIUPsWJ0of8SsVuL900H8o0g884ukJLOfu00hl080RuhUOu83OPKH909DDf8iuurLL94h9989lOJhr8JUJL0hhjIshf09U090IFUj0880f0UJP83ojNS08880dw32040sifJl39r82w8P9h40r8OUO0WhIFljwh8KuNJf94KhI8800u9j0j40jhiRN0f9493h8hIJ9D8RhOKVHUj99ONIHROFihIRwHUhi0F9903Nf0fN0O4ROo3udf8i3hIi0F9UI8L88993hwI0UI9i8i9f89IIdhR8ffF9hIh93hhjFf8DKD0UI0j9LPIu8Nr04008990jflO3ldsFo0skhK0JjVOw8O8409sFuFJf08h0KIujrJ928i2RNHfjO88008089HON2dJu9N90hfFh9hK9UP0h088hO8f09S8Uhjo0U8g88JgFI8VIJ0UJi00F3guP9L9l8uVH0V4iih8k0fJ8OKjIO9F3JjR9ro0h9Iij09irVj0If8jU9HIuS89khJ9RUUjrh9oF8L0oNu9094FN8kh08O88jh8sFIf4I4F8FKliVh0DN09FhJuhwiu9uU9Fi8HNhjff9h80F9VK0h00NLjWdj9RJ8hJ80rKhU8Jf08ur00l888u4JOHKPOui98hUJ8PhNOh0990iu9K03IIOHROPUJwS00wuO8iuIOU90D49hS88Ld39KiNI48SRw09j9FV4u0wi0Wfj4shR3HolP9f0Jlu0IRNi8Dr308f8jhudhh49hF0II38RR80rRh9hUuh0K9IuW0jOHNkIhs88fHgu00su8Jf4UHIj9I400F09fUJo3r3SNJ038JjDLhjfUN9JlUj9UVKS0J80893ugjOUhUJ9wuDsNVi9huDRhfJlVK0KR9I998ihfsWOfULOFUhOFU3H0O0I2P4rFu9D9F9gkh8Ogj80K8s938HhKJg08HJRhKPI48hu9ODUH93VD0uk9FH0V04h89jig0fOIHOjhh0d4FIh9UIUH9UfUhi98Kl9UugwUs4JuOI402IL3VJWgO0hf00g9sHH329KsSuJr902O0Phh9S0U0j0RiKhfLhs038LNOR8sh0k8lhRj0h4FN39oJ8NWlhsWJ00hf090Ihj9RNuI0J0o9uKO89h040KjJS9osjs9KJIuKr0wi3UuD2U9r990Dih99j09fj9k9jl3Su0JfkJi3JJhJh9KOUhi0WVSlUiKJSju0fLFDh99OFuJi0uHj0uUKj0fOHHfu0f00LO0082K90hR04J90hOLIhd8uh9O3LJH8s89hiL9O09jL9999f3h4NhR88U0ri9R08sKKLh0U8Lw9hUHIfi0000R90hsKHJN0wUlfgFjfhHIDU0P320NFO0ihOrO9JIVUU8000rr00UriNus84hj0OgU0dF3OHJuFD8hIuL00sJ880Vf938j09J00Hj9dR8L88I0ji9WOs99FIuh980083IVsUfdIS9rO8hhLhOsL080hO8fwjOI8gF3Ff0Lhu0JJhF8fS0DwOwKs9NoNJ3P0hhO834g4NS0h98w3i9uhj9990080LfrUo808h0R0DFhFIjw3RjfgU98i894r8R9uF9f8i90g3ifjL8uIw0JWiO09O04u8Nh0iOOV8j0I0I099909VwhJJNUFKrjdh0KhJ99HuJLo3W0N8UUI4Ishj3N9jIfS9S9FJs04fIrsl9uw99fhjRo8jO09U8JwjjjROFf0Ni8u0lU0o0u9O0V0N0w9j84W94jFh09Fhh4Oi9UHF40jU0furFsIJJfI8hO9LFUoLF4j08889V3N9FhUifjuUNRu38jJHj83huNLH80whhIKsF0JFU8I0fIij9Ph0R8fhUhN2h03hu4rKV9L0wOh3fhjU0O09R0gWJu4F0hRuVsgINsDHjWuW89098f90ljHUwUON3Kwo9fWU000fFN89RJuNJKhI003F9DSNOP09hu3oIJJNg2u880J0wh0PIsPH09P843rgIhFIIOk9i04U3hIgIIuIIs8ir892HFO2djLH9899hI93I0NO0i0JljH2RgU8h3D0ui9OfHgRRW3r0J888WINhLSUh83DKN3L3099wR9HHFUIuK9394Kl0VUJh0NJUOg0JwH98Ih8duK00iuhhUhkwoJfiL0hONf9U9uI0HU8U89NPF9HIhOf02fgoNh00R9r8ff38IswL40Hi08h98h8uJuug8Sl4IhrwfOHsi9HI8Idh8I4FNo9KIL902oUfHgVl0HI9N909SgkFDhh0JgK0lgf9F9J3009du03jfRiIw0i998O8lJ0gJ0wkRjSsJwg9lI8088FrR9wFFi3jsFNh9w0OjFJ298k04Uhu9NF9DJ08h9Us8g0hsRFWO9909hUjj9w98UNONOou9028809hIPo8fDL38sJhw8V0IwUJ4w9Hk9Hj9JoiFo89ijiL90guu3J2K0KNsNUfrOPJKuh0KH098SO0PUUs0hRNLs0u3O0j3O8uIuIsI94O0hHjVfu0oilFiJSN0Jf9890ShFJr2uds0H43D88O9IP0h98IJJOPh3ru0300L009hRhLdsOVs0hH0SO0fFiDF890o8hfg4JOj4089U0RfV3f9HjdsD808VOF0O8LwfF8ruJ80i8O0P4h8RhIOh9wjK9Nf3F298N0HIdUNNr9dkO29DOw8NhoH0SR9H2kPfhR0jP9su00L9OFkOs4jIh839Fh9I9JuOwR9iJ09SIIjI09fj0390h2U9O8UkNjdjF890hkJ908808K4UoP9uFRWL02LfHw0R4ffNIPJ0909i8u9fhkJshjh98JJN00hOjhj0Fu43VI8suH8UkwhOd243UN9J00h0hKwhfFFO8P9dN09W9hRI2IIjjJf942LRhD2UOg2fDsfuOUFF2OgluuW49j09L3gUN80h2hIjs9s8UuR0hohj99hgK0LVwO9FhNH000jLhV98sINhf89HiwK8h99KL04uUIjJuh9903sJK9Kk99D00jhIIugJ4JF8W0f999I9iFD9k0N0OI9F00OL9P03gJ8wI3L3FKW0F0I98hhsdoDS08jJ3I9LR4kLFkHhLFF9s8I09j8JDRLNhUfg0UfJsKV00J9f9KLR3soP8jRodJ9gO0h00hUu3Ojf8Dh83LHN90ws00u4u8usu8S990oLj0I3O80NFRJ0h08hjOfJu3l993Nh09hU3w98h00P9HJ9hIihouh32r98Jhh9JuOok0900Uh9fo8Rh889809wUh8Ls0i98VhHu0lU90V9JghLJW8FJUJUhiujdokhPfu8OJJ82ffrhfi9Nhijw9uwUhh92uN48FKUjNg0VRjF08IOiJUr08Fr08UuIIwDKuNP0j98SuJLdfIuOUJd80D94LlRUlN9KHRihFwI0ud900h80L8lIj9RJ0DNlwflhw9hJlK9hh9N8diDhOU0osO30VRh0L00dS98LS8KfH9NhdH0888uUIWhK80O8d8hR000sJJPNHhUfsu0ish3fU2w9UF200UJOiPJr9O0KhWSjj4RIjl0jVI9030O0hjFl99uh89W04UfO89U0iu9jODho03s9809R0Ph9loh9808V9R09fUKJj0k9R0UH9J2hjLUflf9uojLRNVOuKO0FhjIL9I93h9fUfuFJihfiFNuFdJRuU0shJh003w0ugo0Hh0RI2iD4IW000gs99h08I9PFS990S4w0HKuIW8K9909sI9lHUUL9UiiN9SOjFfkoLI89gIHiHj8hIJ8OJhij9h9OJIf0IrL89djJ0SIo9339H0iFR909II09lFK9uFIU99jfsI08ffR08s8jjIHfhfPu9909HI80889OUIO804uDW034O9d803I8Fl2ssFR0wi999S9U0k9I049douUIdIPu030FN8KS9RhIuUhV90uJl8uUIHfP9Rshj08HuISF3kj0Uh89fHuhuh89jHUfOf0w0Sk23J089s8080JkWPuuR98wUhU003k0IhwDKLh99ghL4I0VRj4ijOg8fJrLJJ9iIfH82F009UHh39h0Fjj0Ijh08498k9s3swFUF94hIO409Ni08Lwi3jh88F2hs9s48Rg03u9I9sUhuIkiL8wFudUOffS9ShJN83JjJ0ih9l80UJh0ROwH9kHhPPsr0i90fIJNN0sDISw0PshOjdFujo930RSIU04u988LhJwrU0H089Sjw9083088Oho99980FLiOIUduuuj04hJN0h4hJru9J0FDO89IuWUJ0FFghIhorJVPIgJh89WuV8iOIIhwj00U9w2I0Pr9IFj9S9UgLF9JHJ8H0KHj09jh8ir90hUi8J30PgFoiwhJK9j4HOVJf3fH39ho33IJPJj0i94L9j8NJOiD4w2R3i9LFLN9RO4u88f0s9O0LjO0Jl9Pol0Uih8wDijkJHHhN308dw99h9U3H38IK0LO0L8iFOFI0394i0hw9ruF0989h0090w8j9Fu0h9hSVUVH8hw33900UJJI0fhJFKi49u9so09NuFI0fIwDs0uJ8j0hu0ODUhhURKuFLjUN8D49j0rWsh0DkSjfuU90kJsjV90dO9Jf3K8gwF34JOj8hiF0HJ0hU0II0092hjUI40IJIK9I8UPIoI80sLUHRif4jJ0JI9SIhiHjV8hFFsfUIjOJL3jUI04rd04JS0O9FJI8hfFIJj09kSui9w843l88h398OfJKFwoj0JlhO8iii93hhk8KU0VifUhh8KKIOhUINiURHHFOS9RKk8K0f00i8h9NOJk0kjJF00V09hwuI4JKR2R80s0K0Lf809huu9o9UNh0oshh9hP9hJOI9K0NI004jww9D3uu9wrfwuijfJU0urN038sh49JOwOi90IIUlhfSJU3i099h0R3IsjU3OuKKH9IhI0ufKhJ98HFFh00hI999JRIFwO998hDif9KUU0RfIRjwu0L8IJIJj8i009H90Iw9wsjjdOsohFO0FIJi49943KoRJ9W9rO0uUlguwH4jLFJH9kuk8sL43PjF8989K8wdWHs0U0Idwh09N0h2IFhJR0ud0D90r8jOj9OFf92UDkLH4IK88ho2iw0hkwjN89IHPiFUNRjfHhJ0NRH998h90Rf3hjwWu9jr08U92i30FfNUPk8iJfj9L9K0990O4UhfIjFJgV989LgH8V989sDd8i9u00jU0hhUIDuI8h8U9fd3hUhI9J9kFw800RkLu39OO9F30uhWF8IfhUFLR99ohrhh8h9OwUi9V3ih90L0JKDVJhOR89Ju0KhduUgNII9RN98h0OF0HfhuI9I3KI0k9WI4K8OsV9IhhIFDjhPK0u099hJKuLu84K8hfR0FOUNl0W4I93I9l9VNfDJulj90JUjJ9JL9hR9LI2JVVK9H99hJF89R0kuj3u9090iIF99NIfh0F4UFiwkFHU0S0h80OFioPJ3Ks04HhO9hjsh0oNPuR8LUU08gHu8K20PR9u0Ihj8F9fL3J98L9Jh8320SUI39889uLu8iF0sfIH0i0098l0i9u39IP3020h0FHFO8LIji38oL228842hR4shOU8duu9jdKOIUJ4i09Ohh04uH0sUjI0JH90S8S00w4JDLh0o04O9I30w0k0jj0k00sIh90kId88U0iHlkO80sj9I08LN9Jgj83R4J0h00P9wJ9Ri90fOih9h4kufiiRhFL38Dwh3sO090KOJ802RIhhUh00VK9f8f2Dl00fiF9KPRwwr9hK988KL0Ff98J9Nuu8Nrihf9LFOKu0jLj09JdhsSKHr0URofjUJUKw0JNiJ0ROiJJO9839O4WFhfhoDfIU0j0Ndui008939fIV2SN00J00FJV80VF20LwJNd38jUD0I00hL8F0jf9Ils84KswFUHO0998hu409Jd0Ljjl00Ok8O08jO3hUHKPi89I3J9989998jsrfLu8IhJ0N98hR909OO9UIW3PfU8fK9hhIssI90IINRHhOUh0iJ8j9isJJf0hh89HLfWiNj9h3W3s3urU3oi39hshw08fSL0ih839L4h22oPjUkUl9F03h900FhjViV8u8IH0R9F9kI8iJO9Okw9W0k8329r8JjOh0fKOjOjIU8sKL88h8urjIgrSF9O9hI8340KfI9wJkH0uFhdO9O0u9OU0Jr0IhR3hFJRR8uJ9hhfK98OuJJFS8sNJ90308l3gi8N9uOh9SOUfdU38FIg9393P9VwLN4lhiuFKHRUrsFNfII0oO0OJLDK09wSI3JOrUJ08hfk3UU8u9OiP2Us9P08idOFFODWOH8uikfs80O993j9uL9SNVL9J0F9hsOIuV40R80j0L9d04hh04N8gf0I9R2K3I0ws400uN98089FK8jFW2hLuOf9I999f4RUhi3L0D90JfS0lu8w0800huhSN9VFjHkIuHPFUj0hKhOgiUwSNFN0ouiI80F49h403HRUulLD02J9Wu883302UFjV39Wr9NihJ3FUN8h40K9fLJJjL989wNIH394NF8fhNjsJJfoNLr8udIj8h29UuRLHHhHJUIVJ0Ns943D8Ps8hOhjr00OVjFsj08RFkUj49099UhfKu9sHuLN0oFIhV8i99JJSfH0fs03uwwwS0f90JL0rJ39J9KWjJ9F0I0KNOjhhj4H0IKFFo8r0O0sFN0sOF4uLd9WHih8OuO0o00gffNsU39880NfI09H898U8NUW8ls0ISJ0UD00i0NL990fJuJJP9h0ghIUKIgwIIwh8I8j8FK0w003Hff00F999u98Ou9UI3JhdH9LO2V8dfJso089OHu24W3IFUihViUJOjhiwS98ijhVJIhjL0u30K98FJu0N3sh9uk0RVi23iI0Jjih8fHVl098i8hU899R99Pd8I0S8IDJSIJ8IuurfiW28833040huLj4jiI008huI00SlJ0fUhklF99Hrk2LRIKR2RfhOf8K8fK40Hh98H0wRO8O4L0UPLK4F9wO99OjNL43jf0hD9suuj9uUN9uUuUwWUj009ksUf9L00S930fUU8kR4NUdh38J0H89sf9fLr0LFgJfu0UWJRUjUUH033h0IwK8U8lR0Ul09hLOHOuwg8Rw8Ji9HgKUuHjwuRhIf0h9hKi9f0LHI8IwWNhJOOS9RhOLk9uf29U4KUIRw9JR998wRU43u0i89LifFP8L3P9h338h8Jg48FUu9diUO0PjusJiRIFkhUOV9PF9R3u0g99j9ODFiKK0jO30IROu4O9I3sjku0838W0FgFNDUJ9shu9rW8RgRi00Of9O8hg0P3j8gSK9RS0f9Ui9UshH9uJI89FofIFrjfRhIR90I0fVUh0J00I0FgufJHOdJ9ufhfk9u88IOKKOuLS9kRLfuWl0LIhRI90JJPjh00DsUhlfwUs0iJi8RFRJ9i0g999O09J09KUoJ4whh8i4u9sFu8IO8909Kfgs9j0Oj9O0k8F0Rji9u9o9Lj9j3i98iDlHjIl098IU9N0JkWUh9f0dKdfI40FjjF0Uiwu09JjjUNiFLhssJHVOsws89RS3LI0RROIUIJLwI0U44jUsrJlHjLH043j90hlLlwh0H9lLjUjL98f8L0dfJ9U2FHURH0RJ9KOw3UjF33J0LIJLH8r9h090fOROOwPHHjiiLI0sOR98K0UuUUIKJ0wh00g0JSJW0RiR898Wf8LsWUJ9Luu98Kg40fjUU00899FIJfIUh0880JUOIFWs98Uwu0iu09wFsDORgS0J0uH2I0JF099IIFKFuwdds9U88IUjsUju4hkf8N8N9R9OSuIiuOH9r9lu090jL000VI39fiF9I89f89luD0F980DSO08ihDwj9u0WN9hjSiWHUOorFL034jO8ilOK8kll4L900fRhh9h90hu9O9fuIVN8jw8shsiru9hgf99Vi08jSUW9U088w03FwRu334gO00uPu9gf0f3UlWg090jwSUVHoFO9jNKr8FH0Rsifk8J9djhO9009hIH3f483DHKJIKiHs2sU0JOj9K00hju034NjiIOhsN9sNJjuhhwOHu899lfHNKVgSKO3f8IsfgUkfjr04uh080L3HIKVfIg80H00N0huj9R9OHVRK0LIdjRULu80hU4UJ300OsUIfhUN9IUR8sF0k0fuOP8LhHhLj0W8FUUH0U0u0sh0i0lINfFIUoR3rIw8UJjwJ8Jl3RIl8938j099800WKluuJ9Nh0DI00o480R98JhH89dhFu0IILhsU3i0Jiou0UORjh9OfOHh8r9gLhsU9or3FUksI89FFO0NOwhUKKh3fi8f84RI09jFFhFjO4R0UFuIKg8D03i403Ooi30j40IJ0NU0OLN8wD00u0w3I9O02hhjjirH0j8JJIVN0f29O3HUDjuh3K0ujku0020ikhD8J3W9O9KhUh83R09gLJ9uD99DFhL90rK0FsI0h89w0JDUuflUU40wIo30F8HOgsFRhu80IJh0FdI0U3O883l0wR9IhRV4d99HhO9FhS03dH9902wwD8slV4iNfHHshJN09LIf9f9UF9D8KJ3Hfi3w9K80ffu2FJIKK3u9OiJI90hLLuj3JhiJ0fiJhIhON0foRUO8hhU03RU9LjfFujDN4UVOJ3IKHfo8r0uN9sw3Iuj8D8230VUF82NI39JJ9ofKOu9hjPo4USUOds8joUf8OI8UV0FI9F88Ndrl48f024lLJ3FfjL0KUNfIfONS8j0Rr30H8f2HIoKs8fw94fh8UljhD8Jhr08FRfihh8WVOLIU34sFk9dkN8NV4HWF2h9uhFu03sgKV0j08FiFhI0jrUFf9OJ0huRFU9o99RHhR8Nj0O08h0099Uj0J88oOjwfhUwNijw84ONhhIOsNj99hWh9jPNOK989fOI8oUK2933j38NshRIldUPh9i9S0KOs9OJh4UI400jiiflFu0hiDJ80lwgfdjWkoR9lRhh3su90IK9P0lh0IS3L900dod9ro8099J8sKhrU8UJOs8I03kgHOJIIjhr9HLDOd9999uOh0Ig0fsHk0J8F89J8whh9DJ9NOf3JJILh2kj090P00UKIIuw9P040rUJUU9JihfJHhJ4RU93F02FH9V0Jr933j94JLs9jk9I2ih9RJ4Ig9W0jjIFhhFhkU2LoKH40J8hu0809wwShSK9juI048Nh3rihw8039wFKiPI880usoj84wuL889fJI9uhOFK8l0huhju4Fh9JhLVk38KjJfu0L0h3FNKius90Ff0oji8sUffN9L9sR8RPfIiFPu93jLr889FVHWw0HuuhsdJuJ04U38u80FluILh43UikhUwgh3JKI9R9N0908hHLIJsHSUOI9h8O09ikFIwsKDufW4OIhJ0JNNwj89fIihwO09f3h9U30FK8WHJw9R8fr9IIf0iFN890IU8gh8UNo88u0LI2UHN0U0fUf00V88wiKIFi0U9343WdI0388g02hFI0hwJfHfwsrOHHFIh9sUhhrNK9hjhl0Pj0NIhfjF9J9hihfl9H8DHJuuhIWf0HFLoUN8F3w0IRh3w8N2f03JUN3KRH99849hh34H3hIIw9iD3Hk38ksRRO0ufj3d9wjPh0h9Ui0JkOSJRKjW0FI9i29s8hFIk8SK99H8dWw89UiU0iUR0NK0uk4H9iO98L9ORhR8FPOVfFiIjU8d8VhD9w8sU20LW9NI8jWjUjhwDrhNJF8k3ihjFlU039KLJrN098i8I0UFgIJ09gO9oUNhI0l9iwIlO9UJJ43h4r0OS83uFr03hIjdiP0HJw9hU9dulKO0SFIOJKKOJJ0F98988Ifu8jo9P08S0D0OIl9JJ94Hkh900I9juouUJHNhsjjJK9SWS8FR08rUDK9hPU4OJIFhd3LURhfjufhw9I8LId9JihhV9u00J00R9ki9Dh0899ho9i90HO8rFw0UhJfu8ofoo9lOO0JN0IN0WID2i2R43LI3IfFNj09389hRU0VKLu880uog8Hh98O002sUFN9Uh99j9or8r02OS809909NWroRjKhl9f9IL8490I9kHF0f9u9JO83LJ0h8008j4S0wf9SJ99KhjF0W9DOk0goKhu90HLiJF90kUKgO99JLJ0hh90h0Dfou29kiwVI0h0uHR0H0s98Oh0H9lr9s490JHf9N4089Lih9O0Hhw20khSKKw900F3H0h3iJINU3w9WN08wRd0jRN9UWfO909J00O0ju9FIs99RJ9L300O09g99k8H9UswuWis3H094j9Nd8N8kdoh8rfKL8Io800OSiWIRrH9lR9s8Is40RFI9uF00ur8oou4flN3wd0iw0u0h0L0N9sVw0FULiui9IjI98W4kjlPjo0O0h0OK8Hi33iIju9Ruf309do8SL4dr9FIui0L3Jh88JS3F0JJg999oShNI0fouIN0r9h8HN82Fdu48sNN8449w04hIV0Ur09IJg9RhRUU9rO9080JIP048hwfJsIJ0Hs09l8hh2ff9WifR9luNi4Jj3KdfNR0F4wDuK33u8i2hh3R480H009UsiuUL4N0grf4HJsdU0LP0I0fw9O00O00kO8OIFJ3DhN9u98RH8wh9RPghOoOu9V28JiFdWhF3s0UuJd089fH289L93u8000UoIWKigVhI0g383JU9rl9N43hdJ9NkO8j0lu0hVV90LHSjUF0jj0uh0Ku808Oj20g9NF20w08u4ND0F8D8IVPshHh99932Jo9J880J0SjLwuJHDI9Ju8INRr0H9jK9OU39hsJh3ifh8hUfh0Ihh0FWoHd0OVwHh9gR800f90sf0jVh0I98lFL0OLKhRPhI08jPh40swJiU04j0F3o8JK08ND9048oU9IwOI9h9j8s90f3RPdRi0OdhsUJ3900hFi4owikK8hRUhK8Dh0JlJUILu89f8jO90jDINNW3h9g9UIFLh0IFK4PJ0808hd0l309uDsPgUuHjhlkF00F39WjL02S840Ou3KO3ihNJKoiOOlIWJ9Oo08ufs0s9jSw83L0LVwr9VK0I8wH8F9hjIOJ3V0Fik34w28IFVJwF03W988RNfF9sf0IU0H8Uwhw00F3Ihujhd0UF3I9090s809RrhdfRJNwUrOU0hfR9909ShJ3JhVsUhwJRH0jh3JF2883s80O80Oo3dhj8IJIHFWh00Ff900fWhLhHJj93J8j09J9O0S080uhK80uIN003IfK8RI00fUu8h8jF9s0N80883hH9k89O8j8IFHhSIrVILIOuwgJ0f0h0iou9H089U8290hh8i9I9o900wjsf89O0KU9w3J9020KJiJ0jVI398fJHuJJ4O4O0S9U0hkfJr9FU9f8I0Hhw990Ps4KgO3jPs8sjhF99PJuI08FIWu8fh0jPs03HjfSIK9dL0I8l0fr0N8Fh93u3F9I9skufuh80098gS008u90hiL0uUuII4Rd88JO8gLdsUKw9F9uwiljruLJ0jhiJi4j4F8U88irFjFRJUUhhFhsf0WFu0r40FLhUu9IFWhKHU0P9ji093s0Hj9HiUo00UhfO39N0jShUP900uUdj8i08g0IhIIFijN9DUH3NUHIRLiS9L3ufuU9r0i90VDoL03ODi2lu9hfNl34jFRLKk8JDw83LIh0l902h90LOf80gfK88D9I9fuJLJ9Uu09H3sN0wOhF8kh3IL8hujw9U9F8JdhP9f0j03KUNiVU8IUR8wfhwNd0RIs8J8hrJ0lh8uS0IoOH0ffjR8SUu8H2U00829J0FhRu90h8Olf889Okhr9g9030Nh00grWho93JwuFSoJ9iJRfu8D9hK2JJukURPK29NfhDIHOu28hFjJOSN4NLHgV0Hsu0W0K9jLhfHfFOi0I49u3Ps9d00Kujh8N2hNhLlJNwLwSH098hu0PIFf0j2FLs0I9sNF0HiRi8oUjFjiI8fKNWsUuJO0hIOiuKwhNNj9VOr9P2U8UuuFJ0HwKHjr90PihHWjrRh982fhLR0KFwOj092FdDNiNKhi0j8'
</span><span class='line'>
</span><span class='line'># instantiating dynamodb client
</span><span class='line'>session = boto3_session(region_name='eu-west-1', profile_name='perf')
</span><span class='line'>dynamodb = session.client('dynamodb')
</span><span class='line'>
</span><span class='line'>timestamp = strftime("%Y-%m-%dT-%H:%M")
</span><span class='line'>results = open('dynamodb-put-results_{}.txt'.format(timestamp), 'a')
</span><span class='line'>count = 0
</span><span class='line'>
</span><span class='line'>for sid in session_ids:
</span><span class='line'>    count += 1
</span><span class='line'>    gen_data = ''.join(sample(generated_string, len(generated_string)))
</span><span class='line'>    sleep(1)
</span><span class='line'>
</span><span class='line'>    response = dynamodb.put_item(
</span><span class='line'>        TableName='ddb-perf-testing',
</span><span class='line'>        Item={
</span><span class='line'>            'session_id': {'S': sid },
</span><span class='line'>            'data': {'S': gen_data },
</span><span class='line'>            'item_num': {'S': str(count) }
</span><span class='line'>        }
</span><span class='line'>    )
</span><span class='line'>
</span><span class='line'>    results.write('Call Number: {call_num} \n'.format(call_num=count))
</span><span class='line'>    results.write('Call ResponseMetadata: {metadata} \n\n'.format(metadata=response['ResponseMetadata']))
</span><span class='line'>
</span><span class='line'>results.close()</span></code></pre></td></tr></table></div></figure>


<h2>Read from the Table(s):</h2>

<ul>
<li>Read 18KB per second for 3 Hours:</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>from boto3 import Session as boto3_session
</span><span class='line'>from time import sleep, strftime
</span><span class='line'>from random import choice
</span><span class='line'>
</span><span class='line'># delay between each iteration
</span><span class='line'>iteration_delay = 1
</span><span class='line'>
</span><span class='line'># iterations number - 3 hours
</span><span class='line'>iterations = 10800
</span><span class='line'>
</span><span class='line'># session ids that will be fetched in a random.choice order
</span><span class='line'>session_ids = [
</span><span class='line'>    '77c81e29-c86a-411e-a5b3-9a8fb3b2595f',
</span><span class='line'>    'b9a2b8ee-17ab-423c-8dbc-91020cd66097',
</span><span class='line'>    'cbe01734-c506-4998-8727-45f1aa0de7e3',
</span><span class='line'>    'e789f69b-420b-4e6d-9095-cd4482820454',
</span><span class='line'>    'c808a4e6-311e-48d2-b3fd-e9b0602a16ac',
</span><span class='line'>    '2ddf0416-6206-4c95-b6e5-d88b5325a7b1',
</span><span class='line'>    'e8157439-95f4-49a9-91e3-d1afc60a812f',
</span><span class='line'>    'f032115b-b04f-423c-9dfe-e004445b771b',
</span><span class='line'>    'dd6904c5-b65b-4da4-b0b2-f9e1c5895086',
</span><span class='line'>    '075e59be-9114-447b-8187-a0acf1b2f127'
</span><span class='line'>]
</span><span class='line'>
</span><span class='line'># instantiating dynamodb client
</span><span class='line'>session = boto3_session(region_name='eu-west-1', profile_name='perf')
</span><span class='line'>dynamodb = session.client('dynamodb')
</span><span class='line'>dynamodb-table = 'ddb-perf-testing'
</span><span class='line'>
</span><span class='line'>timestamp = strftime("%Y-%m-%dT-%H:%M")
</span><span class='line'>results = open('dynamodb-results_{}.txt'.format(timestamp), 'a')
</span><span class='line'>
</span><span class='line'>for iteration in range(iterations):
</span><span class='line'>    count = iteration + 1
</span><span class='line'>    print(count)
</span><span class='line'>    sleep(iteration_delay)
</span><span class='line'>
</span><span class='line'>    response = dynamodb.get_item(
</span><span class='line'>        TableName=dynamodb-table,
</span><span class='line'>        Key={'session_id': {'S': choice(session_ids)}},
</span><span class='line'>        ConsistentRead=False
</span><span class='line'>    )
</span><span class='line'>
</span><span class='line'>    results.write('Call Number: {cur_iter}/{max_iter} \n'.format(cur_iter=count, max_iter=iterations))
</span><span class='line'>    results.write('Call Item Response =&gt; Key: {attr_id}, Key Number:{attr_num} \n'.format(attr_id=response['Item']['session_id']['S'], attr_num=response['Item']['item_num']['S']))
</span><span class='line'>    results.write('Call ResponseMetadata: {metadata} \n\n'.format(metadata=response['ResponseMetadata']))
</span><span class='line'>
</span><span class='line'>results.close()</span></code></pre></td></tr></table></div></figure>


<h2>Results</h2>

<p><img src="https://cdn.pbrd.co/images/Hp8NsH8.png" alt="" /></p>

<h2>Notes from AWS Support:</h2>

<p>Reasons for High Latencies:</p>

<ul>
<li>RequestLatency is a Server Side Metric</li>
<li>Long requests could relate to metadata lookups</li>
<li>Executing Relative Low Amount of Requests there is Frequent Metadata Lookups; This may cause a spike in latency</li>
<li>Consistent Requests can have higher average latency then Eventual Consistent Reads</li>
<li>Requests in general can encounter higher then normal latency at times, due to network issue, storage node issue, metadata issue.</li>
<li>The p90 should still be single digit</li>
<li>Using Encryption has to interact with KMS API as well (mechanisms in place to deal with KMS integration though to still offer p90 under 10 ms)</li>
<li>DAX: Strongly consistent reads will be passed on to DynamoDB and not handled by the cache</li>
<li>1 RCU reading in Eventual Consistent manner can read 8 kb</li>
<li>Consistent read costs double an eventual consistent read</li>
<li>DDB not 100% of requests will be under 10 ms</li>
</ul>


<p>Resources:
- <a href="https://aws.amazon.com/blogs/developer/tuning-the-aws-sdk-for-java-to-improve-resiliency/">https://aws.amazon.com/blogs/developer/tuning-the-aws-sdk-for-java-to-improve-resiliency/</a>
- <a href="https://aws.amazon.com/blogs/developer/enabling-metrics-with-the-aws-sdk-for-java/">https://aws.amazon.com/blogs/developer/enabling-metrics-with-the-aws-sdk-for-java/</a>
- <a href="https://en.wikipedia.org/wiki/Eventual_consistency">https://en.wikipedia.org/wiki/Eventual_consistency</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2018/09/01/give-your-database-a-break-and-use-memcached-to-return-frequently-accessed-data/">Give Your Database a Break and Use Memcached to Return Frequently Accessed Data</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2018-09-01T17:05:10-04:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>1</span><span class='date-suffix'>st</span>, <span class='date-year'>2018</span></span> <span class='time'>5:05 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="https://objects.ruanbekker.com/assets/images/memcached-logo.png" alt="" /></p>

<p>So let&rsquo;s take this scenario:</p>

<p>Your database is getting hammered with requests and building up some load over time and we would like to place a caching layer in front of our database that will return data from the caching layer, to reduce some traffic to our database and also improve our performance for our application.</p>

<h2>The Scenario:</h2>

<p>Our scenario will be very simple for this demonstration:</p>

<ul>
<li>Database will be using SQLite with product information (product_name, product_description)</li>
<li>Caching Layer will be Memcached</li>
<li>Our Client will be written in Python, which checks if the product name is in cache, if not a <code>GET_MISS</code> will be returned, then the data will be fetched from the database, returns it to the client and save it to the cache</li>
<li>Next time the item will be read, a <code>GET_HIT</code> will be received, then the item will be delivered to the client directly from the cache</li>
</ul>


<h2>SQL Database:</h2>

<p>As mentioned we will be using sqlite for demonstration.</p>

<p>Create the table, populate some very basic data:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="err">$</span> <span class="n">sqlite3</span> <span class="n">db</span><span class="p">.</span><span class="k">sql</span> <span class="o">-</span><span class="n">header</span> <span class="o">-</span><span class="k">column</span>
</span><span class='line'><span class="n">import</span> <span class="n">sqlite3</span> <span class="k">as</span> <span class="k">sql</span>
</span><span class='line'><span class="n">SQLite</span> <span class="k">version</span> <span class="mi">3</span><span class="p">.</span><span class="mi">16</span><span class="p">.</span><span class="mi">0</span> <span class="mi">2016</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">04</span> <span class="mi">19</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">39</span>
</span><span class='line'><span class="n">Enter</span> <span class="ss">&quot;.help&quot;</span> <span class="k">for</span> <span class="k">usage</span> <span class="n">hints</span><span class="p">.</span>
</span><span class='line'>
</span><span class='line'><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">create</span> <span class="k">table</span> <span class="n">products</span> <span class="p">(</span><span class="n">product_name</span> <span class="n">STRING</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span> <span class="n">product_description</span> <span class="n">STRING</span><span class="p">(</span><span class="mi">32</span><span class="p">));</span>
</span><span class='line'><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">insert</span> <span class="k">into</span> <span class="n">products</span> <span class="k">values</span><span class="p">(</span><span class="s1">&#39;apple&#39;</span><span class="p">,</span> <span class="s1">&#39;fruit called apple&#39;</span><span class="p">);</span>
</span><span class='line'><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">insert</span> <span class="k">into</span> <span class="n">products</span> <span class="k">values</span><span class="p">(</span><span class="s1">&#39;guitar&#39;</span><span class="p">,</span> <span class="s1">&#39;musical instrument&#39;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Read all the data from the table:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">products</span><span class="p">;</span>
</span><span class='line'><span class="n">product_name</span>  <span class="n">product_description</span>
</span><span class='line'><span class="c1">------------  -------------------</span>
</span><span class='line'><span class="n">apple</span>         <span class="n">fruit</span> <span class="k">called</span> <span class="n">apple</span>
</span><span class='line'><span class="n">guitar</span>        <span class="n">musical</span> <span class="n">instrument</span>
</span><span class='line'><span class="n">sqlite</span><span class="o">&gt;</span> <span class="p">.</span><span class="n">exit</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Run a Memcached Container:</h2>

<p>We will use docker to run a memcached container on our workstation:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker run -itd --name memcached -p 11211:11211 rbekker87/memcached:alpine
</span></code></pre></td></tr></table></div></figure>


<h2>Our Application Code:</h2>

<p>I will use <a href="https://pymemcache.readthedocs.io/en/latest/getting_started.html">pymemcache</a> as our client library. Install:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>virtualenv .venv <span class="o">&amp;&amp;</span> <span class="nb">source</span> .venv/bin/activate
</span><span class='line'><span class="nv">$ </span>pip install pymemcache
</span></code></pre></td></tr></table></div></figure>


<p>Our Application Code which will be in Python</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">sqlite3</span> <span class="kn">as</span> <span class="nn">sql</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">pymemcache.client</span> <span class="kn">import</span> <span class="n">base</span>
</span><span class='line'>
</span><span class='line'><span class="n">product_name</span> <span class="o">=</span> <span class="s">&#39;guitar&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">client</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">Client</span><span class="p">((</span><span class="s">&#39;localhost&#39;</span><span class="p">,</span> <span class="mi">11211</span><span class="p">))</span>
</span><span class='line'><span class="n">result</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">product_name</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">query_db</span><span class="p">(</span><span class="n">product_name</span><span class="p">):</span>
</span><span class='line'>    <span class="n">db_connection</span> <span class="o">=</span> <span class="n">sql</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;db.sql&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">c</span> <span class="o">=</span> <span class="n">db_connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</span><span class='line'>    <span class="k">try</span><span class="p">:</span>
</span><span class='line'>        <span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select product_description from products where product_name = &quot;{k}&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="n">product_name</span><span class="p">))</span>
</span><span class='line'>        <span class="n">data</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>        <span class="n">db_connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span class='line'>    <span class="k">except</span><span class="p">:</span>
</span><span class='line'>        <span class="n">data</span> <span class="o">=</span> <span class="s">&#39;invalid&#39;</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">data</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
</span><span class='line'>    <span class="k">print</span><span class="p">(</span><span class="s">&quot;got a miss, need to get the data from db&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">result</span> <span class="o">=</span> <span class="n">query_db</span><span class="p">(</span><span class="n">product_name</span><span class="p">)</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="s">&#39;invalid&#39;</span><span class="p">:</span>
</span><span class='line'>        <span class="k">print</span><span class="p">(</span><span class="s">&quot;requested data does not exist in db&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="k">else</span><span class="p">:</span>
</span><span class='line'>        <span class="k">print</span><span class="p">(</span><span class="s">&quot;returning data to client from db&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="k">print</span><span class="p">(</span><span class="s">&quot;=&gt; Product: {p}, Description: {d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">product_name</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="n">result</span><span class="p">))</span>
</span><span class='line'>        <span class="k">print</span><span class="p">(</span><span class="s">&quot;setting the data to memcache&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="n">client</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">product_name</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">else</span><span class="p">:</span>
</span><span class='line'>    <span class="k">print</span><span class="p">(</span><span class="s">&quot;got the data directly from memcache&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="k">print</span><span class="p">(</span><span class="s">&quot;=&gt; Product: {p}, Description: {d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">product_name</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="n">result</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Explanation:</p>

<ul>
<li>We have a function that takes a argument of the product name, that makes the call to the database and returns the description of that product</li>
<li>We will make a get operation to memcached, if nothing is returned, then we know the item does not exists in our cache,</li>
<li>Then we will call our function to get the data from the database and return it directly to our client, and</li>
<li>Save it to the cache in memcached so the next time the same product is queried, it will be delivered directly from the cache</li>
</ul>


<h2>The Demo:</h2>

<p>Our Product Name is <code>guitar</code>, lets call the product, which will be the first time so memcached wont have the item in its cache:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>python app.py
</span><span class='line'>got a miss, need to get the data from db
</span><span class='line'>returning data to client from <span class="nv">db</span>
</span><span class='line'><span class="o">=</span>&gt; Product: guitar, Description: musical instrument
</span><span class='line'>setting the data to memcache
</span></code></pre></td></tr></table></div></figure>


<p>Now from the output, we can see that the item was delivered from the database and saved to the cache, lets call that same product and observe the behavior:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>python app.py
</span><span class='line'>got the data directly from <span class="nv">memcache</span>
</span><span class='line'><span class="o">=</span>&gt; Product: guitar, Description: musical instrument
</span></code></pre></td></tr></table></div></figure>


<p>When our cache instance gets rebooted we will lose our data that is in the cache, but since the source of truth will be in our database, data will be re-added to the cache as they are requested. That is one good reason not to rely on a cache service to be your primary data source.</p>

<p>What if the product we request is not in our cache or database, let&rsquo;s say the product <code>tree</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>python app.py
</span><span class='line'>got a miss, need to get the data from db
</span><span class='line'>requested data does not exist in db
</span></code></pre></td></tr></table></div></figure>


<p>This was a really simple scenario, but when working with masses amount of data, you can benefit from a lot of performance using caching.</p>

<h2>Resources:</h2>

<ul>
<li><a href="https://realpython.com/python-memcache-efficient-caching/">https://realpython.com/python-memcache-efficient-caching/</a></li>
<li><a href="https://github.com/ruanbekker/dockerhub-sources/tree/master/memcached/alpine">https://github.com/ruanbekker/dockerhub-sources/tree/master/memcached/alpine</a></li>
<li><a href="https://pymemcache.readthedocs.io/en/latest/getting_started.html#basic-usage">https://pymemcache.readthedocs.io/en/latest/getting_started.html#basic-usage</a></li>
<li><a href="https://sebastianraschka.com/Articles/2014_sqlite_in_python_tutorial.html">https://sebastianraschka.com/Articles/2014_sqlite_in_python_tutorial.html</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2018/09/01/dockerizing-a-memcached-server-for-docker-on-alpine/">Dockerizing a Memcached Server for Docker on Alpine</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2018-09-01T16:01:09-04:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>1</span><span class='date-suffix'>st</span>, <span class='date-year'>2018</span></span> <span class='time'>4:01 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="https://objects.ruanbekker.com/assets/images/memcached-logo.png" alt="" /></p>

<p>This post I will demostrate how to dockerize a memcached server on Alpine and how to create a boot script that allows you to pass environment variables through to the application.</p>

<h2>What is Memcached</h2>

<p>Memcached is a multi-threaded, in-memory key/value store for small chunks of arbitrary data (strings, objects) from results of database calls, API calls, etc. More on <a href="https://memcached.org/about">Memcached</a></p>

<h2>The Dockerfile:</h2>

<p>Our Dockerfile will consist of a simple install of memcached and add a boot script that we will start it from:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='docker'><span class='line'><span class="k">FROM</span> alpine:3.7
</span><span class='line'>
</span><span class='line'>COPY boot.sh /boot.sh
</span><span class='line'><span class="k">RUN</span> apk --no-cache add memcached <span class="o">&amp;&amp;</span> chmod +x /boot.sh
</span><span class='line'>
</span><span class='line'>USER memcached
</span><span class='line'><span class="k">CMD</span> <span class="o">[</span><span class="s2">&quot;/boot.sh&quot;</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<h2>The Boot Script:</h2>

<p>As you can see we have set defaults so when the user does not specify any environment variables, that it will inherit the default values</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/sh</span>
</span><span class='line'>
</span><span class='line'>/usr/bin/memcached <span class="se">\</span>
</span><span class='line'>  --user<span class="o">=</span><span class="k">${</span><span class="nv">MEMCACHED_USER</span><span class="k">:-</span><span class="nv">memcached</span><span class="k">}</span> <span class="se">\</span>
</span><span class='line'>  --listen<span class="o">=</span><span class="k">${</span><span class="nv">MEMCACHED_HOST</span><span class="k">:-</span><span class="nv">0</span><span class="p">.0.0.0</span><span class="k">}</span> <span class="se">\</span>
</span><span class='line'>  --port<span class="o">=</span><span class="k">${</span><span class="nv">MEMCACHED_PORT</span><span class="k">:-</span><span class="nv">11211</span><span class="k">}</span> <span class="se">\</span>
</span><span class='line'>  --memory-limit<span class="o">=</span><span class="k">${</span><span class="nv">MEMCACHED_MEMUSAGE</span><span class="k">:-</span><span class="nv">64</span><span class="k">}</span> <span class="se">\</span>
</span><span class='line'>  --conn-limit<span class="o">=</span><span class="k">${</span><span class="nv">MEMCACHED_MAXCONN</span><span class="k">:-</span><span class="nv">1024</span><span class="k">}</span> <span class="se">\</span>
</span><span class='line'>  --threads<span class="o">=</span><span class="k">${</span><span class="nv">MEMCACHED_THREADS</span><span class="k">:-</span><span class="nv">4</span><span class="k">}</span> <span class="se">\</span>
</span><span class='line'>  --max-reqs-per-event<span class="o">=</span><span class="k">${</span><span class="nv">MEMCACHED_REQUESTS_PER_EVENT</span><span class="k">:-</span><span class="nv">20</span><span class="k">}</span> <span class="se">\</span>
</span><span class='line'>  --verbose
</span></code></pre></td></tr></table></div></figure>


<h2>Build and Deploy:</h2>

<p>Build the image, if you just want to run the container you can use my public image in the next step:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker build -t <span class="nb">local</span>/memcached:0.1 .
</span></code></pre></td></tr></table></div></figure>


<p>Run the Memcached Container:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker run -itd --name memcached -p 11211:11211 -e <span class="nv">MEMCACHED_MEMUSAGE</span><span class="o">=</span><span class="m">32</span> <span class="nb">local</span>/memcached:0.1
</span></code></pre></td></tr></table></div></figure>


<p>Or my Public Image from Docker Hub:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>docker run -itd --name memcached -p 11211:11211 -e <span class="nv">MEMCACHED_MEMUSAGE</span><span class="o">=</span><span class="m">32</span> rbekker87/memcached:alpine
</span></code></pre></td></tr></table></div></figure>


<h2>Check out the Stats:</h2>

<p>Pass the command <code>stats</code> through the exposed port:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span><span class="nb">echo</span> -e <span class="s2">&quot;stats&quot;</span> <span class="p">|</span> nc localhost <span class="m">11211</span>
</span><span class='line'>STAT pid 8
</span><span class='line'>STAT uptime 2
</span><span class='line'>STAT <span class="nb">time </span>1535833177
</span><span class='line'>STAT version 1.5.6
</span><span class='line'>STAT libevent 2.1.8-stable
</span><span class='line'>STAT pointer_size 64
</span><span class='line'>STAT rusage_user 0.030000
</span><span class='line'>STAT rusage_system 0.000000
</span><span class='line'>STAT max_connections 1024
</span><span class='line'>STAT curr_connections 1
</span><span class='line'>STAT total_connections 2
</span><span class='line'>STAT rejected_connections 0
</span><span class='line'>STAT connection_structures 2
</span><span class='line'>STAT reserved_fds 20
</span><span class='line'>STAT cmd_get 0
</span><span class='line'>STAT cmd_set 0
</span><span class='line'>STAT cmd_flush 0
</span><span class='line'>STAT cmd_touch 0
</span><span class='line'>STAT get_hits 0
</span><span class='line'>STAT get_misses 0
</span><span class='line'>STAT get_expired 0
</span><span class='line'>STAT get_flushed 0
</span><span class='line'>STAT delete_misses 0
</span><span class='line'>STAT delete_hits 0
</span><span class='line'>STAT incr_misses 0
</span><span class='line'>STAT incr_hits 0
</span><span class='line'>STAT decr_misses 0
</span><span class='line'>STAT decr_hits 0
</span><span class='line'>STAT cas_misses 0
</span><span class='line'>STAT cas_hits 0
</span><span class='line'>STAT cas_badval 0
</span><span class='line'>STAT touch_hits 0
</span><span class='line'>STAT touch_misses 0
</span><span class='line'>STAT auth_cmds 0
</span><span class='line'>STAT auth_errors 0
</span><span class='line'>STAT bytes_read 6
</span><span class='line'>STAT bytes_written 0
</span><span class='line'>STAT limit_maxbytes 33554432
</span><span class='line'>STAT accepting_conns 1
</span><span class='line'>STAT listen_disabled_num 0
</span><span class='line'>STAT time_in_listen_disabled_us 0
</span><span class='line'>STAT threads 4
</span><span class='line'>STAT conn_yields 0
</span><span class='line'>STAT hash_power_level 16
</span><span class='line'>STAT hash_bytes 524288
</span><span class='line'>STAT hash_is_expanding 0
</span><span class='line'>STAT slab_reassign_rescues 0
</span><span class='line'>STAT slab_reassign_chunk_rescues 0
</span><span class='line'>STAT slab_reassign_evictions_nomem 0
</span><span class='line'>STAT slab_reassign_inline_reclaim 0
</span><span class='line'>STAT slab_reassign_busy_items 0
</span><span class='line'>STAT slab_reassign_busy_deletes 0
</span><span class='line'>STAT slab_reassign_running 0
</span><span class='line'>STAT slabs_moved 0
</span><span class='line'>STAT lru_crawler_running 0
</span><span class='line'>STAT lru_crawler_starts 255
</span><span class='line'>STAT lru_maintainer_juggles 155
</span><span class='line'>STAT malloc_fails 0
</span><span class='line'>STAT log_worker_dropped 0
</span><span class='line'>STAT log_worker_written 0
</span><span class='line'>STAT log_watcher_skipped 0
</span><span class='line'>STAT log_watcher_sent 0
</span><span class='line'>STAT bytes 0
</span><span class='line'>STAT curr_items 0
</span><span class='line'>STAT total_items 0
</span><span class='line'>STAT slab_global_page_pool 0
</span><span class='line'>STAT expired_unfetched 0
</span><span class='line'>STAT evicted_unfetched 0
</span><span class='line'>STAT evicted_active 0
</span><span class='line'>STAT evictions 0
</span><span class='line'>STAT reclaimed 0
</span><span class='line'>STAT crawler_reclaimed 0
</span><span class='line'>STAT crawler_items_checked 0
</span><span class='line'>STAT lrutail_reflocked 0
</span><span class='line'>STAT moves_to_cold 0
</span><span class='line'>STAT moves_to_warm 0
</span><span class='line'>STAT moves_within_lru 0
</span><span class='line'>STAT direct_reclaims 0
</span><span class='line'>STAT lru_bumps_dropped 0
</span><span class='line'>END
</span></code></pre></td></tr></table></div></figure>


<p>Some descriptions:</p>

<p><code>evictions</code> - when items are evicted from the cache
<code>total_items</code> - the number of items the server has stored since it was started
<code>current_items</code> - the number of items in the cache
<code>bytes</code> - the current number of bytes used to store items
<code>limit_maxbytes</code> - the number of bytes the server is allowed to use for storage
<code>get_misses</code> - the number of times a item has been requested, but not found
<code>get_hits</code> - the number of times a item has been served from the cache</p>

<p>To get specific stats, like evictions:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span><span class="nb">echo</span> -e <span class="s2">&quot;stats&quot;</span> <span class="p">|</span> nc localhost <span class="m">11211</span> <span class="p">|</span> grep -w evictions
</span><span class='line'>STAT evictions 0
</span></code></pre></td></tr></table></div></figure>


<p>When you see evictions value increases, this essentially means that memcache had to remove the oldest items from memory for new or more frequent used items. If this number remains high, consider increasing your memory allocated to memcache.</p>

<p>Slab Stats: returns information about each of the slabs created by memcached during runtime:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span><span class="nb">echo</span> -e <span class="s2">&quot;stats slabs&quot;</span> <span class="p">|</span> nc localhost <span class="m">11211</span>
</span><span class='line'>STAT active_slabs 0
</span><span class='line'>STAT total_malloced 0
</span></code></pre></td></tr></table></div></figure>


<p><code>active_slabs</code> - Total number of slab classes allocated.
<code>total_malloced</code> - Total amount of memory allocated to slab pages.</p>

<p>For detailed description about statistics, have a look at their github resource:
- <a href="https://github.com/memcached/memcached/blob/master/doc/protocol.txt">https://github.com/memcached/memcached/blob/master/doc/protocol.txt</a></p>

<h2>Resources:</h2>

<ul>
<li><a href="https://memcached.org/">https://memcached.org/</a></li>
<li><a href="https://blog.serverdensity.com/monitor-memcached/">https://blog.serverdensity.com/monitor-memcached/</a></li>
<li><a href="https://wiki.mikejung.biz/Memcached">https://wiki.mikejung.biz/Memcached</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2018/08/29/review-and-secure-your-facebook-account/">Review and Secure Your Facebook Account</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2018-08-29T15:03:10-04:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>29</span><span class='date-suffix'>th</span>, <span class='date-year'>2018</span></span> <span class='time'>3:03 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="https://objects.ruanbekker.com/assets/images/fb-security-logo.png" alt="" /></p>

<p>This post is a bit different from my other posts, but I feel it&rsquo;s a important one: Facebook Security.</p>

<p>Facebook, everyone loves it right? Yeah, but what happens when you get locked out of your account, or an attacker gains access to your account and start doing things that you dont want to, and especially all the photos / messages that needs to remain private, can potentially end up in the wrong hands.</p>

<p>Facebook usually detects strange behavior, but being able to be pro-active on security on this can help a lot.</p>

<p>There&rsquo;s a couple of ways how attackers can gain access to your account, but I won&rsquo;t go into that, google will be your friend if you are curious how they do it.</p>

<h2>Scenario: Something suspicious is up / weird behavior / getting unusual messages from groups etc</h2>

<p>Usually Facebook will detect this, but if not you can and should do the following:</p>

<ul>
<li>Reset your password</li>
<li>Enable Two-Factor Authentication</li>
<li>Terminate or Logout all sessions from your account, if you find unknown sessions, report it to facebook and log them out.</li>
<li>Review your account&rsquo;s activity</li>
<li>Review Group Activity, if you are subscribed to groups, unsubscribe</li>
<li>Reach out to facebook support</li>
</ul>


<h2>Head over to your Facebook Accounts Settings Page:</h2>

<p>Head over to <a href="https://www.facebook.com/settings">https://www.facebook.com/settings</a> , this will be the main view where you are able to configure/review your account. It should look like this:</p>

<p><img src="https://objects.ruanbekker.com/assets/images/fb-1.png" alt="" /></p>

<p>When you select the &ldquo;Security and Login&rdquo; tab: <a href="https://www.facebook.com/settings?tab=security">https://www.facebook.com/settings?tab=security</a> , you will be presented with a couple of login options:</p>

<h2>Security and Login Info:</h2>

<p>The list of your devices that is currently logged on:</p>

<p><img src="https://objects.ruanbekker.com/assets/images/fb-2.png" alt="" /></p>

<p>Hit the <code>See More</code> dropdown to review all your devices, which is currently logged onto Facebook, if you are not aware of the sessions, hit the <code>Log Out</code> button to terminate that session, or select <code>Not You</code> if you are not aware of that session, then continue to report the activity to Facebook, so that they can look into it.</p>

<p><img src="https://objects.ruanbekker.com/assets/images/fb-3.png" alt="" /></p>

<p>You can follow up on your incident via <a href="https://www.facebook.com/support/">https://www.facebook.com/support/</a> .</p>

<h2>Password and Two Factor Authentication:</h2>

<p>This is actually the first thing that I would do, is to change your password. If someone did manage to gain access to your password and you are still logged on, change it immediately. If they reset your password before you do, game over. Well kind of..</p>

<p>From the same page, change your password:</p>

<p><img src="https://objects.ruanbekker.com/assets/images/fb-4.png" alt="" /></p>

<p>Enable <code>"Two-Factor Authentication"</code>, when you are logged out, or trying to logon from a new device, a notification will be sent to your device where Facebook is installed, or alternatively, you will receive a code sent to you which you will need to enter after you have logged on, just to provide you with a extra layer of security.</p>

<p><img src="https://objects.ruanbekker.com/assets/images/fb-5.png" alt="" /></p>

<p>Enable <code>"Get alerts about unrecognized logins"</code>, which allows you to set up to 5 friends that can help you unlock your account, if your account has been locked out.</p>

<p><img src="https://objects.ruanbekker.com/assets/images/fb-6.png" alt="" /></p>

<h2>Review your Activity Log</h2>

<p>From <a href="https://www.facebook.com/settings?tab=your_facebook_information">https://www.facebook.com/settings?tab=your_facebook_information</a> , head over to <code>"Activity Log"</code>:</p>

<p><img src="https://objects.ruanbekker.com/assets/images/fb-7.png" alt="" /></p>

<p>Select <code>"Activity Log"</code>, to review your recent activity:</p>

<p><img src="https://objects.ruanbekker.com/assets/images/fb-8.png" alt="" /></p>

<p>Below <code>Comments</code>, select <code>more</code>, then <code>Security and Login Information</code>:</p>

<p><img src="https://objects.ruanbekker.com/assets/images/fb-9.png" alt="" /></p>

<p>Then we will be presented with the <code>Active Sessions</code>, <code>Login and Logouts</code> and <code>Recognized Devices</code>.</p>

<p>First look at <code>Active Sessions</code>:</p>

<p><img src="https://objects.ruanbekker.com/assets/images/fb-10.png" alt="" /></p>

<p>Then <code>Logins and Logouts</code>:</p>

<p><img src="https://objects.ruanbekker.com/assets/images/fb-11.png" alt="" /></p>

<p>From this same page you can review other activity like <code>Search History</code>, <code>Groups</code>. etc.</p>

<p><img src="https://objects.ruanbekker.com/assets/images/fb-12.png" alt="" /></p>

<p>If someone had to access/subscribed to groups, you will be able to review the activity, within 3 different views:</p>

<ul>
<li>Groups: any interaction with groups, such as likes, comments etc.</li>
<li>Membership Activity: Any group memberships</li>
<li>Posts and Comments: Self explanatory.</li>
</ul>


<h2>Final Note:</h2>

<p>People try to access accounts all the time, watch out for the following:</p>

<ul>
<li>Friend Requests: people have a lot of private information on facebook, keep it private</li>
<li>Watch out for strange applications that wants your permission, review the permission levels closely</li>
<li>Reset your password time to time, use unique passwords, and not the same password as the password that your main email account is associated with</li>
<li>Watch out for links, some of them can end you up in a bad spot.</li>
<li>When you see weird activity from your friends account, report it, so that facebook can investigate it. It happened to a friend and Facebook sorted it out within 20 minutes.</li>
</ul>


<h2>Resources:</h2>

<ul>
<li><a href="https://www.facebook.com/security/">https://www.facebook.com/security/</a></li>
<li><a href="https://www.facebook.com/support">https://www.facebook.com/support</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2018/08/27/distributing-a-shared-secret-amongst-a-group-of-participants-using-shamirs-secret-sharing-scheme-aka-ssss/">Distributing a Shared Secret Amongst a Group of Participants Using Shamirs Secret Sharing Scheme Aka Ssss</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2018-08-27T18:29:48-04:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2018</span></span> <span class='time'>6:29 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="https://objects.ruanbekker.com/assets/images/cryptography-word-logo.png" alt="" /></p>

<p>In situations where a group of participants join together to split up a secret in a form of secret sharing, where the secret is devided into parts, giving each participant their own unique part. Together contributing to reconstruct the initial secret. We can achieve this with Shamir&rsquo;s Secret Sharing which is an algorithm in cryptography created by <a href="https://en.wikipedia.org/wiki/Shamir%27s_Secret_Sharing">Adi Shamir</a>.</p>

<h2>More info on Secret Sharing</h2>

<p>Referenced from <a href="https://en.wikipedia.org/wiki/Secret_sharing">Wikipedia: Secret Sharing</a>:</p>

<p>&ldquo;Secret sharing (also called secret splitting) refers to methods for distributing a secret amongst a group of participants, each of whom is allocated a share of the secret. The secret can be reconstructed only when a sufficient number, of possibly different types, of shares are combined together; individual shares are of no use on their own.&rdquo;</p>

<h2>Installing ssss</h2>

<p>On Mac OSX:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ brew install ssss</span></code></pre></td></tr></table></div></figure>


<p>On Debian:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ apt install ssss -y</span></code></pre></td></tr></table></div></figure>


<h2>Creating a Secret:</h2>

<p>Generate a Secret where we will distribute 5 shares, where each participant will have their own unique share, and to reconstruct the secret, we will need 3 participants to rebuild the secret. In our case our shares will be distributed to the following example users:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>- Share 1: James
</span><span class='line'>- Share 2: John
</span><span class='line'>- Share 3: Frank
</span><span class='line'>- Share 4: Paul
</span><span class='line'>- Share 5: Ryan</span></code></pre></td></tr></table></div></figure>


<p>For this demonstration our secret&rsquo;s value will be <code>SuperSecret@123!</code>, which we will split into 5 shares, but to reconstruct, we need 3 parts / shares:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>ssss-split -t <span class="m">3</span> -n 5
</span><span class='line'>Generating shares using a <span class="o">(</span>3,5<span class="o">)</span> scheme with dynamic security level.
</span><span class='line'>Enter the secret, at most <span class="m">128</span> ASCII characters: Using a <span class="m">128</span> bit security level.
</span><span class='line'>1-41ac84013bf568d1cc88b751539f1ff5
</span><span class='line'>2-7d9ca3ca26442bfcca35e0ad205e5659
</span><span class='line'>3-519038837bbf1b7ceefde331ad1ae40f
</span><span class='line'>4-6d4f4e0f086af5be033f516bb3e227d2
</span><span class='line'>5-4143d5465591c53e27f752f73ea69596
</span></code></pre></td></tr></table></div></figure>


<p>In this case, each share will be distributed to each user to save in a secure location.</p>

<h2>Reconstructing the Secret:</h2>

<p>Let&rsquo;s reconstruct the secret, and as we need 3 participants, we will ask <code>John</code>, <code>Paul</code> and <code>Ryan</code> for their shares, so that we can reconstruct the secret:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>ssss-combine -t 3
</span><span class='line'>Enter <span class="m">3</span> shares separated by newlines:
</span><span class='line'>Share <span class="o">[</span>1/3<span class="o">]</span>: 2-7d9ca3ca26442bfcca35e0ad205e5659
</span><span class='line'>Share <span class="o">[</span>2/3<span class="o">]</span>: 4-6d4f4e0f086af5be033f516bb3e227d2
</span><span class='line'>Share <span class="o">[</span>3/3<span class="o">]</span>: 5-4143d5465591c53e27f752f73ea69596
</span><span class='line'>Resulting secret: SuperSecret@123!
</span></code></pre></td></tr></table></div></figure>


<p>As you can see the secret is verified the same as the initial secret.</p>

<h2>Using ssss and qrencode for MFA Codes</h2>

<p>This can be useful for Multi Factor Authentication as well. Setup a Virtual MFA with a Identity that supports MFA Authentication, copy or make note of the &ldquo;Secret Key / Secret Configuration Key&rdquo;, go ahead and setup the MFA Device on your MFA Device to complete the setup.</p>

<p>Once verified and able to logon, logout and delete the MFA Account from your Device.</p>

<p>Generate the same share scheme for the MFA Secret Key, for this example: <code>ABCDEXAMPLE1029384756</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>ssss-split -t <span class="m">3</span> -n 5
</span><span class='line'>Generating shares using a <span class="o">(</span>3,5<span class="o">)</span> scheme with dynamic security level.
</span><span class='line'>Enter the secret, at most <span class="m">128</span> ASCII characters: Using a <span class="m">168</span> bit security level.
</span><span class='line'>1-8d2cf979fb346297cab47ff691bddc1c5a5f34af37
</span><span class='line'>2-4d0f2cdcfff653cc60a4f293c15805f7e84b0a956d
</span><span class='line'>3-dadb6d2cbe42772c9a9042273f0b71dd71422f19cb
</span><span class='line'>4-546bcef428151ceb01fdc6007ac2e5e4f1516670ca
</span><span class='line'>5-c3bf8f0469a1380bfbc976b4849191ce685843fc7e
</span></code></pre></td></tr></table></div></figure>


<p>Distribute the Shares, and when the MFA Device needs to be restored on a Device, reconstruct the secret to get the Secret Key for the MFA Device:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>ssss-combine -t 3
</span><span class='line'>Enter <span class="m">3</span> shares separated by newlines:
</span><span class='line'>Share <span class="o">[</span>1/3<span class="o">]</span>: 1-8d2cf979fb346297cab47ff691bddc1c5a5f34af37
</span><span class='line'>Share <span class="o">[</span>2/3<span class="o">]</span>: 2-4d0f2cdcfff653cc60a4f293c15805f7e84b0a956d
</span><span class='line'>Share <span class="o">[</span>3/3<span class="o">]</span>: 3-dadb6d2cbe42772c9a9042273f0b71dd71422f19cb
</span><span class='line'>Resulting secret: ABCDEXAMPLE1029384756
</span></code></pre></td></tr></table></div></figure>


<p>Now that we have the Secret Key for our MFA Device, let&rsquo;s Generate a QRCode that we can scan in from our device, which will save us from typing a lot of characters. We will need <code>qrencode</code> for this:</p>

<p>For Mac OSX:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>brew install qrencode
</span></code></pre></td></tr></table></div></figure>


<p>for Debian:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>apt install qrencode -y
</span></code></pre></td></tr></table></div></figure>


<p>To generate the QRCode, we will pass the filename: <code>myqrcode.png</code>, the name that will appear on our device: <code>MyNewMFADevice</code>, and the Secret: <code>ABCDEXAMPLE1029384756</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>qrencode -o myqrcode.png -d <span class="m">300</span> -s <span class="m">10</span> <span class="s2">&quot;otpauth://totp/MyNewMFADevice?secret=ABCDEXAMPLE1029384756&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>You will find the <code>myqrcode.png</code> in your current working directory, open the file scan the barcode and your MFA device will be setup and enabled to use.</p>

<h2>Resources:</h2>

<ul>
<li><a href="https://en.wikipedia.org/wiki/Secret_sharing">https://en.wikipedia.org/wiki/Secret_sharing</a></li>
<li><a href="http://point-at-infinity.org/ssss/">http://point-at-infinity.org/ssss/</a></li>
<li><a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_mfa_enable_virtual.html#enable-virt-mfa-for-iam-user">https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_mfa_enable_virtual.html#enable-virt-mfa-for-iam-user</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2018/08/27/improving-performance-from-your-lambda-function-from-the-use-of-global-variables/">Improving Performance From Your Lambda Function From the Use of Global Variables</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2018-08-27T08:30:30-04:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2018</span></span> <span class='time'>8:30 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="https://objects.ruanbekker.com/assets/images/aws-logo.png" alt="" /></p>

<p>When using Lambda and DynamoDB, you can use global variables to gain performance when your data from DynamoDB does not get updated that often, and you would like to use caching to prevent a API call to DynamoDB everytime your Lambda Function gets invoked.</p>

<p>You can use external services like Redis or Memcached when you would like to verify that each invocation is as true as your source of truth which will be DynamoDB. Then your application logic can work with caching.</p>

<p>But in this case we just want a simple piece of code that can keep the state for the remaining time that the function is running on that underlying container. I am not 100% sure, but I have seen that the data can be cached for up to 60 minutes. This can be a total mess when your data gets updated regularly, then I would set all my calls in functions, as the global variables keeps their state for some time.</p>

<script id="mNCC" language="javascript">
    medianet_width = "728";
    medianet_height = "90";
    medianet_crid = "218284798";
    medianet_versionId = "3111299"; 
  </script>


<script src="//contextual.media.net/nmedianet.js?cid=8CUD78FSV"></script>


<h2>Example Function:</h2>

<p>This function gets data from DynamoDB, iterates through a small dataset (10 Items), and appends each group name to my list which is the value of my <code>groups</code> key inside my dictionary.</p>

<p>Due to my global variable <code>mydata</code>, you will see that the first invocation will result in a API call to DynamoDB as the length of my <code>mydata["groups"]</code> being 0, the second invocation, the data will exist inside my global variable, therefore I am returning the data directly from my variable.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">boto3</span><span class="o">,</span> <span class="nn">json</span>
</span><span class='line'>
</span><span class='line'><span class="n">client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s">&#39;dynamodb&#39;</span><span class="p">,</span> <span class="n">region_name</span><span class="o">=</span><span class="s">&#39;eu-west-1&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">tbl</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">Table</span><span class="p">(</span><span class="s">&#39;my-dynamo-table&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">mydata</span> <span class="o">=</span> <span class="p">{}</span>
</span><span class='line'><span class="n">mydata</span><span class="p">[</span><span class="s">&quot;groups&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
</span><span class='line'>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mydata</span><span class="p">[</span><span class="s">&quot;groups&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span class='line'>        <span class="c"># data is not cached, make call to dynamo</span>
</span><span class='line'>        <span class="n">data</span> <span class="o">=</span> <span class="n">tbl</span><span class="o">.</span><span class="n">scan</span><span class="p">()</span>
</span><span class='line'>        <span class="n">group_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;Items&#39;</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">group_data</span><span class="p">:</span>
</span><span class='line'>            <span class="n">mydata</span><span class="p">[</span><span class="s">&quot;groups&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">])</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">mydata</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">else</span><span class="p">:</span>
</span><span class='line'>        <span class="c"># return cached content</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">mydata</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Results of my Invocations:</h2>

<p>The first call that I made:</p>

<p><img src="https://objects.ruanbekker.com/assets/images/lambda-caching-miss.png" alt="" /></p>

<p>The second call that I made:</p>

<p><img src="https://objects.ruanbekker.com/assets/images/lambda-caching-hit.png" alt="" /></p>

<p>If you need a small layer of caching that can improve your latency, this can be used. But if you need your data to be accurate from every call, rather looking into a different approach and external caching services.</p>

<h2>Resources:</h2>

<p><em>Take advantage of Execution Context reuse to improve the performance of your function.</em>:</p>

<p>&ldquo;Make sure any externalized configuration or dependencies that your code retrieves are stored and referenced locally after initial execution. Limit the re-initialization of variables/objects on every invocation. Instead use static initialization/constructor, global/static variables and singletons. Keep alive and reuse connections (HTTP, database, etc.) that were established during a previous invocation.&rdquo;</p>

<ul>
<li><a href="https://docs.aws.amazon.com/lambda/latest/dg/best-practices.html">https://docs.aws.amazon.com/lambda/latest/dg/best-practices.html</a></li>
<li><a href="https://aws.amazon.com/blogs/compute/container-reuse-in-lambda/">https://aws.amazon.com/blogs/compute/container-reuse-in-lambda/</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2018/08/21/send-emails-using-python-and-sendgrid-using-smtplib/">Send Emails Using Python and Sendgrid Using SMTPlib</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2018-08-21T11:30:08-04:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>21</span><span class='date-suffix'>st</span>, <span class='date-year'>2018</span></span> <span class='time'>11:30 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="https://objects.ruanbekker.com/assets/images/sendgrid-logo.png" alt="" /></p>

<p>Quick tutorial on how to send emails using Python and smtplib.</p>

<script id="mNCC" language="javascript">
    medianet_width = "728";
    medianet_height = "90";
    medianet_crid = "218284798";
    medianet_versionId = "3111299"; 
  </script>


<script src="//contextual.media.net/nmedianet.js?cid=8CUD78FSV"></script>


<h2>Sendgrid</h2>

<p>Sendgrid offers 100 free outbound emails per day, sign up with them via <a href="https://sendgrid.com/free/">sendgrid.com/free</a>, create a API Key and save your credentials in a safe place.</p>

<p>You first need to verify your account by sending a mail using their API, but it&rsquo;s step by step so won&rsquo;t take more than 2 minutes to complete.</p>

<h2>Python Code</h2>

<p>Once the verification is completed, our Python Code:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">smtplib</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">email.MIMEMultipart</span> <span class="kn">import</span> <span class="n">MIMEMultipart</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">email.MIMEText</span> <span class="kn">import</span> <span class="n">MIMEText</span>
</span><span class='line'>
</span><span class='line'><span class="n">mail_from</span> <span class="o">=</span> <span class="s">&#39;Ruan Bekker &lt;ruan@ruanbekker.com&gt;&#39;</span>
</span><span class='line'><span class="n">mail_to</span> <span class="o">=</span> <span class="s">&#39;Ruan Bekker &lt;xxxx@gmail.com&gt;&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEMultipart</span><span class="p">()</span>
</span><span class='line'><span class="n">msg</span><span class="p">[</span><span class="s">&#39;From&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mail_from</span>
</span><span class='line'><span class="n">msg</span><span class="p">[</span><span class="s">&#39;To&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mail_to</span>
</span><span class='line'><span class="n">msg</span><span class="p">[</span><span class="s">&#39;Subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Sending mails with Python&#39;</span>
</span><span class='line'><span class="n">mail_body</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
</span><span class='line'><span class="s">Hey,</span>
</span><span class='line'>
</span><span class='line'><span class="s">This is a test.</span>
</span><span class='line'>
</span><span class='line'><span class="s">Regards,</span><span class="se">\n</span><span class="s">Ruan</span>
</span><span class='line'>
</span><span class='line'><span class="s">&quot;&quot;&quot;</span>
</span><span class='line'><span class="n">msg</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">MIMEText</span><span class="p">(</span><span class="n">mail_body</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="k">try</span><span class="p">:</span>
</span><span class='line'>    <span class="n">server</span> <span class="o">=</span> <span class="n">smtplib</span><span class="o">.</span><span class="n">SMTP_SSL</span><span class="p">(</span><span class="s">&#39;smtp.sendgrid.net&#39;</span><span class="p">,</span> <span class="mi">465</span><span class="p">)</span>
</span><span class='line'>    <span class="n">server</span><span class="o">.</span><span class="n">ehlo</span><span class="p">()</span>
</span><span class='line'>    <span class="n">server</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="s">&#39;apikey&#39;</span><span class="p">,</span> <span class="s">&#39;your-api-key&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">server</span><span class="o">.</span><span class="n">sendmail</span><span class="p">(</span><span class="n">mail_from</span><span class="p">,</span> <span class="n">mail_to</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">as_string</span><span class="p">())</span>
</span><span class='line'>    <span class="n">server</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span class='line'>    <span class="k">print</span><span class="p">(</span><span class="s">&quot;mail sent&quot;</span><span class="p">)</span>
</span><span class='line'><span class="k">except</span><span class="p">:</span>
</span><span class='line'>    <span class="k">print</span><span class="p">(</span><span class="s">&quot;issue&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>When I ran the code, I received the mail, and when you inspect the headers you can see that the mail came via sendgrid:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">Received</span><span class="p">:</span> <span class="kn">from</span> <span class="nn">xx.xx.s2shared.sendgrid.net</span> <span class="p">(</span><span class="n">xx</span><span class="o">.</span><span class="n">xx</span><span class="o">.</span><span class="n">s2shared</span><span class="o">.</span><span class="n">sendgrid</span><span class="o">.</span><span class="n">net</span><span class="o">.</span> <span class="p">[</span><span class="n">xx</span><span class="o">.</span><span class="n">xx</span><span class="o">.</span><span class="n">xx</span><span class="o">.</span><span class="n">xx</span><span class="p">])</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<h2>Resources:</h2>

<p>Great post on SSL / TLS:
- <a href="https://stackabuse.com/how-to-send-emails-with-gmail-using-python/">https://stackabuse.com/how-to-send-emails-with-gmail-using-python/</a></p>

<p>Enjoy :D</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2018/08/20/using-iam-authentication-with-amazon-elasticsearch-service/">Using IAM Authentication With Amazon Elasticsearch Service</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2018-08-20T04:12:21-04:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2018</span></span> <span class='time'>4:12 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="https://objects.ruanbekker.com/assets/images/aws-logo.png" alt="" /></p>

<p>Today I will demonstrate how to allow access to Amazons Elasticsearch Service using IAM Authenticationi using AWS Signature Version4.</p>

<h2>Elasticsearch Service Authentication Support:</h2>

<p>When it comes to security, Amazons Elasticsearch Service supports three types of access policies:</p>

<ul>
<li>Resource Based</li>
<li>Identity Based</li>
<li>IP Access Based</li>
</ul>


<p>More information on this can be found below:
- <a href="https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/es-ac.html">https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/es-ac.html</a></p>

<h2>Securing your Amazon Elasticsearch Search Domain:</h2>

<p>To secure your domain with IAM Based Authentication, the following steps will be neeed:</p>

<ul>
<li>Create IAM Policy to be associated with a IAM User or Role</li>
<li>On Elasticsearch Access Policy, associate the ARN to the Resource</li>
<li>Use the AWS4Auth package to sign the requests as AWS supports Signature Version 4</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;Version&quot;</span><span class="p">:</span> <span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;Statement&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="nt">&quot;Sid&quot;</span><span class="p">:</span> <span class="s2">&quot;VisualEditor0&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="nt">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="nt">&quot;Action&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class='line'>                <span class="s2">&quot;es:*&quot;</span>
</span><span class='line'>            <span class="p">],</span>
</span><span class='line'>            <span class="nt">&quot;Resource&quot;</span><span class="p">:</span> <span class="s2">&quot;arn:aws:es:eu-west-1:&lt;ACCOUNT-ID&gt;:domain/&lt;ES-DOMAIN&gt;&quot;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">]</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Create the IAM Role with EC2 Identity Provider as a Trusted Relationship eg. es-role and associate the IAM Policy es-policy to the role.</p>

<p>Create/Moodify the Elasticsearch Access Policy, in this example we will be using a combination of IAM Role, IAM User and IP Based access:</p>

<ul>
<li>IAM Role for EC2 Role Based Services</li>
<li>IAM User for User/System Account</li>
<li>IP Based for cients that needs to be whitelisted via IP (ip-based just for demonstration, as the tests will be used only for IAM)</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="nt">&quot;Version&quot;</span><span class="p">:</span> <span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;Statement&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>      <span class="nt">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="nt">&quot;Principal&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="nt">&quot;AWS&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class='line'>          <span class="s2">&quot;arn:aws:iam::&lt;ACCOUNT-ID&gt;:role/&lt;IAM-ROLE-NAME&gt;&quot;</span><span class="p">,</span>
</span><span class='line'>          <span class="s2">&quot;arn:aws:iam::&lt;ACCOUNT-ID&gt;:user/&lt;IAM-USER-NAME&gt;&quot;</span>
</span><span class='line'>        <span class="p">]</span>
</span><span class='line'>      <span class="p">},</span>
</span><span class='line'>      <span class="nt">&quot;Action&quot;</span><span class="p">:</span> <span class="s2">&quot;es:*&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="nt">&quot;Resource&quot;</span><span class="p">:</span> <span class="s2">&quot;arn:aws:es:eu-west-1:&lt;ACCOUNT-ID&gt;:domain/&lt;ES-DOMAIN&gt;/*&quot;</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>      <span class="nt">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="nt">&quot;Principal&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="nt">&quot;AWS&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span>
</span><span class='line'>      <span class="p">},</span>
</span><span class='line'>      <span class="nt">&quot;Action&quot;</span><span class="p">:</span> <span class="s2">&quot;es:*&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="nt">&quot;Resource&quot;</span><span class="p">:</span> <span class="s2">&quot;arn:aws:es:eu-west-1:&lt;ACCOUNT-ID&gt;:domain/&lt;ES-DOMAIN&gt;/*&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="nt">&quot;Condition&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="nt">&quot;IpAddress&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>          <span class="nt">&quot;aws:SourceIp&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class='line'>            <span class="s2">&quot;x.x.x.x&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="s2">&quot;x.x.x.x&quot;</span>
</span><span class='line'>          <span class="p">]</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">]</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>After the Access Policy has been updated, the Elasticsearch Domain Status will show <code>Active</code></p>

<h2>Testing from EC2 using IAM Instance Profile:</h2>

<p>Launch a EC2 Instance with the IAM Role eg. es-role, then using Python, we will make a request to our Elasticsearch Domain using boto3, aws4auth and the native elasticsearch client for python via our IAM Role, which we will get the temporary credentials from boto3.Session.</p>

<p>Installing the dependencies:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>pip install virtualenv
</span><span class='line'><span class="nv">$ </span>virtualenv .venv
</span><span class='line'><span class="nv">$ </span><span class="nb">source</span> .venv/bin/activate
</span><span class='line'><span class="nv">$ </span>pip install boto3 elasticsearch requests_aws4auth
</span></code></pre></td></tr></table></div></figure>


<p>Our code:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">boto3</span><span class="o">,</span> <span class="nn">json</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">elasticsearch</span> <span class="kn">import</span> <span class="n">Elasticsearch</span><span class="p">,</span> <span class="n">RequestsHttpConnection</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">requests_aws4auth</span> <span class="kn">import</span> <span class="n">AWS4Auth</span>
</span><span class='line'>
</span><span class='line'><span class="n">my_region</span> <span class="o">=</span> <span class="s">&#39;eu-west-1&#39;</span>
</span><span class='line'><span class="n">my_service</span> <span class="o">=</span> <span class="s">&#39;es&#39;</span>
</span><span class='line'><span class="n">my_eshost</span> <span class="o">=</span> <span class="s">&#39;search-replaceme.eu-west-1.es.amazonaws.com&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">session</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span><span class="n">region_name</span><span class="o">=</span><span class="n">my_region</span><span class="p">)</span> <span class="c"># thanks Leon</span>
</span><span class='line'><span class="n">credentials</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get_credentials</span><span class="p">()</span>
</span><span class='line'><span class="n">credentials</span> <span class="o">=</span> <span class="n">credentials</span><span class="o">.</span><span class="n">get_frozen_credentials</span><span class="p">()</span>
</span><span class='line'><span class="n">access_key</span> <span class="o">=</span> <span class="n">credentials</span><span class="o">.</span><span class="n">access_key</span>
</span><span class='line'><span class="n">secret_key</span> <span class="o">=</span> <span class="n">credentials</span><span class="o">.</span><span class="n">secret_key</span>
</span><span class='line'><span class="n">token</span> <span class="o">=</span> <span class="n">credentials</span><span class="o">.</span><span class="n">token</span>
</span><span class='line'>
</span><span class='line'><span class="n">aws_auth</span> <span class="o">=</span> <span class="n">AWS4Auth</span><span class="p">(</span>
</span><span class='line'>    <span class="n">access_key</span><span class="p">,</span>
</span><span class='line'>    <span class="n">secret_key</span><span class="p">,</span>
</span><span class='line'>    <span class="n">my_region</span><span class="p">,</span>
</span><span class='line'>    <span class="n">my_service</span><span class="p">,</span>
</span><span class='line'>    <span class="n">session_token</span><span class="o">=</span><span class="n">token</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">es</span> <span class="o">=</span> <span class="n">Elasticsearch</span><span class="p">(</span>
</span><span class='line'>    <span class="n">hosts</span> <span class="o">=</span> <span class="p">[{</span><span class="s">&#39;host&#39;</span><span class="p">:</span> <span class="n">my_eshost</span><span class="p">,</span> <span class="s">&#39;port&#39;</span><span class="p">:</span> <span class="mi">443</span><span class="p">}],</span>
</span><span class='line'>    <span class="n">http_auth</span><span class="o">=</span><span class="n">aws_auth</span><span class="p">,</span>
</span><span class='line'>    <span class="n">use_ssl</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
</span><span class='line'>    <span class="n">verify_certs</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
</span><span class='line'>    <span class="n">connection_class</span><span class="o">=</span><span class="n">RequestsHttpConnection</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">es</span><span class="o">.</span><span class="n">info</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Running our piece of code, will result in this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>python get-info-from-role.py
</span><span class='line'><span class="o">{</span>
</span><span class='line'>  <span class="s2">&quot;cluster_name&quot;</span>: <span class="s2">&quot;&lt;ACCOUNT-ID&gt;:&lt;ES-DOMAIN&gt;&quot;</span>,
</span><span class='line'>  <span class="s2">&quot;cluster_uuid&quot;</span>: <span class="s2">&quot;sLUnqFSsQdCMlBLrn7BTUA&quot;</span>,
</span><span class='line'>  <span class="s2">&quot;version&quot;</span>: <span class="o">{</span>
</span><span class='line'>    <span class="s2">&quot;lucene_version&quot;</span>: <span class="s2">&quot;6.6.0&quot;</span>,
</span><span class='line'>    <span class="s2">&quot;build_hash&quot;</span>: <span class="s2">&quot;Unknown&quot;</span>,
</span><span class='line'>    <span class="s2">&quot;build_snapshot&quot;</span>: <span class="nb">false</span>,
</span><span class='line'>    <span class="s2">&quot;number&quot;</span>: <span class="s2">&quot;5.5.2&quot;</span>,
</span><span class='line'>    <span class="s2">&quot;build_date&quot;</span>: <span class="s2">&quot;2017-10-18T04:35:01.381Z&quot;</span>
</span><span class='line'>  <span class="o">}</span>,
</span><span class='line'>  <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;KXSwBvT&quot;</span>,
</span><span class='line'>  <span class="s2">&quot;tagline&quot;</span>: <span class="s2">&quot;You Know, for Search&quot;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Testing using IAM Credentials from Credentials Provider:</h2>

<p>Configure your credentials provider:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>pip install awscli
</span><span class='line'><span class="nv">$ </span>aws configure --profile ruan
</span><span class='line'>AWS Access Key ID <span class="o">[</span>None<span class="o">]</span>: xxxxxxxxx
</span><span class='line'>AWS Secret Access Key <span class="o">[</span>None<span class="o">]</span>: xxxxxx
</span><span class='line'>Default region name <span class="o">[</span>None<span class="o">]</span>: eu-west-1
</span><span class='line'>Default output format <span class="o">[</span>None<span class="o">]</span>: json
</span></code></pre></td></tr></table></div></figure>


<p>Using Python, we will get the credentials from the Credential Provider, using our profile name:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">boto3</span><span class="o">,</span> <span class="nn">json</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">elasticsearch</span> <span class="kn">import</span> <span class="n">Elasticsearch</span><span class="p">,</span> <span class="n">RequestsHttpConnection</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">requests_aws4auth</span> <span class="kn">import</span> <span class="n">AWS4Auth</span>
</span><span class='line'>
</span><span class='line'><span class="n">my_service</span> <span class="o">=</span> <span class="s">&#39;es&#39;</span>
</span><span class='line'><span class="n">my_region</span> <span class="o">=</span> <span class="s">&#39;eu-west-1&#39;</span>
</span><span class='line'><span class="n">my_eshost</span> <span class="o">=</span> <span class="s">&#39;search-replaceme.eu-west-1.es.amazonaws.com&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">session</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span>
</span><span class='line'>    <span class="n">region_name</span><span class="o">=</span><span class="n">my_region</span><span class="p">,</span>
</span><span class='line'>    <span class="n">profile_name</span><span class="o">=</span><span class="s">&#39;ruan&#39;</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">credentials</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get_credentials</span><span class="p">()</span>
</span><span class='line'><span class="n">access_key</span> <span class="o">=</span> <span class="n">credentials</span><span class="o">.</span><span class="n">access_key</span>
</span><span class='line'><span class="n">secret_key</span> <span class="o">=</span> <span class="n">credentials</span><span class="o">.</span><span class="n">secret_key</span>
</span><span class='line'>
</span><span class='line'><span class="n">aws_auth</span> <span class="o">=</span> <span class="n">AWS4Auth</span><span class="p">(</span>
</span><span class='line'>    <span class="n">access_key</span><span class="p">,</span>
</span><span class='line'>    <span class="n">secret_key</span><span class="p">,</span>
</span><span class='line'>    <span class="n">my_region</span><span class="p">,</span>
</span><span class='line'>    <span class="n">my_service</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">es</span> <span class="o">=</span> <span class="n">Elasticsearch</span><span class="p">(</span>
</span><span class='line'>    <span class="n">hosts</span> <span class="o">=</span> <span class="p">[{</span><span class="s">&#39;host&#39;</span><span class="p">:</span> <span class="n">my_eshost</span><span class="p">,</span> <span class="s">&#39;port&#39;</span><span class="p">:</span> <span class="mi">443</span><span class="p">}],</span>
</span><span class='line'>    <span class="n">http_auth</span><span class="o">=</span><span class="n">aws_auth</span><span class="p">,</span>
</span><span class='line'>    <span class="n">use_ssl</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
</span><span class='line'>    <span class="n">verify_certs</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
</span><span class='line'>    <span class="n">connection_class</span><span class="o">=</span><span class="n">RequestsHttpConnection</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">es</span><span class="o">.</span><span class="n">info</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Running it will result in:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>python get-info-from-user.py
</span><span class='line'><span class="o">{</span>
</span><span class='line'>  <span class="s2">&quot;cluster_name&quot;</span>: <span class="s2">&quot;&lt;ACCOUNT-ID&gt;:&lt;ES-DOMAIN&gt;&quot;</span>,
</span><span class='line'>  <span class="s2">&quot;cluster_uuid&quot;</span>: <span class="s2">&quot;sLUnqFSsQdCMlBLrn7BTUA&quot;</span>,
</span><span class='line'>  <span class="s2">&quot;version&quot;</span>: <span class="o">{</span>
</span><span class='line'>    <span class="s2">&quot;lucene_version&quot;</span>: <span class="s2">&quot;6.6.0&quot;</span>,
</span><span class='line'>    <span class="s2">&quot;build_hash&quot;</span>: <span class="s2">&quot;Unknown&quot;</span>,
</span><span class='line'>    <span class="s2">&quot;build_snapshot&quot;</span>: <span class="nb">false</span>,
</span><span class='line'>    <span class="s2">&quot;number&quot;</span>: <span class="s2">&quot;5.5.2&quot;</span>,
</span><span class='line'>    <span class="s2">&quot;build_date&quot;</span>: <span class="s2">&quot;2017-10-18T04:37:21.381Z&quot;</span>
</span><span class='line'>  <span class="o">}</span>,
</span><span class='line'>  <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;KXSwBvT&quot;</span>,
</span><span class='line'>  <span class="s2">&quot;tagline&quot;</span>: <span class="s2">&quot;You Know, for Search&quot;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>For more blog posts on Elasticsearch have a look at:
- <a href="http://blog.ruanbekker.com/blog/categories/elasticsearch">blog.ruanbekker.com:elasticsearch</a>
- <a href="https://sysadmins.co.za/tags/elasticsearch">sysadmins.co.za:elasticsearch</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2018/08/15/get-blogpost-titles-links-and-tags-from-a-rss-link-using-python-feedparser/">Get Blogpost Titles Links and Tags From a RSS Link Using Python Feedparser</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2018-08-15T18:14:54-04:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>15</span><span class='date-suffix'>th</span>, <span class='date-year'>2018</span></span> <span class='time'>6:14 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="https://objects.ruanbekker.com/assets/images/python-logo.png" alt="" /></p>

<p>I wanted to get metadata from my other blog <a href="https://sysadmins.co.za">sysadmins.co.za</a>, such as each post&rsquo;s title, link and tags using the RSS link. I stumbled upon <code>feedparser</code>, where I will use it to scrape all the posts details from the link and append it to a list, which I can then use to ingest it into a database or something like that.</p>

<h2>Installing Dependencies:</h2>

<p>Install feedparser and requests:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>pip install feedparser requests
</span></code></pre></td></tr></table></div></figure>


<h2>The Python Code:</h2>

<p>I&rsquo;m not too sure at this point how to get pagination going, so I&rsquo;ve set a range to check, and if a status code of <code>200</code> is received, it will check if the title is in the list that I defined, if not, it will append it to the list.</p>

<p>At the end of the loop, the script will return the list that was defined, which will provide the info mentioned earlier:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">feedparser</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">time</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">requests</span>
</span><span class='line'>
</span><span class='line'><span class="n">rss_url</span> <span class="o">=</span> <span class="s">&quot;https://sysadmins.co.za/rss&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="n">posts</span> <span class="o">=</span> <span class="p">[]</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">get_posts_for_ghost</span><span class="p">(</span><span class="n">rss_url</span><span class="p">):</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="n">feedparser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">rss_url</span><span class="p">)</span>
</span><span class='line'>    <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s">&#39;entries&#39;</span><span class="p">]:</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">each</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">posts</span><span class="p">]:</span>
</span><span class='line'>            <span class="k">pass</span>
</span><span class='line'>        <span class="k">else</span><span class="p">:</span>
</span><span class='line'>            <span class="n">posts</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span class='line'>                <span class="s">&quot;title&quot;</span><span class="p">:</span> <span class="n">each</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">],</span>
</span><span class='line'>                <span class="s">&quot;link&quot;</span><span class="p">:</span> <span class="n">each</span><span class="p">[</span><span class="s">&#39;links&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;href&#39;</span><span class="p">],</span>
</span><span class='line'>                <span class="s">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="s">&#39;term&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">each</span><span class="p">[</span><span class="s">&#39;tags&#39;</span><span class="p">]],</span>
</span><span class='line'>                <span class="s">&quot;date&quot;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">each</span><span class="p">[</span><span class="s">&#39;published_parsed&#39;</span><span class="p">])</span>
</span><span class='line'>            <span class="p">})</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">posts</span>
</span><span class='line'>
</span><span class='line'><span class="n">count</span> <span class="o">=</span> <span class="mi">12</span>
</span><span class='line'>
</span><span class='line'><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;{0}/{1}/&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rss_url</span><span class="p">,</span> <span class="n">count</span><span class="p">))</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span class='line'>        <span class="k">print</span><span class="p">(</span><span class="s">&quot;get succeeded, count at: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">count</span><span class="p">))</span>
</span><span class='line'>        <span class="n">get_posts_for_ghost</span><span class="p">(</span><span class="s">&quot;{0}/{1}/&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rss_url</span><span class="p">,</span> <span class="n">count</span><span class="p">))</span>
</span><span class='line'>        <span class="n">count</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span class='line'>    <span class="k">else</span><span class="p">:</span>
</span><span class='line'>        <span class="k">print</span><span class="p">(</span><span class="s">&quot;got 404, count at: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">count</span><span class="p">))</span>
</span><span class='line'>        <span class="n">count</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">get_posts_for_ghost</span><span class="p">(</span><span class="n">rss_url</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">print</span><span class="p">(</span><span class="n">posts</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Running the script:</h2>

<p>Running the script will look something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>python rssfeed.py
</span><span class='line'>got 404, count at: 12
</span><span class='line'>got 404, count at: 11
</span><span class='line'>got 404, count at: 10
</span><span class='line'>get succeeded, count at: 9
</span><span class='line'>get succeeded, count at: 8
</span><span class='line'>get succeeded, count at: 7
</span><span class='line'>get succeeded, count at: 6
</span><span class='line'>get succeeded, count at: 5
</span><span class='line'>get succeeded, count at: 4
</span><span class='line'>get succeeded, count at: 3
</span><span class='line'>get succeeded, count at: 2
</span><span class='line'>get succeeded, count at: 1
</span><span class='line'><span class="o">[</span>
</span><span class='line'>  <span class="o">{</span>
</span><span class='line'>    <span class="s1">&#39;title&#39;</span>: <span class="s1">&#39;Tutorial on DynamoDB using Bash and the AWS CLI Tools to Interact with a Music Dataset&#39;</span>,
</span><span class='line'>    <span class="s1">&#39;link&#39;</span>: <span class="s1">&#39;https://sysadmins.co.za/tutorial-on-dynamodb-using-bash-and-the-aws-cli-tools-to-interact-with-a-music-dataset/&#39;</span>,
</span><span class='line'>    <span class="s1">&#39;tags&#39;</span>: <span class="o">[</span><span class="s1">&#39;DynamoDB&#39;</span>, <span class="s1">&#39;Bash&#39;</span>, <span class="s1">&#39;AWS&#39;</span><span class="o">]</span>,
</span><span class='line'>    <span class="s1">&#39;date&#39;</span>: <span class="s1">&#39;2018-08-15&#39;</span>
</span><span class='line'>  <span class="o">}</span>,
</span><span class='line'>  <span class="o">{</span>
</span><span class='line'>    <span class="s1">&#39;title&#39;</span>: <span class="s1">&#39;Setup a PPTP VPN on Ubuntu 16&#39;</span>,
</span><span class='line'>    <span class="s1">&#39;link&#39;</span>: <span class="s1">&#39;https://sysadmins.co.za/setup-a-pptp-vpn-on-ubuntu-16/&#39;</span>,
</span><span class='line'>    <span class="s1">&#39;tags&#39;</span>: <span class="o">[</span><span class="s1">&#39;Networking&#39;</span>, <span class="s1">&#39;VPN&#39;</span><span class="o">]</span>,
</span><span class='line'>    <span class="s1">&#39;date&#39;</span>: <span class="s1">&#39;2018-06-27&#39;</span>
</span><span class='line'>  <span class="o">}</span>,
</span><span class='line'>  ...
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2018/08/14/tutorial-on-dynamodb-using-bash-and-the-aws-cli-tools-to-interact-with-a-music-dataset/">Tutorial on DynamoDB Using Bash and the AWS CLI Tools to Interact With a Music Dataset</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2018-08-14T16:33:22-04:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>14</span><span class='date-suffix'>th</span>, <span class='date-year'>2018</span></span> <span class='time'>4:33 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="https://objects.ruanbekker.com/assets/images/aws-logo.png" alt="" /></p>

<p>In this tutorial we will be using Amazons DynamoDB (DynamoDB Local) to host a sample dataset consisting of music data that I retrieved from the iTunes API, which we will be using the aws cli tools to interact with the data.</p>

<p>We will be doing the following:</p>

<ul>
<li>Use Docker to provision a Local DynamoDB Server</li>
<li>Create a DynamoDB Table with a Hash and Range Key</li>
<li>List the Table</li>
<li>Create a Item in DynamoDB</li>
<li>Read a Item from DynamoDB</li>
<li>Read a Item from DynamoDB by specifying the details you would like to read</li>
<li>Batch Write multiple items to DynamoDB</li>
<li>Scan all your Items from DynamoDB</li>
<li>Query by Artist</li>
<li>Query by Artist and Song</li>
<li>Query all the Songs from an Artist starting with a specific letter</li>
<li>Indexes</li>
<li>Delete the Table</li>
</ul>


<p>If you are just getting started with DynamoDB, I recommend having a look at <a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Introduction.html">Amazons DynamoDB Documentation</a> Page first.</p>

<script id="mNCC" language="javascript">
    medianet_width = "728";
    medianet_height = "90";
    medianet_crid = "218284798";
    medianet_versionId = "3111299"; 
  </script>


<script src="//contextual.media.net/nmedianet.js?cid=8CUD78FSV"></script>


<h2>The Music Dataset:</h2>

<p>I used the <a href="https://affiliate.itunes.apple.com/resources/documentation/itunes-store-web-service-search-api/">iTunes API</a> to get the music metadata, but I also have a post on <a href="http://blog.ruanbekker.com/blog/2018/05/08/use-python-requests-to-interact-with-the-itunes-api-to-search-for-music-info/">how to query the iTunes API</a> to get data from them to use.</p>

<p>a Quick way in Python to get the top 10 songs from Guns and Roses, will look like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="s">&#39;https://itunes.apple.com/search?term=guns+and+roses&amp;limit=10&#39;</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Create the DynamoDB Local Server on Docker:</h2>

<p>If you have a AWS Account you can provision your table from there, but if you want to test it locally, you can provision a local DynamoDB Server using Docker:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="err">$</span> <span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">it</span> <span class="o">-</span><span class="n">p</span> <span class="mi">8000</span><span class="p">:</span><span class="mi">8000</span> <span class="o">--</span><span class="n">name</span> <span class="n">dynamodb</span><span class="o">-</span><span class="n">local</span> <span class="n">rbekker87</span><span class="o">/</span><span class="n">dynamodb</span><span class="o">-</span><span class="n">local</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Install the AWS CLI Tools:</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>pip install awscli
</span><span class='line'><span class="nv">$ </span>aws configure
</span><span class='line'><span class="c"># you can enter random data if you are using dynamodb-local</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Create the DynamoDB Table:</h2>

<p>Create a DynamoDB Table named <code>MusicCollection</code> with a <code>Artist (HASH)</code> and <code>SongTitle (RANGE)</code> key attributes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>aws dynamodb create-table --table-name MusicCollection <span class="se">\</span>
</span><span class='line'>  --attribute-definitions <span class="nv">AttributeName</span><span class="o">=</span>Artist,AttributeType<span class="o">=</span>S <span class="nv">AttributeName</span><span class="o">=</span>SongTitle,AttributeType<span class="o">=</span>S <span class="se">\</span>
</span><span class='line'>  --key-schema <span class="nv">AttributeName</span><span class="o">=</span>Artist,KeyType<span class="o">=</span>HASH <span class="nv">AttributeName</span><span class="o">=</span>SongTitle,KeyType<span class="o">=</span>RANGE <span class="se">\</span>
</span><span class='line'>  --provisioned-throughput <span class="nv">ReadCapacityUnits</span><span class="o">=</span>5,WriteCapacityUnits<span class="o">=</span><span class="m">5</span> <span class="se">\</span>
</span><span class='line'>  --endpoint-url http://localhost:8000
</span><span class='line'>
</span><span class='line'>Response:
</span><span class='line'><span class="o">{</span>
</span><span class='line'>    <span class="s2">&quot;TableDescription&quot;</span>: <span class="o">{</span>
</span><span class='line'>        <span class="s2">&quot;TableArn&quot;</span>: <span class="s2">&quot;arn:aws:dynamodb:ddblocal:000000000000:table/MusicCollection&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;AttributeDefinitions&quot;</span>: <span class="o">[</span>
</span><span class='line'>            <span class="o">{</span>
</span><span class='line'>                <span class="s2">&quot;AttributeName&quot;</span>: <span class="s2">&quot;Artist&quot;</span>,
</span><span class='line'>                <span class="s2">&quot;AttributeType&quot;</span>: <span class="s2">&quot;S&quot;</span>
</span><span class='line'>            <span class="o">}</span>,
</span><span class='line'>            <span class="o">{</span>
</span><span class='line'>                <span class="s2">&quot;AttributeName&quot;</span>: <span class="s2">&quot;SongTitle&quot;</span>,
</span><span class='line'>                <span class="s2">&quot;AttributeType&quot;</span>: <span class="s2">&quot;S&quot;</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">]</span>,
</span><span class='line'>        <span class="s2">&quot;ProvisionedThroughput&quot;</span>: <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;NumberOfDecreasesToday&quot;</span>: 0,
</span><span class='line'>            <span class="s2">&quot;WriteCapacityUnits&quot;</span>: 5,
</span><span class='line'>            <span class="s2">&quot;LastIncreaseDateTime&quot;</span>: 0.0,
</span><span class='line'>            <span class="s2">&quot;ReadCapacityUnits&quot;</span>: 5,
</span><span class='line'>            <span class="s2">&quot;LastDecreaseDateTime&quot;</span>: 0.0
</span><span class='line'>        <span class="o">}</span>,
</span><span class='line'>        <span class="s2">&quot;TableSizeBytes&quot;</span>: 0,
</span><span class='line'>        <span class="s2">&quot;TableName&quot;</span>: <span class="s2">&quot;MusicCollection&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;TableStatus&quot;</span>: <span class="s2">&quot;ACTIVE&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;KeySchema&quot;</span>: <span class="o">[</span>
</span><span class='line'>            <span class="o">{</span>
</span><span class='line'>                <span class="s2">&quot;KeyType&quot;</span>: <span class="s2">&quot;HASH&quot;</span>,
</span><span class='line'>                <span class="s2">&quot;AttributeName&quot;</span>: <span class="s2">&quot;Artist&quot;</span>
</span><span class='line'>            <span class="o">}</span>,
</span><span class='line'>            <span class="o">{</span>
</span><span class='line'>                <span class="s2">&quot;KeyType&quot;</span>: <span class="s2">&quot;RANGE&quot;</span>,
</span><span class='line'>                <span class="s2">&quot;AttributeName&quot;</span>: <span class="s2">&quot;SongTitle&quot;</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">]</span>,
</span><span class='line'>        <span class="s2">&quot;ItemCount&quot;</span>: 0,
</span><span class='line'>        <span class="s2">&quot;CreationDateTime&quot;</span>: 1525339294.186
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Listing the Tables:</h2>

<p>List the DynamoDB Table that you created:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>aws dynamodb list-tables --endpoint-url http://localhost:8000
</span><span class='line'>
</span><span class='line'><span class="o">{</span>
</span><span class='line'>    <span class="s2">&quot;TableNames&quot;</span>: <span class="o">[</span>
</span><span class='line'>        <span class="s2">&quot;MusicCollection&quot;</span>
</span><span class='line'>    <span class="o">]</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Create a Item in DynamoDB:</h2>

<p>Add a song from the band <code>Bring me the Horizon</code> called <code>Sleepwalking</code> from the album <code>Sempiternal</code> to the table by using the <code>PutItem</code> call:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>aws dynamodb --endpoint-url http://localhost:8000 put-item --table-name MusicCollection <span class="se">\</span>
</span><span class='line'>  --item <span class="s1">&#39;{&quot;Artist&quot;: {&quot;S&quot;: &quot;Bring me the Horizon&quot;}, &quot;SongTitle&quot;: {&quot;S&quot;: &quot;Sleepwalking&quot;}, &quot;AlbumTitle&quot;: {&quot;S&quot;: &quot;Sempiternal&quot;}}&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Read a Item from DynamoDB</h2>

<p>Get the Song Details from the Table by using the <code>GetItem</code> call:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>aws dynamodb --endpoint-url http://localhost:8000 get-item --table-name MusicCollection <span class="se">\</span>
</span><span class='line'>  --key  <span class="s1">&#39;{&quot;Artist&quot;: {&quot;S&quot;: &quot;Bring me the Horizon&quot;}, &quot;SongTitle&quot;: {&quot;S&quot;: &quot;Sleepwalking&quot;}}&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="o">{</span>
</span><span class='line'>    <span class="s2">&quot;Item&quot;</span>: <span class="o">{</span>
</span><span class='line'>        <span class="s2">&quot;Artist&quot;</span>: <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;S&quot;</span>: <span class="s2">&quot;Bring me the Horizon&quot;</span>
</span><span class='line'>        <span class="o">}</span>,
</span><span class='line'>        <span class="s2">&quot;SongTitle&quot;</span>: <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;S&quot;</span>: <span class="s2">&quot;Sleepwalking&quot;</span>
</span><span class='line'>        <span class="o">}</span>,
</span><span class='line'>        <span class="s2">&quot;AlbumTitle&quot;</span>: <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;S&quot;</span>: <span class="s2">&quot;Sempiternal&quot;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>To only get specific attributes we can use <code>--aatributes-to-get</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>aws dynamodb --endpoint-url http://localhost:8000 get-item --table-name MusicCollection <span class="se">\</span>
</span><span class='line'>  --attributes-to-get <span class="s1">&#39;[&quot;AlbumTitle&quot;, &quot;SongTitle&quot;]&#39;</span> <span class="se">\</span>
</span><span class='line'>  --key  <span class="s1">&#39;{&quot;Artist&quot;: {&quot;S&quot;: &quot;Bring me the Horizon&quot;}, &quot;SongTitle&quot;: {&quot;S&quot;: &quot;Sleepwalking&quot;}}&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="o">{</span>
</span><span class='line'>    <span class="s2">&quot;Item&quot;</span>: <span class="o">{</span>
</span><span class='line'>        <span class="s2">&quot;SongTitle&quot;</span>: <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;S&quot;</span>: <span class="s2">&quot;Sleepwalking&quot;</span>
</span><span class='line'>        <span class="o">}</span>,
</span><span class='line'>        <span class="s2">&quot;AlbumTitle&quot;</span>: <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;S&quot;</span>: <span class="s2">&quot;Sempiternal&quot;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>However, AWS Recommends to use the <code>--projection-expression</code> parameter:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>aws dynamodb --endpoint-url http://localhost:8000 get-item --table-name MusicCollection <span class="se">\</span>
</span><span class='line'>  --projection-expression <span class="s2">&quot;AlbumTitle, SongTitle&quot;</span> <span class="se">\</span>
</span><span class='line'>  --key  <span class="s1">&#39;{&quot;Artist&quot;: {&quot;S&quot;: &quot;Bring me the Horizon&quot;}, &quot;SongTitle&quot;: {&quot;S&quot;: &quot;Sleepwalking&quot;}}&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="o">{</span>
</span><span class='line'>    <span class="s2">&quot;Item&quot;</span>: <span class="o">{</span>
</span><span class='line'>        <span class="s2">&quot;SongTitle&quot;</span>: <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;S&quot;</span>: <span class="s2">&quot;Sleepwalking&quot;</span>
</span><span class='line'>        <span class="o">}</span>,
</span><span class='line'>        <span class="s2">&quot;AlbumTitle&quot;</span>: <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;S&quot;</span>: <span class="s2">&quot;Sempiternal&quot;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/LegacyConditionalParameters.AttributesToGet.html">https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/LegacyConditionalParameters.AttributesToGet.html</a></li>
</ul>


<h2>Batch Write</h2>

<p>Now lets use the <a href="https://affiliate.itunes.apple.com/resources/documentation/itunes-store-web-service-search-api/">iTunes API</a> to get a collection of some songs, which I will dump into a <a href="https://github.com/ruanbekker/dynamodb-local-docker/blob/master/demo/batch-write-songs.json">json file on github</a>. So now that we have a json file with a collection of songs from multiple artists, we can go ahead and write it into our table using the <code>BatchWriteItem</code> call:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>wget https://raw.githubusercontent.com/ruanbekker/dynamodb-local-docker/master/demo/batch-write-songs.json
</span><span class='line'><span class="nv">$ </span>aws dynamodb batch-write-item --request-items file://music-table/batch-write-songs.json --endpoint-url http://localhost:8000
</span></code></pre></td></tr></table></div></figure>


<h2>Scan the Table:</h2>

<p>This can be a very expensive call, as a <code>Scan</code> will return all the items from your table, and depending on the size of your table, you could be throttled, but since we are using dynamodb local and only having 16 items in our table, we can do a scan to return all the items in our table:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>aws dynamodb --endpoint-url http://localhost:8000 scan --table-name MusicCollection
</span><span class='line'><span class="o">{</span>
</span><span class='line'>    <span class="s2">&quot;Count&quot;</span>: 16,
</span></code></pre></td></tr></table></div></figure>


<h2>Query</h2>

<p>Let&rsquo;s start using the <code>Query</code> call to get all the songs from the Artist: AC/DC</p>

<ul>
<li><a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/LegacyConditionalParameters.QueryFilter.html">https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/LegacyConditionalParameters.QueryFilter.html</a></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>aws dynamodb --endpoint-url http://localhost:8000 query --select ALL_ATTRIBUTES <span class="se">\</span>
</span><span class='line'>  --table-name MusicCollection <span class="se">\</span>
</span><span class='line'>  --key-condition-expression <span class="s2">&quot;Artist = :a&quot;</span> <span class="se">\</span>
</span><span class='line'>  --expression-attribute-values  <span class="s1">&#39;{&quot;:a&quot;:{&quot;S&quot;:&quot;AC/DC&quot;}}&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="o">{</span>
</span><span class='line'>    <span class="s2">&quot;Count&quot;</span>: 3,
</span><span class='line'>    <span class="s2">&quot;Items&quot;</span>: <span class="o">[</span>
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;Artist&quot;</span>: <span class="o">{</span>
</span><span class='line'>                <span class="s2">&quot;S&quot;</span>: <span class="s2">&quot;AC/DC&quot;</span>
</span><span class='line'>            <span class="o">}</span>,
</span><span class='line'>            <span class="s2">&quot;SongTitle&quot;</span>: <span class="o">{</span>
</span><span class='line'>                <span class="s2">&quot;S&quot;</span>: <span class="s2">&quot;Back In Black&quot;</span>
</span><span class='line'>            <span class="o">}</span>,
</span><span class='line'>            <span class="s2">&quot;AlbumTitle&quot;</span>: <span class="o">{</span>
</span><span class='line'>                <span class="s2">&quot;S&quot;</span>: <span class="s2">&quot;Back In Black&quot;</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>,
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;Artist&quot;</span>: <span class="o">{</span>
</span><span class='line'>                <span class="s2">&quot;S&quot;</span>: <span class="s2">&quot;AC/DC&quot;</span>
</span><span class='line'>            <span class="o">}</span>,
</span><span class='line'>            <span class="s2">&quot;SongTitle&quot;</span>: <span class="o">{</span>
</span><span class='line'>                <span class="s2">&quot;S&quot;</span>: <span class="s2">&quot;Thunderstruck&quot;</span>
</span><span class='line'>            <span class="o">}</span>,
</span><span class='line'>            <span class="s2">&quot;AlbumTitle&quot;</span>: <span class="o">{</span>
</span><span class='line'>                <span class="s2">&quot;S&quot;</span>: <span class="s2">&quot;The Razors Edge&quot;</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>,
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;Artist&quot;</span>: <span class="o">{</span>
</span><span class='line'>                <span class="s2">&quot;S&quot;</span>: <span class="s2">&quot;AC/DC&quot;</span>
</span><span class='line'>            <span class="o">}</span>,
</span><span class='line'>            <span class="s2">&quot;SongTitle&quot;</span>: <span class="o">{</span>
</span><span class='line'>                <span class="s2">&quot;S&quot;</span>: <span class="s2">&quot;You Shook Me All Night Long&quot;</span>
</span><span class='line'>            <span class="o">}</span>,
</span><span class='line'>            <span class="s2">&quot;AlbumTitle&quot;</span>: <span class="o">{</span>
</span><span class='line'>                <span class="s2">&quot;S&quot;</span>: <span class="s2">&quot;Back in Black&quot;</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">]</span>,
</span><span class='line'>    <span class="s2">&quot;ScannedCount&quot;</span>: 3,
</span><span class='line'>    <span class="s2">&quot;ConsumedCapacity&quot;</span>: null
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Query to get the details of a specific Song from a specific Artist:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>aws dynamodb --endpoint-url http://localhost:8000 query --select ALL_ATTRIBUTES <span class="se">\</span>
</span><span class='line'>  --table-name MusicCollection <span class="se">\</span>
</span><span class='line'>  --key-condition-expression <span class="s2">&quot;Artist = :a and SongTitle = :t&quot;</span> <span class="se">\</span>
</span><span class='line'>  --expression-attribute-values  <span class="s1">&#39;{ &quot;:a&quot;: {&quot;S&quot;: &quot;AC/DC&quot;}, &quot;:t&quot;: {&quot;S&quot;: &quot;You Shook Me All Night Long&quot;}}&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="o">{</span>
</span><span class='line'>    <span class="s2">&quot;Count&quot;</span>: 1,
</span><span class='line'>    <span class="s2">&quot;Items&quot;</span>: <span class="o">[</span>
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;Artist&quot;</span>: <span class="o">{</span>
</span><span class='line'>                <span class="s2">&quot;S&quot;</span>: <span class="s2">&quot;AC/DC&quot;</span>
</span><span class='line'>            <span class="o">}</span>,
</span><span class='line'>            <span class="s2">&quot;SongTitle&quot;</span>: <span class="o">{</span>
</span><span class='line'>                <span class="s2">&quot;S&quot;</span>: <span class="s2">&quot;You Shook Me All Night Long&quot;</span>
</span><span class='line'>            <span class="o">}</span>,
</span><span class='line'>            <span class="s2">&quot;AlbumTitle&quot;</span>: <span class="o">{</span>
</span><span class='line'>                <span class="s2">&quot;S&quot;</span>: <span class="s2">&quot;Back in Black&quot;</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">]</span>,
</span><span class='line'>    <span class="s2">&quot;ScannedCount&quot;</span>: 1,
</span><span class='line'>    <span class="s2">&quot;ConsumedCapacity&quot;</span>: null
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Query to get all the songs from the Beatles that starts with the letter &lsquo;H&rsquo;:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>aws dynamodb --endpoint-url http://localhost:8000 query --select ALL_ATTRIBUTES <span class="se">\</span>
</span><span class='line'>  --table-name MusicCollection <span class="se">\</span>
</span><span class='line'>  --key-condition-expression <span class="s2">&quot;Artist = :a and begins_with(SongTitle, :t)&quot;</span> <span class="se">\</span>
</span><span class='line'>  --expression-attribute-values  <span class="s1">&#39;{&quot;:a&quot;:{&quot;S&quot;:&quot;The Beatles&quot;}, &quot;:t&quot;: {&quot;S&quot;: &quot;h&quot;}}&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="o">{</span>
</span><span class='line'>    <span class="s2">&quot;Count&quot;</span>: 2,
</span><span class='line'>    <span class="s2">&quot;Items&quot;</span>: <span class="o">[</span>
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;Artist&quot;</span>: <span class="o">{</span>
</span><span class='line'>                <span class="s2">&quot;S&quot;</span>: <span class="s2">&quot;The Beatles&quot;</span>
</span><span class='line'>            <span class="o">}</span>,
</span><span class='line'>            <span class="s2">&quot;SongTitle&quot;</span>: <span class="o">{</span>
</span><span class='line'>                <span class="s2">&quot;S&quot;</span>: <span class="s2">&quot;Happy Day&quot;</span>
</span><span class='line'>            <span class="o">}</span>,
</span><span class='line'>            <span class="s2">&quot;AlbumTitle&quot;</span>: <span class="o">{</span>
</span><span class='line'>                <span class="s2">&quot;S&quot;</span>: <span class="s2">&quot;The Beatles 1967-1970 (The Blue Album)&quot;</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>,
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;Artist&quot;</span>: <span class="o">{</span>
</span><span class='line'>                <span class="s2">&quot;S&quot;</span>: <span class="s2">&quot;The Beatles&quot;</span>
</span><span class='line'>            <span class="o">}</span>,
</span><span class='line'>            <span class="s2">&quot;SongTitle&quot;</span>: <span class="o">{</span>
</span><span class='line'>                <span class="s2">&quot;S&quot;</span>: <span class="s2">&quot;Help!&quot;</span>
</span><span class='line'>            <span class="o">}</span>,
</span><span class='line'>            <span class="s2">&quot;AlbumTitle&quot;</span>: <span class="o">{</span>
</span><span class='line'>                <span class="s2">&quot;S&quot;</span>: <span class="s2">&quot;The Beatles Box Set&quot;</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">]</span>,
</span><span class='line'>    <span class="s2">&quot;ScannedCount&quot;</span>: 2,
</span><span class='line'>    <span class="s2">&quot;ConsumedCapacity&quot;</span>: null
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>So our table consists of Artist (HASH) and SongTitle (RANGE), so we can only query based on those attributes. You will find when you try to query on a attribute that is not part of the KeySchema, a exception will be received:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>aws dynamodb --endpoint-url http://localhost:8000 query --select ALL_ATTRIBUTES --table-name MusicCollection --key-condition-expression <span class="s2">&quot;Artist = :a and AlbumTitle = :t&quot;</span> --expression-attribute-values  <span class="s1">&#39;{&quot;:a&quot;:{&quot;S&quot;:&quot;AC/DC&quot;}, &quot;:t&quot;: {&quot;S&quot;: &quot;Back in Black&quot;}}&#39;</span>
</span><span class='line'>
</span><span class='line'>An error occurred <span class="o">(</span>ValidationException<span class="o">)</span> when calling the Query operation: Query condition missed key schema element
</span></code></pre></td></tr></table></div></figure>


<p>So how do we query on a attribute that is not part of the KeySchema? Let&rsquo;s say you want to query all the songs from a Artist and a specific Album.</p>

<h2>Global Secondary Indexes:</h2>

<p>Add Global Secondary Index, with the Attributes: Artist and AlbumTitle.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>aws dynamodb --endpoint-url http://localhost:8000 update-table --table-name MusicCollection <span class="se">\</span>
</span><span class='line'>  --attribute-definitions <span class="nv">AttributeName</span><span class="o">=</span>Artist,AttributeType<span class="o">=</span>S <span class="nv">AttributeName</span><span class="o">=</span>SongTitle,AttributeType<span class="o">=</span>S <span class="nv">AttributeName</span><span class="o">=</span>AlbumTitle,AttributeType<span class="o">=</span>S <span class="se">\</span>
</span><span class='line'>  --global-secondary-index-updates <span class="s2">&quot;Create={&quot;</span>IndexName<span class="s2">&quot;=&quot;</span>album-index<span class="s2">&quot;, &quot;</span>KeySchema<span class="s2">&quot;=[ {&quot;</span>AttributeName<span class="s2">&quot;=&quot;</span>Artist<span class="s2">&quot;, &quot;</span>KeyType<span class="s2">&quot;=&quot;</span>HASH<span class="s2">&quot;}, {&quot;</span>AttributeName<span class="s2">&quot;=&quot;</span>AlbumTitle<span class="s2">&quot;, &quot;</span>KeyType<span class="s2">&quot;=&quot;</span>RANGE<span class="s2">&quot; }], &quot;</span>Projection<span class="s2">&quot;={&quot;</span>ProjectionType<span class="s2">&quot;=&quot;</span>INCLUDE<span class="s2">&quot;, &quot;</span>NonKeyAttributes<span class="s2">&quot;=&quot;</span>AlbumTitle<span class="s2">&quot;}, &quot;</span>ProvisionedThroughput<span class="s2">&quot;= {&quot;</span>ReadCapacityUnits<span class="s2">&quot;=1, &quot;</span>WriteCapacityUnits<span class="s2">&quot;=1} }&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="o">{</span>
</span><span class='line'>    <span class="s2">&quot;TableDescription&quot;</span>: <span class="o">{</span>
</span><span class='line'>        <span class="s2">&quot;TableArn&quot;</span>: <span class="s2">&quot;arn:aws:dynamodb:ddblocal:000000000000:table/MusicCollection&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;AttributeDefinitions&quot;</span>: <span class="o">[</span>
</span><span class='line'>            <span class="o">{</span>
</span><span class='line'>                <span class="s2">&quot;AttributeName&quot;</span>: <span class="s2">&quot;Artist&quot;</span>,
</span><span class='line'>                <span class="s2">&quot;AttributeType&quot;</span>: <span class="s2">&quot;S&quot;</span>
</span><span class='line'>            <span class="o">}</span>,
</span><span class='line'>            <span class="o">{</span>
</span><span class='line'>                <span class="s2">&quot;AttributeName&quot;</span>: <span class="s2">&quot;SongTitle&quot;</span>,
</span><span class='line'>                <span class="s2">&quot;AttributeType&quot;</span>: <span class="s2">&quot;S&quot;</span>
</span><span class='line'>            <span class="o">}</span>,
</span><span class='line'>            <span class="o">{</span>
</span><span class='line'>                <span class="s2">&quot;AttributeName&quot;</span>: <span class="s2">&quot;AlbumTitle&quot;</span>,
</span><span class='line'>                <span class="s2">&quot;AttributeType&quot;</span>: <span class="s2">&quot;S&quot;</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">]</span>,
</span><span class='line'>        <span class="s2">&quot;GlobalSecondaryIndexes&quot;</span>: <span class="o">[</span>
</span><span class='line'>            <span class="o">{</span>
</span><span class='line'>                <span class="s2">&quot;IndexName&quot;</span>: <span class="s2">&quot;album-index&quot;</span>,
</span><span class='line'>                <span class="s2">&quot;Projection&quot;</span>: <span class="o">{</span>
</span><span class='line'>                    <span class="s2">&quot;ProjectionType&quot;</span>: <span class="s2">&quot;INCLUDE&quot;</span>,
</span><span class='line'>                    <span class="s2">&quot;NonKeyAttributes&quot;</span>: <span class="o">[</span>
</span><span class='line'>                        <span class="s2">&quot;AlbumTitle&quot;</span>
</span><span class='line'>                    <span class="o">]</span>
</span><span class='line'>                <span class="o">}</span>,
</span><span class='line'>                <span class="s2">&quot;ProvisionedThroughput&quot;</span>: <span class="o">{</span>
</span><span class='line'>                    <span class="s2">&quot;WriteCapacityUnits&quot;</span>: 1,
</span><span class='line'>                    <span class="s2">&quot;ReadCapacityUnits&quot;</span>: 1
</span><span class='line'>                <span class="o">}</span>,
</span><span class='line'>                <span class="s2">&quot;IndexStatus&quot;</span>: <span class="s2">&quot;CREATING&quot;</span>,
</span><span class='line'>                <span class="s2">&quot;Backfilling&quot;</span>: <span class="nb">false</span>,
</span><span class='line'>                <span class="s2">&quot;KeySchema&quot;</span>: <span class="o">[</span>
</span><span class='line'>                    <span class="o">{</span>
</span><span class='line'>                        <span class="s2">&quot;KeyType&quot;</span>: <span class="s2">&quot;HASH&quot;</span>,
</span><span class='line'>                        <span class="s2">&quot;AttributeName&quot;</span>: <span class="s2">&quot;Artist&quot;</span>
</span><span class='line'>                    <span class="o">}</span>,
</span><span class='line'>                    <span class="o">{</span>
</span><span class='line'>                        <span class="s2">&quot;KeyType&quot;</span>: <span class="s2">&quot;RANGE&quot;</span>,
</span><span class='line'>                        <span class="s2">&quot;AttributeName&quot;</span>: <span class="s2">&quot;AlbumTitle&quot;</span>
</span><span class='line'>                    <span class="o">}</span>
</span><span class='line'>                <span class="o">]</span>,
</span><span class='line'>                <span class="s2">&quot;IndexArn&quot;</span>: <span class="s2">&quot;arn:aws:dynamodb:ddblocal:000000000000:table/MusicCollection/index/album-index&quot;</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">]</span>,
</span><span class='line'>        <span class="s2">&quot;ProvisionedThroughput&quot;</span>: <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;NumberOfDecreasesToday&quot;</span>: 0,
</span><span class='line'>            <span class="s2">&quot;WriteCapacityUnits&quot;</span>: 5,
</span><span class='line'>            <span class="s2">&quot;LastIncreaseDateTime&quot;</span>: 0.0,
</span><span class='line'>            <span class="s2">&quot;ReadCapacityUnits&quot;</span>: 5,
</span><span class='line'>            <span class="s2">&quot;LastDecreaseDateTime&quot;</span>: 0.0
</span><span class='line'>        <span class="o">}</span>,
</span><span class='line'>        <span class="s2">&quot;TableSizeBytes&quot;</span>: 984,
</span><span class='line'>        <span class="s2">&quot;TableName&quot;</span>: <span class="s2">&quot;MusicCollection&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;TableStatus&quot;</span>: <span class="s2">&quot;ACTIVE&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;KeySchema&quot;</span>: <span class="o">[</span>
</span><span class='line'>            <span class="o">{</span>
</span><span class='line'>                <span class="s2">&quot;KeyType&quot;</span>: <span class="s2">&quot;HASH&quot;</span>,
</span><span class='line'>                <span class="s2">&quot;AttributeName&quot;</span>: <span class="s2">&quot;Artist&quot;</span>
</span><span class='line'>            <span class="o">}</span>,
</span><span class='line'>            <span class="o">{</span>
</span><span class='line'>                <span class="s2">&quot;KeyType&quot;</span>: <span class="s2">&quot;RANGE&quot;</span>,
</span><span class='line'>                <span class="s2">&quot;AttributeName&quot;</span>: <span class="s2">&quot;SongTitle&quot;</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">]</span>,
</span><span class='line'>        <span class="s2">&quot;ItemCount&quot;</span>: 15,
</span><span class='line'>        <span class="s2">&quot;CreationDateTime&quot;</span>: 1525339294.186
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now when we use the same query, but we specify our index, we will get the data:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>aws dynamodb --endpoint-url http://localhost:8000 query <span class="se">\</span>
</span><span class='line'>  --select ALL_ATTRIBUTES <span class="se">\</span>
</span><span class='line'>  --table-name MusicCollection <span class="se">\</span>
</span><span class='line'>  --index-name album-index <span class="se">\</span>
</span><span class='line'>  --key-condition-expression <span class="s2">&quot;Artist = :a and AlbumTitle = :t&quot;</span> <span class="se">\</span>
</span><span class='line'>  --expression-attribute-values  <span class="s1">&#39;{&quot;:a&quot;:{&quot;S&quot;:&quot;AC/DC&quot;}, &quot;:t&quot;: {&quot;S&quot;: &quot;Back in Black&quot;}}&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="o">{</span>
</span><span class='line'>    <span class="s2">&quot;Count&quot;</span>: 1,
</span><span class='line'>    <span class="s2">&quot;Items&quot;</span>: <span class="o">[</span>
</span><span class='line'>        <span class="o">{</span>
</span><span class='line'>            <span class="s2">&quot;Artist&quot;</span>: <span class="o">{</span>
</span><span class='line'>                <span class="s2">&quot;S&quot;</span>: <span class="s2">&quot;AC/DC&quot;</span>
</span><span class='line'>            <span class="o">}</span>,
</span><span class='line'>            <span class="s2">&quot;SongTitle&quot;</span>: <span class="o">{</span>
</span><span class='line'>                <span class="s2">&quot;S&quot;</span>: <span class="s2">&quot;You Shook Me All Night Long&quot;</span>
</span><span class='line'>            <span class="o">}</span>,
</span><span class='line'>            <span class="s2">&quot;AlbumTitle&quot;</span>: <span class="o">{</span>
</span><span class='line'>                <span class="s2">&quot;S&quot;</span>: <span class="s2">&quot;Back in Black&quot;</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">]</span>,
</span><span class='line'>    <span class="s2">&quot;ScannedCount&quot;</span>: 1,
</span><span class='line'>    <span class="s2">&quot;ConsumedCapacity&quot;</span>: null
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Delete the Table:</h2>

<p>Delete the Table that we created:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>aws dynamodb --endpoint-url http://localhost:8000 delete-table --table-name MusicCollection
</span></code></pre></td></tr></table></div></figure>


<h2>Resources:</h2>

<ul>
<li><a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/SQLtoNoSQL.ReadData.Query.html">https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/SQLtoNoSQL.ReadData.Query.html</a></li>
<li><a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/SQLtoNoSQL.Indexes.html">https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/SQLtoNoSQL.Indexes.html</a></li>
<li><a href="https://affiliate.itunes.apple.com/resources/documentation/itunes-store-web-service-search-api/">https://affiliate.itunes.apple.com/resources/documentation/itunes-store-web-service-search-api/</a></li>
</ul>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/6">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/4">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Subscribe</h1>
  <!-- Begin MailChimp Signup Form -->
  <div id="mc_embed_signup">
  <form action="https://sysadmins.us15.list-manage.com/subscribe/post?u=3dfcff447b6ee598231eeb658&amp;id=3542f323a9" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
      <div class="indicates-required"><span class="asterisk"></span></div>
      <div class="mc-field-group">
	<label for="mce-EMAIL">Email Address:  <span class="asterisk"></span>
        </label>
	<input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL">
        </div>
	<div id="mce-responses" class="clear">
	  <div class="response" id="mce-error-response" style="display:none"></div>
	  <div class="response" id="mce-success-response" style="display:none"></div>
	</div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
      <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_3dfcff447b6ee598231eeb658_3542f323a9" tabindex="-1" value=""></div>
    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
    </div>
  </form>
</div>
<!--End mc_embed_signup-->
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2019/02/07/the-aws-cli-cheatsheet-for-bash/">The AWS CLI Cheatsheet for Bash</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/02/05/python-multiprocessing-tutorial/">Python Multiprocessing Tutorial</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/02/05/convert-float-to-decimal-data-types-for-boto3-dynamodb-using-python/">Convert Float to Decimal Data Types for Boto3 DynamoDB Using Python</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/01/29/paginate-through-iam-users-on-aws-using-python-and-boto3/">Paginate Through IAM Users on AWS Using Python and Boto3</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/01/10/setup-a-3-node-docker-swarm-cluster-on-ubuntu-16-dot-04/">Setup a 3 Node Docker Swarm Cluster on Ubuntu 16.04</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2019 - Ruan -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>



  <li>
    <a href="https://twitter.com/ruanbekker">
      <i class="fa fa-twitter"></i> Twitter
    </a>
  </li>



  <li>
    <a href="https://github.com/ruanbekker">
      <i class="fa fa-github"></i> GitHub
    </a>
  </li>



  <li>
    <a href="https://sysadmins.co.za">
      <i class="fa fa-bars"></i> My HowTo Blog
    </a>
  </li>


</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'blog-ruanbekker';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
